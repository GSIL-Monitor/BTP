(function(d,f){var c=d.mobiscroll,b=c.util,a=b.isString,e={batch:40,inputClass:"",invalid:[],rtl:false,showInput:true,groupLabel:"Groups",checkIcon:"checkmark",dataText:"text",dataValue:"value",dataGroup:"group",dataDisabled:"disabled"};c.presetShort("select");c.presets.scroller.select=function(M){var j,v,A,L,D,h,O,af,k,t,q,U,H,aj,J,l={},ah={},C={},w={},ae={},g=d.extend({},M.settings),W=d.extend(M.settings,e,g),m=W.batch,K=W.layout||(/top|bottom/.test(W.display)?"liquid":""),G=K=="liquid",ag=d(this),Q=W.multiple||ag.prop("multiple"),P=b.isNumeric(W.multiple)?W.multiple:Infinity,S=this.id+"_dummy",y=d('label[for="'+this.id+'"]').attr("for",S),Z=W.label!==f?W.label:(y.length?y.text():ag.attr("name")),u="dw-msel mbsc-ic mbsc-ic-"+W.checkIcon,Y=W.readonly,ai=W.data,R=!!ai,ad=R?!!W.group:d("optgroup",ag).length,T=W.group,aa=ad&&T&&T.groupWheel!==false,ac=ad&&T&&aa&&T.clustered===true,B=ad&&(!T||(T.header!==false&&!ac)),ak=ag.val()||[],V=[],I={},E={},o={};function N(){var am,ao,an,i,ap,s=0,aq=0,al={};E={};o={};t=[];L=[];V.length=0;if(R){d.each(W.data,function(at,ar){i=ar[W.dataText];ap=ar[W.dataValue];ao=ar[W.dataGroup];an={value:ap,text:i,index:at};E[ap]=an;t.push(an);if(ad){if(al[ao]===f){am={text:ao,value:aq,options:[],index:aq};o[aq]=am;al[ao]=aq;L.push(am);aq++}else{am=o[al[ao]]}if(ac){an.index=am.options.length}an.group=al[ao];am.options.push(an)}if(ar[W.dataDisabled]){V.push(ap)}})}else{if(ad){d("optgroup",ag).each(function(ar){o[ar]={text:this.label,value:ar,options:[],index:ar};L.push(o[ar]);d("option",this).each(function(at){an={value:this.value,text:this.text,index:ac?at:s++,group:ar};E[this.value]=an;t.push(an);o[ar].options.push(an);if(this.disabled){V.push(this.value)}})})}else{d("option",ag).each(function(ar){an={value:this.value,text:this.text,index:ar};E[this.value]=an;t.push(an);if(this.disabled){V.push(this.value)}})}}if(t.length){v=t[0].value}if(B){t=[];s=0;d.each(o,function(at,ar){ap="__group"+at;an={text:ar.text,value:ap,group:at,index:s++};E[ap]=an;t.push(an);V.push(an.value);d.each(ar.options,function(au,av){av.index=s++;t.push(av)})})}}function F(av,an,ar,au,ap,ay,at){var ao,aq,ax=[],aw=[],al=ar[au]!==f?ar[au].index:0,s=Math.max(0,al-m),am=Math.min(an.length-1,s+m*2);if(ah[ap]!==s||C[ap]!==am){for(ao=s;ao<=am;ao++){aw.push(an[ao].text);ax.push(an[ao].value)}l[ap]=true;w[ap]=s;ae[ap]=am;aq={multiple:ay,values:aw,keys:ax,label:at};if(G){av[0][ap]=aq}else{av[ap]=[aq]}}else{l[ap]=false}}function ab(i){F(i,L,o,A,O,false,W.groupLabel)}function p(i){F(i,ac?o[A].options:t,E,U,q,Q,Z)}function X(){var i=[[]];if(aa){ab(i)}p(i);return i}function r(i){if(Q){if(i&&a(i)){i=i.split(",")}if(d.isArray(i)){i=i[0]}}U=i===f||i===null||i===""||!E[i]?v:i;if(aa){A=E[U]?E[U].group:null;aj=A}}function z(i,s){var al=i?M._tempWheelArray:(M._hasValue?M._wheelArray:null);return al?(W.group&&s?al:al[q]):null}function x(){var s,an,am=[],al=0;if(Q){an=[];for(al in I){am.push(E[al]?E[al].text:"");an.push(al)}s=am.join(", ")}else{an=U;s=E[U]?E[U].text:""}M._tempValue=an;k.val(s);ag.val(an)}function n(i){var al=i.attr("data-val"),s=i.hasClass("dw-msel");if(Q&&i.closest(".dwwl").hasClass("dwwms")){if(i.hasClass("dw-v")){if(s){i.removeClass(u).removeAttr("aria-selected");delete I[al]}else{if(b.objectToArray(I).length<P){i.addClass(u).attr("aria-selected","true");I[al]=al}}}return false}else{if(i.hasClass("dw-w-gr")){h=i.attr("data-val")}}}if(!W.invalid.length){W.invalid=V}if(aa){O=0;q=1}else{O=-1;q=0}if(Q){ag.prop("multiple",true);if(ak&&a(ak)){ak=ak.split(",")}for(af=0;af<ak.length;af++){I[ak[af]]=ak[af]}}N();r(ag.val());d("#"+S).remove();if(ag.next().is("input.mbsc-control")){k=ag.off(".mbsc-form").next().removeAttr("tabindex")}else{k=d('<input type="text" id="'+S+'" class="mbsc-control mbsc-control-ev '+W.inputClass+'" readonly />');if(W.showInput){k.insertBefore(ag)}}M.attachShow(k.attr("placeholder",W.placeholder||""));ag.addClass("dw-hsel").attr("tabindex",-1).closest(".ui-field-contain").trigger("create");x();M.setVal=function(am,al,an,i,s){if(Q){if(am&&a(am)){am=am.split(",")}I=b.arrayToObject(am);am=am?am[0]:null}M._setVal(am,al,an,i,s)};M.getVal=function(i,s){if(Q){return b.objectToArray(I)}return z(i,s)};M.refresh=function(){N();ah={};C={};W.wheels=X();ah[O]=w[O];C[O]=ae[O];ah[q]=w[q];C[q]=ae[q];j=true;r(U);M._tempWheelArray=aa?[A,U]:[U];if(M._isVisible){M.changeWheel(aa?[O,q]:[q],0,true)}};M.getValues=M.getVal;M.getValue=z;return{width:50,layout:K,headerText:false,anchor:k,confirmOnTap:aa?[false,true]:true,formatValue:function(an){var al,s,am=[];if(Q){for(al in I){am.push(E[al]?E[al].text:"")}return am.join(", ")}s=an[q];return E[s]?E[s].text:""},parseValue:function(i){r(i===f?ag.val():i);return aa?[A,U]:[U]},onValueTap:n,onValueFill:x,onBeforeShow:function(){if(Q&&W.counter){W.headerText=function(){var i=0;d.each(I,function(){i++});return(i>1?W.selectedPluralText||W.selectedText:W.selectedText).replace(/{count}/,i)}}r(ag.val());if(aa){M._tempWheelArray=[A,U]}M.refresh()},onMarkupReady:function(i){i.addClass("dw-select");d(".dwwl"+O,i).on("mousedown touchstart",function(){clearTimeout(J)});d(".dwwl"+q,i).on("mousedown touchstart",function(){if(!D){clearTimeout(J)}});if(B){d(".dwwl"+q,i).addClass("dw-select-gr")}if(Q){i.addClass("dwms");d(".dwwl",i).on("keydown",function(s){if(s.keyCode==32){s.preventDefault();s.stopPropagation();n(d(".dw-sel",this))}}).eq(q).attr("aria-multiselectable","true");H=d.extend({},I)}},validate:function(al,aq,am,an){var ao,av,au=[],aw=M.getArrayVal(true),s=aw[O],ap=aw[q],at=d(".dw-ul",al).eq(O),ar=d(".dw-ul",al).eq(q);if(ah[O]>1){d(".dw-li",at).slice(0,2).removeClass("dw-v").addClass("dw-fv")}if(C[O]<L.length-2){d(".dw-li",at).slice(-2).removeClass("dw-v").addClass("dw-fv")}if(ah[q]>1){d(".dw-li",ar).slice(0,2).removeClass("dw-v").addClass("dw-fv")}if(C[q]<(ac?o[s].options:t).length-2){d(".dw-li",ar).slice(-2).removeClass("dw-v").addClass("dw-fv")}if(!j){U=ap;if(aa){A=E[U].group;if(aq===f||aq===O){A=+aw[O];D=false;if(A!==aj){U=o[A].options[0].value;ah[q]=null;C[q]=null;D=true;W.readonly=[false,true]}else{W.readonly=Y}}}if(ad&&(/__group/.test(U)||h)){U=o[E[h||U].group].options[0].value;ap=U;h=false}M._tempWheelArray=aa?[s,ap]:[ap];if(aa){ab(W.wheels);if(l[O]){au.push(O)}}p(W.wheels);if(l[q]){au.push(q)}clearTimeout(J);J=setTimeout(function(){if(au.length){j=true;D=false;aj=A;ah[O]=w[O];C[O]=ae[O];ah[q]=w[q];C[q]=ae[q];M._tempWheelArray=aa?[s,U]:[U];M.changeWheel(au,0,aq!==f)}if(aa){if(aq===q){M.scroll(at,O,M.getValidCell(A,at,an,false,true).v,0.1)}M._tempWheelArray[O]=A}W.readonly=Y},aq===f?100:am*1000);if(au.length){return D?false:true}}if(aq===f&&Q){av=I;ao=0;d(".dwwl"+q+" .dw-li",al).removeClass(u).removeAttr("aria-selected");for(ao in av){d(".dwwl"+q+' .dw-li[data-val="'+av[ao]+'"]',al).addClass(u).attr("aria-selected","true")}}if(B){d('.dw-li[data-val^="__group"]',al).addClass("dw-w-gr")}d.each(W.invalid,function(ay,ax){d('.dw-li[data-val="'+ax+'"]',ar).removeClass("dw-v dw-fv")});j=false},onValidated:function(){U=M._tempWheelArray[q]},onClear:function(i){I={};k.val("");d(".dwwl"+q+" .dw-li",i).removeClass(u).removeAttr("aria-selected")},onCancel:function(){if(!M.live&&Q){I=d.extend({},H)}},onDestroy:function(){if(!k.hasClass("mbsc-control")){k.remove()}ag.removeClass("dw-hsel").removeAttr("tabindex")}}}})(jQuery);