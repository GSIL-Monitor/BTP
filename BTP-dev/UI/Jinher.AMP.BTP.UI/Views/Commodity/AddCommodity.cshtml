@using System.Web
@using System.Web.Script.Serialization
@{
    ViewBag.Title = "商品发布";
    List<Jinher.AMP.BTP.Deploy.SecondAttributeDTO> Colorlist = ViewBag.Colorlist;
    List<Jinher.AMP.BTP.Deploy.SecondAttributeDTO> Sizelist = ViewBag.Sizelist;
    List<Jinher.AMP.BTP.Deploy.CustomDTO.CategorySDTO> categorylist = ViewBag.CategoryList;
    List<Jinher.AMP.BTP.Deploy.CustomDTO.CategorySDTO> innerCategorylist = ViewBag.InnerCategoryList;
    List<Jinher.AMP.BTP.Deploy.CustomDTO.CategorySDTO> EsCategoryList = ViewBag.EsCategoryList;
    Jinher.AMP.BTP.Deploy.CustomDTO.CommodityCookie commodityCookie = ViewBag.Cookie;

    List<Jinher.AMP.BTP.Deploy.CustomDTO.ColorAndSizeAttributeVM> AttributeList = ViewBag.AttributeList;
    bool isCustomES = ViewBag.isCustomES;

    string selfTakeChk = "";
    if (commodityCookie != null)
    {
        selfTakeChk = commodityCookie.IsEnableSelfTake == 0 ? "" : "checked='checked'";
    }

    bool isShowCategoryTree = ViewBag.IsShowCategoryTree;
    string ctreeDisplay = isShowCategoryTree ? "block" : "none";
    if (!isShowCategoryTree && commodityCookie != null)
    {
        commodityCookie.CommoditCategoryName = "";
        commodityCookie.CommoditCategory = null;
    }
}
@helper getUrlParam()
{
    string url = "flag=add";
    if (Request.QueryString["state"] != null)
    {
        url = url + "&state=" + Request.QueryString["state"].ToString();
    }
    if (Request.QueryString["appId"] != null)
    {
        url = url + "&appId=" + Request.QueryString["appId"].ToString();
    }
    if (Request.QueryString["userId"] != null)
    {
        url = url + "&userId=" + Request.QueryString["userId"].ToString();
    }

    @url;
}
<head>
    <!--<link href="/Scripts/ueditor_mini/dialogs/video/video.css" type="text/css" rel="stylesheet" />-->
    <!--富文本使用-->
    <link href="/Scripts/ueditor_mini/themes/default/css/umeditor.min.css" type="text/css"
          rel="stylesheet" />
    <link href="/Scripts/ueditor_mini/dialogs/image/image.css" type="text/css" rel="stylesheet" />
    <link rel="Stylesheet" type="text/css" href="/Scripts/japaginator/bootstrap.min.css" />
    <script type="text/javascript" src="/Scripts/ueditor_mini/umeditor.config.js"></script>
    <script type="text/javascript" src="/Scripts/ueditor_mini/umeditor.min.js"></script>
    <script type="text/javascript" src="/Scripts/ueditor_mini/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript" src="/Scripts/ueditor_mini/dialogs/link/link.js"></script>
    <script type="text/javascript" src="/Scripts/ueditor_mini/dialogs/image/image.js"></script>
    <script type="text/javascript" src="/Scripts/Validator/JValidator.js"></script>
    <script type="text/javascript" src="/Scripts/uploadify/jquery.uploadify.min.js"></script>
    <!--弹出选择框使用-->
    <script type="text/javascript" src="/Scripts/jquery.watermark.js"></script>
    <link rel="stylesheet" type="text/css" href="/Content/default/jquery.ui.jhtablebox.css" />
    <script type="text/javascript" src="/Scripts/TableBox/jquery.ui.jhtablebox.js"></script>
    <script type="text/javascript" src="/Scripts/japaginator/jqPaginator.js"></script>
    <style type="text/css">
        .input input {
            vertical-align: -2px;
            _vertical-align: -1px;
            margin-right: 2px;
        }

        .txtColor {
            color: #8c94a9;
        }

        .floa2 h1,
        .floa1 h1,
        .floa11 h1,
        .bbtn h1 {
            font-size: 14px;
            color: #8c94a9;
            padding-bottom: 5px;
            border-bottom: 1px solid #DDDDDD;
        }

        .close {
            margin-top: 10px;
            float: right;
            display: inline-block;
            *zoom: 1;
            *display: inline;
            width: 7px;
            height: 7px;
            color: transparent;
            background: url('/Images/shut.png') center no-repeat;
        }

        .floa11 ul,
        .floa1 ul,
        .floa2 ul {
            padding: 0 0 10px 10px;
        }

            .floa11 ul li,
            .floa1 ul li
            .floa2 ul li {
                margin-top: 5px;
                color: #8c94a9;
            }

        .addfloa2 {
            display: none;
            padding: 5px 10px;
            height: auto;
            border: 1px solid #B8BFCF;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
        }

        .btn120 {
            display: inline-block;
            width: 120px;
            height: 28px;
            line-height: 28px;
            background: url('/Content/default/images/btn120.png') no-repeat;
            text-align: center;
            vertical-align: middle;
            color: #5F7392;
            box-shadow: 1px 1px 2px #DBDBDB;
        }

        .createtable {
            border: 1px solid #B1CDE3;
            padding: 0;
            margin: 0 auto;
            border-collapse: collapse;
            width: 100%;
        }

            .createtable td {
                border: 1px solid #B1CDE3;
                background: #fff;
                font-size: 12px;
                padding: 3px 3px 3px 8px;
                color: #4f6b72;
            }

        #batchUploadA:hover {
            color: #007fff;
            text-decoration: underline;
        }

        #batchUploadA {
            color: #2f94ff;
            text-decoration: underline;
        }

        .uploadify {
            box-shadow: 1px 1px 2px #dbdbdb;
            color: #5f7392;
            display: inline-block;
            height: 28px;
            line-height: 28px;
            text-align: center;
            vertical-align: middle;
            width: 120px;
        }

        .uploadify-button, .uploadify-button-text {
            text-indent: 0 !important;
        }

        .spa span {
            margin: 0;
        }

        /*********************商品SKU图片*********************/
        .spfb_t_r {
            margin-left: -500px;
        }

        .comSKUPic {
            position: relative;
            top: 0;
            left: 0;
        }

            .comSKUPic span {
                margin-left: 0px;
                color: #007fff;
                text-decoration: underline;
            }

            .comSKUPic object {
                margin-left: -30px;
            }

        .createtable .uploadify {
            box-shadow: none;
        }

        .createtable .uploadify-button {
            background-image: none !important;
        }

        .createtable .comSKUPic .del {
            position: absolute;
            top: -6px;
            left: 50%;
            margin-left: 30px;
            background: #555;
            color: #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 12px;
            line-height: 14px;
            text-decoration: none;
        }

        .uploadify-queue {
            margin-bottom: 1em
        }

        .uploadify-queue-item {
            background-color: #F5F5F5;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font: 11px Verdana,Geneva,sans-serif;
            margin-top: 5px;
            max-width: 350px;
            padding: 10px
        }

            .uploadify-queue-item .cancel a {
                background: url('/Images/uploadify-cancel.png') 0 0 no-repeat;
                float: right;
                height: 16px;
                text-indent: -9999px;
                width: 16px
            }

            .uploadify-queue-item.completed {
                background-color: #E5E5E5
            }

        .uploadify-progress {
            background-color: #E5E5E5;
            margin-top: 10px;
            width: 100%
        }

        .uploadify-progress-bar {
            background-color: #09F;
            height: 3px;
            width: 1px
        }

        .uploadify-error {
            background-color: #FDE5DD !important
        }

        #tabContainer {
            margin: 0 auto;
        }

        ul.tabs {
            margin: 0px;
            padding: 0px;
            list-style: none;
        }

            ul.tabs li {
                background: none;
                color: #222;
                display: inline-block;
                padding: 10px 15px;
                cursor: pointer;
            }

                ul.tabs li.current {
                    background: #ededed;
                    color: #222;
                }

        .tab-content {
            display: none;
            background: #ededed;
            padding: 15px;
        }

            .tab-content.current {
                display: inherit;
            }
    </style>
    <script type="text/javascript">
    var freightList = JSON.parse('@Html.Raw(ViewBag.FreightList)');
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    document.ondragstart = function () { return true; }

    $(function () {
        $("#comdtyPicBtn").hide();
        initUplodaImg();
        initUplodaCommodityListPic();
        if ($("#VideoName").html()) {
            $("#deleVideo").show();
        }
        $('#changecategory').attr('href', '/Category/EsNetIndex?callBack=' + encodeURIComponent(window.location.href));
        $('#changeInnerCategory').attr('href', '/InnerCategory/EsNetIndex?callBack=' + encodeURIComponent(window.location.href));
        var OrgUrl = "@ViewBag.OrgUrl";

        if (OrgUrl != "") {
            $("#div3").OpenDiv();
            if (window.parent) { //在iframe页面打开时，纠正top
                $("#div3").css("top", 200 + $(window.parent.document).scrollTop());
            }
        }
        if (!getQueryString("state")) {
            $("#btnCancel").css("display", "none");
        }
        if (getQueryString("state") == 1 || getQueryString("state") == 2) {
            $("#btnSubmit").text("保存");
        }

        $(".an1").bind("click", function () {
            window.parent.openMenu("publisherInfo");
        });
        $("#commoditycategory,#commoditysize,#commoditycolor,#commodityInnerCategory,#commodityTaxClassCode,#commoditybrand,#commodityEsCategory").focus(function () {
            if (this.value == '请选择') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请选择';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请选择') {
                $(this).addClass("txtColor");
            }
        });
        $("#commoditycode").focus(function () {
            var noCode = this.value;
            var $span = $(this).next();
            if (noCode.length >= 30) {
                $span.html("最多可输入30位字符");
            } else {
                $span.html("");
            }
        }).keyup(function () {
            var noCode = this.value;
            var $span = $(this).next();
            if (noCode.length >= 30) {
                $span.html("最多可输入30位字符");
            } else {
                $span.html("");
            }
        }).blur(function () {
            var noCode = this.value;
            var $span = $(this).next();
            $span.html("");
            if (noCode != '') {
                $.ajax({
                    url: '/Commodity/IsExistsNoCode',
                    type: 'post',
                    async: true,
                    dataType: "json",
                    data: { noCode: noCode, appId: getQueryString('appId') },
                    error: function () {
                        $("#ajaxLoadBlind").remove();
                        alert("请求错误，请稍后刷新进行操作.");
                    },
                    success: function (msg) {
                        $("#ajaxLoadBlind").remove();
                        if (msg.ResultCode == 1) {
                            $span.html("商品编号不能重复，该编号已存在");
                            return;
                        }
                        $span.html("");
                    },
                    beforeSend: function () {
                        ajaxLoading('1', '');
                    }
                });
            }
        });

        //选择“虚拟商品（卡密）”后，出现“活动编码”和“类型编码”;
        $("input[name=rdoCommodityType]").change(function () {
            switch ($("input[name=rdoCommodityType]:checked").attr("value")) {
                case "0":
                    $("#liYJCouponActivityId").hide();
                    $("#liYJCouponType").hide();
                    break;
                case "1":
                   $("#liYJCouponActivityId").show();
                   $("#liYJCouponType").show();
                    break;
                default:
                    break;
            }
        });


        //商品编码验证
        $("#YJCouponActivityId").focus(function () {
                if (this.value == '最多60个字') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '最多60个字';
                    $(this).addClass("txtColor");
                }
                updateRight();
            }).each(function () {
                if (this.value == '最多60个字') {
                    $(this).addClass("txtColor");
                }
            });
         //类型编码验证
        $("#YJCouponType").focus(function () {
                if (this.value == '最多60个字') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '最多60个字';
                    $(this).addClass("txtColor");
                }
                updateRight();
            }).each(function () {
                if (this.value == '最多60个字') {
                    $(this).addClass("txtColor");
                }
            });

        if ('@isCustomES'.toLowerCase() == 'false') {
            $("#commodityname").focus(function () {

                if (this.value == '最多30个字') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '最多30个字';
                    $(this).addClass("txtColor");
                }
                updateRight();
            }).each(function () {
                if (this.value == '最多30个字') {
                    $(this).addClass("txtColor");
                }
            });
        } else {
            $("#commodityname").focus(function () {
                if (this.value == '最多60个字') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '最多60个字';
                    $(this).addClass("txtColor");
                }
                updateRight();
            }).each(function () {
                if (this.value == '最多60个字') {
                    $(this).addClass("txtColor");
                }
            });
        }
        $("#commoditymarketprice").focus(function () {
            if (this.value == '请输入正数最多两位小数') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入正数最多两位小数';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请输入正数，最多两位小数') {
                $(this).addClass("txtColor");
            }
        });
        $("#commodityprice").focus(function () {
            if (this.value == '请输入正数最多两位小数') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入正数最多两位小数';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请输入正数，最多两位小数') {
                $(this).addClass("txtColor");
            }
            });

        $("#costPrice").focus(function () {
            if (this.value == '请输入正数最多两位小数' || this.value == '请填写含税进货价') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入正数最多两位小数';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请输入正数，最多两位小数') {
                $(this).addClass("txtColor");
            }
        });

        @if(ViewBag.IsYJBJ)
        {
        <text>
        $("#barCode").focus(function () {
            if (this.value == '请输入商品条形码') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入商品条形码';
                $(this).addClass("txtColor");
            }
        });

        </text>
        }

        $("#commodityInputTax").focus(function () {
            if (this.value == '请输入正数最多两位小数') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入正数最多两位小数';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请输入正数，最多两位小数') {
                $(this).addClass("txtColor");
            }
        });
        $("#commodityduty").focus(function () {
            if (this.value == '请输入正数最多两位小数') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入正数最多两位小数';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请输入正数，最多两位小数') {
                $(this).addClass("txtColor");
            }
        });
        $("#commodityTaxRate").focus(function () {
            if (this.value == '请输入正数最多两位小数') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入正数最多两位小数';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请输入正数，最多两位小数') {
                $(this).addClass("txtColor");
            }
        });
        $("#commoditystock").focus(function () {
            if (this.value == '请输入非负整数') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入非负整数';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请输入非负整数') {
                $(this).addClass("txtColor");
            }
        });
        $("#commodityWeight").focus(function () {
            if (this.value == '请输入正数') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请输入正数';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请输入正数') {
                $(this).addClass("txtColor");
            }
        });
        if ("@ViewBag.hasVideoFunction".toLowerCase() == "false") {
            $("#VideoFunc").hide();
        }
        else {
            $("#VideoFunc").show();
        }

        $("input[name=rdoPriceMethod]").change(function () {
            switch ($("input[name=rdoPriceMethod]:checked").attr("value")) {
                case "0":
                    $("#liWeight").hide();
                    $("#commodityWeight").val('请输入正数').next().html("kg").css('color', '');
                    $("#commodityWeight").addClass("txtColor");
                    break;
                case "1":
                    $("#liWeight").show();
                    break;
                default:
                    break;
            }
            resetFreight();
        });
        if ($("input[name=rdoPriceMethod]:checked").attr("value") == 1) {
            $("#liWeight").show();
        }

        resetFreight();
    });
    //重置运费
    function resetFreight() {
        $("#commodityFreight").empty().append($("<option>").val("-1").text("请选择物流模板"));
        if (freightList && freightList.length > 0) {
            for (var i = 0; i < freightList.length; i++) {
                if (freightList[i].ExpressType == 1 || freightList[i].PricingMethod == $("input[name=rdoPriceMethod]:checked").attr("value"))
                    $("#commodityFreight").append($("<option>").val(freightList[i].Id).text(freightList[i].Name));
            }
        }
    }

    function loadListImg() {
        //listImgSrcString = "commodityCookie.ImgList";

        var listImgSrcString = $("#listImgShowSrcString").val()
            .replace(/_*http:\/\//g, 'http://');

        //listImgShowSrcString = "commodityCookie.listImgShowSrcString";
        var listImgShowSrcString = $("#listImgShowSrcString").val();
        var listImgSrc = $.trim(listImgSrcString) ? listImgSrcString.split(',') : '';
        var listImgShowSrc = listImgShowSrcString.split(',');
        for (var i = 0; i < listImgSrc.length; i++) {
            if (listImgSrc[i] != "") {
                var htmlContent = $('<div class="img1">' +
                    '<img src="" name="" width="80" height="80" class="one">' +
                    '<img src="/Images/finished.png" class="two" style="display: none">' +
                    '<img src="/Images/close.jpg" class="two" style="top: 0px;" onclick="deleteImg(this);">' +
                    '</div>');
                var clone = htmlContent.clone();
                clone.find('.one').attr('src', listImgSrc[i]).attr('name', listImgSrc[i]);
                $("#sortable").find('img:last').before(clone);
            }
        }
    }


    function setCommodityCategory() {
        var id = [];
        var text = [];
        $('#tcategoryUl').find('input:checked').each(function () {
            id.push(this.value);
            text.push($(this).nextAll('span').text());
        });
        $('#commoditycategory').val(text);
        $('#cateogryIdList').val(id);
    }

    @if(ViewBag.IsYJBJ)
    {
    <text>
    function setInnerCommodityCategory() {
        var id = [];
        var text = [];
        $('#tinnerCategoryUl').find('input:checked').each(function () {
            id.push(this.value);
            text.push($(this).nextAll('span').text());
        });

        $('#commodityInnerCategory').val(text);
        $('#innerCateogryIdList').val(id);
     }

     function setEsCommodityCategory() {
            var id = [];
            var text = [];
            $('#escategoryUl').find('input:checked').each(function () {
                id.push(this.value);
                text.push($(this).nextAll('span').text());
            });

            $('#commodityEsCategory').val(text);
            $('#EsCateogryIdList').val(id);
     }

    </text>
    }

    function toCheckSelected() {
        var cateogryIdList = "";
        var categoryNameList = "";
        $("#tcategoryUl input:checkbox:checked").each(function () {
            cateogryIdList = cateogryIdList + "," + $(this).val();
            categoryNameList = categoryNameList + "," + $(this).next().text();
        });
        if (cateogryIdList.length > 0) {
            cateogryIdList = cateogryIdList.substring(1, cateogryIdList.length);
            categoryNameList = categoryNameList.substring(1, categoryNameList.length);
        }
        $("#commoditycategory").val(categoryNameList);
        $("#cateogryIdList").val(cateogryIdList);
        $("#commoditycategory").removeClass("txtColor");
    }


    function toCheckSizeSelected() {
        var sizeIdList = "";
        var sizeNameList = "";
        $("#sizeUl input:checkbox:checked").each(function () {
            sizeIdList = sizeIdList + "," + $(this).val();
            sizeNameList = sizeNameList + "," + $(this).next().text();
        });
        if (sizeIdList.length > 0) {
            sizeIdList = sizeIdList.substring(1, sizeIdList.length);
            sizeNameList = sizeNameList.substring(1, sizeNameList.length);
        }
        $("#commoditysize").val(sizeNameList);
        $("#commoditysize").removeClass("txtColor");
        $("#sizeIdList").val(sizeIdList);
        updateRight();
    }

    function toCheckColorSelected() {
        var colorIdList = "";
        var colorNameList = "";
        $("#colorUl input:checkbox:checked").each(function () {
            colorIdList = colorIdList + "," + $(this).val();
            colorNameList = colorNameList + "," + $(this).next().text();
        });
        if (colorIdList.length > 0) {
            colorIdList = colorIdList.substring(1, colorIdList.length);
            colorNameList = colorNameList.substring(1, colorNameList.length);
        }
        $("#commoditycolor").val(colorNameList);
        $("#commoditycolor").removeClass("txtColor");
        $("#colorIdList").val(colorIdList);
        updateRight();
    }

    function closeCategoryDiv() {
        $("#categoryDiv").hide();
        ajaxSaveInfo();
        }

        function closeEsCategoryDiv() {
            $("#EsCategoryDiv").hide();
            ajaxSaveInfo();
        }


    @if(ViewBag.IsYJBJ)
    {
    <text>
    function closeInnerCategoryDiv() {
        $("#innerCategoryDiv").hide();
        ajaxSaveInfo();
    }
    </text>
    }
    function closeSzieDIV() {
        $("#sizeDIV").hide();
        ajaxSaveInfo();
    }
    function closeColorDIV() {
        $("#colorDIV").hide();
        ajaxSaveInfo();
    }

    function getListImgSrcString() {
        var src = [];
        $("#sortable").find('.one').each(function () {
            src.push($(this).attr("src"));
        });
        return src.join(',');
    }


    $(document).ready(function () {
        //默认滚动到页面的顶部。
        $(window.top).scrollTop(0);

        //	window.iID = setInterval(function () {ajaxSaveInfo();}, 500);

        $('.spfb_t_l').find('input').change(function () {
            ajaxSaveInfo();
        });

        //设置类目、尺寸、颜色复选框的选中状态 begin
        var attrArray = [];
        attrArray = attrArray.concat($.trim($("#cateogryIdList").val()).split(','), $.trim($("#innerCateogryIdList").val()).split(','),
            $.trim($("#commoditysize").val()).split(','),
            $.trim($("#commoditycolor").val()).split(','));
        var attrLen = attrArray.length;
        var sourceObj = $("#categoryDiv input[type='checkbox'],#sizeDIV input[type='checkbox'],#colorDIV input[type='checkbox'],#innerCategoryDiv input[type='checkbox']");
        for (var i = 0; i < attrLen; i++) {
            var val = attrArray[i];
            if (val != "") {
                sourceObj.each(function () {
                    if (this.value == val || $(this).nextAll('span').text().toLocaleLowerCase() == val.toLocaleLowerCase()) {
                        this.checked = true;
                    } else if (this.innerHTML == val) {
                        this.checked = true;
                    }
                });
            }
        } //end

        $("#commoditymarketprice").blur(function () {
            var $span = $(this).next();
            var val = $.trim(this.value);
            $span.css("color", "red");
            if (val == "" || val == "请输入正数最多两位小数") {
                $span.html(getCurrency());
                $span.css("color", "");
                return;
            }
            if (!/^\d+(\.\d{2})?$/.test(val)) {
                if (!/^\d+(\.\d{1})?$/.test(val)) {
                    $span.html("请填写正确的市场价最多保留2位小数");
                    return;
                }
            }
            if (val < 0) {
                $span.html("市场价必须大于等于0");
                return;
            }
            if (parseFloat(val) < parseFloat($.trim($("#commodityprice").val()))) {
                $span.html("市场价不得小于商品现价");
                return;
            }
            $span.html(getCurrency());
            $span.css("color", "");
        });

        $("#commodityprice").blur(function () {
            var $span = $(this).next();
            var val = $.trim(this.value);
            $span.css("color", "red");
            if (val == "") {
                $span.html("商品价格不能为空");
                return;
            }
            if (!/^\d+(\.\d{2})?$/.test(val)) {
                if (!/^\d+(\.\d{1})?$/.test(val)) {
                    $span.html("请填写正确的价格最多保留2位小数");
                    return;
                }
            }
            if (val < 0) {
                $span.html("价格必须大于等于0");
                return;
            }
            if (parseFloat(val) > parseFloat($.trim($("#commoditymarketprice").val()))) {
                $("#commoditymarketprice").next().css("color", "red").html("市场价不得小于商品现价");
            } else {
                $("#commoditymarketprice").next().css("color", "").html(getCurrency());
            }
            $span.html(getCurrency());
            $span.css("color", "");
        });

        $("#costPrice").blur(function () {
            var $span = $(this).next();
            var val = $.trim(this.value);
            $span.css("color", "red");
            if (val == "") {
                $span.html("进货价不能为空");
                return;
            }
            if (!/^\d+(\.\d{2})?$/.test(val)) {
                if (!/^\d+(\.\d{1})?$/.test(val)) {
                    $span.html("请填写正确的价格最多保留2位小数");
                    return;
                }
            }
            if (val < 0) {
                $span.html("价格必须大于等于0");
                return;
            }
            $span.html(getCurrency());
            $span.css("color", "");
        });

        $("#commoditystock").blur(function () {
            var $span = $(this).next();
            var val = $.trim(this.value);
            $span.css("color", "red");
            if (val == "") {
                $span.html("商品数量不能为空");
                return;
            }

            if (!/^\d+?$/.test(val)) {
                $span.html("请填写正确的数量");
                return;
            }
            if (val < 0) {
                $span.html("商品数量不能小于0");
                return;
            }
            $span.html("件");
            $span.css("color", "");
        });
        $("#commodityWeight").blur(function () {
            var $span = $(this).next();
            var val = $.trim(this.value);
            $span.css("color", "red");
            if (val == "" || val == "请输入正数最多五位小数") {
                $span.html("kg");
                $span.css("color", "");
                return;
            }

            if (!/^\d+(\.\d{1,5})?$/.test(val)) {
                $span.html("请填写正确的重量参数最多保留5位小数");
                return;
            }

            if (val <= 0) {
                $span.html("重量参数必须大于0");
                return;
            }
            $span.html("kg");
            $span.css("color", "");
        });
        $("#ScoreScale").blur(function () {
            var $span = $(this).next();
            var val = $.trim(this.value);
            $span.html("%积分（请到支付方式菜单设置积分兑换汇率)");
            $span.css("color", "red");
            if (val == "") {
                $span.css("color", "");
                $(this).val('');
                return;
            }
            if (val <= 0) {
                $span.html("积分比例参数必须大于0");
                $(this).val('');
                return;
            }
            if (!/^\d+(\.\d{1,5})?$/.test(val)) {
                $span.html("请填写正确的积分比例参数最多保留5位小数");
                $(this).val('');
                return;
            }
            $span.css("color", "");
        });

        $('#tcategoryUl').on('click', 'input', function () {
            var self = $(this);
            var input = self.parents('ul').prevAll().find('input');
            if (input.length) {
                if (self.prop('checked')) {
                    input.prop('checked', true);
                } else {
                    //				input.prop('checked', false);
                    self.parent().nextAll('ul').find('input').prop('checked', false);
                }
            } else {
                self.parent().nextAll('ul').find('input').prop('checked', false);
            }
            setCommodityCategory();
        });

        @if(ViewBag.IsYJBJ)
        {
        <text>
        $('#tinnerCategoryUl').on('click', 'input', function () {
            var self = $(this);
            var input = self.parents('ul').prevAll().find('input');
            if (input.length) {
                if (self.prop('checked')) {
                    input.prop('checked', true);
                } else {
                    self.parent().nextAll('ul').find('input').prop('checked', false);
                }
            } else {
                self.parent().nextAll('ul').find('input').prop('checked', false);
            }
            setInnerCommodityCategory();
        });

        $('#escategoryUl').on('click', 'input', function () {
            var self = $(this);
            var input = self.parents('ul').prevAll().find('input');
            if (input.length) {
                if (self.prop('checked')) {
                    input.prop('checked', true);
                } else {
                    //				input.prop('checked', false);
                    self.parent().nextAll('ul').find('input').prop('checked', false);
                }
            } else {
                self.parent().nextAll('ul').find('input').prop('checked', false);
            }
            setEsCommodityCategory();
        });



        </text>
        }


        $("#commoditycategory").focus(function () {
            var top = $('#commoditycategory').offset().top;
            var left = $('#commoditycategory').offset().left;
            var height = $('#commoditycategory').height();
            $("#categoryDiv").css({ "top": top + height, "left": left }).show();
            $("#sizeDIV").hide();
            $("#colorDIV").hide();
            $("#attributeDIV").hide();
            $("#attrDIV2").hide();
            $("#attrDIV1").hide();
            $("#freightDIV").hide();
            $("#EsCategoryDiv").hide();
            @if(ViewBag.IsYJBJ)
            {
            <text>
                $("#innerCategoryDiv").hide();
            </text>
            }
        });

        @if(ViewBag.IsYJBJ)
        {
        <text>
        $("#commodityInnerCategory").focus(function () {
            var top = $('#commodityInnerCategory').offset().top;
            var left = $('#commodityInnerCategory').offset().left;
            var height = $('#commodityInnerCategory').height();
            $("#innerCategoryDiv").css({ "top": top + height, "left": left }).show();
            $("#categoryDiv").hide();
            $("#sizeDIV").hide();
            $("#colorDIV").hide();
            $("#attributeDIV").hide();
            $("#attrDIV2").hide();
            $("#attrDIV1").hide();
            $("#freightDIV").hide();
            $("#SpecificationsDIV").hide();
            $("#EsCategoryDiv").hide();
        });

        $("#commodityEsCategory").focus(function () {
            var top = $('#commodityEsCategory').offset().top;
            var left = $('#commodityEsCategory').offset().left;
            var height = $('#commodityEsCategory').height();
            $("#EsCategoryDiv").css({ "top": top + height, "left": left }).show();
            $("#categoryDiv").hide();
            $("#sizeDIV").hide();
            $("#colorDIV").hide();
            $("#attributeDIV").hide();
            $("#attrDIV2").hide();
            $("#attrDIV1").hide();
            $("#freightDIV").hide();
            $("#SpecificationsDIV").hide();
            $("#innerCategoryDiv").hide();
        });

        </text>
        }

        $("#commoditysize").focus(function () {
            var top = $('#commoditysize').offset().top;
            var left = $('#commoditysize').offset().left;
            var height = $('#commoditysize').height();
            $("#sizeDIV").css({ "top": top + height, "left": left }).show();
            $("#categoryDiv").hide();
            $("#colorDIV").hide();
            $("#SpecificationsDIV").hide();
            $("#EsCategoryDiv").hide();
            @if(ViewBag.IsYJBJ)
            {
            <text>
            $("#innerCategoryDiv").hide();
            </text>
            }
        });

        $("#commoditycolor").focus(function () {
            var top = $('#commoditycolor').offset().top;
            var left = $('#commoditycolor').offset().left;
            var height = $('#commoditycolor').height();
            $("#colorDIV").css({ "top": top + height, "left": left }).show();
            $("#categoryDiv").hide();
            $("#innerCategoryDiv").hide();
            $("#EsCategoryDiv").hide();
            $("#sizeDIV").hide();
            @if(ViewBag.IsYJBJ)
            {
            <text>
            $("#innerCategoryDiv").hide();
            </text>
            }
        });

        $("#sizeUl input[type='checkbox']").change(function () {
            toCheckSizeSelected();
        });

        $("#colorUl input[type='checkbox']").change(function () {
            toCheckColorSelected();
        });


        $("#showPrev").click(function () {
            rotateImg("prev");
        });
        $("#showNext").click(function () {
            rotateImg("next");
        });

        //详情页图片初始化显示
        loadListImg();
        //页面初始化后更新手机预览效果
        updateRight();
    });

    function rotateImg(direction) {
        var img = $("#showImg")[0];
        var imgList = $("#sortable div.img1 img.one");
        if (imgList.length > 0) {
            for (var i = 0; i < imgList.length; i++) {
                var newImg = imgList.get(i);
                if (newImg.src == img.src) {
                    if (direction == 'prev') {
                        if (i == 0) {
                            img.src = imgList.get(imgList.length - 1).src;
                        }
                        else {
                            img.src = imgList.get(i - 1).src;
                        }
                        break;
                    }
                    else {
                        if (i == imgList.length - 1) {
                            img.src = imgList.get(0).src;
                        }
                        else {
                            img.src = imgList.get(i + 1).src;
                        }
                        break;
                    }
                }
            }
        }
        else {
            img.src = "/Images/comment_pic5.png";
        }
    }
        // 获取用户输入的属性值
    function GetInputValue() {
        IsCanSumbit = true;
        var selectJson = "[";
        $("input[name='attrCache']").each(function () {
            var price = $(this).prev().val();
            var marketprice = $(this).parent().next().children().eq(0).val();
            var duty = $(this).parent().next().next().children().eq(0).val();
            var stock = $(this).parent().next().next().next().children().eq(0).val();
            var CostPrice = $(this).parent().next().next().next().next().children().eq(0).val();
            var BarCode = $(this).parent().next().next().next().next().next().children().eq(0).val();
            var Code = $(this).parent().next().next().next().next().next().next().children().eq(0).val();
            var JDCode = $(this).parent().next().next().next().next().next().next().next().children().eq(0).val();
            var erQiCode = $(this).parent().next().next().next().next().next().next().next().next().children().eq(0).val();
            // 计算图片地址
            var index = $(this).attr('data-tab-index');
            var ThumImg = $("#ComThumImgSrc"+index).val();
            var src = [];
            $("#sortable"+index).find('.one').each(function () {
                src.push($(this).attr("src"));
            });
            var CarouselImgs = src.join(',');

            marketprice = $.trim(marketprice) == '' ? null : $.trim(marketprice);
            if (duty) {
                if (!/^\d+(\.\d{2})?$/.test(duty)) {
                    if (!/^\d+(\.\d{1})?$/.test(duty)) {
                        IsCanSumbit = false;
                    }
                }
            }

            @if(ViewBag.IsYJBJ)
            {
            <text>
            if(!BarCode) {
                IsCanSumbit = false;
            }
            </text>
            }
            duty = $.trim(duty) == '' ? null : $.trim(duty);
            var t = '{"ComAttributeIds":' + decodeURIComponent($(this).val()) + ',"Price":"' + price + '","Stock":"' + stock + '","MarketPrice":' + marketprice + ',"Duty":' + duty + ',"CostPrice":"' + CostPrice + '","BarCode":"' + BarCode + '","Code":"' + Code + '","JDCode":"' + JDCode + '","ErQiCode":"' + erQiCode + '", "ThumImg":"' + ThumImg + '", "CarouselImgs":"' + CarouselImgs + '"}';
            if (selectJson == "[") {
                selectJson += t;
            }
            else {
                selectJson += "," + t;
            }
            if (IsCanSumbit) {
                CheckData(price, stock);
            }
        });
        if (selectJson != "]") {
            selectJson += "]";
            return selectJson;
        }
        return "";
    }
    var SelectAttr = new Array();
        //获取只有一个属性的字符串
    function GetOneAttrStr() {
        var attributeNames = "";
        var attributeIds = "";
        var attrName = "";
        var attrId = "";
        if (SelectAttr.length == 1) {
            for (var i = 0; i < FristAttrValueList.length; i++) {
                if (i == 0) {
                    attributeNames = FristAttrValueList[i].Name;
                    attributeIds = FristAttrValueList[i].Id;
                }
                else {
                    attributeNames = attributeNames + "," + FristAttrValueList[i].Name;
                    attributeIds = attributeIds + "," + FristAttrValueList[i].Id;
                }
            }
            attrId = SelectAttr[0].Id;
            attrName = SelectAttr[0].Name;
        }
        return { attrIds: attributeIds, attrNames: attributeNames, attrName: attrName, attrId: attrId };
    }
    function checkMoneyRange(money, canZero, isNullable) {
        if ((money == "" || money == null) && isNullable) {
            return true;
        }
        if (canZero) {
            if (money > 999999999.99 || money < 0)
                return false;
        } else {
            if (money > 999999999.99 || money <= 0)
                return false;
        }
        return true;
    }
    function CheckAttr() {
        msgError = "";
        if (SelectAttr.length > 0) {
            if (FristAttrValueList.length <= 0) {
                msgError = "商品" + SelectAttr[0].Name + "不能为空";
                return false;
            }
        }

        if (SelectAttr.length > 1) {
            if (TwoAttrValueList.length <= 0) {
                msgError = "商品" + SelectAttr[1].Name + "不能为空";
                return false;
            }
        }
        return true;
    }
    //校验市场价是否合法
    //市场价不能小于商品现价
    function CheckMarketPrice() {
        var result = true;
        var multAttr = false;
        $("input[name='attrCache']").each(function () {
            multAttr = true;
            var price = $(this).prev().val();
            var marketprice = $(this).parent().next().children().eq(0).val();
            if (parseFloat(price) > parseFloat(marketprice)) {
                result = false;
                return;
            }
        });
        if (!multAttr) {
            var price = $("#commodityprice").val();
            var marketprice = $("#commoditymarketprice").val();
            if (parseFloat(price) > parseFloat(marketprice)) {
                result = false;
            }
        }
        return result;
    }
    function toSave() {
        var postData = {};
        postData.CommodityId = $.trim($("#commodityId").val());
        postData.CommoditCategory = $.trim($("#cateogryIdList").val());
        postData.CategoryName = $('#commoditycategory').val();
        postData.InnerCategoryName = $('#commodityInnerCategory').val();
        postData.CommodityCode = $.trim($("#commoditycode").val());
        postData.CommodityName = $.trim($("#commodityname").val());
        postData.CommodityMarketPrice = $.trim($("#commoditymarketprice").val()) == '请输入正数最多两位小数' ? '' : $.trim($("#commoditymarketprice").val());
        postData.CommodityPrice = $.trim($("#commodityprice").val());
        postData.CommodityType=$("input[name='rdoCommodityType']:checked").val();//商品类型;
        postData.YJCouponActivityId= $.trim($("#YJCouponActivityId").val());//活动编码;
        postData.YJCouponType = $.trim($("#YJCouponType").val()); //类型编码;
        postData.CostPrice = $.trim($("#costPrice").val());
        @if(ViewBag.IsYJBJ)
        {
        <text>
        postData.CommoditInnerCategory = $.trim($("#innerCateogryIdList").val());
        postData.InnerCategoryName = $('#commodityInnerCategory').val();
        postData.BarCode = $.trim($("#barCode").val());
        </text>
        }

        postData.EsCategory = $('#EsCateogryIdList').val();
        postData.EsCategoryName = $('#commodityEsCategory').val();

        @if(ViewBag.ShowJDCode)
        {
        <text>
        postData.JDCode = $.trim($("#jdCode").val());
        </text>
        }
        @if(ViewBag.ShowErQiCode)
        {
        <text>
        postData.ErQiCode = $.trim($("#erQiCode").val());
        </text>
        }

        postData.CommodityDuty = $.trim($("#commodityduty").val()) == '请输入正数最多两位小数' ? '' : $.trim($("#commodityduty").val());
        postData.CommodityTaxRate = $.trim($("#commodityTaxRate").val()) == '请输入正数最多两位小数' ? '' : $.trim($("#commodityTaxRate").val());
        postData.CommodityInputTax = $.trim($("#commodityInputTax").val()) == '请输入正数最多两位小数' ? '' : $.trim($("#commodityInputTax").val());
        postData.TaxClassCode = $.trim($("#commodityTaxClassCode").val());
        postData.Unit = $.trim($("#commodityUnit").val());
        postData.CommodityStock = $.trim($("#commoditystock").val());
        postData.CommoditySize = $.trim($("#sizeIdList").val());
        postData.CommodityImgList = getListImgSrcString();
        postData.CommodityColor = $.trim($("#colorIdList").val());
        postData.RelaCommodityList = $.trim($("#CommodityIds").val());


        var $commodityColor = $.trim($("#commoditycolor").val());
        var $commoditySize = $.trim($("#commoditysize").val());

        postData.ColorNames = $commodityColor == '请选择' ? '' : $commodityColor;
        postData.SizeNames = $commoditySize == '请选择' ? '' : $commoditySize;
        postData.Picture = $("#picture").val();
        postData.CommodityDetails = encodeURIComponent(ue.getContent());
        postData.TechSpecs = encodeURIComponent(techSpecsEditor.getContent());
        postData.SaleService = encodeURIComponent(saleServiceEditor.getContent());
        postData.State = getQueryString('state') || 0;

        // { attrIds: attributeIds, attrNames: attributeNames, attrName: attrName, attrId: attrId };
        var attr = GetOneAttrStr();

        postData.AttrId = attr.attrId;
        postData.AttrName = attr.attrName;

        postData.AttrNames = attr.attrNames;
        postData.AttrIds = attr.attrIds;
        postData.AttrObj = GetInputValue();

        //            postData.FreightId = FreightId;
        //            postData.FreightName = $("#commodityFreight").val();
        postData.FreightId = $("#commodityFreight").val();
        postData.FreightName = $("#commodityFreight").find("option:selected").text();

        if (postData.ColorNames == "请选择") {
            postData.ColorNames = "";
        }
        if (postData.SizeNames == "请选择") {
            postData.SizeNames = "";
        }
        //是否支持自提。
        postData.IsEnableSelfTake = $("#chkIsEnableSelfTake").attr("checked") == "checked" ? 1 : 0;

        postData.PricingMethod = $("input[name=rdoPriceMethod]:checked").attr("value");
        postData.IsAssurance = $('#IsAssurance').val();
        postData.IsReturns=$('#IsReturns').val();
        postData.Isnsupport=$("#Isnsupport").val();
        var ServiceSettingIds="";
        $("input[name='ServiceSettingId']").each(function(){
             var ServiceSettingId=$(this).val();
             if(ServiceSettingId!=null||ServiceSettingId!=""){
                 ServiceSettingIds+=(ServiceSettingId+"|");
             }

        });
        if(ServiceSettingIds!=null||ServiceSettingIds!=""){

            ServiceSettingIds=ServiceSettingIds.substring(0,ServiceSettingIds.length-1);
        }
        postData.ServiceSettingId=ServiceSettingIds;
        postData.Weight = $("#commodityWeight").val();
        postData.ScoreScale = $("#ScoreScale").val();
        postData.SaleAreas = $("#SaleAreas").val();
        postData.VideoName = $.trim($("#VideoName").html());
        postData.VideoUrl = $.trim($("#VideoUrl").html());
        postData.VideoWebUrl = $.trim($("#VideoWebUrl").html());
        postData.VideoPicUrl = $.trim($("#VideoPicUrl").html());
        //添加品牌墙
        postData.BrandId=$("#hidBrandId").val();
        postData.BrandName=$("#hidBrandName").val();
        if ($("#Specifications").val()!="请选择") {
            postData.Specifications  =$.trim($("#Specifications").val());
        }
        else {
           postData.Specifications="";
        }
        var result = Valid();
        if (result == 0) {
            $.ajax({
                url: '/Commodity/AddCommodity',
                type: 'post',
                data: postData,
                beforeSend: function () {
                    //				clearInterval(iID);
                    ajaxLoading(1, '');
                },
                complete: function () {
                    ajaxLoading(1, '');
                },
                success: function (data) {
                    if (data.Result == true) {
                        $.cookie('SaveCommodityCookie', null);
                        if (data.CommodityUrl == "0") {
                            alert("发布成功");
                            setTimeout(function () {
                                if (getQueryString('state')) {
                                    window.location.href = "/Commodity/Index?appId=" + getQueryString('appId')+"&userId="+getQueryString('userId');
                                } else {
                                    window.location.href = window.location.href.replace(/#.*$/, "");
                                }
                            }, 1200);
                        } else {
                            alert("保存成功");
                            setTimeout(function () {
                                if (getQueryString('state')) {
                                    window.location.href = "/Commodity/StoreIndex?appId=" + getQueryString('appId')+"&userId="+getQueryString('userId');
                                } else {
                                    window.location.href = window.location.href.replace(/#.*$/, "");
                                }
                            }, 1200);
                        }
                    } else {
                        alert(data.Messages);
                    }
                    return false;
                }, error: function (msg) {
                    //				window.iID = setInterval(function () {ajaxSaveInfo();}, 500);
                    alert("请稍后再试！");
                    try {
                        console.log(msg.responseText);
                    } catch (e) {
                    }
                }
            })
        } else {
            alert(result);
        }
    }
    function Valid() {
        //判断商品品牌
//        if($.trim($("#commoditybrand").val()) == "" || $.trim($("#commoditybrand").val()) == "请选择")
//        {
//            return "品牌不能为空";
//        }
        @if(ViewBag.IsYJBJ)
        {
            <text>
                if ($.trim($("#commodityInnerCategory").val()) == "" || $.trim($("#commodityInnerCategory").val()) == "请选择") {
                    return "商城品类不能为空";
                }
                if ($.trim($("#barCode").val()) == "" || $.trim($("#barCode").val()) == "请输入商品条形码") {
                    return "商品条形码不能为空";
                }
            </text>

            if (ViewBag.IsShowEsCategory) {
               <text>
                if ($.trim($("#EsCateogryIdList").val()) == "") {
                    return "前端分类不能为空";
                }
                </text>
            }
         }

        if ($.trim($("#commoditycode").val()) == "") {
        } else {
            var noCode = $("#commoditycode").next().html();
            if (noCode != "") {
                return "商品编号不能重复，该编号已存在";
            }
        }


        if ($("input[name=rdoCommodityType]:checked").attr("value")==1) {
            if ($.trim($("#YJCouponType").val()) == "" || $.trim($("#YJCouponType").val()) == "最多30个字" || $.trim($("#YJCouponType").val()) == "最多60个字") {
                return "类型编码不能为空";
            }
        }

        if ($("input[name=rdoCommodityType]:checked").attr("value")==1) {
            if ($.trim($("#YJCouponActivityId").val()) == "" || $.trim($("#YJCouponActivityId").val()) == "最多30个字" || $.trim($("#YJCouponActivityId").val()) == "最多60个字") {
                return "活动编码不能为空";
            }
        }

        if ($.trim($("#commodityname").val()) == "" || $.trim($("#commodityname").val()) == "最多30个字" || $.trim($("#commodityname").val()) == "最多60个字") {
            return "商品名称不能为空";
        }
        if ($.trim($("#IsHaveMallApply").val()) == "True") {
            if ($.trim($("#commodityTaxRate").val()) == "" || $.trim($("#commodityTaxRate").val()) == "请输入正数最多两位小数" || $.trim($("#commodityTaxRate").val()) == "0.00") {
                return "销项税不能为空";
            }
            if ($.trim($("#commodityInputTax").val()) == "" || $.trim($("#commodityInputTax").val()) == "请输入正数最多两位小数" || $.trim($("#commodityTaxRate").val()) == "0.00") {
                return "进项税不能为空";
            }
            if ($.trim($("#commodityTaxClassCode").val()) == "" || $.trim($("#commodityTaxClassCode").val()) == "请选择") {
                return "税收编码不能为空";
            }
            if ($.trim($("#commodityUnit").val()) == "" || $.trim($("#commodityUnit").val()) == "请输入正数最多两位小数" || $.trim($("#commodityTaxRate").val()) == "0.00") {
                return "计价单位不能为空";
            }
        }

        @if(ViewBag.ShowJDCode)
        {
            <text>
            if ($.trim($("#commodityFreight").val()) == "" || $.trim($("#commodityFreight").val()) == "-1") {
                return "物流费用不能为空";
            }
            if ($.trim($("#saleAreastxt").text()) == "" || $.trim($("#saleAreastxt").text()) == "未指定销售区域") {
                return "销售区域不能为空";
            }
            </text>
        }
        @if(ViewBag.ShowErQiCode){
            <text>
            if ($.trim($("#erQiCode").val()) == "") {
                return "标准化系统标准编码不能为空";
            }
            </text>
        }
        if ('@isCustomES'.toLowerCase() == 'false') {
            if ($.trim($("#commodityname").val()).length > 30) {
                return "名称最多30个字";
            }
        } else {
            if ($.trim($("#commodityname").val()).length > 60) {
                return "名称最多60个字";
            }
        }


        var commoditypriceTrim = $.trim($("#commodityprice").val());
        if (commoditypriceTrim == "" || commoditypriceTrim == '请输入正数最多两位小数') {
            return "商品价格不能为空";
        }
        if (!/^\d+(\.\d{2})?$/.test($("#commodityprice").val())) {
            if (!/^\d+(\.\d{1})?$/.test($("#commodityprice").val())) {
                return "请填写正确的商品价格, 最多保留2位小数";
            }
        }
        if ($("#commodityprice").val() < 0) {
            return "价格必须大于等于0";
        }
        if (!checkMoneyRange($.trim($("#commodityprice").val()), true, false)) {
            return "最多填写9位正数";
        }

        var commoditymarketprice = $.trim($("#commoditymarketprice").val()) == '请输入正数最多两位小数' ? '' : $.trim($("#commoditymarketprice").val());
        //市场价非必填内容，但如果有只，必须是正数，最多保留两位小数，且不小于$("#commodityprice")的值
        if (commoditymarketprice != "") {
            if (!/^\d+(\.\d{2})?$/.test(commoditymarketprice)) {
                if (!/^\d+(\.\d{1})?$/.test(commoditymarketprice)) {
                    return "请填写正确的市场价最多保留2位小数";
                }
            }
        }
        var costPriceTrim = $.trim($("#costPrice").val());
        if (costPriceTrim == "" || costPriceTrim == '请填写含税进货价') {
            return "进货价不能为空";
        }
        if (!/^\d+(\.\d{2})?$/.test($("#costPrice").val())) {
            if (!/^\d+(\.\d{1})?$/.test($("#costPrice").val())) {
                return "请填写正确的进货价, 最多保留2位小数";
            }
        }
        if ($("#costPrice").val() < 0) {
            return "价格必须大于等于0";
        }
        if (!checkMoneyRange($.trim($("#costPrice").val()), true, false)) {
            return "最多填写9位正数";
        }
        if (parseFloat($("#commoditymarketprice").val()) < parseFloat($("#commodityprice").val())) {
            return "市场价不得小于商品现价";
        }
        if (!checkMoneyRange($.trim($("#commoditymarketprice").val()), true, true)) {
            return "最多填写9位正数";
        }
        if ($.trim($("#commoditystock").val()) == "") {
            return "商品数量不能为空";
        }

        if (!/^\d+?$/.test($("#commoditystock").val())) {
            return "请填写正确的商品数量";
        }
        if ($.trim($("#commoditystock").val()) < 0) {
            return "商品数量不能小于0";
        }
        if ($.trim($("#picture").val()) == "") {
            return "商品缩略图不能为空";
        }
        if (!getListImgSrcString().length) {
            return "商品详情页图样不能为空";
        }
        var con = ue.getContent();
        con = con.replace(/<\/?(img)[^>]*>|&nbsp;/ig, "");
        if (con.length > 0
            && con.length > 8000) {
            return "描述内容不能超过8000个字符。";
        }

        @if(ViewBag.IsYJBJ)
        {
        @:if (!IsCanSumbit) return "请检查商品属性数量、价格、关税格式、商品条形码输入是否正确";
        }
        else
        {
        @:if (!IsCanSumbit) return "请检查商品属性数量、价格、关税格式输入是否正确";
        }

        if (!CheckAttr()) return msgError;

        if (!CheckMarketPrice()) return "市场价不得小于商品现价";
        var attrMess = "";
        $("input[name='attrCache']").each(function () {
            var price = $(this).prev().val();
            if (!checkMoneyRange(price, true, false)) {
                attrMess = "最多填写9位正数";
                return;
            }
            var marketprice = $(this).parent().next().children().eq(0).val();
            marketprice = $.trim(marketprice) == '' ? null : $.trim(marketprice);
            if (!checkMoneyRange(marketprice, true, true)) {
                attrMess = "最多填写9位正数";
                return;
            }
            var duty = $(this).parent().next().next().children().eq(0).val();
            if (!checkMoneyRange(duty, true, true)) {
                attrMess = "最多填写9位正数";
                return;
            }
        });
        if (attrMess)
            return attrMess;

        if ($("input[name=rdoPriceMethod]:checked").attr("value") == "1") {
            var weight = $.trim($("#commodityWeight").val());
            if (weight == "" || weight == "请输入正数") {
                return "计重商品重量参数不能为空";
            }
            if (!/^\d+(\.\d{1,5})?$/.test(weight)) {
                return "请填写正确的重量参数最多保留5位小数";
            }
            if (eval(weight) <= 0) {
                return "重量参数必须为正数";
            }
        }

       if($.trim($("#Specifications").val())!=null||$.trim($("#Specifications").val())!="") {
                var  arr = $.trim($("#Specifications").val()).split(',');
                if (arr.length>10) {
                   return "最多只能设置10个包装规格";
                }
       }

        return 0;
    }

    function toSelectAll(obj) {
        if ($(obj).attr("checked")) {
            $("#sortable img.one").each(function () {
                if ($(this) != $("#sortable img:last")) {
                    $(this).addClass("imgchecked");
                    $(this).next().show();
                }
            });
        } else {
            $("#sortable img").each(function () {
                if ($(this) != $("#sortable img:last")) {
                    $(this).removeClass("imgchecked");
                    $(this).next().hide();
                }
            });
        }
    }
    function toDeleteAllImgList() {
        $("#sortable div.img1").each(function () {
            if ($(this).find("img.two").css("display") != "none") {
                $(this).remove();
            }
        });
        updateRightImg();
    }

    function updateRight() {
        updateRightImg();
		var CostPrice=$.trim($("#costPrice").val());
            var inputax=$.trim($("#commodityInputTax").val());
            if(CostPrice>0&&inputax>=0){
                var aaa=CostPrice/(1+inputax/100);
                $("#CostPriceNoContainsTax").val(aaa.toFixed(2));
            }
        var comName = $.trim($("#commodityname").val());
        if (comName.length > 12) {
            comName = comName.substring(0, 12) + '...';
        }
        $("div.spfb_t_r ul li.one1 p").text(comName);
        $("div.spfb_t_r ul li.one2").text(getCurrency() + $("#commodityprice").val());
        var size = $.trim($("#commoditysize").val());
        if (size == "" || size == "请选择") {
            size = "请选择尺寸";
        }
        $("div.spfb_t_r ul li.one4 span.siz").text("尺寸：" + size);
        var color = $.trim($("#commoditycolor").val());
        if (color == "" || color == "请选择") {
            color = "请选择颜色";
        }
        $("div.spfb_t_r ul li.one4 span.col").text("颜色：" + color);


        $("div.spfb_t_r ul li.flag1").hide();
        $("div.spfb_t_r ul li.flag2").hide();
        for (var i = 0; i < SelectAttr.length; i++) {
            if (i == 0) {
                $("div.spfb_t_r ul li.flag1").show();
                $("div.spfb_t_r ul li.one4 span.col").text(SelectAttr[i].Name + "：" + $("#commodityAttr1").val());
            }
            else {
                $("div.spfb_t_r ul li.flag2").show();
                $("div.spfb_t_r ul li.one4 span.siz").text(SelectAttr[i].Name + "：" + $("#commodityAttr2").val());
            }
        }
        }

    function updateRightImg() {
        var imgList = $("#sortable div.img1 img.one");
        if (imgList.length > 0) {
            $("#showImg").attr("src", imgList[0].src);
            ajaxSaveInfo();
        }
        else {
            $("#showImg").attr("src", "/Images/comment_pic5.png");
        }
    }

    function selectCode() {
        $("#MyIframeSelectCode").attr("src", 'SelSingleTaxRateCode');
        var left = document.documentElement.clientWidth / 2 - 700 / 2;
        var top = 100;
        try {
            top = window.parent.getScrollTop();
        }
        catch (Error) {

        }

        $("#dialogSelectCode").jhtablebox({
            width: 700,
            height: 680,
            modal: true,
            resizable: false,
            title: "选择税收编码",
            position: [left, top]
        });
    }

    function ajaxSaveInfo() {
         //添加cookie清空
        $.cookie('SaveCommodityCookie', null);

        var addCommodityCookie = {};
        addCommodityCookie.AppId = getQueryString('appId');
        addCommodityCookie.CommoditCategory = encodeURIComponent($.trim($("#cateogryIdList").val()));
        addCommodityCookie.CommodityCode = encodeURIComponent($("#commoditycode").val());
        addCommodityCookie.CommodityName = encodeURIComponent($("#commodityname").val());
        addCommodityCookie.CommodityMarketPrice = encodeURIComponent($("#commoditymarketprice").val());
        addCommodityCookie.CommodityPrice = encodeURIComponent($("#commodityprice").val());
        addCommodityCookie.CommodityType = encodeURIComponent($("input[name='rdoCommodityType']:checked").val());//商品类型
        addCommodityCookie.YJCouponActivityId = encodeURIComponent($("#YJCouponActivityId").val());//活动编码
        addCommodityCookie.YJCouponType = encodeURIComponent($("#YJCouponType").val());//类型编码
        addCommodityCookie.CostPrice = encodeURIComponent($("#costPrice").val());
        @if(ViewBag.IsYJBJ)
        {
        <text>
        addCommodityCookie.CommoditInnerCategory = encodeURIComponent($.trim($("#innerCateogryIdList").val()));
        addCommodityCookie.CommoditInnerCategoryName = encodeURIComponent($("#commodityInnerCategory").val());
        addCommodityCookie.BarCode = encodeURIComponent($("#barCode").val());

        </text>
        }

        addCommodityCookie.EsCategoryName = encodeURIComponent($("#commodityEsCategory").val());
        addCommodityCookie.EsCategory = encodeURIComponent($("#EsCateogryIdList").val());

        @if(ViewBag.ShowJDCode)
        {
        <text>
        addCommodityCookie.JDCode = encodeURIComponent($("#jdCode").val());
        </text>
        }
        @if(ViewBag.ShowErQiCode)
        {
        <text>
        addCommodityCookie.ErQiCode = encodeURIComponent($("#erQiCode").val());
        </text>
        }
        addCommodityCookie.CommodityDuty = encodeURIComponent($("#commodityduty").val());
        addCommodityCookie.CommodityTaxRate = encodeURIComponent($("#commodityTaxRate").val());
        addCommodityCookie.CommodityInputTax = encodeURIComponent($("#commodityInputTax").val());
        addCommodityCookie.TaxClassCode = encodeURIComponent($("#commodityTaxClassCode").val());
        addCommodityCookie.Unit = encodeURIComponent($("#commodityUnit").val());
        addCommodityCookie.CommodityStock = encodeURIComponent($("#commoditystock").val());
        addCommodityCookie.CommoditySize = encodeURIComponent($.trim($("#sizeIdList").val()));
        addCommodityCookie.CommodityColor = encodeURIComponent($.trim($("#colorIdList").val()));
        addCommodityCookie.CommoditySizeName = encodeURIComponent($("#commoditysize").val());
        addCommodityCookie.CommodityColorName = encodeURIComponent($("#commoditycolor").val());
        addCommodityCookie.CommoditCategoryName = encodeURIComponent($("#commoditycategory").val());
        addCommodityCookie.Picture = encodeURIComponent($("#CommodityImg").attr('src'));
        addCommodityCookie.hidpic = encodeURIComponent($.trim($("#picture").val()));
        addCommodityCookie.CommodityDetails = encodeURIComponent(ue.getContent());
        addCommodityCookie.TechSpecs = encodeURIComponent(techSpecsEditor.getContent());
        addCommodityCookie.SaleService = encodeURIComponent(saleServiceEditor.getContent());

        addCommodityCookie.State = getQueryString('state') || 0;
        addCommodityCookie.listImgShowSrcString = getListImgSrcString();
        addCommodityCookie.SelectAttr = encodeURIComponent(JSON.stringify(SelectAttr));
        addCommodityCookie.FristAttrValueList = encodeURIComponent(JSON.stringify(FristAttrValueList));
        addCommodityCookie.TwoAttrValueList = encodeURIComponent(JSON.stringify(TwoAttrValueList));
        addCommodityCookie.FreightId = encodeURIComponent($("#commodityFreight").val());
        addCommodityCookie.FreightName = encodeURIComponent($("#commodityFreight").find("option:selected").text());
        addCommodityCookie.InputAttrValue = encodeURIComponent(GetInputValue());

        //是否支持自提。
        addCommodityCookie.IsEnableSelfTake = $("#chkIsEnableSelfTake").attr("checked") == "checked" ? 1 : 0;
        addCommodityCookie.PricingMethod = $("input[name=rdoPriceMethod]:checked").attr("value");
        addCommodityCookie.IsAssurance =encodeURIComponent($('#IsAssurance').val());
        addCommodityCookie.IsReturns=encodeURIComponent($("#IsReturns").val());
        addCommodityCookie.Isnsupport=encodeURIComponent($("#Isnsupport").val());
        var ServiceSettingIds="";
        $("input[name='ServiceSettingId']").each(function(){
             var ServiceSettingId=$(this).val();
             if(ServiceSettingId!=null||ServiceSettingId!=""){
                 ServiceSettingIds+=(ServiceSettingId+"|");
             }
        });
        if(ServiceSettingIds!=null||ServiceSettingIds!=""){

            ServiceSettingIds=ServiceSettingIds.substring(0,ServiceSettingIds.length-1);
        }
        addCommodityCookie.ServiceSettingId=encodeURIComponent(ServiceSettingIds);
        addCommodityCookie.Weight = $("#commodityWeight").val();
        addCommodityCookie.ScoreScale = $("#ScoreScale").val();
        //addCommodityCookie.SaleAreas = $("#SaleAreas").val();
        //addCommodityCookie.SaleAreasText = $.trim($("#saleAreastxt").text());

        //	$.ajax({
        //		url: '/Commodity/SaveCookie',
        //		type: 'post',
        //		data: addCommodityCookie,
        //		error: function (msg) {
        //			try {
        //				console.log(msg.responseText);
        //			} catch (e) {
        //			}
        //		}, success: function () {
        //
        //		}
        //
        //	});
        var arrTmp = [];
        for (var i in addCommodityCookie) {
            arrTmp.push(i + '=' + addCommodityCookie[i]);
        }
        var day = new Date();
        day.setDate(day.getDate() + 30);

        document.cookie = 'SaveCommodityCookie=' + arrTmp.join('&') + ';expires=' + day.toGMTString();
    }

    function closeWindow() {
        //window.close();
        //history.back(-1);
        window.location.href = document.referrer;
    }
    </script>
    <script type="text/javascript">
    var AttrValueList = JSON.parse('@Html.Raw(ViewBag.AttributeValueJson)');
    var SelectAttr = new Array();
    var FristAttrValueList = new Array();
    var TwoAttrValueList = new Array();
    //关联商品确定时，回调
    function commodityListFrame(ret) {
        $("#commodityListFrame").jhtablebox("close");
        $("#commodityListFrame").removeAttr("src");
        if (ret && ret.code) {
            var CommodityIds = $("#CommodityIds");
            var str = deleteNumber(ret.code, true);
            var newValue = deleteNumber(str.join(','), true);
            CommodityIds.val(newValue.join(','));
            $("#num").text("已选" + newValue.length + "件");
        }
        else if (ret.code == "") {
            var CommodityIds = $("#CommodityIds");
            CommodityIds.val("");
            $("#num").text("已选0件");
        }
    }
    //加载
    $(function () {
        $("#attributeUl input[type='checkbox']").change(function () {
            toCheckAttributeSelected(this);

            $("#attrUl1 input[type='checkbox']").change(function () {
                CreateSingleAttributeDecare(1);
            });
        });

        //            $("#freightUl input[type='checkbox']").change(function () {
        //                toCheckFreightSelected(this);
        //            });

        $("#commodityFreight").change(function () {
            ajaxSaveInfo();
        });

        $("#commodityAttribute").focus(function () {
            var top = $('#commodityAttribute').offset().top;
            var left = $('#commodityAttribute').offset().left;
            var height = $('#commodityAttribute').height();
            $("#attributeDIV").css({ "top": top + height, "left": left }).show();
            $("#categoryDiv").hide();
            $("#innerCategoryDiv").hide();
            $("#attrDIV2").hide();
            $("#attrDIV1").hide();
            $("#freightDIV").hide();
            $("#SpecificationsDIV").hide();
        });

         //初始化加载规格数据
        SearchSpecifications();

        //规格设置
        $("#Specifications").focus(function () {
            var top = $('#Specifications').offset().top;
            var left = $('#Specifications').offset().left;
            var height = $('#Specifications').height();
            $("#SpecificationsDIV").css({ "top": top + height, "left": left }).show();
            $("#categoryDiv").hide();
            $("#innerCategoryDiv").hide();
            $("#attrDIV2").hide();
            $("#attrDIV1").hide();
            $("#attributeDIV").hide();
            $("#freightDIV").hide();
        });

        $("#commodityAttr1").focus(function () {
            var top = $('#commodityAttr1').offset().top;
            var left = $('#commodityAttr1').offset().left;
            var height = $('#commodityAttr1').height();
            $("#attrDIV1").css({ "top": top + height, "left": left }).show();
            $("#categoryDiv").hide();
            $("#innerCategoryDiv").hide();
            $("#attrDIV2").hide();
            $("#attributeDIV").hide();
            $("#freightDIV").hide();
            $("#SpecificationsDIV").hide();
        });
        $("#commodityAttr2").focus(function () {
            var top = $('#commodityAttr2').offset().top;
            var left = $('#commodityAttr2').offset().left;
            var height = $('#commodityAttr2').height();
            $("#attrDIV2").css({ "top": top + height, "left": left }).show();
            $("#categoryDiv").hide();
            $("#innerCategoryDiv").hide();
            $("#attrDIV1").hide();
            $("#attributeDIV").hide();
            $("#freightDIV").hide();
            $("#SpecificationsDIV").hide();
        });

        //弹出关联商品选择窗口
        $("#relationcom").bind("click", function () {
            var url = "/Commodity/RelationCommodityList?CommodityId=00000000-0000-0000-0000-000000000000&CommodityIdList=" + $("#CommodityIds").val();
            $("#commodityListFrame").attr("src", url);
            $("#commodityListFrame").jhtablebox({
                height: 750,
                width: 910,
                resizable: false,
                title: "选择部分上架商品",
                modal: true,
                buttons: {},
                autoOpen: true,
                closedByHide: true
            });
            $("#commodityListFrame").attr("width", "910");
            $("#commodityListFrame").css("width", "910px");
        });

        $("#commodityAttr1,#commodityAttr2").focus(function () {
            if (this.value == '请选择') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '请选择';
                $(this).addClass("txtColor");
            }
        }).each(function () {
            if (this.value == '请选择') {
                $(this).addClass("txtColor");
            }
        });


        //            $("#commodityFreight").focus(function () {
        //                if (this.value == '请选择物流模板') {
        //                    this.value = '';
        //                    $(this).removeClass("txtColor");
        //                }
        //            }).blur(function () {
        //                if (this.value == '') {
        //                    this.value = '请选择物流模板';
        //                    $(this).addClass("txtColor");
        //                }
        //            }).each(function () {
        //                if (this.value == '请选择物流模板') {
        //                    $(this).addClass("txtColor");
        //                }
        //            });

        $("#chkIsEnableSelfTake").on("change", function () {
            ajaxSaveInfo();
        });
        InitAttr();




    });

    function JoinName(arr) {
        var attributeNameList = "";
        for (var i = 0; i < arr.length; i++) {
            if (i == 0) {
                attributeNameList = arr[i].Name;
            }
            else {
                attributeNameList = attributeNameList + "," + arr[i].Name;
            }
        }
        return attributeNameList;
    }
    var SelectAttrValue = new Array();
    //利用缓存初始化
    function InitAttr() {
        selectAttrStr = '@(commodityCookie != null && commodityCookie.SelectAttr != null ? commodityCookie.SelectAttr : "")';
        if (selectAttrStr != "") {
            SelectAttr = JSON.parse(decodeURIComponent(selectAttrStr));
        }

        fristAttrValueListStr = '@(commodityCookie != null && commodityCookie.FristAttrValueList != null ? commodityCookie.FristAttrValueList : "")';
        if (fristAttrValueListStr != "") {
            FristAttrValueList = JSON.parse(decodeURIComponent(fristAttrValueListStr));
        }

        twoAttrValueListStr = '@(commodityCookie != null && commodityCookie.TwoAttrValueList != null ? commodityCookie.TwoAttrValueList : "")';
        if (twoAttrValueListStr != "") {
            TwoAttrValueList = JSON.parse(decodeURIComponent(twoAttrValueListStr));
        }

        var inputAttrValueListStr = '@(commodityCookie != null && commodityCookie.InputAttrValue != null ? commodityCookie.InputAttrValue : "")';
        if (inputAttrValueListStr != "") {
            SelectAttrValue = JSON.parse(decodeURIComponent(inputAttrValueListStr));
        }


        FreightId = '@(commodityCookie != null && commodityCookie.FreightId != null ? commodityCookie.FreightId : "")';
        var FreightName = '@(commodityCookie != null && commodityCookie.FreightName != null ? commodityCookie.FreightName : "")';
        $("#commodityFreight").val(FreightId);
        //            if (FreightId != "") {
        //                $("#commodityFreight").val(FreightName);
        //                $("#commodityFreight").removeClass("txtColor");
        //                var sourceObj1 = $("#freightDIV input[type='checkbox']");
        //                sourceObj1.each(function () {
        //                    if (this.value.toLocaleLowerCase() == FreightId.toLocaleLowerCase() || $(this).nextAll('span').text().toLocaleLowerCase() == FreightName.toLocaleLowerCase()) {
        //                        this.checked = true;
        //                    } else if (this.innerHTML == val) {
        //                        this.checked = true;
        //                    }
        //                });
        //            }

        for (var i = 0; i < SelectAttr.length; i++) {
            FromatAttrValue(SelectAttr[i].Id, SelectAttr[i].Name, i + 1);
        }

        $("#commodityAttribute").val(JoinName(SelectAttr));
        $("#commodityAttribute").removeClass("txtColor");
        $("#commodityAttr1").val(JoinName(FristAttrValueList));
        $("#commodityAttr1").removeClass("txtColor");
        $("#commodityAttr2").val(JoinName(TwoAttrValueList));
        $("#commodityAttr2").removeClass("txtColor");

        var attrArray = [];
        attrArray = attrArray.concat(SelectAttr, FristAttrValueList, TwoAttrValueList);
        var attrLen = attrArray.length;
        var sourceObj = $("#attributeDIV input[type='checkbox'],#attrDIV1 input[type='checkbox'],#attrDIV2 input[type='checkbox']");
        for (var i = 0; i < attrLen; i++) {
            var val = attrArray[i];
            if (val != "") {
                sourceObj.each(function () {
                    if (this.value.toLocaleLowerCase() == val.Id.toLocaleLowerCase() || $(this).nextAll('span').text().toLocaleLowerCase() == val.Name.toLocaleLowerCase()) {
                        this.checked = true;
                    } else if (this.innerHTML == val) {
                        this.checked = true;
                    }
                });
            }
        }

        if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
            CreateAttributeDecare(0);
        }
        else {//单属性商品初始化
            CreateSingleAttributeDecare(0);
        }
        updateRight();
        ajaxSaveInfo();
    }

    var FreightId = "";
    function toCheckFreightSelected(obj) {
        var attrobj = $(obj);
        if ($("#freightUl input:checkbox:checked").length > 1) {
            alert("最多只能选择一项！");
            attrobj.attr("checked", false);
            return;
        }
        var freightIdList = "";
        var freightNameList = "";

        $("#freightUl input:checkbox:checked").each(function () {
            freightIdList = $(this).val();
            freightNameList = $(this).next().text();
        });
        FreightId = freightIdList;
        // commodityFreight
        $("#commodityFreight").val(freightNameList);
        $("#commodityFreight").removeClass("txtColor");

    }


    function toCheckAttributeSelected(obj) {
        var attrobj = $(obj);
        if ($("#attributeUl input:checkbox:checked").length > 2) {
            alert("最多只能选择两项！");
            attrobj.attr("checked", false);
            return;
        }

        if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
            if (confirm("更改会清空已填写的数据，确认更改吗")) {
                FristAttrValueList = new Array();
                TwoAttrValueList = new Array();
                $("#attributeDecareli").hide();
                $("#attributeDecareTab").html("");
                $("#tabContainer").empty();
                $("#commoditystock").attr('readonly', false);
                $("#commoditymarketprice").removeAttr("disabled");
                $("#commodityprice").removeAttr("disabled");
                $("#commodityduty").removeAttr("disabled");
                $("#commodityTaxRate").removeAttr("disabled");
                $("#costPrice").removeAttr("disabled");
                @if(ViewBag.IsYJBJ)
                {
                <text>
                $("#commoditycode").removeAttr("disabled");
                $("#barCode").removeAttr("disabled");

                </text>
                }
                @if(ViewBag.ShowJDCode)
                {
                <text>
                $("#jdCode").removeAttr("disabled");
                </text>
                }
                @if(ViewBag.ShowErQiCode)
                {
                <text>
                $("#erQiCode").removeAttr("disabled");
                </text>
                }
            }
            else {
                attrobj.attr("checked", true);
                return;
            }
        }
        let oldSelectAttrLength = SelectAttr.length;
        var attrid = attrobj.val().toLocaleLowerCase();
        $("#attrSelect1").hide();
        $("#attrSelect2").hide();

        if (attrobj.attr("checked") != true && attrobj.attr("checked") != "checked") {
            for (var i = 0; i < SelectAttr.length; i++) {
                if (SelectAttr[i].Id.toLocaleLowerCase() == attrid) {
                    SelectAttr.splice(i, 1);
                    break;
                }
            }
        }
        else {
            SelectAttr.push({ Id: attrid, Name: attrobj.next().text() });
        }
        var attributeNameList = "";
        for (var i = 0; i < SelectAttr.length; i++) {
            if (i == 0) {
                attributeNameList = SelectAttr[i].Name;
            }
            else {
                attributeNameList = attributeNameList + "," + SelectAttr[i].Name;
            }
            RestDisabledAttribute();
        }

        for (var i = 0; i < SelectAttr.length; i++) {
            FromatAttrValue(SelectAttr[i].Id, SelectAttr[i].Name, i + 1);
        }

        $("#commodityAttribute").val(attributeNameList);
        $("#commodityAttribute").removeClass("txtColor");

        if($("#attributeUl input:checkbox:checked").length === 0) {
            if(oldSelectAttrLength === 2) {
                CreateAttributeDecare(0);
            }
            if(oldSelectAttrLength === 1) {
                CreateSingleAttributeDecare(0);
            }
        }

        updateRight();
    }

    function closeAttributeDIV() {
        $("#attributeDIV").hide();
        ajaxSaveInfo();
    }


    //查询规格数据
    function  SearchSpecifications(){
        var obj={};
        obj.AppId= getQueryString("appId");
        $.ajax({
            url: '/SecondAttribute/SearchSpecifications',
            type: 'post',
            data: obj,
            success:function(data) {
                if(data.length>0){
                    $("#SpecificationsUl").empty();
                    var str="";
                    for(var i=0;i<data.length;i++) {
                        str+='<li><label><input name="chk" type="checkbox"  onchange="SpecificationsChange()"  value="1*'+data[i].Attribute+'"/><span>1*'+data[i].Attribute+'</span></label></li>';
                    }
                    $("#SpecificationsUl").append(str);
                }
            },
            error: function () {
                alert("请稍候再试");
            }
        })

    }

    //获取到改变的参数值
    function  SpecificationsChange() {
        var str="";
        $("input[name='chk']:checked").each(function(){
            str+=$(this).val()+",";
        })
        var endIndex=str.lastIndexOf(",");
        str=str.substring(0,endIndex);
        $("#Specifications").val(str);
    }


     //关闭规格设置
    function closeSpecificationsDIV()  {
           $("#SpecificationsDIV").hide();
           ajaxSaveInfo();
    }




    function closeFreightDIV() {
        $("#freightDIV").hide();
        ajaxSaveInfo();
    }

    function FromatAttrValue(attributeId, attributeName, ids) {
        $("#attrSelect" + ids).show();
        $("#commodityAttrNameTip" + ids).html("商品" + attributeName + "：");
        $("#commodityAttr" + ids).val("");
        $("#attrIdList" + ids).val("");

        $("#updateAttr" + ids).attr("href", "/SecondAttribute/AttributeIndex?AttributeId=" + attributeId + "&@getUrlParam()");
        $("#updateAttr" + ids).html("设置" + attributeName);

        var _attrValueList = new Array();

        for (var i = 0; i < AttrValueList.length; i++) {
            if (AttrValueList[i].AttributeId.toLocaleLowerCase() == attributeId.toLocaleLowerCase()) {
                _attrValueList.push(AttrValueList[i]);
            }
        }

        var html = '';
        for (var i = 0; i < _attrValueList.length; i++) {
            html += '<li><label><input type="checkbox" value="' + _attrValueList[i].Id + '"/><span>' + _attrValueList[i].Name + '</span></label></li>';
        }
        $("#attrtip" + ids).html("请选择" + attributeName + "信息");
        $("#attrUl" + ids).html(html);
        // $("#attrDiv" + ids).show();

        $("#attrUl" + ids + " input[type='checkbox']").change(function () {
            toCheckTwoAttributeSelected(this, ids);
        });
        //重新注册事件
    }

    function closeAttrDIV(ids) {
        $("#attrDIV" + ids).hide();
        ajaxSaveInfo();
    }
    var IsInput = false;
    function toCheckTwoAttributeSelected(obj, ids) {
        var attrobj = $(obj);
        var sed = true;
        if (attrobj.attr("checked") != true && attrobj.attr("checked") != "checked") {
            sed = false;
        }
        if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0 && IsInput) {
            if (!confirm("更改会清空已填写的数据，确认更改吗")) {
                attrobj.attr("checked", !sed);
                return;
            }
        }


        var tempAttr = new Array();
        var colorIdList = "";
        var colorNameList = "";

        $("#attrUl" + ids + " input:checkbox:checked").each(function () {
            tempAttr.push({ Id: $(this).val(), Name: $(this).next().text() });
            colorIdList = colorIdList + "," + $(this).val();
            colorNameList = colorNameList + "," + $(this).next().text();
        });
        if (colorIdList.length > 0) {
            colorIdList = colorIdList.substring(1, colorIdList.length);
            colorNameList = colorNameList.substring(1, colorNameList.length);
        }

        if (ids == 1) {
            FristAttrValueList = tempAttr;
        }
        else {
            TwoAttrValueList = tempAttr;
        }
        CreateAttributeDecare(1);
        $("#commodityAttr" + ids).val(colorNameList);
        $("#commodityAttr" + ids).removeClass("txtColor");
        //  $("#attrIdList" + ids).val(colorIdList);
        updateRight();
    }

    function DisabledAttribute() {
        $("#commodityprice").attr("disabled", "");
        $("#commoditymarketprice").attr("disabled", "");
        $("#commodityduty").attr("disabled", "");
        $("#commodityTaxRate").attr("disabled", "");
        $("#costPrice").attr("disabled", "");
        @if(ViewBag.IsYJBJ)
        {
        <text>
        $("#commoditycode").attr("disabled", "");
        $("#barCode").attr("disabled", "");

        </text>
        }
        @if(ViewBag.ShowJDCode)
        {
        <text>
        $("#jdCode").attr("disabled", "");
        </text>
        }
        @if(ViewBag.ShowErQiCode)
        {
        <text>
        $("#erQiCode").attr("disabled", "");
        </text>
        }
    }


    function RestDisabledAttribute() {
        $("#commodityprice").removeAttr("disabled");
        $("#commoditymarketprice").removeAttr("disabled");
        $("#commodityduty").removeAttr("disabled");
        $("#commodityTaxRate").removeAttr("disabled");
        $("#costPrice").removeAttr("disabled");
        @if(ViewBag.IsYJBJ)
        {
        <text>
        $("#commoditycode").removeAttr("disabled");
        $("#barCode").removeAttr("disabled");

        </text>
        }
        @if(ViewBag.ShowJDCode)
        {
        <text>
        $("#jdCode").removeAttr("disabled");
        </text>
        }
        @if(ViewBag.ShowErQiCode)
        {
        <text>
        $("#erQiCode").removeAttr("disabled");
        </text>
        }
    }

    //根据选择的属性创建笛卡尔积
    function CreateAttributeDecare(type) {
        IsInput = false;
        if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
            $("#commoditystock").attr('readonly', true);
            if (type == 1) {
                $("#commoditystock").val("");
            }
            var fristAttributeId = SelectAttr[0].Id;
            var twoAttributeId = SelectAttr[1].Id;
            var fristAttributeName = SelectAttr[0].Name;
            var twoAttributeName = SelectAttr[1].Name;

            attrValueList = AttrValueList;
            fristAttrValueList = FristAttrValueList;
            twoAttrValueList = TwoAttrValueList;

            var html = "";
            html += '<tr>';
            html += '<td align="center" style=" width:10%;">' + fristAttributeName + '</td>';
            html += '<td align="center" style=" width:10%;">' + twoAttributeName + '</td>';
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>价格</td>';
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" ></span>市场价</td>';
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" ></span>关税</td>';
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>库存</td>';
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>进货价</td>';
            @if(ViewBag.IsYJBJ)
            {
            <text>
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>商品条码</td>';
            html += '<td align="center" style=" width:20%;">商品编码</td>';
            </text>
            }
            @if(ViewBag.ShowJDCode)
            {
            <text>
            html += '<td align="center" style=" width:20%;">备注编码</td>';
            </text>
            }
            @if(ViewBag.ShowErQiCode)
            {
            <text>
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>标准化系统标准编码</td>';
            </text>
            }
            html += '<td align="center" style="width:25%;">商品图片</td>';
            html += '</tr>';
            // 商品SKU轮播图Html
            var carouselUlHtml = '<ul class="tabs">';
            var carouselContentHtml = "";
            var index = 0;
            for (var i = 0; i < fristAttrValueList.length; i++) {
                for (var j = 0; j < twoAttrValueList.length; j++) {
                    html += '<tr>';
                    if (j == 0) {
                        html += '<td align="center" rowspan="' + twoAttrValueList.length + '">' + fristAttrValueList[i].Name + '</td>';
                    }
                    var josn = '[{"AttributeId":"' + fristAttributeId + '","SecondAttributeId":"' + fristAttrValueList[i].Id + '","Attribute":"' + fristAttributeName + '","SecondAttribute":"' + fristAttrValueList[i].Name + '"},';
                    josn += '{"AttributeId":"' + twoAttributeId + '","SecondAttributeId":"' + twoAttrValueList[j].Id + '","Attribute":"' + twoAttributeName + '","SecondAttribute":"' + twoAttrValueList[j].Name + '"}]';
                    josn = encodeURIComponent(josn);
                    html += '<td align="center">' + twoAttrValueList[j].Name + '</td>';
                    // 商品SKU轮播图Tab Id
                    var carouselId = "carousel" + index;
                    if(index == 0) {
                        carouselUlHtml += '<li class="tab-link current" data-tab="'+ carouselId +'">'+fristAttrValueList[i].Name+'/'+twoAttrValueList[j].Name+'</li>';
                        carouselContentHtml += '<div id="'+ carouselId +'" class="tab-content current">';
                    } else {
                        carouselUlHtml += '<li class="tab-link" data-tab="'+ carouselId +'">'+fristAttrValueList[i].Name+'/'+twoAttrValueList[j].Name+'</li>';
                        carouselContentHtml += '<div id="'+ carouselId +'" class="tab-content">';
                    }
                    carouselContentHtml += `
                        <div class="spfb_b1t">
                            <span class="zihao">商品SKU详情页图样</span> <span>（</span>
                            <img src="/Images/xiaoshou.jpg"><span>直接拖动图片可调整顺序）</span> <a id="batchUploadA" style="padding-left: 100px;" href="javascript:" onclick="uploadImgBatch()">批量上传图片</a>
                            <span style="margin-left: 10px;">&nbsp;&nbsp;建议图片尺寸：640*640或640*480，根据定制平台“商品轮播版式组件”的配置匹配尺寸,单张图小于100K，推荐使用640*640；</span>
                        </div>
                    `;

                    carouselContentHtml += '<div class="spfb_b1c" id="sortable'+index+'">';
                    let mleft = 0;
                    if (type == 0) {
                        var reattr = AutoValue(fristAttrValueList[i].Name, twoAttrValueList[j].Name, fristAttributeName, twoAttributeName);
                        var marketprice = reattr.MarketPrice ? reattr.MarketPrice : '';
                        html += '<td><input type="text" name="ComPrice" value="' + reattr.Price + '" style="width: 80px;" onblur="CheckAttrPrice(this)" maxlength="12" /><input type="hidden" name="attrCache" value="' + josn + '" data-tab="'+ carouselId +'" data-tab-index="'+index+'"> <span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="MarketPrice" value="' + marketprice + '" style="width: 80px;" onblur="CheckAttrMarketPrice(this)" maxlength="12"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="Duty" value="' + (reattr.Duty || '') + '" style="width: 80px;" onblur="CheckAttrDuty(this)"  maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" value="' + (reattr.Stock || '') + '" name="ComStock" style="width: 80px;" onblur="CheckAttrNum(this)"  maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" value="' + (reattr.CostPrice || '') + '" name="ComCostPrice" style="width: 80px;" onblur="CheckAttrCostPrice(this)" maxlength="12" /><span style="paddding:0px;margin:0px;"></span></td>';
                        @if(ViewBag.IsYJBJ)
                        {
                        <text>
                        html += '<td><input type="text" value="' + (reattr.BarCode || '') + '" name="ComBarCode" style="width: 80px;" onblur="CheckAttrBarCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" value="' + (reattr.Code || '') + '" name="ComCode" style="width: 80px;" onblur="CheckAttrCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        @if(ViewBag.ShowJDCode)
                        {
                        <text>
                        html += '<td><input type="text" value="' + (reattr.JDCode || '') + '" name="ComJDCode" style="width: 80px;" onblur="CheckAttrJDCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        @if(ViewBag.ShowErQiCode)
                        {
                        <text>
                        html += '<td><input type="text" value="' + (reattr.ErQiCode || '') + '" name="ComErQiCode" style="width: 80px;" onblur="CheckAttrErQiCode(this)"/><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        if(reattr.ThumImg) {
                            html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" value="'+ reattr.ThumImg +'" /><div id="ComThumImgContent'+index+'" style="position:relative;top:0;left:0;margin-top:10px;"><img src="'+reattr.ThumImg+'" name="" width="80" height="80" class="one"/><a href="javascript:void(0);" class="del" onclick="deleteComImg(this)">x</a></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none" /></div></div></td>';
                        } else {
                            html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"></div><div><input id="ComThumPicDelBtn'+index+'" type="button" value="删除" onclick="deleteComImg(this);" style="display: none;width: 50px;float: left;margin-right: 10px;height: 28px;cursor: pointer" /><input type="file" id="ComThumPicBtn'+index+'" style="display: none" /></div></div></td>';
                        }
                        if(reattr.CarouselImgs) {
                            reattr.CarouselImgs.split(',').forEach(function(v) {
                                mleft+=114;
                                carouselContentHtml += `
                                    <div class="img1">
                                        <img src="`+v+`" width="80" height="80" class="one">
                                        <img src="/Images/finished.png" class="two" style="display: none">
                                        <img src="/Images/close.jpg" class="two" style="top: 0px;" onclick="deleteImg(this);">
                                    </div>
                                `;
                            });
                        }
                    }
                    else {
                        html += '<td><input type="text" name="ComPrice" style="width: 80px;" onblur="CheckAttrPrice(this)" maxlength="12"/><input type="hidden" name="attrCache" value="' + josn + '" data-tab="'+ carouselId +'" data-tab-index="'+index+'" /><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="MarketPrice" style="width: 80px;" onblur="CheckAttrMarketPrice(this)" maxlength="12"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text"  name="Duty" style="width: 80px;" onblur="CheckAttrDuty(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text"  name="ComStock" style="width: 80px;" onblur="CheckAttrNum(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text"  name="ComCostPrice" style="width: 80px;" onblur="CheckAttrCostPrice(this)" maxlength="12" /><span style="paddding:0px;margin:0px;"></span></td>';
                        @if(ViewBag.IsYJBJ)
                        {
                        <text>
                        html += '<td><input type="text"  name="ComBarCode" style="width: 80px;" onblur="CheckAttrBarCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text"  name="ComCode" style="width: 80px;" onblur="CheckAttrCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        @if(ViewBag.ShowJDCode)
                        {
                        <text>
                        html += '<td><input type="text" name="ComJDCode" style="width: 80px;" onblur="CheckAttrJDCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        @if(ViewBag.ShowErQiCode)
                        {
                        <text>
                        html += '<td><input type="text" name="ComErQiCode" style="width: 80px;" onblur="CheckAttrErQiCode(this)"/><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none" /></div></div></td>';
                    }
                    html += '</tr>';
                    carouselContentHtml += '</div>';
                    carouselContentHtml += `
                        <div id="addimg`+ index +`"  style="position: relative;margin-top:-`+(mleft>0?108:0)+`px; margin-left: `+ mleft +`px; padding: 10px 0 13px 30px">
                            <img src="/Images/comment_pic5.png" id="CommodityListPic`+ index +`">
                        </div>
                    `;
                    carouselContentHtml += '</div>';
                    index++;
                }
            }
            carouselUlHtml += '</ul>';
            $("#attributeDecareTab").html(html);
            $("#tabContainer").html(carouselUlHtml+carouselContentHtml);
            if (fristAttributeName != null && fristAttributeName != "" && twoAttributeName != null & twoAttributeName != "") {
               DisabledAttribute();
            }
            else {
                RestDisabledAttribute();
            }
            $("#attributeDecareli").show();
            refreshLayout();
        }
        else {
            $("#attributeDecareli").hide();
            $("#attributeDecareTab").html("");
            $("#tabContainer").empty();
            $("#commoditystock").attr('readonly', false);
        }
        initSKUCommodityPic();
    }
    function CreateSingleAttributeDecare(type) {
        IsInput = false;
        if (SelectAttr.length == 1 && TwoAttrValueList.length == 0 && FristAttrValueList.length > 0) {
            $("#commoditystock").attr('readonly', true);
            if (type == 1) {
                $("#commoditystock").val("");
            }
            var fristAttributeId = SelectAttr[0].Id;
            var twoAttributeId = "";
            var fristAttributeName = SelectAttr[0].Name;
            var twoAttributeName = "";

            attrValueList = AttrValueList;
            fristAttrValueList = FristAttrValueList;
            twoAttrValueList = TwoAttrValueList;

            var html = "";
            html += '<tr>';
            html += '<td align="center" style=" width:11%;">' + fristAttributeName + '</td>';
            //html += '<td align="center" style=" width:11%;">' + twoAttributeName + '</td>';
            html += '<td align="center" style=" width:26%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>价格</td>';
            html += '<td align="center" style=" width:26%;"><span style="color:red; paddding:0px;margin:0px;" ></span>市场价</td>';
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" ></span>关税</td>';
            html += '<td align="center" style=" width:26%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>库存</td>';
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>进货价</td>';
            @if(ViewBag.IsYJBJ)
            {
            <text>
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>商品条码</td>';
            html += '<td align="center" style=" width:20%;">商品编码</td>';
            </text>
            }
            @if(ViewBag.ShowJDCode)
            {
            <text>
            html += '<td align="center" style=" width:20%;">备注编码</td>';
            </text>
            }
            @if(ViewBag.ShowErQiCode)
            {
            <text>
            html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>标准化系统标准编码</td>';
            </text>
            }
            html += '<td align="center" style=" width:20%;">商品图片</td>';
            html += '</tr>';

            // 商品SKU轮播图Html
            var carouselUlHtml = '<ul class="tabs">';
            var carouselContentHtml = "";
            var index = 0;

            for (var i = 0; i < fristAttrValueList.length; i++) {
                html += '<tr>';
                var josn = '[{"AttributeId":"' + fristAttributeId + '","SecondAttributeId":"' + fristAttrValueList[i].Id + '","Attribute":"' + fristAttributeName + '","SecondAttribute":"' + fristAttrValueList[i].Name + '"}]';
                //josn += '{"AttributeId":"' + twoAttributeId + '","SecondAttributeId":"' + twoAttrValueList[j].Id + '","Attribute":"' + twoAttributeName + '","SecondAttribute":"' + twoAttrValueList[j].Name + '"}]';
                josn = encodeURIComponent(josn);
                html += '<td align="center">' + fristAttrValueList[i].Name + '</td>';
                // 商品SKU轮播图Tab Id
                var carouselId = "carousel" + index;
                if(index == 0) {
                    carouselUlHtml += '<li class="tab-link current" data-tab="'+ carouselId +'">'+fristAttrValueList[i].Name+'</li>';
                    carouselContentHtml += '<div id="'+ carouselId +'" class="tab-content current">';
                } else {
                    carouselUlHtml += '<li class="tab-link" data-tab="'+ carouselId +'">'+fristAttrValueList[i].Name+'</li>';
                    carouselContentHtml += '<div id="'+ carouselId +'" class="tab-content">';
                }
                carouselContentHtml += `
                    <div class="spfb_b1t">
                        <span class="zihao">商品SKU详情页图样</span> <span>（</span>
                        <img src="/Images/xiaoshou.jpg"><span>直接拖动图片可调整顺序）</span> <a id="batchUploadA" style="padding-left: 100px;" href="javascript:" onclick="uploadImgBatch()">批量上传图片</a>
                        <span style="margin-left: 10px;">&nbsp;&nbsp;建议图片尺寸：640*640或640*480，根据定制平台“商品轮播版式组件”的配置匹配尺寸,单张图小于100K，推荐使用640*640；</span>
                    </div>
                `;
                carouselContentHtml += '<div class="spfb_b1c" id="sortable'+index+'">';
                let mleft = 0;
                if (type == 0) {
                    var reattr = AutoValue(fristAttrValueList[i].Name, "", fristAttributeName, twoAttributeName);
                    var marketprice = reattr.MarketPrice ? reattr.MarketPrice : '';
                    html += '<td><input type="text" name="ComPrice" value="' + reattr.Price + '" style="width: 80px;" onblur="CheckAttrPrice(this)" maxlength="12" /><input type="hidden" name="attrCache" value="' + josn + '" data-tab-index="'+index+'" /> <span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text" name="MarketPrice" value="' + marketprice + '" style="width: 80px;" onblur="CheckAttrMarketPrice(this)" maxlength="12"/><span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text" name="Duty" value="' + (reattr.Duty || '') + '" style="width: 80px;" onblur="CheckAttrDuty(this)"  maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text" value="' + reattr.Stock + '" name="ComStock" style="width: 80px;" onblur="CheckAttrNum(this)"  maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text" value="' + (reattr.CostPrice || '') + '" name="ComCostPrice" style="width: 80px;" onblur="CheckAttrCostPrice(this)" maxlength="12" /><span style="paddding:0px;margin:0px;"></span></td>';
                    @if(ViewBag.IsYJBJ)
                    {
                    <text>

                    html += '<td><input type="text" value="' + (reattr.BarCode || '') + '" name="ComBarCode" style="width: 80px;" onblur="CheckAttrBarCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text" value="' + (reattr.Code || '') + '" name="ComCode" style="width: 80px;" onblur="CheckAttrCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                    </text>
                    }
                    @if(ViewBag.ShowJDCode)
                    {
                    <text>
                    html += '<td><input type="text" value="' + (reattr.JDCode || '') + '" name="ComJDCode" style="width: 80px;" onblur="CheckAttrJDCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                    </text>
                    }
                    @if(ViewBag.ShowErQiCode)
                    {
                    <text>
                    html += '<td><input type="text" value="' + (reattr.ErQiCode || '') + '" name="ComErQiCode" style="width: 80px;" onblur="CheckAttrErQiCode(this)"/><span style="paddding:0px;margin:0px;"></span></td>';
                    </text>
                    }
                    if(reattr.ThumImg) {
                        html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" value="'+ reattr.ThumImg +'" /><div id="ComThumImgContent'+index+'" style="position: relative;top:0;left:0;margin-top:10px;"><img src="'+reattr.ThumImg+'" name="" width="80" height="80" class="one"><a href="javascript:void(0);" class="del" onclick="deleteComImg(this);"></a></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none" /></div></div></td>';
                    } else {
                        html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none" /></div></div></td>';
                    }
                    if(reattr.CarouselImgs) {
                        reattr.CarouselImgs.split(',').forEach(function(v) {
                            mleft += 114;
                            carouselContentHtml += `
                                <div class="img1">
                                    <img src="`+v+`" width="80" height="80" class="one">
                                    <img src="/Images/finished.png" class="two" style="display: none">
                                    <img src="/Images/close.jpg" class="two" style="top: 0px;" onclick="deleteImg(this);">
                                </div>
                            `;
                        });
                    }
                }
                else {
                    html += '<td><input type="text" name="ComPrice" style="width: 80px;" onblur="CheckAttrPrice(this)" maxlength="12"/><input type="hidden" name="attrCache" value="' + josn + '" data-tab-index="'+index+'" /> <span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text" name="MarketPrice" style="width: 80px;" onblur="CheckAttrMarketPrice(this)" maxlength="12"/><span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text"  name="Duty" style="width: 80px;" onblur="CheckAttrDuty(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text"  name="ComStock" style="width: 80px;" onblur="CheckAttrNum(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text"  name="ComCostPrice" style="width: 80px;" onblur="CheckAttrCostPrice(this)" maxlength="12" /><span style="paddding:0px;margin:0px;"></span></td>';
                    @if(ViewBag.IsYJBJ)
                    {
                    <text>

                    html += '<td><input type="text"  name="ComBarCode" style="width: 80px;" onblur="CheckAttrBarCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                    html += '<td><input type="text"  name="ComCode" style="width: 80px;" onblur="CheckAttrCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                    </text>
                    }
                    @if(ViewBag.ShowJDCode)
                    {
                    <text>
                    html += '<td><input type="text"  name="ComJDCode" style="width: 80px;" onblur="CheckAttrJDCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                    </text>
                    }
                    @if(ViewBag.ShowErQiCode)
                    {
                    <text>
                    html += '<td><input type="text"  name="ComErQiCode" style="width: 80px;" onblur="CheckAttrErQiCode(this)"/><span style="paddding:0px;margin:0px;"></span></td>';
                    </text>
                    }
                    html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none" /></div></div></td>';
                }
                html += '</tr>';
                carouselContentHtml += '</div>';
                carouselContentHtml += `
                    <div id="addimg`+ index +`"  style="position: relative;margin-top:-`+(mleft>0?108:0)+`px; margin-left: `+ mleft +`px; padding: 10px 0 13px 30px">
                        <img src="/Images/comment_pic5.png" id="CommodityListPic`+ index +`">
                    </div>
                `;
                carouselContentHtml += '</div>';
                index++;
            }
            carouselUlHtml += '</ul>';
            $("#attributeDecareTab").html(html);
            $("#tabContainer").html(carouselUlHtml+carouselContentHtml);
            if (fristAttributeName != null && fristAttributeName != "") {
                DisabledAttribute();
            }
            else {
                RestDisabledAttribute();
            }
            $("#attributeDecareli").show();
            refreshLayout();
        }
        else {
            $("#attributeDecareli").hide();
            $("#attributeDecareTab").html("");
            $("#tabContainer").empty();
            $("#commoditystock").attr('readonly', false);
        }
        initSKUCommodityPic();
    }
    function refreshLayout() {
        try {
            $("body").height($("body div:first").outerHeight());
            if(!window.parent===window) {
                window.parent.refreshLayout();
            }
        }
        catch (err) {
        }
    }

    function AutoValue(fname, tname, aName1, aName2) {
        fname = fname.toLocaleLowerCase();
        tname = tname.toLocaleLowerCase();
        if (SelectAttrValue.length > 0) {
            var a1 = SelectAttrValue[0].ComAttributeIds[0].Attribute.toLocaleLowerCase();
            var a2 = SelectAttrValue[0].ComAttributeIds[1].Attribute.toLocaleLowerCase();
            aName1 = aName1.toLocaleLowerCase();
            aName2 = aName2.toLocaleLowerCase();
            if (a1 == aName1 && a2 == aName2) {
                for (var i = 0; i < SelectAttrValue.length; i++) {
                    var f = SelectAttrValue[i].ComAttributeIds[0].SecondAttribute.toLocaleLowerCase();
                    var t = SelectAttrValue[i].ComAttributeIds[1].SecondAttribute.toLocaleLowerCase();
                    if (fname == f && t == tname) {
                        IsInput = true;
                        return { Price: SelectAttrValue[i].Price, Stock: SelectAttrValue[i].Stock, MarketPrice: SelectAttrValue[i].MarketPrice, Duty: SelectAttrValue[i].Duty, CostPrice: SelectAttrValue[i].CostPrice, BarCode: SelectAttrValue[i].BarCode, Code: SelectAttrValue[i].Code, JDCode: SelectAttrValue[i].JDCode, ThumImg: SelectAttrValue[i].ThumImg, CarouselImgs: SelectAttrValue[i].CarouselImgs };
                    }
                }
            }
        }
        return "";
    }

    function CheckAttrPrice(obj) {
        var val = $(obj).val();
        var tip = $(obj).next().next();
        tip.css("color", "red");
        if (val == "") {
            $(obj).val('0.00');
            alert('金额不能为空');
            return;
        }
        if (!/^\d+(\.\d{2})?$/.test(val)) {
            if (!/^\d+(\.\d{1})?$/.test(val)) {
                $(obj).val('0.00');
                alert("请填写正确的金额最多保留2位小数");
                return;
            }
        }
        if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
            if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                alert("最多填写9位正数");
                return;
            }
        }

        val = parseFloat(val);
        if (val < 0) {
            $(obj).val('0.00');
            alert('金额不可为负数');
            return;
        }

        var marketprice = $(obj).parent().next().find('input:first').val();
        if (val > parseFloat(marketprice)) {
            //$(obj).parent().next().find('span:first').html("不得大于市场价").css("color", "red");
            tip.html("不得大于市场价");
            return;
        }

        var maxprice = 9999999999;
        var hasprice = false;
        var barCode = '';
        var comCode = '';
        var jdCode = '';
        $("input[name='ComPrice']").each(function () {
            var s = $(this).val();
            if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                maxprice = parseFloat(s);
                hasprice = true;
                barCode = $(this).parent().next().next().next().next().next().children().eq(0).val();
                comCode = $(this).parent().next().next().next().next().next().next().children().eq(0).val();
                jdCode = $(this).parent().next().next().next().next().next().next().next().children().eq(0).val();
            }
        });
        if (hasprice) {
            $("#commodityprice").val(maxprice);
            if(barCode){
                $("#barCode").val(barCode).removeClass('txtColor');
            }
            if(comCode){
                $("#commoditycode").val(comCode).removeClass('txtColor');
            }
            if(jdCode){
                $("#jdCode").val(jdCode).removeClass('txtColor');
            }
        }

        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }
    function CheckAttrMarketPrice(obj) {
        var val = $(obj).val();
        var tip = $(obj).next();
        tip.css("color", "red");
        if (val == "") {
            return;
        }
        if (!/^\d+(\.\d{2})?$/.test(val)) {
            if (!/^\d+(\.\d{1})?$/.test(val)) {
                $(obj).val('0.00');
                alert("请填写正确的金额最多保留2位小数");
                return;
            }
        }
        if (val < 0) {
            $(obj).val('0.00');
            alert('金额不可为负数');
            return;
        }
        if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
            if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                alert("最多填写9位正数");
                return;
            }
        }

        var price = $(obj).parent().prev().find('input:first').val();
        if (parseFloat(val) < parseFloat(price)) {
            //$(obj).parent().next().find('span:first').html("不得大于市场价").css("color", "red");
            tip.html("不得小于现价");
            return;
        }

        var maxprice = 9999999999;
        var hasprice = false;
        $("input[name='MarketPrice']").each(function () {
            var s = $(this).val();
            if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                maxprice = parseFloat(s);
                hasprice = true;
            }
        });
        if (hasprice) {
            $("#commoditymarketprice").val(maxprice);
        }


        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }
    function CheckAttrNum(obj) {
        var n = 0;
        $("input[name='ComStock']").each(function () {
            var s = $(this).val();
            if (s != "" && /^\d+?$/.test(s)) {
                n += parseInt(s);
            }
        });
        $("#commoditystock").val(n);

        var v = $(obj).val();
        var tip = $(obj).next();
        tip.css("color", "red");
        if (v == "") {
            tip.html("不能为空");
            return;
        }
        if (!/^\d+?$/.test(v)) {
            tip.html("格式错误");
            return;
        }

        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }
    function CheckAttrDuty(obj) {
        var val = $(obj).val();
        var tip = $(obj).next();
        tip.css("color", "red");
        if (val == "") {
            return;
        }
        if (!/^\d+(\.\d{2})?$/.test(val)) {
            if (!/^\d+(\.\d{1})?$/.test(val)) {
                tip.html("格式错误");
                return;
            }
        }
        if (val < 0) {
            $(obj).val('0.00');
            alert('金额不可为负数');
            return;
        }
        if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
            if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                alert("最多填写9位正数");
                return;
            }
        }

        var maxprice = 9999999999;
        var hasprice = false;
        $("input[name='Duty']").each(function () {
            var s = $(this).val();
            if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                maxprice = parseFloat(s);
                hasprice = true;
            }
        });
        if (hasprice) {
            $("#commodityduty").val(maxprice).removeClass('txtColor');
        } else {
            $("#commodityduty").val("请输入正数最多两位小数").addClass('txtColor');
        }

        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }

    function CheckAttrCostPrice(obj) {
        var val = $(obj).val();
        var tip = $(obj).next().next();
        tip.css("color", "red");
        if (val == "") {
            $(obj).val('0.00');
            alert('金额不能为空');
            return;
        }
        if (!/^\d+(\.\d{2})?$/.test(val)) {
            if (!/^\d+(\.\d{1})?$/.test(val)) {
                $(obj).val('0.00');
                alert("请填写正确的金额最多保留2位小数");
                return;
            }
        }
        if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
            if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                alert("最多填写9位正数");
                return;
            }
        }

        val = parseFloat(val);
        if (val < 0) {
            $(obj).val('0.00');
            alert('金额不可为负数');
            return;
        }

        var maxprice = 9999999999;
        var hasprice = false;
        $("input[name='ComCostPrice']").each(function () {
            var s = $(this).val();
            if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                maxprice = parseFloat(s);
                hasprice = true;
            }
        });

        if (hasprice) {
            $("#costPrice").val(maxprice).removeClass('txtColor');
        }
        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }

    function CheckAttrBarCode(obj) {
        var val = $(obj).val();
        var tip = $(obj).next();
        tip.css("color", "red");
        if (val == "") {
            tip.html("不能为空");
            return;
        }
        var maxprice = 9999999999;
        var barCode = '';
        var hasprice = false;
        $("input[name='ComPrice']").each(function () {
            var s = $(this).val();
            if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                maxprice = parseFloat(s);
                hasprice = true;
                barCode = $(this).parent().next().next().next().next().next().children().eq(0).val();
            }
        });

        if (hasprice&&barCode==val) {
            $("#barCode").val(val).removeClass('txtColor');
        }

        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }
    function CheckAttrErQiCode(obj) {
        var val = $(obj).val();
        var tip = $(obj).next();
        tip.css("color", "red");
        if (val == "") {
            tip.html("不能为空");
            return;
        }
        var maxprice = 9999999999;
        var barCode = '';
        var hasprice = false;
        $("input[name='ComPrice']").each(function () {
            var s = $(this).val();
            if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                maxprice = parseFloat(s);
                hasprice = true;
                barCode = $(this).parent().next().next().next().next().next().children().eq(0).val();
            }
        });

        if (hasprice&&barCode==val) {
            $("#barCode").val(val).removeClass('txtColor');
        }

        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }

    function CheckAttrCode(obj){
        var val = $(obj).val();
        var tip = $(obj).next();
        tip.css("color", "red");
        if (val == "") {
            return;
        }

        var maxprice = 9999999999;
        var barCode = '';
        var hasprice = false;
        $("input[name='ComPrice']").each(function () {
            var s = $(this).val();
            if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                maxprice = parseFloat(s);
                hasprice = true;
                barCode = $(this).parent().next().next().next().next().next().next().children().eq(0).val();
            }
        });

        if (hasprice&&barCode==val) {
            $("#commoditycode").val(val).removeClass('txtColor');
        }

        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }

    function CheckAttrJDCode(obj){
        var val = $(obj).val();
        var tip = $(obj).next();
        tip.css("color", "red");
        if (val == "") {
            return;
        }

        var maxprice = 9999999999;
        var barCode = '';
        var hasprice = false;
        $("input[name='ComPrice']").each(function () {
            var s = $(this).val();
            if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                maxprice = parseFloat(s);
                hasprice = true;
                barCode = $(this).parent().next().next().next().next().next().next().next().children().eq(0).val();
            }
        });

        if (hasprice&&barCode==val) {
            $("#jdCode").val(val).removeClass('txtColor');
        }

        tip.html("");
        tip.css("color", "");
        IsInput = true;
        ajaxSaveInfo();
    }

    var msgError = "";
    function CheckAttr() {
        msgError = "";
        if (SelectAttr.length > 0) {
            if (FristAttrValueList.length <= 0) {
                msgError = "商品" + SelectAttr[0].Name + "不能为空";
                return false;
            }
        }

        if (SelectAttr.length > 1) {
            if (TwoAttrValueList.length <= 0) {
                msgError = "商品" + SelectAttr[1].Name + "不能为空";
                return false;
            }
        }
        return true;
    }

    var IsCanSumbit = true;
    function CheckData(price, stock) {
        if (stock == "" || price == "") {
            IsCanSumbit = false;
            return;
        }
        if (!/^\d+?$/.test(stock)) {
            IsCanSumbit = false;
            return;
        }
        if (!/^\d+(\.\d{2})?$/.test(price)) {
            if (!/^\d+(\.\d{1})?$/.test(price)) {
                IsCanSumbit = false;
                return;
            }
        }

        //            if (stock <= 0 || price <= 0) {
        //                IsCanSumbit = false;
        //                return;
        //            }

    }

    function checkMoneyRange(money, canZero, isNullable) {
        if ((money == "" || money == null) && isNullable) {
            return true;
        }
        if (canZero) {
            if (money > 999999999.99 || money < 0)
                return false;
        } else {
            if (money > 999999999.99 || money <= 0)
                return false;
        }
        return true;
    }
    // 获取用户输入的属性值
    function GetInputValue() {
        IsCanSumbit = true;
        var selectJson = "[";
        $("input[name='attrCache']").each(function () {
            var price = $(this).prev().val();
            var marketprice = $(this).parent().next().children().eq(0).val();
            var duty = $(this).parent().next().next().children().eq(0).val();
            var stock = $(this).parent().next().next().next().children().eq(0).val();
            var CostPrice = $(this).parent().next().next().next().next().children().eq(0).val();
            var BarCode = $(this).parent().next().next().next().next().next().children().eq(0).val();
            var Code = $(this).parent().next().next().next().next().next().next().children().eq(0).val();
            var JDCode = $(this).parent().next().next().next().next().next().next().next().children().eq(0).val();
            var erQiCode = $(this).parent().next().next().next().next().next().next().next().next().children().eq(0).val();
            // 计算图片地址
            var index = $(this).attr('data-tab-index');
            var ThumImg = $("#ComThumImgSrc"+index).val();
            var src = [];
            $("#sortable"+index).find('.one').each(function () {
                src.push($(this).attr("src"));
            });
            var CarouselImgs = src.join(',');

            marketprice = $.trim(marketprice) == '' ? null : $.trim(marketprice);
            if (duty) {
                if (!/^\d+(\.\d{2})?$/.test(duty)) {
                    if (!/^\d+(\.\d{1})?$/.test(duty)) {
                        IsCanSumbit = false;
                    }
                }
            }

            @if(ViewBag.IsYJBJ)
            {
            <text>
            if(!BarCode) {
                IsCanSumbit = false;
            }
            </text>
            }
            duty = $.trim(duty) == '' ? null : $.trim(duty);
            var t = '{"ComAttributeIds":' + decodeURIComponent($(this).val()) + ',"Price":"' + price + '","Stock":"' + stock + '","MarketPrice":' + marketprice + ',"Duty":' + duty + ',"CostPrice":"' + CostPrice + '","BarCode":"' + BarCode + '","Code":"' + Code + '","JDCode":"' + JDCode + '","ErQiCode":"' + erQiCode + '", "ThumImg":"' + ThumImg + '", "CarouselImgs":"' + CarouselImgs + '"}';
            if (selectJson == "[") {
                selectJson += t;
            }
            else {
                selectJson += "," + t;
            }
            if (IsCanSumbit) {
                CheckData(price, stock);
            }
        });
        if (selectJson != "]") {
            selectJson += "]";
            return selectJson;
        }
        return "";
    }
    //校验市场价是否合法
    //市场价不能小于商品现价
    function CheckMarketPrice() {
        var result = true;
        var multAttr = false;
        $("input[name='attrCache']").each(function () {
            multAttr = true;
            var price = $(this).prev().val();
            var marketprice = $(this).parent().next().children().eq(0).val();
            if (parseFloat(price) > parseFloat(marketprice)) {
                result = false;
                return;
            }
        });
        if (!multAttr) {
            var price = $("#commodityprice").val();
            var marketprice = $("#commoditymarketprice").val();
            if (parseFloat(price) > parseFloat(marketprice)) {
                result = false;
            }
        }
        return result;
    }

        //获取只有一个属性的字符串
    function GetOneAttrStr() {
        var attributeNames = "";
        var attributeIds = "";
        var attrName = "";
        var attrId = "";
        if (SelectAttr.length == 1) {
            for (var i = 0; i < FristAttrValueList.length; i++) {
                if (i == 0) {
                    attributeNames = FristAttrValueList[i].Name;
                    attributeIds = FristAttrValueList[i].Id;
                }
                else {
                    attributeNames = attributeNames + "," + FristAttrValueList[i].Name;
                    attributeIds = attributeIds + "," + FristAttrValueList[i].Id;
                }
            }
            attrId = SelectAttr[0].Id;
            attrName = SelectAttr[0].Name;
        }
        return { attrIds: attributeIds, attrNames: attributeNames, attrName: attrName, attrId: attrId };
    }
    function deleteNumber(str, type) {
        var arr = str.split(',');
        var tmpArr = [];
        var tmpObj = {};
        var tmpValue = '';
        for (var i = 0; i < arr.length; i++) {
            tmpValue = $.trim(arr[i]);
            if (!tmpObj[tmpValue] && tmpValue) {
                if (tmpValue == '请选择商品编号') {
                    break;
                }
                tmpObj[tmpValue] = true;
                tmpArr.push(tmpValue);
            }
        }
        return type ? tmpArr : tmpArr.join(',');
    }

    function ConfirmAppDistrictOption(arg) {
        if (arg.length > 0) {
            var saleAreas = "";
            var saleAreasText = "";
            for (var i = 0; i < arg.length - 1; i++) {
                saleAreas += arg[i].AreaCode + ",";
                saleAreasText += arg[i].AreaName + "、";
            }
            saleAreas += arg[arg.length - 1].AreaCode;
            saleAreasText += arg[arg.length - 1].AreaName;
            //alert(saleAreas);
            $("#SaleAreas").val(saleAreas);
            if (saleAreas == "000000") {
                $("#saleAreastxt").text("全网销售");
            } else {
                $("#saleAreastxt").text(saleAreasText);
            }
        }
        else {
            $("#SaleAreas").val("");
            $("#saleAreastxt").text("未指定销售区域");
        }
        ajaxSaveInfo();

        closeDivSetSaleAreasDialog();
    }
    function CancelAppDistrictOption() {
        closeDivSetSaleAreasDialog();
    }
    function GetAppDistrictOption() {
        var tem = $("#SaleAreas").val();
        var arg = tem;
        var code = arg.split(',');
        var a = new Array();
        for (var i = 0; i < code.length; i++) {
            a[i] = {};
            a[i].AreaCode = code[i];
        }
        return a;
    }

    function ShowDivSetSaleAreasDialog() {

        $("#divSetSaleAreasDialog").jhtablebox({
            height: 530,
            width: 632,
            resizable: false,
            title: "选择区域",
           // position: [300, 125],
            modal: true,
            closedByHide: false
        });
      //  $("#divSetSaleAreasDialog").parent().css({ "position": "fixed", "top": 125, "left": 300 });

    }
    function closeDivSetSaleAreasDialog() {
        $("#divSetSaleAreasDialog").jhtablebox("close");
    }

    // 视频地址

    function VideoDivAlert() {

        $("#divSetVideoDialog").jhtablebox({
            height: 640,
            width: 850,
            resizable: false,
            title: "添加多媒体",
            position: [300, 50],
            modal: true,
            closedByHide: false
        });
        $("#divSetVideoDialog").parent().css({ "position": "fixed", "top": 50, "left": 300 });

    }
    function toDeleteVideo() {
        if ($("#VideoName").html()) {
            $("<div></div>").jhtablebox({
                position: [300, 125],
                type: "Confirm",
                title: "消息提示",
                content: "您确认要删除视频吗？",
                autoOpen: true,
                confirm: function () {
                    $("#deleVideo").hide();
                    $("#VideoName").html("");
                    $("#VideoUrl").html("");
                    $("#VideoWebUrl").html("");
                    $("#VideoPicUrl").html("");
                }
            });

        } else {
            alert("没有可删除的视频！");
        }
    }
    function MediaSelectComplete(result) {
        if (result.operation == "confirm") {
            document.getElementById("VideoName").innerText = result.name;
            $("#deleVideo").show();
            document.getElementById("VideoUrl").innerText = result.clientUrl;
            document.getElementById("VideoWebUrl").innerText = result.url;
            document.getElementById("VideoPicUrl").innerText = result.thumbnailUrl;
        }

        $("#divSetVideoDialog").jhtablebox("close");
    }

    // 初始化上传图片
    function initUplodaImg() {
        $("#comdtyPicBtn").uploadify({
            'swf': '@Url.Content("~/scripts/uploadify/uploadify.swf")',
            'auto': true,
            'multi': false,
            'width': 80,
            'height': 28,
            'buttonText': '上传图片',
            'buttonImage': '/Content/images/btn80.png',
            'fileTypeDesc': 'Image',
            'fileTypeExts': '*.jpg;*.png',
            'preventCaching': true,
            'uploader': '/AppImage/DirectUploadWH',
            'formData': { "iHeight": 316, "iWidth": 316 },
            'onUploadSuccess': function (file, data, response) {
                if (data != "false") {
                    if (data != "size" && data != "whsize") {
                        var httpurl = data;
                        $("#CommodityImg").attr("src", httpurl);
                        ajaxSaveInfo();
                        $('#picture').val(httpurl);
                        refreshLayout();
                    } else if (data == "size") {
                        alert("请上传50K以内的图片！");
                    } else {
                        alert("请按要求高度和宽度上传图片！");
                    }
                } else {
                    alert("上传失败！");
                }
            },
            'onUploadError': function (file, errorCode, errorMes) {
                alert("上传失败，请稍后再试");
            },
            'onFallback': function () {
                alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试");
            },
            fileSizeLimit: '50KB',
            onSelectError: function (file, errorCode, errorMsg) {
                switch (errorCode) {
                    case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:
                        this.queueData.errorMsg = '建议图片小于50K！';
                        break;
                }
            }
        });
    }

    var leftValue = 0;
    function initUplodaCommodityListPic() {
        $("#CommodityListPic").uploadify({
            'swf': '@Url.Content("~/scripts/uploadify/uploadify.swf")',
            'auto': true,
            'multi': false,
            'width': 85,
            'height': 85,
            'buttonText': '',
            'buttonImage': '/Images/comment_pic5.png',
            'fileTypeDesc': 'Image',
            'fileTypeExts': '*.jpg;*.png',
            'preventCaching': true,
            'uploader': '/AppImage/DirectUploadWH',
            'formData': { "iHeight": 640, "iWidth": 640 },
            'onUploadSuccess': function (file, data) {
                if (data !== "false") {
                    if ($("#sortable").find('.one').length < 5) {
                        var a = newGuid();
                        var htmlContent = '<div id="' + a + '" class="img1">' +
                                '<img src="{src}" name="" width="80" height="80" class="one">' +
                                '<img src="/Images/finished.png" class="two" style="display: none">' +
                                '<img src="/Images/close.jpg" class="two" style="top: 0px;" onclick="deleteImg(this);">' +
                                '</div>';
                        htmlContent = htmlContent.replace("{src}", data);
                        $("#sortable").append(htmlContent);

                        leftValue = $("#addimg").css('margin-left');
                        if (leftValue === undefined) {
                            leftValue = 0;
                        } else {
                            leftValue = leftValue.substring(0, 3);
                        }
                        leftValue = parseInt(leftValue) + 114;
                        $("#addimg").css('margin-top', '-108px');
                        $("#addimg").css('margin-left', leftValue + "px");

                        //更新右部手机图
                        updateRight();
                        dialogImgClosed();
                        //保存数据到 cookie.
                        ajaxSaveInfo();
                    } else {
                        alert("最多只能上传5张图片！");
                    }

                } else {
                    alert("上传失败！");
                }
            },
            'onUploadError': function () {
                alert("上传失败，请稍后再试");
            },
            'onFallback': function () {
                alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试");
            },
            fileSizeLimit: '100KB',
            'onSelectError': function (file, errorCode, errorMsg) {
                switch (errorCode) {
                    case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:
                        this.queueData.errorMsg = '建议图片小于100K！';
                        break;
                }
            }
        });
        $("#CommodityListPic-queue").remove();
    }
    function deleteImg(img) {
        if (img.parentNode !== undefined) {

            var $addimg = $(img).parent().parent().parent().children().eq(2);
            var cleftValue = $addimg.css('margin-left');
            cleftValue = parseInt(cleftValue.substring(0, 3)) - 114;
            if (cleftValue === 0) {
                $addimg.css('margin-top', "0px");
            }
            $addimg.css('margin-left', cleftValue + "px");
            img.parentNode.remove();
        }
    }

    // 初始化商品SKU图片
    function initSKUCommodityPic() {
        var skuTotal = 0;
        if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
            skuTotal = TwoAttrValueList.length*FristAttrValueList.length;
        } else if(SelectAttr.length == 1 && TwoAttrValueList.length == 0 && FristAttrValueList.length > 0) {
            skuTotal = FristAttrValueList.length;
        }
        if (skuTotal > 0) {
            for (let i=0;i<skuTotal;i++) {
                // 缩略图
                $("#ComThumPicBtn"+i).uploadify({
                    'swf': '@Url.Content("~/scripts/uploadify/uploadify.swf")',
                    'auto': true,
                    'multi': false,
                    'width': 60,
                    'height': 28,
                    'buttonText': '上传图片',
                    'buttonImage': '/Content/images/btn80.png',
                    'fileTypeDesc': 'Image',
                    'fileTypeExts': '*.jpg;*.png',
                    'preventCaching': true,
                    'uploader': '/AppImage/DirectUploadWH',
                    'formData': { "iHeight": 316, "iWidth": 316 },
                    'removeTimeout': 1,
                    'onUploadSuccess': function (file, data, response) {
                        if (data != "false") {
                            if (data != "size" && data != "whsize") {
                                var httpurl = data;
                                $("#ComThumImgContent"+i).html('<img src="' + data + '" name="" width="80" height="80" class="one"><a href="javasctipt:void(0)" class="del" onclick="deleteComImg(this);">x</a>');
                                $("#ComThumPicDelBtn"+i).show();
                                $("#ComThumImgSrc"+i).val(httpurl);
                                ajaxSaveInfo();
                            } else if (data == "size") {
                                alert("请上传50K以内的图片！");
                            } else {
                                alert("请按要求高度和宽度上传图片！");
                            }
                        } else {
                            alert("上传失败！");
                        }
                    },
                    'onUploadError': function (file, errorCode, errorMes) {
                        alert("上传失败，请稍后再试");
                    },
                    'onFallback': function () {
                        alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试");
                    },
                    fileSizeLimit: '50KB',
                    onSelectError: function (file, errorCode, errorMsg) {
                        switch (errorCode) {
                            case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:
                                this.queueData.errorMsg = '建议图片小于50K！';
                                break;
                        }
                    }
                });

                // 轮播图
                $("#CommodityListPic"+i).uploadify({
                    'swf': '@Url.Content("~/scripts/uploadify/uploadify.swf")',
                    'auto': true,
                    'multi': false,
                    'width': 85,
                    'height': 85,
                    'buttonText': '',
                    'buttonImage': '/Images/comment_pic5.png',
                    'fileTypeDesc': 'Image',
                    'fileTypeExts': '*.jpg;*.png',
                    'preventCaching': true,
                    'uploader': '/AppImage/DirectUploadWH',
                    'formData': { "iHeight": 640, "iWidth": 640 },
                    'onUploadSuccess': function (file, data) {
                        if (data !== "false") {
                            if ($("#sortable"+i).find('.one').length < 5) {
                                var a = newGuid();
                                var htmlContent = '<div id="' + a + '" class="img1">' +
                                        '<img src="{src}" name="" width="80" height="80" class="one">' +
                                        '<img src="/Images/finished.png" class="two" style="display: none">' +
                                        '<img src="/Images/close.jpg" class="two" style="top: 0px;" onclick="deleteImg(this);">' +
                                        '</div>';
                                htmlContent = htmlContent.replace("{src}", data);
                                $("#sortable"+i).append(htmlContent);

                                leftValue = $("#addimg"+i).css('margin-left');
                                if (leftValue === undefined) {
                                    leftValue = 0;
                                } else {
                                    leftValue = leftValue.substring(0, 3);
                                }
                                leftValue = parseInt(leftValue) + 114;
                                $("#addimg"+i).css('margin-top', '-108px');
                                $("#addimg"+i).css('margin-left', leftValue + "px");
                                dialogImgClosed();
                                //保存数据到 cookie.
                                ajaxSaveInfo();
                            } else {
                                alert("最多只能上传5张图片！");
                            }

                        } else {
                            alert("上传失败！");
                        }
                    },
                    'onUploadError': function () {
                        alert("上传失败，请稍后再试");
                    },
                    'onFallback': function () {
                        alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试");
                    },
                    fileSizeLimit: '100KB',
                    'onSelectError': function (file, errorCode, errorMsg) {
                        switch (errorCode) {
                            case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:
                                this.queueData.errorMsg = '建议图片小于100K！';
                                break;
                        }
                    }
                });
                $("#CommodityListPic"+i+"-queue").remove();
            }
            /***************Tabs***************/
            $('ul.tabs li').click(function(){
                var tab_id = $(this).attr('data-tab');

                $('ul.tabs li').removeClass('current');
                $('.tab-content').removeClass('current');

                $(this).addClass('current');
                $("#"+tab_id).addClass('current');
            });
        } else {
            $("#tabContainer").empty();
        }
    }

    // 删除商品SKU缩略图
    function deleteComImg(img) {
        $(img).parent().prev().prev().val("");
        $(img).parent().html("");
    }
    </script>
</head>
<div class="box">
    <div class="content">
        <div class="right right1">
            <div class="spfb_t">
                <div class="spfb_t_l" style="width: 1200px">
                    <ul>
                        <li>
                            <h2>基本信息</h2>
                        </li>
                        <li style="display:@ctreeDisplay">
                            <span>店铺分类：</span>
                            @if (commodityCookie != null && commodityCookie.CommoditCategoryName != null)
                            {
                                <input type="text" id="commoditycategory" value="@commodityCookie.CommoditCategoryName"
                                       readonly="readonly" />
                            }
                            else
                            {
                                <input type="text" id="commoditycategory" value="请选择" readonly="readonly" class="txtColor" />
                            }
                            @if (commodityCookie != null && commodityCookie.CommoditCategory != null)
                            {
                                <input type="hidden" id="cateogryIdList" value="@commodityCookie.CommoditCategory" />
                            }
                            else
                            {
                                <input type="hidden" id="cateogryIdList" value="" />
                            }
                            <a target="_self" href="javascript:" id="changecategory">类目设置</a>
                        </li>


                        <li class="dxin">
                            @*<img src="/Images/xin.png"/>*@
                            <span>品&nbsp;&nbsp;&nbsp;&nbsp;牌：</span>
                            <input type="text" id="commoditybrand" value="请选择" readonly="readonly" class="txtColor" />
                            <input type="hidden" id="hidBrandAppId" value="@ViewBag.BrandAppId " />
                        </li>


                        @if (ViewBag.IsYJBJ)
                        {
                            <li style="display:@ctreeDisplay">
                                <img src="/Images/xin.png" /><span style="margin-left:2px;">商城品类：</span>
                                @if (commodityCookie != null && commodityCookie.CommoditInnerCategoryName != null)
                                {
                                    <input type="text" id="commodityInnerCategory" value="@commodityCookie.CommoditInnerCategoryName"
                                           readonly="readonly" />
                                }
                                else
                                {
                                    <input type="text" id="commodityInnerCategory" value="请选择" readonly="readonly" class="txtColor" />
                                }
                                @if (commodityCookie != null && commodityCookie.CommoditInnerCategory != null)
                                {
                                    <input type="hidden" id="innerCateogryIdList" value="@commodityCookie.CommoditInnerCategory" />
                                }
                                else
                                {
                                    <input type="hidden" id="innerCateogryIdList" value="" />
                                }
                                @if (ViewBag.IsYJApp)
                                {
                                    <a target="_self" href="javascript:" id="changeInnerCategory">品类设置</a>
                                }
                                <span style="coloe:gray">此品类为商城管理使用品类</span>
                            </li>

                            if (ViewBag.IsShowEsCategory)
                            {
                                <li style="display:@ctreeDisplay">
                                    <img src="/Images/xin.png" /><span style="margin-left:2px;">前端分类：</span>
                                    @if (commodityCookie != null && commodityCookie.EsCategoryName != null)
                                    {
                                        <input type="text" id="commodityEsCategory" value="@commodityCookie.EsCategoryName"
                                               readonly="readonly" />
                                    }
                                    else
                                    {
                                        <input type="text" id="commodityEsCategory" value="请选择" readonly="readonly" class="txtColor" />
                                    }
                                    @if (commodityCookie != null && commodityCookie.EsCategory != null)
                                    {
                                        <input type="hidden" id="EsCateogryIdList" value="@commodityCookie.EsCategory" />
                                    }
                                    else
                                    {
                                        <input type="hidden" id="EsCateogryIdList" value="" />
                                    }
                                </li>
                            }

                                <li class="dxin">
                                    <img src="/Images/xin.png" />
                                    <span>商品条码：</span>
                                    @if (commodityCookie != null && !string.IsNullOrEmpty(commodityCookie.BarCode))
                                    {
                                        <input type="text" id="barCode" value="@commodityCookie.BarCode" class="txtColor" />
                                    }
                                    else
                                    {
                                        <input type="text" id="barCode" value="请输入商品条形码" class="txtColor" />
                                    }
                                </li>
                            }


                            @if (ViewBag.IsYJBJ)
                            {
                                <li>
                                    <span>商品类型：</span>
                                    <input id="idSW" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoCommodityType"
                                           value="0" checked="checked" />
                                    <label for="idSW">
                                        实物商品
                                    </label>
                                    <input id="idXN" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoCommodityType"
                                           value="1" />
                                    <label for="idXN">
                                        虚拟商品（卡密）
                                    </label>
                                </li>
                            }






                            <li class="dxin" style="display: none" id="liYJCouponActivityId">
                                <img src="/Images/xin.png" />
                                <span>活动编码：</span>
                                @if (commodityCookie != null && commodityCookie.YJCouponActivityId != null)
                                {
                                    <input type="text" id="YJCouponActivityId" value="@commodityCookie.YJCouponActivityId" class="txtColor" maxlength="60" />
                                }
                                else
                                {
                                    <input type="text" id="YJCouponActivityId" value="最多60个字" class="txtColor" maxlength="60" />
                                }
                            </li>
                            <li class="dxin" style="display: none" id="liYJCouponType">
                                <img src="/Images/xin.png" />
                                <span>类型编码：</span>
                                @if (commodityCookie != null && commodityCookie.YJCouponType != null)
                                {
                                    <input type="text" id="YJCouponType" value="@commodityCookie.YJCouponType" class="txtColor" maxlength="60" />
                                }
                                else
                                {
                                    <input type="text" id="YJCouponType" value="最多60个字" class="txtColor" maxlength="60" />
                                }
                            </li>

                            <li>
                                <span>商品编号：</span>
                                @if (commodityCookie != null && commodityCookie.CommodityCode != null)
                                {
                                    <input type="text" id="commoditycode" value="@commodityCookie.CommodityCode" class="txtColor" maxlength="@Jinher.AMP.BTP.Common.InputControl.Commodity_NoCode_Length" />
                                }
                                else
                                {
                                    <input type="text" id="commoditycode" value="" class="txtColor" maxlength="@Jinher.AMP.BTP.Common.InputControl.Commodity_NoCode_Length" />
                                }
                                <span style="margin: 0; color: red;"></span>
                            </li>
                            @if (ViewBag.ShowJDCode)
                            {
                                <li>
                                    <span>备注编码：</span>
                                    @if (commodityCookie != null && commodityCookie.JDCode != null)
                                    {
                                        <input type="text" id="jdCode" value="@commodityCookie.JDCode" class="txtColor" />
                                    }
                                    else
                                    {
                                        <input type="text" id="jdCode" value="" class="txtColor" />
                                    }
                                    <span style="margin: 0; color: red;"></span>
                                </li>
                            }
                            @if (ViewBag.ShowErQiCode)
                            {
                                <li>
                                    <img src="/Images/xin.png" />
                                    <span>标准化系统标准编码：</span>
                                    @if (commodityCookie != null && commodityCookie.ErQiCode != null)
                                    {
                                        <input type="text" id="erQiCode" value="@commodityCookie.ErQiCode" class="txtColor" />
                                    }
                                    else
                                    {
                                        <input type="text" id="erQiCode" value="" class="txtColor" />
                                    }
                                    <span style="margin: 0; color: red;"></span>
                                </li>
                            }
                            <li class="dxin">
                                <img src="/Images/xin.png" />
                                <span>商品名称：</span>
                                @if (commodityCookie != null && commodityCookie.CommodityName != null)
                                {
                                    if (isCustomES)
                                    {
                                        <input type="text" id="commodityname" value="@commodityCookie.CommodityName" class="txtColor"
                                               maxlength="60" />
                                    }
                                    else
                                    {
                                        <input type="text" id="commodityname" value="@commodityCookie.CommodityName" class="txtColor"
                                               maxlength="30" />
                                    }

                                }
                                else
                                {
                                    if (isCustomES)
                                    {
                                        <input type="text" id="commodityname" value="最多60个字" class="txtColor" maxlength="60" />
                                    }
                                    else
                                    {
                                        <input type="text" id="commodityname" value="最多30个字" class="txtColor" maxlength="30" />
                                    }

                                }
                                <input type="hidden" value="" id="commodityState" />
                            </li>
                            <li>
                                <span style="margin-left: 33px">市场价：</span>
                                @if (commodityCookie != null && !commodityCookie.CommodityMarketPrice.IsNullVauleFromWeb() && commodityCookie.CommodityMarketPrice != "请输入正数最多两位小数")
                                {
                                    <input onblur="CheckInputFloatKk(this)" type="text" id="commoditymarketprice" value="@commodityCookie.CommodityMarketPrice" onchange="updateRight()"
                                           maxlength="12" />
                                }
                                else
                                {
                                    <input type="text" onblur="CheckInputFloatKk(this)" id="commoditymarketprice" value="请输入正数最多两位小数"
                                           onchange="updateRight()" maxlength="12" class="txtColor" />
                                }
                                <span style="margin: 0">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                            </li>
                            <li class="dxin">
                                <img src="/Images/xin.png" />
                                <span>商品现价：</span>
                                @if (commodityCookie != null && !commodityCookie.CommodityPrice.IsNullVauleFromWeb() && commodityCookie.CommodityPrice != "请输入正数最多两位小数")
                                {
                                    <input type="text" onblur="CheckInputFloat(this)" id="commodityprice" value="@commodityCookie.CommodityPrice" onchange="updateRight()"
                                           maxlength="12" />
                                }
                                else
                                {
                                    <input type="text" onblur="CheckInputFloat(this)" id="commodityprice" value="请输入正数最多两位小数"
                                           onchange="updateRight()" maxlength="12" class="txtColor" />
                                }
                                <span>@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                            </li>
                            <li class="dxin">
                                <img src="/Images/xin.png" />
                                <span style="margin-left: 13px">进货价：</span>
                                @if (commodityCookie != null && !commodityCookie.CostPrice.IsNullVauleFromWeb() && commodityCookie.CostPrice != "请填写含税进货价")
                                {
                                    <input type="text" onblur="CheckInputFloat(this)" id="costPrice" value="@commodityCookie.CostPrice" onchange="updateRight()"
                                           maxlength="12" />
                                }
                                else
                                {
                                    <input type="text" onblur="CheckInputFloat(this)" id="costPrice" value="请填写含税进货价"
                                           onchange="updateRight()" maxlength="12" class="txtColor" />
                                }
                                <span>@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                            </li>

                            <li class="dxin">
                                <img src="/Images/xin.png" />
                                <span>税收编码：</span>
                                @if (commodityCookie != null && !commodityCookie.TaxClassCode.IsNullVauleFromWeb())
                                {
                                    <input readonly="readonly" type="text" id="commodityTaxClassCode" value="@commodityCookie.CommodityTaxRate" maxlength="30" onclick="selectCode()" />
                                }
                                else
                                {
                                    <input readonly="readonly" type="text" id="commodityTaxClassCode" value="请选择" maxlength="30" class="txtColor" onclick="selectCode()" />

                                }
                            </li>
                            <li class="@(ViewBag.IsYJBJ?"dxin":"")">
                                @if (ViewBag.IsYJBJ)
                                {
                                    <img src="/Images/xin.png" />
                                    <span style="margin-left: 15px;">销项税：</span>
                                }
                                else
                                {
                                    <span style="margin-left: 35px">销项税：</span>
                                }
                                @if (commodityCookie != null && !commodityCookie.CommodityTaxRate.IsNullVauleFromWeb() && commodityCookie.CommodityTaxRate != "请输入正数最多两位小数")
                                {
                                    @*<input onblur="CheckInputFloatNullable(this)" type="text" id="commodityTaxRate" value="@commodityCookie.CommodityTaxRate" onchange="updateRight()" maxlength="12" />*@
                                    <select id="commodityTaxRate" value="@commodityCookie.CommodityTaxRate" style="width:450px;height:27px;line-height:27px; border: 1px solid #B8BFCF;  border-radius: 3px;">
                                        <option value="0">0</option>
                                        <option value="6">6</option>
                                        <option value="10">10</option>
                                        <option value="16">16</option>
                                    </select>

                                }
                                else
                                {
                                    @*<input type="text" onblur="CheckInputFloatNullable(this)" id="commodityTaxRate" value="请输入正数最多两位小数" onchange="updateRight()" maxlength="12" class="txtColor" />*@

                                    <select id="commodityTaxRate" style="width:450px;height:27px;line-height:27px; border: 1px solid #B8BFCF;  border-radius: 3px;">
                                        <option value="0">0</option>
                                        <option value="6">6</option>
                                        <option value="10">10</option>
                                        <option value="16">16</option>
                                    </select>
                                }
                                <span style="margin: 0">%</span>
                            </li>
                            <li class="@(ViewBag.IsYJBJ?"dxin":"")">
                                @if (ViewBag.IsYJBJ)
                                {
                                    <img src="/Images/xin.png" />
                                    <span style="margin-left: 15px;">进项税：</span>
                                }
                                else
                                {
                                    <span style="margin-left: 35px">进项税：</span>
                                }
                                @if (commodityCookie != null && !commodityCookie.CommodityInputTax.IsNullVauleFromWeb() && commodityCookie.CommodityInputTax != "请输入正数最多两位小数")
                                {
                                    @*<input onblur="CheckInputFloatNullable(this)" type="text" id="commodityInputTax" value="@commodityCookie.CommodityInputTax" onchange="updateRight()" maxlength="12" />*@
                                    <select id="commodityInputTax" value="@commodityCookie.CommodityInputTax" style="width:450px;height:27px;line-height:27px; border: 1px solid #B8BFCF;  border-radius: 3px;">
                                        <option value="0">0</option>
                                        <option value="6">6</option>
                                        <option value="10">10</option>
                                        <option value="16">16</option>
                                    </select>
                                }
                                else
                                {
                                    @*<input type="text" onblur="CheckInputFloatNullable(this)" id="commodityInputTax" value="请输入正数最多两位小数" onchange="updateRight()" maxlength="12" class="txtColor" />*@

                                    <select id="commodityInputTax" style="width:450px;height:27px;line-height:27px; border: 1px solid #B8BFCF;  border-radius: 3px;">
                                        <option value="0">0</option>
                                        <option value="6">6</option>
                                        <option value="10">10</option>
                                        <option value="16">16</option>
                                    </select>
                                }
                                <span style="margin: 0">%</span>
                            </li>

                            <li>
                                <span style="margin-left: 0px">不含税进货价:</span>
                                <input type="text" id="CostPriceNoContainsTax" maxlength="12" readonly />
                                <span style="margin: 0">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                            </li>
                            <li>
                                <span style="margin-left: 49px">关税：</span>
                                @if (commodityCookie != null && !commodityCookie.CommodityDuty.IsNullVauleFromWeb() && commodityCookie.CommodityDuty != "请输入正数最多两位小数")
                                {
                                    <input onblur="CheckInputFloatNullable(this)" type="text" id="commodityduty" value="@commodityCookie.CommodityDuty" onchange="updateRight()"
                                           maxlength="12" />
                                }
                                else
                                {
                                    <input type="text" onblur="CheckInputFloatNullable(this)" id="commodityduty" value="请输入正数最多两位小数"
                                           onchange="updateRight()" maxlength="12" class="txtColor" />
                                }
                                <span style="margin: 0">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                            </li>
                            <li style="display: none;">
                                <span>商品尺寸：</span>
                                @if (commodityCookie != null && commodityCookie.CommoditySizeName != null)
                                {
                                    <input type="text" id="commoditysize" value="@commodityCookie.CommoditySizeName" readonly="readonly" />
                                }
                                else
                                {
                                    <input type="text" id="commoditysize" value="请选择" readonly="readonly" class="txtColor" />
                                }
                                @if (commodityCookie != null && commodityCookie.CommoditySizeids != null)
                                {
                                    <input type="hidden" id="sizeIdList" value="@commodityCookie.CommoditySizeids" />
                                }
                                else
                                {
                                    <input type="hidden" id="sizeIdList" value="" />
                                }
                                <a target="_self" href="/SecondAttribute/SizeIndex?@getUrlParam()" id="updatesize">尺寸设置</a>
                            </li>
                            <li style="display: none;">
                                <span>商品颜色：</span>
                                @if (commodityCookie != null && commodityCookie.CommodityColorName != null)
                                {
                                    <input type="text" id="commoditycolor" value="@commodityCookie.CommodityColorName" readonly="readonly" />
                                }
                                else
                                {
                                    <input type="text" id="commoditycolor" value="请选择" readonly="readonly" class="txtColor" />
                                }
                                @if (commodityCookie != null && commodityCookie.CommodityColorids != null)
                                {
                                    <input type="hidden" id="colorIdList" value="@commodityCookie.CommodityColorids" />
                                }
                                else
                                {
                                    <input type="hidden" id="colorIdList" value="" />
                                }
                                <a target="_self" href="/SecondAttribute/ColorIndex?@getUrlParam()" id="updatecolor">
                                    颜色设置
                                </a>
                            </li>

                            <li>
                                <span>包装规格：</span>
                                <input type="text" id="Specifications" value="请选择" readonly="readonly" class="txtColor" />
                                <a target="_self" href="/SecondAttribute/SpecificationsIndex?@getUrlParam()" id="Specificationscolor">
                                    规格设置
                                </a>
                            </li>
                            <li>
                                <span>商品属性：</span>
                                <input type="text" id="commodityAttribute" value="请选择" readonly="readonly" class="txtColor" />
                                <a target="_self" href="/SecondAttribute/AttributeIndex?@getUrlParam()" id="updatecolor">
                                    属性设置
                                </a>
                            </li>
                            <li style="display: none;" id="attrSelect1">
                                <span id="commodityAttrNameTip1">商品属性1：</span>
                                <input type="text" id="commodityAttr1" value="请选择" readonly="readonly" class="txtColor" />
                                <a target="_self" href="/SecondAttribute/AttributeIndex?@getUrlParam()" id="updateAttr1">
                                    设置
                                </a>
                            </li>
                            <li style="display: none;" id="attrSelect2">
                                <span id="commodityAttrNameTip2">商品属性2：</span>
                                <input type="text" id="commodityAttr2" value="请选择" readonly="readonly" class="txtColor" />
                                <a target="_self" href="/SecondAttribute/AttributeIndex?@getUrlParam()" id="updateAttr2">
                                    设置
                                </a>
                            </li>
                            <li style="padding-left: 15px; width: 1050px; display: none;" id="attributeDecareli">
                                <table class="createtable" border="0" align="center" cellpadding="0" cellspacing="0"
                                       id="attributeDecareTab"></table>
                            </li>
                            <li class="dxin">
                                <img src="/Images/xin.png" />
                                <span>商品数量：</span>
                                @if (commodityCookie != null && commodityCookie.CommodityStock != null)
                                {
                                    <input type="text" id="commoditystock" value="@commodityCookie.CommodityStock" />
                                }
                                else
                                {
                                    <input type="text" id="commoditystock" value="请输入非负整数" class="txtColor" />
                                }
                                <span>件</span>
                            </li>
                            <li class="@(ViewBag.IsYJBJ?"dxin":"")">
                                @if (ViewBag.IsYJBJ)
                                {
                                    <img src="/Images/xin.png" />
                                    <span>计量单位：</span>
                                }
                                else
                                {
                                    <span style="margin-left: 20px">计量单位：</span>
                                }
                                @if (commodityCookie != null && commodityCookie.Unit != null)
                                {
                                    <input type="text" id="commodityUnit" value="@commodityCookie.Unit" maxlength="10" />
                                }
                                else
                                {
                                    <input type="text" id="commodityUnit" maxlength="10" class="txtColor" />
                                }
                            </li>
                            <li>
                                <span>计价方式：</span>
                                @if (commodityCookie != null && commodityCookie.PricingMethod == "1")
                                {
                                    <input id="idJS" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoPriceMethod"
                                           value="0" />
                                    <label for="idJS">
                                        按件数
                                    </label>
                                    <input id="idZL" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoPriceMethod"
                                           value="1" checked="checked" />
                                    <label for="idZL">
                                        按重量
                                    </label>
                                }
                                else
                                {

                                    <input id="idJS" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoPriceMethod"
                                           value="0" checked="checked" />
                                    <label for="idJS">
                                        按件数
                                    </label>
                                    <input id="idZL" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoPriceMethod"
                                           value="1" />
                                    <label for="idZL">
                                        按重量
                                    </label>

                                }
                            </li>
                            <li class="dxin" style="display: none" id="liWeight">
                                <img src="/Images/xin.png" />
                                <span>重量参数：</span>
                                @if (commodityCookie != null && commodityCookie.Weight != null)
                                {
                                    <input type="text" id="commodityWeight" value="@commodityCookie.Weight" />
                                }
                                else
                                {
                                    <input type="text" id="commodityWeight" value="请输入非负数" class="txtColor" />
                                }
                                <span>kg</span>
                            </li>
                            @if (ViewBag.ShowJDCode)
                            {
                                <li class="dxin">
                                    <img src="/Images/xin.png" />
                                    <span>物流费用：</span>
                                    <select id="commodityFreight" class="txtColor" style="width: 452px; height: 29px;"></select>
                                    <a target="_self" href="/Freight/Index?@getUrlParam()" id="updateFreight">物流模板设置</a>
                                </li>
                                <li class="dxin">
                                    <img src="/Images/xin.png" />
                                    <span>销售区域：</span>
                                    <span id="saleAreastxt">未指定销售区域</span> <a href="javascript:" id="updateTmpSaleAreas" onclick="ShowDivSetSaleAreasDialog()">编辑区域</a>
                                </li>
                            }
                            else
                            {
                                <li>
                                    <span>物流费用：</span>
                                    <select id="commodityFreight" class="txtColor" style="width: 452px; height: 29px;"></select>
                                    <a target="_self" href="/Freight/Index?@getUrlParam()" id="updateFreight">物流模板设置</a>
                                </li>
                                <li>
                                    <span>销售区域：</span>
                                    <span id="saleAreastxt">未指定销售区域</span> <a href="javascript:" id="updateTmpSaleAreas" onclick="ShowDivSetSaleAreasDialog()">编辑区域</a>
                                </li>
                            }
                            <li>
                                <span>服务权益：<a href="javascript:ShowServiceData()">请点此选择支持的服务项</a></span>
                                <ul id="fwqy" style="margin:15px 0 0 70px;line-height:5px;">
                                    <li>
                                        @if (commodityCookie != null && commodityCookie.IsAssurance == true)
                                        {
                                            <input id="IsAssurance" type="hidden" name="IsAssurance" value="1" />
                                            <span>七天无理由退：七天无理由退</span>
                                        }
                                        else
                                        {
                                            <input id="IsAssurance" type="hidden" name="IsAssurance" value="0" />
                                        }
                                        @if (commodityCookie != null && commodityCookie.IsReturns == true)
                                        {
                                            <input id="IsReturns" type="hidden" name="IsReturns" value="1" />
                                            <span>不支持退货：不支持退货</span>
                                        }
                                        else
                                        {
                                            <input id="IsReturns" type="hidden" name="IsReturns" value="0" />
                                        }
                                        @if (commodityCookie != null && commodityCookie.Isnsupport == true)
                                        {

                                            <input id="Isnsupport" type="hidden" name="Isnsupport" value="1" />
                                            <span>不支持7天无理由退货：不支持7天无理由退货</span>
                                        }
                                        else
                                        {
                                            <input id="Isnsupport" type="hidden" name="Isnsupport" value="0" />
                                        }
                                    </li>
                                </ul>
                            </li>

                            @* @if (commodityCookie != null && commodityCookie.SaleAreasText != null)
            {
                <span id="saleAreastxt">@commodityCookie.SaleAreasText</span>
            }
            else
            {
                <span id="saleAreastxt">未指定销售区域</span>
            }*@
                            @*<li style="display:@ViewBag.IsAppInZPH">
                <div class="input">
                    <span>
                        <input type="checkbox" id="chkIsEnableSelfTake" style="width: auto; height: auto; vertical-align:middle;
                    cursor: pointer;" @selfTakeChk />
                    </span>
                    <label for="chkIsEnableSelfTake" style="cursor: pointer; vertical-align: middle;">
                        支持自提</label></div>
            </li>*@

                            <li>
                                <span>成交后送商品金额的</span>
                                @if (commodityCookie != null && commodityCookie.ScoreScale != null)
                                {
                                    <input type="text" class="txtColor" id="ScoreScale" value="@commodityCookie.ScoreScale" style="width: 80px; text-align: center; border-bottom: 1px solid #ccc;" />
                                }
                                else
                                {
                                    <input type="text" class="txtColor" id="ScoreScale" style="width: 80px; text-align: center;
                                    border-bottom: 1px solid #ccc;" />
                                }
                                <span>%积分（请到支付方式菜单设置积分兑换汇率)</span>
                            </li>
                            <li>
                                <input id="CommodityIds" type="hidden" value="" /><span>相关商品：</span> <a id="relationcom"
                                                                                                        style="text-decoration: underline; cursor: pointer;">选择相关商品</a>&nbsp;&nbsp;&nbsp;<span id="num">已选0件</span>
                            </li>
                            <div id="VideoFunc">
                                <li>
                                    <input id="CommodityVideo" type="hidden" value="" /><span>视频展示：</span> <a id="relationvideo"
                                                                                                              onclick="VideoDivAlert()" style="text-decoration: underline; cursor: pointer;">从资源库获取</a>&nbsp;&nbsp;&nbsp;<span id="VideoName"></span> &nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" id="deleVideo"
                                                                                                                                                                                                                                                                           style="display: none" onclick="toDeleteVideo()">删除</a>
                                </li>
                            </div>
                            <li class="spa">
                                <div style="display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex;
                                -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center;
                                align-items: center;">
                                    <img src="/Images/xin.png" alt="" />
                                    <span style="margin-left: -2px;">商品缩略图：<input type="file" id="comdtyPicBtn" style="display: none" /></span>
                                    <span style="margin-left: 10px;">&nbsp;&nbsp;建议图片尺寸：316*316,小于50K</span>
                                </div>
                                @if (commodityCookie != null && commodityCookie.Picture != null)
                                {

                                    <div>
                                        <img class="tut" style="margin-top:10px;margin-left: 20px;" alt="" src="@commodityCookie.Picture"
                                             width="110" height="110" id="CommodityImg" />
                                    </div>
                                }
                                else
                                {
                                    <div>
                                        <img class="tut" style="margin-top: 5px;" alt="" src="/Content/images/img1.jpg" width="110"
                                             height="110" id="CommodityImg" />
                                    </div>
                                }
                                @if (commodityCookie != null && commodityCookie.Hidpic != null)
                                {
                                    <input type="hidden" id="picture" value="@commodityCookie.Hidpic" />
                                }
                                else
                                {
                                    <input type="hidden" id="picture" value="" />
                                }
                            </li>
                        </ul>
                </div>
                <!-- 右侧图片预览 -->
                <div class="spfb_t_r" style="margin-right:0px">
                    <ul>
                        <li>
                            <img src="/images/tele_top.png" alt="" width="240" height="15" />
                        </li>
                        <li>
                            <img src="/images/add_pic.png" alt="" width="240" height="32" />
                        </li>
                        <li>
                            <div id="showPrev" style="float: left; top: 50%; margin-top: -90px; position: absolute;
                                cursor: pointer">
                                <img src="/Images/m_prev.png" />
                            </div>
                            <div id="showNext" style="float: right; top: 50%; margin-top: -90px; position: absolute;
                                right: 0; cursor: pointer">
                                <img src="/Images/m_next.png" />
                            </div>
                            <div>
                                <img id="showImg" src="/Images/comment_pic5.png" alt="" width="240" height="181" />
                            </div>
                        </li>
                        <li class="one one1" style="position: absolute; top: 210px;">
                            <p>
                                裂帛2014秋冬新款时尚春色通勤毛呢外套
                            </p>
                            <span>收藏</span>
                        </li>
                        <li class="one one2">请输入整数最多两位小数</li>
                        <li class="one one4 flag1"><span class="col">请选择颜色</span></li>
                        <li class="one one4 flag2"><span class="siz">请选择尺码</span></li>
                        <li class="one one4">
                            <p>
                                <span class="fir">卖家包邮</span><span>月销量82笔</span><span>广东广州</span>
                            </p>
                        </li>
                        <li>
                            <img src="/images/add3.png" alt="" width="240" height="39" />
                        </li>
                        <li class="one6"></li>
                        <li class="one5"><span class="spa1">加入购物车</span><span class="spa2">购买</span></li>
                    </ul>
                </div>
                <div style="clear: both;">
                </div>
            </div>
            <div class="spfb_b">
                <div class="spfb_b1">
                    <div class="spfb_b1t">
                        <span class="xint">*</span> <span class="zihao">商品详情页图样</span> <span>（</span>
                        <img src="/Images/xiaoshou.jpg" /><span>直接拖动图片可调整顺序）</span> <a id="batchUploadA"
                                                                                       style="padding-left: 100px;" href="javascript:" onclick="uploadImgBatch()">批量上传图片</a>
                        <span style="margin-left: 10px;">&nbsp;&nbsp;建议图片尺寸：640*640或640*480，根据定制平台“商品轮播版式组件”的配置匹配尺寸,单张图小于100K，推荐使用640*640；</span>
                        @*<span style="float: right; padding-right: 15px;">
                            <input type="file" id="btn_file" style="display: none" />
                            <input id="selectAllInput" name="selectAllInput" type="checkbox" onpropertychange="toSelectAll(this)"
                                onchange="toSelectAll(this)" value="全选" />
                            <label for="selectAllInput">
                                全选</label>&nbsp&nbsp&nbsp&nbsp&nbsp<a href="javascript:void(0)" onclick="toDeleteAllImgList()">删除</a>*@
                        </span>
                    </div>
                    <div class="spfb_b1c" id="sortable">
                        @if (commodityCookie != null && commodityCookie.listImgShowSrcString != null)
                        {
                            <input id="listImgShowSrcString" type="text" style="display: none" value="@commodityCookie.listImgShowSrcString" />
                        }
                        else
                        {
                            <input id="listImgShowSrcString" type="text" style="display: none" value="" />
                        }
                    </div>
                    <div id="addimg" style="position: relative; padding: 10px 0 13px 30px">
                        <img src="/Images/comment_pic5.png" id="CommodityListPic" />
                    </div>
                </div>
                <div class="spfb_b1">
                    <div id="tabContainer">
                    </div>
                </div>
                <div class="spfb_b1">
                    <div class="spfb_b1t">
                        <span class="zihao1">描述内容</span>
                    </div>
                    <div id="textDiv" class="item" style="padding-left: 0; width: 100%;">
                        <script type="text/plain" id="myEditor">
                        </script>
                    </div>
                </div>

                <div class="spfb_b1">
                    <div class="spfb_b1t">
                        <span class="zihao1">规格参数：</span>
                    </div>
                    <div id="textTechSpecsDiv" class="item" style="padding-left: 0; width: 100%;">
                        <script type="text/plain" id="myTechSpecsEditor">
                        </script>
                    </div>
                </div>
                <div class="spfb_b1">
                    <div class="spfb_b1t">
                        <span class="zihao1">售后说明：</span>
                    </div>
                    <div id="textSaleServiceDiv" class="item" style="padding-left: 0; width: 100%;">
                        <script type="text/plain" id="mySaleServiceEditor">
                        </script>
                    </div>
                </div>
            </div>
            <div class="butt" style="text-align: center; width: 98%; margin: 20px;">
                <a href="javascript:;" class="btn120" id="btnSubmit" onclick="toSave()">发布</a> <a id="btnCancel" href="javascript:;" class="btn120" onclick="closeWindow()" style="margin-left: 20px;">
                    取消
                </a>
            </div>
            <div style="text-align: center; width: 98%; margin: 20px; margin-top: 10px;">
                <span class="zihao">注：商品发布成功后5分钟左右可搜索到该商品~</span>
            </div>
        </div>
    </div>

    <div class="floa11 addfloa2" id="SpecificationsDIV">
        <h1>
            <a href="javascript:closeSpecificationsDIV()" class="close"></a><span>选择包装规格</span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="SpecificationsUl"></ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="savecolor" onclick="closeSpecificationsDIV()" class="btn120"
               style="margin-top: 6px;">确定</a>
        </div>
    </div>

    <div class="floa11 addfloa2" id="attributeDIV">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" onclick="closeAttributeDIV()"></a><span>最多只能选择两项</span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="attributeUl">
                @foreach (var attr in AttributeList)
                {

                    <li>
                        <label>
                            <input type="checkbox" value="@attr.AttributeId" /><span>@attr.AttributeName</span>
                        </label>
                    </li>
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="savecolor" onclick="closeAttributeDIV()" class="btn120"
               style="margin-top: 6px;">确定</a>
        </div>
    </div>
    <div class="floa11 addfloa2" id="attrDIV1">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" onclick="closeAttrDIV(1)"></a><span id="attrtip1">
                请选择**信息
            </span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="attrUl1"></ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="savecolor" onclick="closeAttrDIV(1)" class="btn120" style="margin-top: 6px;">
                确定
            </a>
        </div>
    </div>
    <div class="floa11 addfloa2" id="attrDIV2" style="z-index: 9999;">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" onclick="closeAttrDIV(2)"></a><span id="attrtip2">
                请选择**信息
            </span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="attrUl2"></ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="savecolor" onclick="closeAttrDIV(2)" class="btn120" style="margin-top: 6px;">
                确定
            </a>
        </div>
    </div>
    <div class="floa11 addfloa2" id="freightDIV" style="z-index: 9999;">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" onclick="closeFreightDIV()"></a>请选择物流信息
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="freightUl">
                @*         @foreach (var freight in FreightListFreightList)
                    {

                        <li>
                            <label>
                                <input type="checkbox" value="@freight.Id"/>
                                <span>@freight.Name</span>
                            </label>
                        </li>
                    }*@
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="saveFreight" onclick="closeFreightDIV()" class="btn120"
               style="margin-top: 6px;">确定</a>
        </div>
    </div>
    <div class="floa2 addfloa2" id="categoryDiv">
        <!-- gyy -->
        <h1>
            <a href="javascript:;" class="close" onclick="closeCategoryDiv()"></a><span>选择类目信息</span>
        </h1>
        <div style="overflow-y: auto; height: 195px;">
            <ul class="first" id="tcategoryUl">
                @foreach (var cate in categorylist)
                {
                    <li class="firs">
                        <label>
                            @if (cate.SecondCategory == null || cate.SecondCategory.Count == 0)
                            {
                                <input name="cateogryClassLevel1" type="checkbox" value="@cate.Id" />
                            }<span>@cate.Name</span>
                        </label>
                        <ul class="second">
                            @if (cate.SecondCategory == null) { cate.SecondCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.SCategorySDTO>(); }
                            @foreach (var scate in cate.SecondCategory)
                            {
                                <li class="firs firs1">
                                    <label>
                                        @if (scate.ThirdCategory == null || scate.ThirdCategory.Count == 0)
                                        {
                                            <input name="cateogryClassLevel2" type="checkbox" value="@scate.Id" />
                                        }<span>@scate.Name</span>
                                    </label>
                                    <ul class="third">
                                        @if (scate.ThirdCategory == null) { scate.ThirdCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.TCategorySDTO>(); }
                                        @foreach (var tcate in scate.ThirdCategory)
                                        {
                                            <li>
                                                <label>
                                                    <input name="cateogryClassLevel3" type="checkbox"
                                                           value="@tcate.Id" /><span>@tcate.Name</span>
                                                    </label>
                                                </li>
                                            }
                                    </ul>
                                </li>
                            }
                        </ul>
                    </li>
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="savecategory" onclick="closeCategoryDiv()" class="btn120"
               style="margin-top: 6px;">确定</a>
        </div>
    </div>

    <div class="floa11 addfloa2" id="brandDiv" style="width:400px;">
        <h1>
            <a href="javascript:;" class="close" onclick="closeBrandDiv()"></a><span>选择品牌</span>
        </h1>
        <div>
            <ul>
                <li>
                    <label>品牌名称：</label>
                    <input type="text" style="width:140px;" class="inp-txt" id="txtBrandName" maxlength="20">
                    <a class="btn120" style="cursor:pointer" onclick="searchBrandList(1);">查询</a>
                </li>
            </ul>
        </div>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="brandUl">
                <div id="liBrandDiv">

                </div>
            </ul>
            <ul>
                <li>
                    <input type="hidden" id="hidBrandId" />
                    <input type="hidden" id="hidBrandName" />
                </li>
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <ul class="pagination" id="pagination2"></ul>
            <br />
            <div style="text-align:right;">
                <a href="javascript:;" id="saveBrand" onclick="checkedBrand()" class="btn120"
                   style="margin-top: 6px;">确定</a>
                <a href="javascript:;" id="closeBrand" onclick="closeBrandDiv()" class="btn120"
                   style="margin-top: 6px;">取消</a>
            </div>
        </div>
    </div>

    @if (ViewBag.IsYJBJ)
    {
        <div class="floa2 addfloa2" id="innerCategoryDiv">
            <!-- gyy -->
            <h1>
                <a href="javascript:;" class="close" onclick="closeInnerCategoryDiv()"></a><span>选择商品品类</span>
            </h1>
            <div style="overflow-y: auto; height: 195px;">
                <ul class="first" id="tinnerCategoryUl">
                    @foreach (var cate in innerCategorylist)
                    {
                        <li class="firs">
                            <label>
                                @if (cate.SecondCategory == null || cate.SecondCategory.Count == 0)
                                {
                                    <input name="cateogryClassLevel" type="radio" value="@cate.Id" />
                                }
                                <span>@cate.Name</span>
                            </label>
                            <ul class="second">
                                @if (cate.SecondCategory == null) { cate.SecondCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.SCategorySDTO>(); }
                                @foreach (var scate in cate.SecondCategory)
                                {
                                    <li class="firs firs1">
                                        <label>
                                            @if (scate.ThirdCategory == null || scate.ThirdCategory.Count == 0)
                                            {
                                                <input name="cateogryClassLevel" type="radio" value="@scate.Id" />
                                            }
                                            <span>@scate.Name</span>
                                        </label>
                                        <ul class="third">
                                            @if (scate.ThirdCategory == null)
                                            {
                                                scate.ThirdCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.TCategorySDTO>();
                                            }
                                            @foreach (var tcate in scate.ThirdCategory)
                                            {
                                                <li>
                                                    <label>
                                                        <input name="cateogryClassLevel" type="radio"
                                                               value="@tcate.Id" /><span>@tcate.Name</span>
                                                        </label>
                                                    </li>
                                                }
                                        </ul>
                                    </li>
                                }
                            </ul>
                        </li>
                    }
                </ul>
            </div>
            <div class="bbtn" style="text-align: center;">
                <h1></h1>
                <a href="javascript:;" id="saveInnerCategory" onclick="closeInnerCategoryDiv()" class="btn120"
                   style="margin-top: 6px;">确定</a>
            </div>
        </div>
    }
    <div class="floa2 addfloa2" id="EsCategoryDiv">
        <h1>
            <a href="javascript:;" class="close" onclick="closeEsCategoryDiv()"></a><span>选择前端分类信息</span>
        </h1>
        <div style="overflow-y: auto; height: 195px;">
            <ul class="first" id="escategoryUl">
                @if (EsCategoryList != null)
                {
                    foreach (var cate in EsCategoryList)
                    {
                        <li class="firs">
                            <label>
                                @if (cate.SecondCategory == null || cate.SecondCategory.Count == 0)
                                {
                                    <input name="escateogryClassLevel1" type="checkbox" value="@cate.Id" />
                                }   <span>@cate.Name</span>
                            </label>
                            <ul class="second">
                                @if (cate.SecondCategory == null) { cate.SecondCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.SCategorySDTO>(); }
                                @foreach (var scate in cate.SecondCategory)
                                {
                                    <li class="firs firs1">
                                        <label>
                                            <span>@scate.Name</span>
                                        </label>
                                        <ul class="third">
                                            @if (scate.ThirdCategory == null) { scate.ThirdCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.TCategorySDTO>(); }
                                            @foreach (var tcate in scate.ThirdCategory)
                                            {
                                                <li>
                                                    <label>
                                                        <input name="escateogryClassLevel3" type="checkbox"
                                                               value="@tcate.Id" /><span>@tcate.Name</span>
                                                        </label>
                                                    </li>
                                                }
                                        </ul>
                                    </li>
                                }
                            </ul>
                        </li>
                    }
                }

            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="essavecategory" onclick="closeEsCategoryDiv()" class="btn120"
               style="margin-top: 6px;">确定</a>
        </div>
    </div>





    <div class="floa1 addfloa2" id="sizeDIV">
        <!-- gyy -->
        <h1>
            <a href="javascript:;" class="close" onclick="closeSzieDIV()"></a><span>选择尺寸信息</span>
        </h1>
        <div style="overflow-y: auto; height: 160px;">
            <!-- gyy 195 -->
            <ul class="first" id="sizeUl">
                @foreach (var size in Sizelist)
                {

                    <li>
                        <label>
                            <input type="checkbox" value="@size.Id" />
                            <span>@size.Name</span>
                        </label>
                    </li>
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="savesize" onclick="closeSzieDIV()" class="btn120" style="margin-top: 6px;">
                确定
            </a>
        </div>
    </div>
    <div class="floa11 addfloa2" id="colorDIV">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" onclick="closeColorDIV()"></a><span>选择颜色信息</span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="colorUl">
                @foreach (var color in Colorlist)
                {

                    <li>
                        <label>
                            <input type="checkbox" value="@color.Id" /><span>@color.Name</span>
                        </label>
                    </li>
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1></h1>
            <a href="javascript:;" id="savecolor" onclick="closeColorDIV()" class="btn120" style="margin-top: 6px;">
                确定
            </a>
        </div>
    </div>
    <div id="divSetSaleAreasDialog" style="display: none;">
        <div>
            @*   @if (commodityCookie != null && commodityCookie.SaleAreas != null)
                {
                    <input type="hidden" id="SaleAreas" value="@commodityCookie.SaleAreas" />
                }
                else
                {
                    <input type="hidden" id="SaleAreas" value="" />
                }*@
            <input type="hidden" id="SaleAreas" value="" />
            <iframe style="width:100%;height:600px; scroll:auto; border:0;" src="@ViewBag.ProvinceCityUrl"></iframe>
        </div>
    </div>
    @*视频地址*@
    <div id="divSetVideoDialog" style="display: none;">
        <div>
            <span style="display: none" id="VideoName"></span><span style="display: none" id="VideoUrl">
            </span><span style="display: none" id="VideoWebUrl"></span><span style="display: none"
                                                                             id="VideoPicUrl"></span>
            <iframe style="width:100%;height:600px; scroll:auto; border:0;" src="@ViewBag.VideoHost"></iframe>
        </div>
    </div>
</div>
<div id="loadImgDiv" style="overflow: hidden; width: auto; min-height: 0; height: 470px;
    display: none;">
    <iframe id="contentFrame" name="contentFrame" scrolling="no" src="" height="480"
            width="630" frameborder="0" style="border: 0; overflow: hidden;"></iframe>
</div>
<div class="tanchu" id="div3" style="height: 160px;">
    <div class="tanchu_r">
        <p>
        </p>
        <div style="font-size: 14px; text-align: center;" class="color">
            您需要先完善发布者信息才能发布商品！
        </div>
        <div style="text-align: center;">
            <button class="an1">
                确定
            </button>
        </div>
    </div>
</div>
<div id="uploadImgBatchDiv">
    <iframe id="uploadImgBatchIframe" style="width: 100%; height: 600px; scroll: auto;
        border: 0;"></iframe>
</div>
<div id="loadCommodityList" style="overflow: hidden; width: auto; min-height: 0;
                                                           height: 470px; display: none;">
    <iframe id="commodityListFrame" name="commodityListFrame" scrolling="yes" src=""
            frameborder="0" style="border: 0; overflow: hidden; padding: 0; margin: 0; height: 630px;
                                                                          width: 939px" width="939"></iframe>
</div>
<div style="display: none">
    <input id="IsHaveMallApply" hidden="hidden" value="@ViewBag.IsHaveMallApply" />
</div>
<div id="dialogSelectCode" style="display: none;">
    <iframe id="MyIframeSelectCode" frameborder="0" style="width: 100%; height: 700px;
        overflow-y: auto; border: 0px;"></iframe>
</div>


<div class="tanchu" id="ServiceData" style="margin-top:450px; width: 500px;height:400px;">
    <div style="height: 20px;color: #555;padding: 5px 15px;position: relative;background: #efefef;overflow: hidden;">
        <span>选择服务项设置</span><a style="position: absolute;top: 5px;right: 15px;font-size: 14px; cursor:pointer;" onclick="serviceclose()">x</a>
    </div>

    <div style="width:100%;height:300px;overflow-y:auto;margin-top:10px;">
        <ul id="Service" style="margin:5px 20px 0 30px;line-height:25px;">
            <li>
                <input name="items" type="checkbox" onchange="Ischeck()" value="1" />
                <span>七天无理由退：七天无理由退</span>
            </li>
            <li>
                <input name="items" type="checkbox" onchange="Ischeck()" value="1" />
                <span>不支持退货：不支持退货</span>
            </li>
            <li>
                <input name="items" type="checkbox" onchange="Ischeck()" value="1" />
                <span>不支持7天无理由退货：不支持7天无理由退货</span>
            </li>
        </ul>
    </div>
    <div class="tanchu_r">
        <div style="text-align:center;">
            <button onclick="serviceAdd()" id="btnExportData">确定</button>
            &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
            <button onclick="serviceclose()"> 取消</button>
        </div>

    </div>
</div>


<script type="text/javascript">





    //弹出导出
    function ShowServiceData() {

        $("#ServiceData").OpenDiv();
        $("#Service").find("li:gt(2)").empty();
        $.ajax({
            type: "post",
            url: "@Url.Action("GetAllServiceSettings", "Commodity")",
            data:{AppId: getQueryString("appId")},
            success: function (data) {
                var html="";
                if(data.length>0){
                    for(var i=0;i<data.length;i++) {
                        html+='<li><input name="items"  type="checkbox"  value="'+data[i].Id+'" /> <span> '+data[i].Title+'：'+data[i].Content+'</span></li>';
                    }
                }
                $("#Service").append(html);
                Checkitem();
            },
            error: function ()
            {
                alert("操作失败");
            }
        });
    }


     //头三个是互斥操作
    function  Ischeck()
    {

        if($("input[name='items']:eq(0)").is(':checked')==false&&$("input[name='items']:eq(1)").is(':checked')==false&&$("input[name='items']:eq(2)").is(':checked')==false){

                $("input[name='items']:eq(0)").attr('disabled',false);
                $("input[name='items']:eq(1)").attr('disabled',false);
                $("input[name='items']:eq(2)").attr('disabled',false);
        }
        else {
             if($("input[name='items']:eq(0)").is(':checked')){
                  $("input[name='items']:eq(0)").attr('disabled',false);
                  $("input[name='items']:eq(1)").attr('disabled',true);
                  $("input[name='items']:eq(2)").attr('disabled',true);
              }
              if($("input[name='items']:eq(1)").is(':checked')){

                  $("input[name='items']:eq(0)").attr('disabled',true);
                  $("input[name='items']:eq(1)").attr('disabled',false);
                  $("input[name='items']:eq(2)").attr('disabled',true);
              }
              if($("input[name='items']:eq(2)").is(':checked')){
                $("input[name='items']:eq(0)").attr('disabled',true);
                $("input[name='items']:eq(1)").attr('disabled',true);
                $("input[name='items']:eq(2)").attr('disabled',false);
              }
        }
    }

    //获取选中的值
    function  Checkitem(){

        if($("input[name='IsAssurance']").val()==1){
            $("input[name='items']:eq(0)").prop("checked",true);
        }

        if($("input[name='IsReturns']").val()==1){
            $("input[name='items']:eq(1)").prop("checked",true);
        }

        if($("input[name='Isnsupport']").val()==1){
            $("input[name='items']:eq(2)").prop("checked",true);
        }
        var ServiceSettingIds=[];
        $("input[name='ServiceSettingId']").each(function(){
            ServiceSettingIds.push($(this).val());
        });

        var resval="";
        $("input[name='items']:gt(2)").each(function(){
            resval=$(this).val();
            for(var i=0;i<ServiceSettingIds.length;i++){
               if(ServiceSettingIds[i]==resval)
               {
                  $(this).prop("checked",true);
               }
            }

        });
        Ischeck();
    }

        //关闭服务项设置
    function serviceclose() {
        $("#ServiceData").CloseDiv();
    }


    //添加数据
    function serviceAdd() {
        $("#ServiceData").CloseDiv();
        $("#fwqy").empty();
        var html="";
        $("input[name='items']").each(function(){
            var Id="";
            var Content="";
            if ($(this).attr("checked")) {
                Id=$(this).val();
                Content = $(this).next().text();
                if(Content=="七天无理由退：七天无理由退"){
                   html+='<li><input id="IsAssurance"  type="hidden" name="IsAssurance" value="1" /><span>七天无理由退：七天无理由退</span><li>';
                }
                else if(Content=="不支持退货：不支持退货"){
                   html+='<li><input id="IsReturns"  type="hidden" name="IsReturns" value="1" /><span>不支持退货：不支持退货</span><li>';
                }
                else if(Content=="不支持7天无理由退货：不支持7天无理由退货"){
                   html+='<li><input id="Isnsupport"  type="hidden" name="Isnsupport" value="1" /><span>不支持7天无理由退货：不支持7天无理由退货</span><li>';
                }
                else {
                   html+='<li><input   type="hidden" name="ServiceSettingId" value="'+Id+'" /><span>'+Content+'</span><li>';
                }
            }

        });
        $("#fwqy").append(html);
        $("input[name='items']").prop("checked",false);
    }


    function umeditorCheckImgSize(size){
        if(size > 500*1000) {
            alert("最大只能上传500KB");
            return false;
        }
        return true;
    }

    var textDivWidth = $("#textDiv").width();
    var textTechSpecsDivWidth = $("#textTechSpecsDiv").width();
    var textSaleServiceDivWidth = $("#textSaleServiceDiv").width();


    /******初始化商品详情Editor******/
    var ue = UM.getEditor('myEditor', {
        //这里可以选择自己需要的工具按钮名称
        toolbar: ['undo redo | bold italic underline strikethrough | forecolor | removeformat |',
            'insertorderedlist insertunorderedlist | selectall cleardoc | paragraph fontsize',
            '| justifyleft justifycenter justifyright justifyjustify |',
            'link unlink | image | horizontal fullscreen'],
        //focus时自动清空初始化时的内容
        autoClearinitialContent: false,
        //关闭字数统计
        wordCount: false,
        //关闭elementPath
        elementPathEnabled: false,
        //默认的编辑区域高度
        initialFrameHeight: 300,
        //宽度
        initialFrameWidth: '100%',
        //自适应高度
        autoHeightEnabled: false,
        //工具条保持不动
        autoFloatEnabled: false,
        zIndex: 5,
        //更多其他参数，请参考umeditor.config.js中的配置项
        filterRules: function () {
            return {
                //$:{}表示不保留任何属性
                p: { $: {} },
                h3: { $: {} },
                h2: { $: {} },
                img: function (node) {
                    var src = node.getAttr('src');
                    node.setAttr();
                    node.setAttr({ 'src': src })
                },
                //黑名单，以下标签及其子节点都会被过滤掉
                '-': 'script style meta iframe embed object'
            }
        } ()
    });
    var commodityDetailCookie = '';
    @if (commodityCookie != null)
    {
        Html.Raw("commodityDetailCookie = '" + commodityCookie.CommodityDetails + "';");
    }
    ue.setContent(commodityDetailCookie);



    /******初始化规格参数Editor******/
    var techSpecsEditor = UM.getEditor('myTechSpecsEditor', {
        //这里可以选择自己需要的工具按钮名称
        toolbar: ['undo redo | bold italic underline strikethrough | forecolor | removeformat |',
            'insertorderedlist insertunorderedlist | selectall cleardoc | paragraph fontsize',
            '| justifyleft justifycenter justifyright justifyjustify |',
            'link unlink | image | horizontal fullscreen'],
        //focus时自动清空初始化时的内容
        autoClearinitialContent: false,
        //关闭字数统计
        wordCount: false,
        //关闭elementPath
        elementPathEnabled: false,
        //默认的编辑区域高度
        initialFrameHeight: 300,
        //宽度
        initialFrameWidth: '100%',
        //自适应高度
        autoHeightEnabled: false,
        //工具条保持不动
        autoFloatEnabled: false,
        zIndex: 5,
        //更多其他参数，请参考umeditor.config.js中的配置项
        filterRules: function () {
            return {
                //$:{}表示不保留任何属性
                p: { $: {} },
                h3: { $: {} },
                h2: { $: {} },
                img: function (node) {
                    var src = node.getAttr('src');
                    node.setAttr();
                    node.setAttr({ 'src': src })
                },
                //黑名单，以下标签及其子节点都会被过滤掉
                '-': 'script style meta iframe embed object'
            }
        } ()
    });
    var commodityTechSpecsCookie = '';
    @if (commodityCookie != null)
    {
        Html.Raw("commodityTechSpecsCookie = '" + commodityCookie.TechSpecs + "';");
    }
    techSpecsEditor.setContent(commodityTechSpecsCookie);


    /******初始化售后说明Editor******/
    var saleServiceEditor = UM.getEditor('mySaleServiceEditor', {
        //这里可以选择自己需要的工具按钮名称
        toolbar: ['undo redo | bold italic underline strikethrough | forecolor | removeformat |',
            'insertorderedlist insertunorderedlist | selectall cleardoc | paragraph fontsize',
            '| justifyleft justifycenter justifyright justifyjustify |',
            'link unlink | image | horizontal fullscreen'],
        //focus时自动清空初始化时的内容
        autoClearinitialContent: false,
        //关闭字数统计
        wordCount: false,
        //关闭elementPath
        elementPathEnabled: false,
        //默认的编辑区域高度
        initialFrameHeight: 300,
        //宽度
        initialFrameWidth: '100%',
        //自适应高度
        autoHeightEnabled: false,
        //工具条保持不动
        autoFloatEnabled: false,
        zIndex: 5,
        //更多其他参数，请参考umeditor.config.js中的配置项
        filterRules: function () {
            return {
                //$:{}表示不保留任何属性
                p: { $: {} },
                h3: { $: {} },
                h2: { $: {} },
                img: function (node) {
                    var src = node.getAttr('src');
                    node.setAttr();
                    node.setAttr({ 'src': src })
                },
                //黑名单，以下标签及其子节点都会被过滤掉
                '-': 'script style meta iframe embed object'
            }
        } ()
    });
    var commoditySaleServiceCookie = '';
    @if (commodityCookie != null)
    {
        Html.Raw("commoditySaleServiceCookie = '" + commodityCookie.SaleService + "';");
    }
    saleServiceEditor.setContent(commoditySaleServiceCookie);


    // change
    ue.addListener("contentChange", function () {
        ajaxSaveInfo();
    });

    techSpecsEditor.addListener("contentChange", function () {
        ajaxSaveInfo();
    });

    saleServiceEditor.addListener("contentChange", function () {
        ajaxSaveInfo();
    });
</script>
<script type="text/javascript">

    //以下为图片批量上传所用

    //在页面中添加图片
    function loadBatchUploadListImg(imgListArry) {
        var listImgSrc = imgListArry;
        for (var i = 0; i < listImgSrc.length; i++) {
            if (listImgSrc[i] != "") {
                var htmlContent = $('<div class="img1">' +
                    '<img src="" name="" width="80" height="80" class="one">' +
                    '<img src="/Images/finished.png" class="two" style="display: none">' +
                    '<img src="/Images/close.jpg" class="two" style="top: 0px;" onclick="deleteImg(this);">' +
                    '</div>');
                var clone = htmlContent.clone();
                clone.find('.one').attr('src', listImgSrc[i]).attr('name', listImgSrc[i]);
                $("#sortable").append(clone);

                leftValue = $("#addimg").css('margin-left');
                if (leftValue === undefined) {
                    leftValue = 0;
                } else {
                    leftValue = leftValue.substring(0, 3);
                }
                leftValue = parseInt(leftValue) + 114;
                $("#addimg").css('margin-top', '-108px');
                $("#addimg").css('margin-left', leftValue + "px");

                //更新右部手机图
                updateRight();
                dialogImgClosed();
                //保存数据到 cookie.
                ajaxSaveInfo();
            }
        }
    }

    //图片批量上传的url
    var curUrl = window.location.href;
    var uploadImgBatchIframeUrl = "/ImgBatchUpload/Index" + curUrl.substring(curUrl.indexOf("?"));

    //打开
    function uploadImgBatch() {
        var icount = $("#sortable").find('.one').length;
        if (icount >= 5) {
            alert('最多只能上传5张图片');
            return;
        }
        $("#uploadImgBatchIframe").attr("src", uploadImgBatchIframeUrl);
        $("#uploadImgBatchDiv").jhtablebox({
            title: "批量上传图片",
            width: 710,
            height: 490,
            modal: true,
            resizable: false
        });
    }

    //初时加载
    function loadBatchParam() {
        var objLoad = {};
        var icount = $("#sortable").find('.one').length;
        objLoad.Width = 640;
        objLoad.Height = 480;
        objLoad.Size = 50;
        objLoad.Accept = [".png", ".jpg", ".jpeg"];
        objLoad.Count = 5;
        objLoad.iCount = icount;
        objLoad.Url = "/Handler/ImgBatchUploadHandler.ashx";
        objLoad.fileSizeLimit = 100;
        return objLoad;
    }

    //关闭
    function uploadImgBatchClose() {
        $("#uploadImgBatchDiv").jhtablebox("close");
    }

    //确定
    function uploadImgBatchConfirm(obj) {
        $("#uploadImgBatchDiv").jhtablebox("close");
        if (obj && obj.Url) {
            loadBatchUploadListImg(obj.Url);
        }
    }

    function newGuid() {
        var guid = "";
        for (var i = 1; i <= 32; i++) {
            var n = Math.floor(Math.random() * 16.0).toString(16);
            guid += n;
            if ((i == 8) || (i == 12) || (i == 16) || (i == 20))
                guid += "-";
        }
        return guid;
    }

    function setCodeData(rowData) {
        $('#commodityTaxClassCode').val(rowData.Code);
        $('#commodityTaxRate').val(rowData.TaxRate * 100);
    }

    function closeTbBox() {
        $("#dialogSelectCode").jhtablebox("close");
    }
</script>
<script type="text/javascript">
    var pageIndex = 1;
    var pageSize = 20;
    var pageCount = 1;
    function initBrand() {
        var brandName = $.trim($("#txtBrandName").val());
        var brandStatus = 1;
        var brandAppId = $("#hidBrandAppId").val();
        var data = {
            "brandName": brandName,
            "brandStatus": brandStatus,
            "PageNo": pageIndex,
            "PageSize": pageSize,
            "brandAppId": brandAppId
        };
        var initFlag = true;
        $.ajax({
            async: false,
            type: "POST",
            data: data,
            url: '../Brand/GetBrandListByAppId',
            dataType: "json",
            success: function (res) {
                if (res.Result) {
                    pageCount = res.DataCount;
                    $.jqPaginator('#pagination2', {
                        totalCounts: pageCount,
                        pageSize: pageSize,
                        visiblePages: 0,
                        currentPage: pageIndex,
                        prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
                        next: '<li class="next"><a href="javascript:;">下一页</a></li>',
                        onPageChange: function (index) {
                            pageIndex = index;
                            if (initFlag) {
                                initFlag = false;
                            }
                            else {
                                searchBrandList(pageIndex);
                            }
                        }
                    });
                    $("#liBrandDiv").html("");
                    for (var i = 0; i < res.DataList.length; i++) {
                        $("#liBrandDiv").append("<li><label><input type='radio' data-name='" + res.DataList[i].Brandname + "' value='" + res.DataList[i].Id + "' name='brand' /><span>" + res.DataList[i].Brandname + "</span></label></li>");
                    }
                }
            },
            error: function () {
                alert("请稍候再试");
                return false;
            }
        });
    }
    function searchBrandList(pageNo) {
        pageIndex = pageNo;
        var brandName = $.trim($("#txtBrandName").val());
        var brandStatus = 1;
        var brandAppId = $("#hidBrandAppId").val();
        var data = {
            "brandName": brandName,
            "brandStatus": brandStatus,
            "PageNo": pageIndex,
            "PageSize": pageSize,
            "brandAppId": brandAppId
        };
        $.ajax({
            async: false,
            type: "POST",
            data: data,
            url: '../Brand/GetBrandListByAppId',
            dataType: "json",
            success: function (res) {
                if (res.Result) {
                    pageCount = res.DataCount == 0 ? 1 : res.DataCount;
                    $("#pagination2").jqPaginator("option", {
                        currentPage: pageIndex,
                        totalCounts: pageCount,
                        pageSize: pageSize,
                        visiblePages: 0
                    });
                    $("#liBrandDiv").html("");
                    for (var i = 0; i < res.DataList.length; i++) {
                        $("#liBrandDiv").append("<li><label><input type='radio' data-name='" + res.DataList[i].Brandname + "' value='" + res.DataList[i].Id + "' name='brand' /><span>" + res.DataList[i].Brandname + "</span></label></li>");
                    }
                }
            },
            error: function () {
                alert("请稍候再试");
                return false;
            }
        });
    }

    function closeBrandDiv() {
        $("#brandDiv").hide();
    }
    function checkedBrand() {
        var checkedBrand = $("#brandUl input[name='brand']:checked");
        var brandId = checkedBrand.val();
        var brandName = checkedBrand.attr("data-name");
        $("#commoditybrand").val(brandName);
        $("#hidBrandId").val(brandId);
        $("#hidBrandName").val(brandName);
        closeBrandDiv();
    }
    $("#commoditybrand").focus(function () {
        var top = $('#commoditybrand').offset().top;
        var left = $('#commoditybrand').offset().left;
        var height = $('#commoditybrand').height();
        $("#brandDiv").css({ "top": top + height, "left": left }).show();
        initBrand();
    });

    (function () {
        var commodityTaxRat; var commodityInputTax;
        @{
            bool _CommodityTaxRate=false;
            bool _CommodityInputTax = false;
            string commodityTaxRat="";
            string commodityInputTax="";
            if (commodityCookie != null && !commodityCookie.CommodityTaxRate.IsNullVauleFromWeb() && commodityCookie.CommodityTaxRate != "请输入正数最多两位小数")
            {
                commodityTaxRat = @commodityCookie.CommodityTaxRate;
            }

            if (commodityCookie != null && !commodityCookie.CommodityInputTax.IsNullVauleFromWeb() && commodityCookie.CommodityInputTax != "请输入正数最多两位小数")
            {
                commodityInputTax = @commodityCookie.CommodityInputTax;
            }

       }
        if (new Boolean('@_CommodityTaxRate')) {
            commodityTaxRat = new Number(@commodityTaxRat)
        }
        if (new Boolean('@_CommodityInputTax')) {
            commodityInputTax = new Number(@commodityInputTax)
        }
        $("#commodityTaxRate").val(commodityTaxRat.toString());
        $("#commodityInputTax").val(commodityInputTax.toString());
    })()
</script>



