@using System.Web
@{
    Layout = "~/Views/Shared/_MobileSimplifyLayout.cshtml";
    //kevin要用，所以做了特殊处理，即微信中《买走美国》应用正常显示下单页面，否则只显示微信

    var brainhoopAppId = new Guid("cf063155-e6e9-4019-ba12-6b44b704243f");
    bool onlyWxPay = ViewBag.IsWx && Jinher.AMP.BTP.UI.Util.MobileCookies.AppId != brainhoopAppId;
    Jinher.AMP.BTP.Deploy.OrderFieldDTO orderset = ViewBag.OrderSet;
    List<string> appids = new List<string>();
    if (orderset.AppId != Guid.Empty)
    {
        appids.Add(orderset.AppId.ToString());
    }
}
@helper Currency()
{
    @Jinher.AMP.BTP.UI.Util.MobileCookies.GetCurrency();
}
@section TitleHtml
{
    <title>确认订单</title>
}
@section CssStyles{
    <link rel="stylesheet" href="/Content/Mobile/css.css" />
    <link href="../../Content/Mobile/zeptodialog/css/widget/dialog/dialog.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/Mobile/zeptodialog/css/widget/dialog/dialog.default.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/Mobile/zeptodialog/css/widget/dialog/dialog_demo.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="../../Content/style/ratchet.min.css" />
    <link rel="stylesheet" href="../../Content/style/skin.css" />
    <link rel="stylesheet" href="../../Content/style/icons.css" />
    <link rel="stylesheet" href="../../Content/style/iSpinner.css" />
    <link rel="stylesheet" href="../../Content/Mobile/zphStyle/font-awesome.css" />
    <link rel="stylesheet" href="/Content/Mobile/zphStyle/placeOrder.css" />
    <link rel="stylesheet" href="/Content/style/mobiscroll.css" />
    <link rel="stylesheet" href="/Content/Mobile/zphStyle/MyCoupon.css">
    <style type="text/css">
        .dialog {
            position: fixed;
            top: 50%;
            left: 30px;
            right: 30px;
            max-width: 500px;
            margin: 0 auto;
            border-radius: 10px;
            background-color: white;
            min-height: 100px;
            transform: translateY(-50%);
            box-shadow: 0px 0px 10px 0px #666666;
            padding: 20px;
            z-index: 1101;
            display: none;
        }

        .__required::before {
            content: "*";
            color: rgb(255, 73, 73);
            margin-right: 4px;
        }

        /*修改*/
        .hide {
            display: none;
        }

        .bar {
            left: 0;
            right: 0;
            max-width: 500px;
            margin: 0 auto;
            display: -webkit-box; /* android 2.1-3.0, ios 3.2-4.3 */
        }

            .bar .pay-cancal {
                width: 1.5%;
            }
        /**/
        #crowdcontent {
            background-color: rgba(255,255,255,0);
            padding: 6px;
            position: static;
        }

        .dialog .footer {
            height: 64px !important;
        }

        .table-view .dingdan span {
            color: #333;
            font-size: 14px;
            font-family: 'MIcrosoft Yahei';
        }

        .table-view .dingdan > span {
            display: block;
            padding-right: 15px;
            text-align: right;
        }
        /*活动说明*/
        .activity-instruction, .activity-instruction div, .activity-instruction a {
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .activity-instruction {
            padding: 0 10px;
            background: #fff;
        }

            .activity-instruction .instruction-head {
                height: 34px;
                line-height: 34px;
            }

                .activity-instruction .instruction-head:after {
                    content: '';
                    display: block;
                    clear: both;
                }

                .activity-instruction .instruction-head span {
                    font-size: .875rem;
                }

                .activity-instruction .instruction-head a {
                    float: right;
                    font-size: .8rem;
                    color: #565555;
                    line-height: 1.2;
                    padding: 10px 0 9px;
                    text-decoration: none;
                }

                    .activity-instruction .instruction-head a:active {
                        opacity: .8;
                    }

            .activity-instruction .steps {
                display: -webkit-box;
                display: -webkit-flex;
                display: flex;
            }

                .activity-instruction .steps .step, .activity-instruction .steps .step > div {
                    width: 69px;
                    height: 46px;
                    -webkit-border-radius: 5px;
                    border-radius: 5px;
                }

                .activity-instruction .steps .step {
                    font-size: .75rem;
                    position: relative;
                    overflow: hidden;
                }

                    .activity-instruction .steps .step > div {
                        border: 1px dashed #999;
                        color: #666;
                    }

                    .activity-instruction .steps .step.active > div {
                        border: 1px dashed #ff7800;
                        color: #ff7800;
                    }

                    .activity-instruction .steps .step .triangle {
                        width: 30px;
                        height: 30px;
                        background: #999;
                        -webkit-transform: rotate(45deg);
                        position: absolute;
                        top: -15px;
                        left: -15px;
                    }

                    .activity-instruction .steps .step.active .triangle {
                        background: #ff7800;
                    }

                    .activity-instruction .steps .step .step-text {
                        margin: 8px 0 0 10px;
                    }

                    .activity-instruction .steps .step .step-num {
                        color: #fff;
                        position: absolute;
                        top: 0;
                        left: 4px;
                    }

                .activity-instruction .steps span {
                    -webkit-box-flex: 1;
                    -webkit-flex: 1;
                    flex: 1;
                    color: #999;
                    height: 46px;
                    line-height: 46px;
                    text-align: center;
                }

            .activity-instruction .activity-tip {
                color: #ff7800;
                font-size: .75rem;
                line-height: 18px;
                padding: 10px 0;
            }

                .activity-instruction .activity-tip img {
                    width: 16px;
                    vertical-align: bottom;
                    margin-right: 5px;
                }

        #main {
            height: 850px;
        }

        .box_3 {
            border-radius: 4px;
            background-color: rgb(181, 22, 26);
            line-height: 2.5em;
            text-align: center;
            margin-bottom: 10%;
            color: #fff;
            font-size: 1.3em;
            letter-spacing: 3px;
            border: none;
        }

        .span_2 {
            background: url(/Content/Mobile/sub_hover.png) left no-repeat;
        }

        .span_3 {
            background: url(/Content/Mobile/add_hover.png) right no-repeat;
        }

        .span_com {
            width: 26px;
            height: 26px;
            margin-top: 0.2em !important;
            background-size: 25px 25px;
        }

        .NewBox {
            width: 30%;
            border-radius: 4px;
            background-color: rgb(181, 22, 26);
            line-height: 2.5em;
            text-align: center;
            margin-bottom: 10%;
            color: #fff;
            font-size: 1.3em;
            letter-spacing: 3px;
            border: none;
        }

        .li_span_pay_focus {
            color: Orange;
        }

        .ispinner-box input {
            width: 2.8rem;
            padding-right: 0px;
        }

        .picture-list {
            margin-top: 9px;
            zoom: 1;
            display: block;
            height: 78px;
        }

            .picture-list > li:nth-child(2), .picture-list > li:nth-child(5) {
                margin-left: 4.247826%;
                margin-right: 4.247826%;
            }

            .picture-list > li {
                position: relative;
                float: left;
                width: 30.434783%;
                height: 64px;
                background: #d5d5d5;
                display: list-item;
                text-align: -webkit-match-parent;
                font-family: Arial, 'Microsoft Yahei',STHeiti,sans-serif;
                color: #666;
                font-size: 14px;
                margin-bottom: 10px;
            }

                .picture-list > li img {
                    width: 100%;
                    height: 100%;
                }


            .picture-list .icon-close {
                position: absolute;
                right: -9px;
                top: -9px;
                width: 18px;
                height: 18px;
                background: #6f6f6f;
                border-radius: 50%;
                background: url("/Content/style/images/icon-close.png") no-repeat;
                -webkit-background-size: 18px 18px;
                background-size: 18px 18px;
            }

            .picture-list [class^="icon-"]:before, [class*=" icon-"]:before {
                text-decoration: inherit;
                display: none;
                speak: none;
            }

            .picture-list .icon-close:before {
                content: '';
            }

            .picture-list input:valid {
                background-color: transparent;
                box-shadow: none;
            }

            .picture-list input {
                -webkit-appearance: textfield;
                border-image-source: initial;
                border-image-slice: initial;
                border-image-width: initial;
                border-image-outset: initial;
                border-image-repeat: initial;
                -webkit-rtl-ordering: logical;
                -webkit-user-select: text;
                border: 2px inset;
            }

        .btn_addPic {
            width: 51px;
            height: 43px;
            float: left;
            position: relative;
            overflow: hidden;
            background-color: #F3F3F3;
            color: #7b7b7b;
            font-size: 14px;
            line-height: 48px;
            cursor: pointer;
            text-align: center;
            margin: 10px;
            border: solid 1px #CCCCCC;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22iso-8859-1%22%3F%3E%3C!DOCTYPE%20svg%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20SVG%201.1%2F%2FEN%22%20%22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11.dtd%22%3E%3Csvg%20version%3D%221.1%22%20id%3D%22Layer_1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20x%3D%220px%22%20y%3D%220px%22%20%20width%3D%2214px%22%20height%3D%2214px%22%20viewBox%3D%220%200%2014%2014%22%20style%3D%22enable-background%3Anew%200%200%2014%2014%3B%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20fill%3D%22%23FFF%22%20points%3D%2214%2C5%209%2C5%209%2C0%205%2C0%205%2C5%200%2C5%200%2C9%205%2C9%205%2C14%209%2C14%209%2C9%2014%2C9%20%22%2F%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3C%2Fsvg%3E');
            background-position: center 18px;
            background-repeat: no-repeat;
        }

        .fn-clear {
            zoom: 1;
        }

        .filePrew {
            display: block;
            position: absolute;
            top: 0px;
            left: 0;
            width: 60px;
            height: 100%;
            cursor: pointer;
            opacity: 0;
        }

        input[type="file" i] {
            font-size: 100%;
            -webkit-appearance: textfield;
            border-image-source: initial;
            border-image-slice: initial;
            border-image-width: initial;
            border-image-outset: initial;
            border-image-repeat: initial;
            -webkit-rtl-ordering: logical;
            -webkit-user-select: text;
            border-image-source: initial;
            border-image-slice: initial;
            border-image-width: initial;
            border-image-outset: initial;
            border-image-repeat: initial;
            -webkit-rtl-ordering: logical;
            -webkit-user-select: text;
            align-items: baseline;
            color: inherit;
            text-align: start;
        }

        input[type="image" i], input[type="file" i] {
            -webkit-appearance: initial;
            background-color: initial;
            padding: 0;
            border: initial;
        }


        .upload {
            padding: 0 8px;
            border-radius: 3px;
            border: 1px solid #d5d5d5;
            background: #f2f2f2;
            line-height: 24px;
        }

        .say {
            color: #d5d5d5;
        }

        #JhRentAgreement a:link, #JhRentAgreement a:visited, #JhRentAgreement a:hover, #JhRentAgreement a:active {
            text-decoration: underline;
        }

        .push-right:after {
            background-image: url(/Content/Mobile/yj-angle-right.png);
            width: 6px;
            height: 12px;
            background-size: 100% 100%;
            content: "";
            margin-top: -6px;
            right: 0;
        }

        .table-view .table-view-cell .spanCouponAmount {
            padding-right: 15px;
        }

        .table-view {
            margin-bottom: 5px;
        }

            .table-view .product {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                overflow: hidden;
                text-overflow: ellipsis;
                word-break: break-all;
                -webkit-box-orient: vertical;
                font-family: 'Microsoft Yahei';
                font-weight: 400;
                font-size: 14px;
                padding-right: 25px;
            }

            .table-view .summary > span {
                margin-right: 6px;
                font-family: 'Microsoft Yahei';
            }

            .table-view .table-view-cell {
                padding: 8px 0 8px 0;
                border-bottom: 1px solid #e8e8e8;
            }

                .table-view .table-view-cell.shopCartItem {
                    border: 0;
                    padding-bottom: 0;
                }

        .full-cell > a:not(.btn) {
            margin: 0 15px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e8e8e8;
        }

        .info-view span {
            color: #999;
            font-family: 'Microsoft Yahei';
            padding-right: 10px;
        }

        .table-view-cell .navigate-right > .badge {
            right: 30px;
        }

        .toggle {
            height: 24px;
            width: 50px;
            border: 1px solid #eee;
            border-radius: 25px;
            background-color: #eee;
            box-shadow: none;
        }

            .toggle:before {
                content: '';
            }

            .toggle .toggle-handle {
                top: 0;
                left: 0;
                width: 22px;
                height: 22px;
                border-radius: 50%;
            }

            .toggle.active {
                border: 1px solid #e95045;
                background-color: #e95045;
            }

                .toggle.active .toggle-handle {
                    margin-left: 28px;
                }

        .panicbuying-name {
            font-size: 12px;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
        }

        input[type="radio"] {
            vertical-align: text-bottom;
            margin-right: 5px;
        }

        .table-view .summary {
            line-height: 1.2;
            position: relative;
            margin-top: 5px;
        }

        .table-view .categoryProduct {
            line-height: 1.2;
            position: relative;
            margin-top: 5px;
        }

        .table-view .summary {
            bottom: 0;
        }

        .form-group {
            display: table;
            width: 100%;
            font-size: .8rem;
            padding: 0 10px;
            margin: 3px 0;
            position: relative;
        }

        .tableCell {
            display: table-cell;
        }

        .form-group input {
            width: 100%;
            font-size: .8rem;
            margin: 0;
            outline: none 0;
            border: none;
            display: inline-block;
            padding: 0 5px;
        }

        .disableA {
            opacity: 1;
            pointer-events: none;
            background: #e5e5e5;
            color: #a1a1a1;
        }

        .disableB {
            pointer-events: none;
        }

        .delivery-info .table-view li a .address span {
            margin-right: 20px;
        }

        #demo_treelist {
            font-size: 14px;
        }

        .panel-alert {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 6px 15px;
            box-sizing: border-box;
            background-color: #fbedd3;
            color: #333;
        }

            .panel-alert .con {
                display: block;
                font-size: 11px;
                line-height: 1.4;
                padding-right: 25px;
                word-break: break-all;
            }

            .panel-alert .close {
                box-sizing: border-box;
                position: absolute;
                right: 10px;
                top: 50%;
                margin-top: -11px;
                width: 22px;
                height: 22px;
                font-size: 14px;
                text-decoration: none;
                line-height: 0;
                text-align: center;
                background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAPlSURBVHja7NlBiFV1FMfxz8x1Edno1ptGC8uZjGiRhLZIQg0taWGEFFFhpll5axHtbJFCMBbUpZKkJLCwWhQZQZBSkaEhRRRZKkRhddfN6KLwOi08D4apeXPvfe+NSHO27/7/7/f9n//5n/85/76xsTEXs/W7yG0GYAagQ5vVrYmKLLkGq7AMg7gCs+PnMziFEziMA/hh/Pg0L6cfoMiS2XgQG2OuT/ABjofgM/Hp7ABaFIDv4BzewG6cbqqhr8kxWmRJPx7B09iH1/B9zWmuwwO4H9vxcpqXZ3sOUGTJVXgLR/EKjnW4+wbxKG7C3WlenuxZEBdZsgZfxxZ4rAvixXbLYlG+LrJkbU88UGTJeuzFnfiwR4fKbRFDG9K83Ns1gCJLbsd7uBWf9/hkXIYvsC7Ny/0db6EiSxaGe9dNg3hpXh7GWrxZZMlgRwBFliR4O06Jj6YrOaV5+TG2YV+RJbM68cAWHMHz051h07x8EYewtVEMRJL6BcsnPW36Z3VP8bmz/8rIRZZcHQt4ZZqXp+t6YGPs/amOynl4EgM1JQ/EuHltvHASe/Bwky20IQZPZfdiMZ6qATEQ3y+O8e1sT2ipDlBkyeK423xXQcxu/I75FSFa4ufHuN1TxMKP+LvIkuvreGAFDlZczRHsrAgxUfzOGD+VHQxNlQGWxbVXFyGaihdaltUBGMJPNYOyHUQn4oWWoToArT/SBYjLOxQPv2FBHYABjDY80UcwPA5ie4fiRcFzWR2APnTSMBrFrpijNdeuhuKNm6cywAjmdAAwENeQvnF/vqVBsptyR0wG8Efs3aZ/Nn7Pb6uZJ/7LFkQcVAaYNOprih+OxRjuEGIwKrfKAEewtAviR8fFRCcQS0NTZYADWNkl8boAsTI0VQNI87LVdLq2S+IbQxRZMoRL0rz8tu5ttO0tcJxtrih+MojNU3zf9lbcP8Ut874IoHbWqhmqiJ8IcSzGt6vHH8KrtQGiAtoR/Z+2XsZzDTL3aIwr2nzzOHakeTlpApyqJnwJX+EJvDBZGdgLK7JkK27GksZFfZqXJe7BM1g9XQV9kSWr8Wy0Gs92o7F1RzS2luPLHutfEmd+dxpb4Yn9zneRP8OaHopfFeI3VRFfGSAgWt25dyO4um0Z3sddaV7uqTqoSXt90Pk3gUMR5Cc6FL4wFmQ51qd5WasSrP1GlublcdyIn8Pdww0vfkNR4BzFr7ihrvhGHpjgjbnYFNnyr+geHA6vnIq6Ygxz40rcemK6BZfi9UiYI03fyPq69VIffZsVIXCR829ic6KY+TPu861Hvk/xzQTPXliAC2UzD90zAP93gH8GAI+PWq9wNgy3AAAAAElFTkSuQmCC");
                background-position: center center;
                background-size: cover;
                opacity: .4;
            }

        .bottom-tips-wrap {
            position: fixed;
            bottom: 50px;
            left: 0;
            right: 0;
            max-width: 500px;
            margin: 0 auto;
            height: 44px;
            line-height: 44px;
            padding: 0 15px;
            color: #333;
            font-size: 11px;
            background: #fbedd3;
            font-family: 'Microsoft Yahei';
            z-index: 3;
        }

        a {
            text-decoration: none;
        }

        .mk-confirm-wrap {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            max-width: 500px;
            margin: 0 auto;
            z-index: 1000;
            background: rgba(0, 0, 0, .5);
            font-family: 'Microsoft Yahei';
        }

        .mk-confirm {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80%;
            -webkit-transform: translate(-50%,-50%);
            transform: translate(-50%,-50%);
            -webkit-border-radius: 5px;
            border-radius: 5px;
            background-color: #fff;
            text-align: center;
        }

        .mk-confirm-content {
            padding: 18px 10px;
            line-height: 16px;
            border-bottom: 1px solid #E8E8E8;
            font-size: 14px;
        }

            .mk-confirm-content .mk-confirm-message {
                font-family: 'Microsoft Yahei';
            }

        .mk-confirm-bottom {
            display: -webkit-box;
            -webkit-box-flex: 1;
            height: 33px;
            line-height: 33px;
        }

        .mk-confirm-btn {
            display: block;
            -webkit-box-flex: 1;
            color: #000;
            font-family: 'Microsoft Yahei';
        }

        .mk-confirm-cancel {
            border-right: 1px solid #E8E8E8;
            font-family: 'Microsoft Yahei';
        }

        .table-view > div.reserver-wrap, .reserver-wrap {
            position: relative;
            height: 22px;
            line-height: 22px;
            margin-top: -1px;
            padding: 0 15px;
            background: #fbedd3;
            font-size: 11px;
            color: #999;
        }
        /*赠品*/
        .table-view .present-wrap {
            padding: 6px 0;
            background: #f3f4f5;
        }

        .present {
            position: relative;
            top: 0;
            left: 0;
            display: -webkit-box;
            -webkit-box-flex: 1;
            padding: 5px 15px;
            background: #f3f4f5;
        }

            .present .present-title {
                display: -webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 2;
                -webkit-box-flex: 1;
                overflow: hidden;
                text-overflow: ellipsis;
                font-family: 'Microsoft Yahei';
                font-size: 12px;
                line-height: 14px;
                color: #333;
            }

                .present .present-title:before {
                    content: '\005b\8d60\54c1\005d';
                    color: #e95045;
                }

            .present .present-info {
                display: block;
                min-width: 75px;
                font-size: 11px;
                line-height: 11px;
                color: #999;
                text-align: right;
            }

                .present .present-info span {
                    margin-top: 15px;
                    font-size: 11px;
                    line-height: 12px;
                    color: #999;
                    font-family: 'Microsoft Yahei';
                }

                .present .present-info a img {
                    width: 20px;
                    margin-top: -4px;
                }

                .present .present-info > img {
                    position: absolute;
                    top: 0;
                    width: 28px;
                    height: 24px;
                    margin-left: 5px;
                }

                    .present .present-info > img.active {
                        display: block !important;
                    }
    </style>
    @if (onlyWxPay)
    {
        <style>
            .wx-pay {
                box-sizing: border-box;
                padding: 20px;
                text-align: center;
                font-size: 18px;
                -webkit-font-smoothing: antialiased;
                max-width: 500px;
            }

            .weui-btn:after {
                content: " ";
                width: 200%;
                height: 200%;
                position: absolute;
                top: 0;
                left: 0;
                border: 1px solid rgba(0, 0, 0, 0.2);
                -webkit-transform: scale(0.5);
                transform: scale(0.5);
                -webkit-transform-origin: 0 0;
                transform-origin: 0 0;
                box-sizing: border-box;
                border-radius: 10px;
            }

            .weui-btn_primary:not(.weui-btn_disabled):visited {
                color: #FFFFFF;
            }

            .weui-btn_primary {
                background-color: #1AAD19;
            }

            .weui-btn {
                position: relative;
                display: block;
                margin-left: auto;
                margin-right: auto;
                padding-left: 14px;
                padding-right: 14px;
                box-sizing: border-box;
                font-size: 18px;
                text-align: center;
                text-decoration: none;
                color: #FFFFFF;
                line-height: 2.55555556;
                border-radius: 5px;
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
                overflow: hidden;
            }

            .weui-btn_disabled.weui-btn_primary {
                background-color: #9ED99D;
            }

            .weui-btn_disabled {
                color: rgba(255, 255, 255, 0.6);
            }

            .weui-btn_primary:not(.weui-btn_disabled):active {
                color: rgba(255, 255, 255, 0.6);
                background-color: #179B16;
            }

            .content {
                overflow: auto;
                background-color: #e7e6ec;
                padding-bottom: 117px;
            }

            .money {
                color: #ff0054;
            }
        </style>
    }
}
@section ClientScript
    {
    @*<script src="https://www.debuggap.com/statistic/debuggap.js"></script>*@
    <script type="text/javascript" language="javascript" src="https://webapi.amap.com/maps?v=1.3&key=@Jinher.AMP.BTP.Common.CustomConfig.AmapKey"></script>
    <script src="/Scripts/md5.js" type="text/javascript"></script>
    <script src="/Scripts/CommLib.js?version=1.0" type="text/javascript"></script>
    <script src="/Content/js/ratchet.min.js" type="text/javascript"></script>
    <script src="/Content/js/ispinner.js" type="text/javascript"></script>
    <script src="/Content/Mobile/zeptodialog/zepto.tanchu.js" type="text/javascript"></script>
    <script src="/Content/Mobile/touchScroll.js" type="text/javascript"></script>
    <script src="/dist/lib/Areatopthree-sample.js" type="text/javascript"></script>
    <script src="/Content/Mobile/fastClick.min.js" type="text/javascript"></script>
    <script src="/Content/js/mobiscroll.js" type="text/javascript"></script>
    <script src="/Content/js/mobiscroll.treelist.js" type="text/javascript"></script>
    <script src="/dist/js/createOrder.js?@DateTime.Now" type="text/javascript"></script>
    @Html.Raw(@Jinher.AMP.BTP.UI.Util.WebUtil.GetBehaviorRecordJs())
    <script type="text/javascript">
        $(function () {

            if (getQueryString("appId") == "cf063155-e6e9-4019-ba12-6b44b704243f") {
                $(".activity-tip").empty();
                $(".activity-tip").append('<img src="/Content/Mobile/fire-icon.png" alt="" />支付开团并喊好友参团，组团成功后等待商家发货；如组团失败，请联系智力圈客服凯文退款。微信ID：kevinmeiguo。');
            } else {
                $(".activity-tip").empty();
                $(".activity-tip").append('<img src="/Content/Mobile/fire-icon.png" alt="" />支付开团并喊好友参团，组团成功后等待商家发货；如组团失败，则系统自动将款项原路退还。');
            }
        })

        // 是否是活动商品
        var isPromotion = false;
        // 优惠套装 数量
        var setMealCount = -1;
        // 是否预售
        var IsPresell = false;
        // 是否有赠品
        var _hasPresent = false;
        var _userYJCoupons;
        var _userYJB;
        var _isInit = true;


        //显示众销信息。
        function showCrowdfund(data) {
            if (data == null) {
                return;
            }
            //众筹每股金额
            var perShareMoney = data.PerShareMoney;
            //用户已购买金额
            var money = data.Money;
            //用户已持有股数
            var currentShareCount = data.CurrentShareCount;
            //是否是进行中的众筹 true为活动中
            var isActiveCrowdfunding = data.IsActiveCrowdfunding;
            //众筹可购买股数
            var shareCountRemain = data.ShareCountRemain;
            //用户将要够买的金额
            var usergou = $(".span_4").html();

            if (isActiveCrowdfunding == "true" || isActiveCrowdfunding) {
                $(".crowli").show();
                //如果用户将要够买 产生的股点数超过了此App剩余的股点数
                if ((usergou / perShareMoney) >= shareCountRemain) {
                    $(".crowinfor").html("您已拥有全部剩余股点" + shareCountRemain + "股！");

                }
                else {
                    //向上取整,有小数就整数部分加1
                    var jianggu = parseInt(usergou / perShareMoney) + 1;
                    var chaprice = ((perShareMoney * jianggu) - usergou).toFixed(2);
                    $(".crowinfor").html("您再购买" + chaprice + "元商品就能获得" + jianggu + "股，坐等分红啦！");
                }
            }
        }


        //CreateOrder 计算运费、获取优惠信息。
        function calcFreight(hasAddress, num) {
            var sttoggle = isSelfTakeForCreateOrder();

            //是否显示优惠券。
            var issc = sessionStorage.IsHYL ? "1" : "0";
            ajaxLoadingSingle.show();
            var cparam = {};
            cparam.esAppId = getEsAppId();
            cparam.templateCounts = buildComList();
            cparam.freightTo = $(".sprovince").html();
            cparam.isSelfTake = sttoggle;
            cparam.uid = getUserId();
            cparam.issc = issc;
            cparam.isScore = _isReloadScore;
            cparam.hasAddress = hasAddress;
            cparam.coupons = _useCouponDic;
            cparam.useYjb = YJB.useYjb;
            cparam.yjCoupons = YJCOUPON.currentCouponeIds;
            var strjson = CommLib.ObjToStringWithQuot(cparam);
            getDataAjax2({
                url: "/Mobile/CalFreightMultiApps",
                data: strjson,
                callback: function (result) {
                    _isReloadScore = false;
                    ajaxLoadingSingle.hide();
                    showFreightCouponInfo(result, num);
                    COUPON.freightMultiApps = result;

                    if (!result.hasPromotion) {
                        window.StoreCoupon.init();
                        window.StoreCoupon.initEvent();
                    }
                    //JsCrowdfund();
                },
                error: function () {
                    ajaxLoadingSingle.hide();
                }
            });
        }

        //显示运费和优惠券信息
        function showFreightCouponInfo(result, num) {
            //显示运费信息。
            var freightResult = result.FreightResult;
            _couponResult = result.CouponResult.Data;
            _userScore = result.ScoreResult;
            _userYJB = result.YJBInfo;
            _userYJCoupons = result.YJCouponInfo;
            //总运费
            var tf = 0;
            if (freightResult != null) {
                _freightResult = freightResult.AppFreight;
                if (freightResult.Freight != undefined) {
                    tf = Math.abs(freightResult.Freight).toFixed(2);
                }
            }
            $('#freight').html(tf);
            setSessionStorage('commodityUpInfo', 'freight', tf);
            if (sessionStorage.type == "gouwuche") {
                var shopList = JSON.parse(sessionStorage.ShopCartDate);
                $("#divShopCommoditys > div").each(function (ind, el) {
                    var appid = $(this).attr("co-tag-appid");
                    var shop = shopList.GetFirstElement("AppId", appid);
                    var price = eval(shop.AppAmount);
                    var realPrice = price;

                    //运费
                    var f = 0;
                    if (_freightResult != null && _freightResult.length > 0) {
                        var fa = _freightResult.GetFirstElement("AppId", appid);
                        if (fa) {
                            f = fa.Freight;
                        }
                    }

                    $(this).find('span[co-tag="Freight"]').html(f);

                    if (f > 0) {
                        $(this).find(".shop-info-list-text").text('快递￥' + fa.Freight);
                    } else {
                        // if (fa) $(this).find(".shop-info-list-text").text(fa.FreeFreightStandard);
                        $(this).find(".shop-info-list-text").text('快递￥0');
                    }

                    realPrice += f;

                    if (shop.Duty && shop.Duty > 0) {
                        realPrice += shop.Duty;
                    }

                    // 优惠券    <span co-tag="CouponAmountShop" id="spanCouponAmount">0</span>
                    var cspan = $(this).find('ul li span[co-tag="CouponAmountShop"]');
                    cspan.parents("li").hide();
                    cspan.html("0");
                    COUPON.initDisplayWhenBasket(_couponResult);
                    if (_couponResult != null && _couponResult.length > 0) {
                        //优惠券。

                        var cdto = _couponResult.GetFirstElement("ShopId", appid);

                        ////遍历的这个优惠券的节点，上次选择的优惠券的Id
                        //var couponid = $(`#divShopCommoditys [co-tag-appid="${appid}"] [onclick = "COUPON.chooseCoupon(this)"]`).data("couponid");
                        //    //cspan.parents("li").data("couponid");

                        ////如果上次选择了优惠券。
                        //if ((couponid != null) && (couponid != ""))
                        //{
                        //    cdto = _couponResult.GetFirstElement("CouponId", couponid);
                        //    cspan.parents("li").data('couponid', couponid);
                        //}
                        //else
                        //    cspan.parents("li").data('couponid', couponid);
                        //("CouponId", cspan.parents("li").data("couponid"));//("ShopId", appid);

                        if ((cdto != null)) { // &&  && couponAppId==null)||(couponAppId != null && couponAppId == appid
                            cspan.parents("li").show();
                            //商店通用
                            if (cdto.CouponType == 0) {
                                var youh = 0;
                                youh = cdto.Cash > price ? price : cdto.Cash;
                                realPrice = (realPrice * 100 - youh * 100) / 100;
                                cspan.text(youh);


                            } else if (cdto.CouponType == 1) { //优惠券适用于“指定商品”
                                var totalPriceCommodity = 0;
                                if (cdto.GoodList != null && cdto.GoodList.length > 0) {
                                    var gstr = cdto.GoodList.join(",");
                                    var shoppings = shop.ShoppingCartItemSDTO;
                                    for (var j = 0; j < shoppings.length; j++) {
                                        if (gstr.indexOf(shoppings[j].Id) > -1) {
                                            //同一商品，属性不同，价格也不同。(可能有同一商品id,不同价格。)
                                            totalPriceCommodity += eval(shoppings[j].CommodityNumber) * eval(shoppings[j].RealPrice);
                                        }
                                    }
                                }
                                //优惠券金额大于商品总价，只优惠商品总价。
                                realPrice -= cdto.Cash > totalPriceCommodity ? totalPriceCommodity : cdto.Cash;
                                cspan.html(cdto.Cash > totalPriceCommodity ? totalPriceCommodity : cdto.Cash);
                                cspan.parents("li").data('shopid', appid);
                            }
                            cspan.parents("li").data('couponid', cdto.CouponId);

                            if (cdto.Cash == 0) {
                                cspan.parent().addClass('hide');
                                cspan.parent().next().removeClass('hide');
                            } else {
                                cspan.parent().removeClass('hide');
                                cspan.parent().next().addClass('hide');
                            }
                        }
                    }

                    //合计
                    $("#AppSetMeal").text((price * num).toFixed(2));
                    $(this).find('ul li span[co-tag="AppAmount"]').html((realPrice * num).toFixed(2));

                    shop.RealPrice = realPrice * num;
                    shop.Price = shop.AppAmount * num;
                });
                //将修改后的CouponId\CouponValue\RealPrice保存到sessionStorage.ShopCartDate
                sessionStorage.ShopCartDate = JSON.stringify(shopList);

            }
            else {
                if (freightResult.AppFreight) {
                    if (freightResult.AppFreight[0].Freight > 0) {
                        $("#freightBar .shop-info-list-text").text('快递￥' + freightResult.AppFreight[0].Freight);
                    } else {
                        // $("#freightBar .shop-info-list-text").text(freightResult.AppFreight[0].FreeFreightStandard);
                        $("#freightBar .shop-info-list-text").text('快递￥0');
                    }
                }

                //商品金额。
                var CommdityAmount = 0;
                if (Number(commodityUpInfo.Specifications) > 0) { //有规格的情况
                    CommdityAmount = Math.abs(commodityUpInfo.number * commodityUpInfo.Specifications * commodityUpInfo.realPrice).toFixed(2) * 1.0;
                } else {
                    CommdityAmount = Math.abs(commodityUpInfo.number * commodityUpInfo.realPrice).toFixed(2) * 1.0;
                }
                COUPON.initDisplay(_couponResult);
                //优惠券
                $("#spanCouponAmount").html("0");
                $("#spanCouponAmount").parents("li").hide();
                if (_couponResult != null && _couponResult.length > 0) {

                    //优惠券抵用金额，     如果商品金额和 优惠券金额 选择小的
                    var camount = CommdityAmount > _couponResult[0].Cash ? _couponResult[0].Cash : CommdityAmount;
                    $("#spanCouponAmount").html(camount);
                    $("#spanCouponAmount").parents("li").show();
                    $("#spanCouponAmount").parents("li").data('couponid', _couponResult[0].CouponId);


                    //优惠券的金额为0，并且优惠券的Id不存在：显示不使用优惠券
                    if (_couponResult[0].Cash == 0 && _couponResult[0].CouponId == "") {
                        $("#spanCouponAmount").parent().addClass('hide');
                        $("#spanCouponAmount").parent().next().removeClass('hide');
                    } else {
                        $("#spanCouponAmount").parent().removeClass('hide');
                        $("#spanCouponAmount").parent().next().addClass('hide');
                    }
                }
            }
            // 初始化积分
            initScore();
            // 初始化易捷币
            if (_userYJB) YJB.initYjbInfo(_userYJB);
            // 初始化易捷抵现卷
            if (_isInit && _userYJCoupons) initYJCouponInfo(_userYJCoupons);
            _isInit = false;
            CalcPayPrice && CalcPayPrice();
        }

        //初始显示积分信息
        function initScore() {
            //订单项里的商品appid如果和esappId不同，则“积分”不显示。
            //未启用“积分抵现”，则“积分”不显示。
            if (!JsVilaDataNull(window._userScore) || (!window._userScore.IsCashForScore)) {
                return;
            }

            $("#spanUserScore").html(window._userScore.Score);
            $("#signScore_balance").show();
            //            $("#scoreValueli").show();
            //启用了“积分抵现”，但用户没有积分可以抵现
            //不足以抵0.01元（可能data.Score >0,但兑换成人民币后不足0.01元；也可能data.Score=0）。
            if (window._userScore.Score / window._userScore.ScoreCost <= 0.01) {
                $("#spanActivedScore").hide();
                $("#spanNoScore").show();
                $("#spanCannotScore").hide();
                $("#signScorePay").css("pointer-events", "none");
                return;
            }

            $("#spanActivedScore").show();
            $("#spanNoScore").hide();
            $("#spanCannotScore").hide();

            var scoreUsed = parseInt(window._userScore.Money * window._userScore.ScoreCost);
            if (scoreUsed > 0) {
                $("#spanUserScore").html(window._userScore.Score);
                $(".orderScoreAmount_3").text((scoreUsed / window._userScore.ScoreCost).toFixed(2));
                $("#spanScoreUse").text(scoreUsed);
                $("#signScorePay").css("pointer-events", "");
            } else {
                //让开关失效。
                $("#signScorePay").css("pointer-events", "none");
                $(".orderScoreAmount_3").text("0.00");
                $("#spanScoreUse").text("0");
            }
        }

        // 初始化易捷抵用卷信息
        function initYJCouponInfo(data) {
            // 判断是否有可以抵用券
            if (data && data.YJCoupons.length > 0) {
                $("#hasYJCoupon").removeClass("hide");
                // 是否可以叠加使用
                if (data.CanCombinabled) {
                    // 默认使用金额最大的抵用券
                    var maxPrice = Math.max.apply(Math, data.YJCoupons.map(function (o) { return o.Price; }))
                    YJCOUPON.chooseYJCouponCore([data.YJCoupons.filter(function (_) { return _.Price == maxPrice })[0].Id]);
                } else {
                    if (!isPromotion && getQueryString("type") !== "diygroup") {
                        YJCOUPON.chooseYJCouponCore(null);
                    } else {
                        $("#hasYJCoupon").addClass("hide");
                        $("#noYJCoupon").addClass('hide');
                    }
                }
                YJCOUPON.initData(data);
            } else {
                $("#noYJCoupon").removeClass('hide');
            }

            if (!isPromotion && getQueryString("type") !== "diygroup") {
                //                // 判断是否有可以抵用券
                //                if (data && data.YJCoupons.length > 0) {
                //                    $("#hasYJCoupon").removeClass("hide");
                //                    // 是否可以叠加使用
                //                    if (data.CanCombinabled) {
                //                        // 默认使用金额最大的抵用券
                //                        var maxPrice = Math.max.apply(Math, data.YJCoupons.map(function(o) { return o.Price; }))
                //                        YJCOUPON.chooseYJCouponCore([data.YJCoupons.filter(function(_) { return _.Price == maxPrice })[0].Id]);
                //                    } else {
                //                        YJCOUPON.chooseYJCouponCore(null)
                //                    }
                //                    YJCOUPON.initData(data);
                //                } else {
                //                    $("#noYJCoupon").removeClass('hide');
                //                }
            } else {
                //                $("#hasYJCoupon").addClass("hide");
                //                $("#noYJCoupon").addClass('hide');
                $("#yjb_balance").addClass('hide');
            }
        }

        //将不同方向过来的需要下订单的商品组成统一格式。（商品详情直接购买、购物车结算、客户端原生直接打开下订单页面）
        function buildComList() {
            var request = [];
            if (sessionStorage.type != "gouwuche") {

                //规格设置
                var Num = 0;
                if (Number(commodityUpInfo.Specifications) > 0) {
                    Num = Number(commodityUpInfo.number * commodityUpInfo.Specifications);
                } else {
                    Num = Number(commodityUpInfo.number);
                }
                var com = {
                    ItemId: "00000000-0000-0000-0000-000000000000",
                    CommodityId: sessionStorage.commodityId_2,
                    RealPrice: commodityUpInfo.realPrice,
                    ColorAndSize: (commodityUpInfo.color ? commodityUpInfo.color : '') + ',' + (commodityUpInfo.size ? commodityUpInfo.size : ''),
                    Num: Num,
                    AppId: sessionStorage.appId,
                    IsPromotion: parseFloat(commodityUpInfo.realPrice).toFixed(2) != parseFloat(commodityUpInfo.price).toFixed(2),
                    OutPromotionId: commodityUpInfo.OutPromotionId
                };
                if (com.OutPromotionId == undefined) {
                    com.OutPromotionId = "";
                }
                request.push(com);
                isPromotion = com.IsPromotion;
            } else {
                var sh = sessionStorage.ShopCartDate;
                sh = JSON.parse(sh);
                for (var c = 0; c < sh.length; c++) {
                    var shopId = sh[c].AppId;
                    var shoppingCartItems = sh[c].ShoppingCartItemSDTO;
                    for (var i = 0; i < shoppingCartItems.length; i++) {
                        //规格设置
                        var Num = 0;
                        if (shoppingCartItems[i].Specifications != null && Number(shoppingCartItems[i].Specifications.Attribute) > 0) {
                            Num = Number(shoppingCartItems[i].CommodityNumber * shoppingCartItems[i].Specifications.Attribute);
                        }
                        else if (Number(shoppingCartItems[i].Specifications) > 0) {
                            Num = Number(shoppingCartItems[i].CommodityNumber * shoppingCartItems[i].Specifications);
                        }
                        else if (shoppingCartItems[i].Specification != null && Number(shoppingCartItems[i].Specification.Attribute) > 0) {
                            Num = Number(shoppingCartItems[i].CommodityNumber * shoppingCartItems[i].Specification.Attribute);
                        } else {
                            Num = shoppingCartItems[i].CommodityNumber;
                        }
                        var com = {
                            ItemId: shoppingCartItems[i].ShopCartItemId === undefined ? "00000000-0000-0000-0000-000000000000" : shoppingCartItems[i].ShopCartItemId,
                            CommodityId: shoppingCartItems[i].Id,
                            RealPrice: shoppingCartItems[i].RealPrice,
                            ColorAndSize: shoppingCartItems[i].Size === undefined ? "," : shoppingCartItems[i].Size,
                            Num: Num,
                            AppId: shoppingCartItems[i].AppId,
                            IsPromotion: parseFloat(shoppingCartItems[i].RealPrice).toFixed(2) != parseFloat(shoppingCartItems[i].Price).toFixed(2)
                        };
                        if (setMealCount > 0) {
                            com.Num = setMealCount;
                        }
                        request.push(com);
                        if (com.IsPromotion) {
                            isPromotion = com.IsPromotion;
                        }
                    }
                }
            }
            return request;
        }
    </script>
    <script type="text/javascript">
        var dateTemplate = '<li style="font-size:12px;">{ScrollDateText}<input type="hidden" name="ScrollDateValue" value="{ScrollDateFmt}" data-text="{ScrollDateValue}" />';
        var timeTemplate = '<li style="font-size:12px;">{ScrollTimeText}<input type="hidden" name="ScrollTimeValue" value="{ScrollTime}" data-text="{ScrollTimeValue}"  /></li>';
        //修改click事件
        $(function() {
            FastClick.attach(document.body);
        });
        var service_type = "0x0003";
        var logOrderId = 'orderid:' + getQueryString("orderId") + '|';
        //订单项模板。
        var shopItemTemplate = "";
        var commodityItemTemplate = "";

        //地址信息。
        var _addressInfo = new Object();

        //众筹信息列表
        var_crowdfundingList = [];

        //是否自提标记
        var _selftaketoggle = false;

        //加载商品自提数据是否完成。
        var _selftakeCompleted = false;
        //加载收货地址数据是否完成。
        var _loadAddressCompleted = false;
        //积分-人民币兑换比例。
        var _userScore = {};

        //GetCreateOrderAllInfo返回的数据。
        var _pageAllInfoData = {};

        var _isAllAppInZPH = false;
        //下单商品是否包含关税
        var _hasDuty = false;
        //下单商品是否包含实物商品
        var _hasPhysicalCommodity = false;
        //下单商品是否包含虚拟商品
        var _hasVirtualCommodity = false;
        var appIds = new Array();
        //配送方式（配置）：0 app没有自提功能，1快递，2自提，3两者
        var _appSelfTakeWay = @ViewBag.AppSelfTakeWay;
        //配送方式（选择）：0:快递；1自提
        var _appSelfTakeFlag = 0;
        //检查可用的app配送方式。0 不显示配送方式；1 只显示快递；2 只显示自提；3 都显示，但自提是灰色显示
        var _checkEnableWay = 0;
        //0 非平台型app; 1 平台型app
        var _isPlatformApp = @ViewBag.IsPlatformApp;
        //用来存当前页的东西
        var _pageCache = {};
        //订单总金额，
        var _orderRealPrice = 0;

        var _isReloadScore = true;

        //优惠信息列表。
        var _couponResult = new Array();
        //运费信息列表。
        var _freightResult = new Array();
        var brainhoopAppId = '@brainhoopAppId';

        // 使用的优惠券
        var _useCouponDic = new Array();
        // 当前优惠券AppId
        var _currentCouponAppId = sessionStorage.appId;
        var _commodityNum = 1;

        var commodityUpInfo;
        if (JsVilaDataNull(getQueryString("srctype"))) {
            sessionStorage.SrcType = getQueryString("srctype");
        }
        if (JsVilaDataNull(getQueryString("producttype"))) {
            sessionStorage.ProductType = getQueryString("producttype");
        }

        function getCityCode(cityName) {
            var cityCode;
            var allCities = [];
            allCities = getAllCities();
            for (var i = 0, n = allCities.length; i < n; i++) {
                if (cityName == allCities[i].Name) {
                    cityCode = allCities[i].AreaCode;
                }
            }
            return cityCode;
        }

        function isSelfTakeForCreateOrder() {
            //$("#selftaketoggle").is(".active") ? "1":"0";
            return _appSelfTakeFlag;
        }

        function setPageSetting() {
            if (JsVilaDataNull(sessionStorage.CreateOrderInfo)) {
                _pageCache = JSON.parse(sessionStorage.CreateOrderInfo);
            }
            if (JsVilaDataNull(getQueryString('addressid'))) {
                _pageCache.addressId = getQueryString('addressid');
            }
            if (JsVilaDataNull(getQueryString('couponCodes'))) {
                _pageCache.couponCodes = getQueryString('couponCodes');
            }
            if (JsVilaDataNull(getQueryString('couponCount'))) {
                _pageCache.couponCount = getQueryString('couponCount');
            }
            if (JsVilaDataNull(getQueryString('couponCount'))) {
                _pageCache.couponCount = getQueryString('couponCount');
            }
            if (JsVilaDataNull(getQueryString('appselftakestationid'))) {
                _pageCache.appSelfTakeStationId = getQueryString('appselftakestationid');
            }
            if (!JsVilaDataNull(_pageCache.needinvoice)) {
                if ($("#invoicetoggle").is(".active")) {
                    _pageCache.needinvoice = 1;
                } else {
                    _pageCache.needinvoice = 0;
                }
            }
            if (!JsVilaDataNull(_pageCache.signScorePay)) {
                if ($("#signScorePay").is(".active")) {
                    _pageCache.signScorePay = 1;
                } else {
                    _pageCache.signScorePay = 0;
                }
            }
            if (!JsVilaDataNull(_pageCache.goldpay)) {
                if ($("#goldpay").is(".active")) {
                    _pageCache.goldpay = 1;
                } else {
                    _pageCache.goldpay = 0;
                }
            }
            if (!JsVilaDataNull(_pageCache.appSelfTakeFlag)) {
                if ($("#selfTakeWay").is(".current")) {
                    _pageCache.appSelfTakeFlag = 1;
                } else {
                    _pageCache.appSelfTakeFlag = 0;
                }
            }
            sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
        }


        function goldpayToggleActive() {
            //行为记录->选择金币支付开
            logBTP(sessionStorage.SrcType, service_type, "0x0020", sessionStorage.commodityId_2 || '');
            getDataAjax({
                url: '/Mobile/CheckGoldPwd',
                data: { userId: getUserId() },
                callback: function(data) {
                    ajaxLoadingSingle.hide();
                    _pageCache.goldpay = 1;
                    sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
                    $('#goldpw').show();
                    if (data.Code == 1) { //未设置密码
                        showDialog('#setPwdDialog');
                        hideDialog('#payDialog');
                    } else {
                        showDialog('#payDialog');
                        hideDialog('#setPwdDialog');
                    }
                },
                beforeSend: function() {
                    ajaxLoadingSingle.show();
                },
                error: function() {
                    ajaxLoadingSingle.hide();
                }
            });
        }

        function invoiceToggleActive() {
            $('#InvoiceMessage').show();
            _pageCache.needinvoice = 1;
            sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
            var invText = "点击设置发票信息";

            var invoice = JsVilaDataNull(sessionStorage.InvoiceDTO) && $.parseJSON(sessionStorage.InvoiceDTO);
            if (invoice) {
                if (invoice.Category == 1) {
                    invText = "增值税普通发票";
                } else if (invoice.Category == 2) {
                    invText = "电子发票";
                } else if (invoice.Category == 3) {
                    invText = "不要发票";
                } else if (invoice.Category == 4) {
                    invText = "增值税专用发票";
                }
            }
            $("#invoiceTip").html(invText);

        }

        //用于判断是否可以上传附件
        //var uploadAppId = "4c30b251-a6f0-4023-a924-09f2991013a1";
        //var uploadAppId = "5fd4ce14-5b52-43d9-90e6-c19e1559347b,4c30b251-a6f0-4023-a924-09f2991013a1";
        var _newContractCommodityList = $.parseJSON(decodeURIComponent('@ViewBag.RentAgreement'));
        var _showContractCommodityList = [];
        var _contractTemplete = "";
        var _uploadAppId = "";
        var dialog4 = "";
        var callbackurl = "";

        function htmlDecodeJQ(str) {
            return $('').html(str).text();
        }

        //获取下订单所有app

        function getAppIds() {
            //appids
            if (sessionStorage.type == "gouwuche") {
                var sh = sessionStorage.ShopCartDate;
                var shopcartData = [];
                if (JsVilaDataNull(sh)) {
                    shopcartData = JSON.parse(sh);
                    for (var i = 0; i < shopcartData.length; i++) {
                        if (appIds.indexOf(shopcartData[i].AppId) > -1) {
                            continue;
                        }
                        appIds.push(shopcartData[i].AppId);
                    }
                }
            } else {
                appIds.push(sessionStorage.appId);
            }
            appIds = appIds.join(",");
        }


        //下订单使用

        function createOrder(documents) {
            if (sessionStorage.type != "gouwuche") {
                //var commodityUpInfo = JSON.parse(sessionStorage.commodityUpInfo);
                var comTitle = '';
                if (!commodityUpInfo)
                    return;
                if (commodityUpInfo.name != '' && commodityUpInfo.name != undefined) {
                    comTitle += commodityUpInfo.name;
                }
                var sizecolor = '';
                if (commodityUpInfo.color != '' && commodityUpInfo.color != undefined) {
                    sizecolor += commodityUpInfo.color;
                }
                if (commodityUpInfo.size != '' && commodityUpInfo.size != undefined) {
                    if (sizecolor != '') {
                        sizecolor += ' '
                    }
                    sizecolor += commodityUpInfo.size;
                }
                if (Number(commodityUpInfo.Specifications) > 0) {
                    if (sizecolor != '') {
                        sizecolor += ''
                    }
                    sizecolor += " 1*" + commodityUpInfo.Specifications;
                }
                documents.find('h1').text(comTitle);
                documents.find('.price_make_1').val(Math.abs(commodityUpInfo.price).toFixed(2));
                documents.find('.span_number').text("数量:" + commodityUpInfo.number);
                documents.find('.ispinner').val(commodityUpInfo.number);
                documents.find("#oneCommodityNum span").html(commodityUpInfo.number);
                if (commodityUpInfo.orderType == 0
                        && sessionStorage.type != "diygroup") {
                    documents.find('.ispinner').parents("p").show();
                    documents.find("#oneCommodityNum").hide();
                    documents.find("#oneCommodityNum").parents("li").css("padding-right", "65px");
                } else {
                    documents.find('.ispinner').parents("p").hide();
                    documents.find("#oneCommodityNum").show();
                    documents.find("#oneCommodityNum").parents("li").css("padding-right", "15px");
                }
                var totalprice = 0.00;
                if (commodityUpInfo.currentSpecifications != null && commodityUpInfo.currentSpecifications != "") {
                    var arr = commodityUpInfo.currentSpecifications.split('*');
                    totalprice = Number(commodityUpInfo.realPrice * commodityUpInfo.number * arr[1]).toFixed(2);
                } else {
                    totalprice = Number(commodityUpInfo.realPrice * commodityUpInfo.number).toFixed(2);
                }

                if (Number(commodityUpInfo.Specifications) > 0) {
                    totalprice = Number(commodityUpInfo.realPrice * commodityUpInfo.number * commodityUpInfo.Specifications).toFixed(2);
                } else {
                    totalprice = Number(commodityUpInfo.realPrice * commodityUpInfo.number).toFixed(2);
                }

                $(".totalprice").text(totalprice);
                $(".payprice").text(totalprice);
                $("#submitorder").html(getPaySubmitDesc());
                $(".price_3").text("0.00")
                $('#freight').html("0.00");
                documents.find('.categoryProduct').text(commodityUpInfo.CategoryName);
                if (sizecolor.length>5) {
                    var attrbute=sizecolor.substr(0,5);
                    documents.find('.summary').text(attrbute+"...");
                }
                else {
                    documents.find('.summary').text(sizecolor);
                }
                $('.compic').attr('src', commodityUpInfo.pic);
                $('.comName').html(commodityUpInfo.name);
                if (typeof(commodityUpInfo.realPrice) == 'number') {
                    $('.comPrice').html("¥" + commodityUpInfo.realPrice.toFixed(2));
                } else {
                    $('.comPrice').html("¥" + parseFloat(commodityUpInfo.realPrice).toFixed(2));
                }
                if (JsVilaDataNull(commodityUpInfo.commodityId)) {
                    sessionStorage.commodityId_2 = commodityUpInfo.commodityId;
                }

                $('#siglecom').show();
                $("#ulDetails").show();

                var objList = sessionStorage.CommidotyId ? sessionStorage.CommidotyId : sessionStorage.commodityId_2;
                var checkReuslt = isShowUploadOrContract(objList);
                if (checkReuslt.showUploadFileCom) {
                    _uploadAppId = sessionStorage.appId.toLowerCase();
                }
                showHideUploadOrContract(checkReuslt);
            } else {
                _selftakeCompleted = true;
                $('#siglecom').hide();
                $("#ulDetails").show();
                displayCartInfo();
            }

            if (_pageCache.goldpay == 1) {
                $("#gold_balance").show();
                $("#goldpay").addClass('active');
                goldpayToggleActive();
            }
            if (_pageCache.signScorePay == 1) {
                $("#signScorePay").addClass('active');
            }
            var couponCode = _pageCache.couponCodes;
            var couponCount = eval(_pageCache.couponCount) * 1.0;
            if (JsVilaDataNull(couponCode) && couponCount > 0) {
                $("#couponInfo").text("使用" + couponCode.split(';').length + "张");
            }
            if (_pageCache.needinvoice == 1) {
                $("#invoicetoggle").addClass('active');
                invoiceToggleActive();
            }

            Invoice.initDisplay();
            CalcPayPrice();

            GetCreateOrderAllInfo();

        }
        //计算所有优惠之后需要用户实际支付的金额。
        function CalcPayPrice() {
            var payCouponValue = 0, goldValue = 0, scoreValue = 0;
            var yjbValue = 0, yjCouponValue = 0;yjcValue=0;
            var freight = eval($("#freight").text());
            var duty    = eval($("#duty").text()) || 0;
            var totalprice     = eval($(".totalprice").text());
            var realTotalPrice = totalprice;
            var payPriceValue = (totalprice + freight + duty).toFixed(2);

            var StoreCouponValue = 0;
            //跨店满减券 qgb
            if (StoreCoupon.StoreCouponCommdityPrice > 0)
                StoreCouponValue = (StoreCoupon.StoreCouponCommdityPrice > StoreCoupon.StoreCouponPrice ? StoreCoupon.StoreCouponPrice : StoreCoupon.StoreCouponCommdityPrice);

            StoreCouponValue = parseFloat(StoreCouponValue);

            //优惠券总计。
            var hasCoupon = false;
            if ((_couponResult != null && _couponResult.length > 0) || StoreCouponValue>0) {
                var totalCash = StoreCouponValue;
                if (sessionStorage.type == "gouwuche") {
                    $('#divShopCommoditys ul li span[co-tag="CouponAmountShop"]').each(function(ind, el) {
                        if ($(this).css("display") != "none") {
                            totalCash += eval($(this).text());
                        }
                    });
                } else {
                    totalCash += eval($("#spanCouponAmount").text());
                }
                if (totalCash > payPriceValue) {
                    totalCash = payPriceValue;
                }
                payPriceValue -= totalCash;
                payPriceValue = payPriceValue.toFixed(2);
                totalCash = eval(totalCash).toFixed(2);
                $(".payCouponValueUH").text(totalCash);
                if(Number(totalCash)>0) {
                    $("#payCouponValueUHli").show();
                } else {
                    $("#payCouponValueUHli").hide();
                }
                hasCoupon = totalCash > 0;
                if(totalCash>0) {
                    realTotalPrice -= totalCash;
                }
            } else {
                $(".payCouponValueUH").text("0.00");
                $("#payCouponValueUHli").hide();
            }



            //积分
            if ($("#signScorePay").is(".active")) {
                var scorebalance = window._userScore.Money;
                if (scorebalance >= eval(payPriceValue)) {
                    scoreValue = payPriceValue;
                } else {
                    scoreValue = scorebalance;
                }
                var scoreAmount = parseInt(scoreValue * window._userScore.ScoreCost);
                scoreValue = (scoreAmount / window._userScore.ScoreCost).toFixed(2);
                $(".scoreValue").text(scoreValue);
                $("#scoreValueli").show();
            } else {
                $(".scoreValue").text("0.00");
                $("#scoreValueli").hide();
            }
            payPriceValue = (payPriceValue - scoreValue).toFixed(2);
            _orderRealPrice = payPriceValue;


            // 易捷币
            var hasYJB = false;
            //if ($("#toggleYJB").is(".active")) {
            if(YJB.useYjb) {
                var totalYJBInsteadCashAmount = window._userYJB.InsteadCashAmount;
                if (totalYJBInsteadCashAmount >= eval(payPriceValue)) {
                    yjbValue = payPriceValue;
                } else {
                    yjbValue = totalYJBInsteadCashAmount;
                }
                $(".yjbValue").text(yjbValue);
                $("#yjbValueli").show();
                YJB.yjbValue = yjbValue;

                //$("#orderYJBAmount").text(yjbValue);
                //$("#orderYJB").text(Math.round(yjbValue * YJB.yjbRate));
                hasYJB = yjbValue > 0;
            } else {
                $(".yjbValue").text("0.00");
                $("#yjbValueli").hide();
            }
            YJB.useYjb = yjbValue > 0;
            realTotalPrice -= yjbValue;
            payPriceValue = (payPriceValue - yjbValue).toFixed(2);
            _orderRealPrice = payPriceValue;

            // 易捷抵用券
            var hasYJCoupon = false;
            if (YJCOUPON.currentCouponPrice) {
                YJCOUPON.currentUseCouponPrice = Math.min(YJCOUPON.currentCouponPrice, realTotalPrice);
                $(".yjCouponValue").text(YJCOUPON.currentUseCouponPrice.toFixed(2));
                $("#yjCouponValueli").show();
                payPriceValue = Math.max(0, (payPriceValue - YJCOUPON.currentUseCouponPrice).toFixed(2));
                _orderRealPrice = payPriceValue;
                hasYJCoupon = true;
            } else {
                $(".yjCouponValue").text("0.00");
                $("#yjCouponValueli").hide();
            }

            //油卡兑换券
            // YouKa.initDisplay(totalprice);
            YouKa.resetState(totalprice);
            //!_hasPresent && !hasCoupon && !hasYJCoupon && !hasYJB ? window.YouKa.enable(totalprice) : window.YouKa.disable();

            //代金券
            var couponCount = (eval(_pageCache.couponCount) * 1.00).toFixed(2);
            var couponCode = _pageCache.couponCodes;
            if (JsVilaDataNull(couponCode) && couponCount > 0 && _isAllAppInZPH) {
                if (eval(couponCount) >= eval(payPriceValue)) {
                    payCouponValue = payPriceValue;
                } else {
                    payCouponValue = couponCount;
                }
                payCouponValue = eval(payCouponValue).toFixed(2);
                $(".payCouponValue").text(payCouponValue);
                $("#payCouponValueli").show();
            }
            payPriceValue = (payPriceValue - payCouponValue).toFixed(2);
            (function(){
                //易捷卡
                //非自营商品的价格 包含运费
                var fzyPrice=0;
                var fzydpids=[];//非自营店铺的id
                if(YJCard.YjcCommodityInfo.types.length>0){
                    for (var i = 0; i < YJCard.YjcCommodityInfo.types.length; i++) {
                        if((YJCard.YjcCommodityInfo.types)[i]!='self'){
                            fzydpids.push((YJCard.YjcCommodityInfo.appId)[i].toString().toUpperCase());
                        }
                    }
                    //debugger
                    if(sessionStorage.ShopCartDate){//从购物车提交
                        var _ShopCartDate=JSON.parse(sessionStorage.ShopCartDate);
                        if(Array.isArray(_ShopCartDate)){
                            var fzysp=  _ShopCartDate.filter(function(item){
                                return fzydpids.indexOf(item.AppId.toString().toUpperCase())>-1;
                            });
                            for (var i = 0; i < fzysp.length; i++) {
                                fzyPrice+=parseFloat(fzysp[i].RealPrice);
                            }
                        }
                    }else{//单订单提交
                        if(sessionStorage.commodityUpInfo){
                            var _commondity = JSON.parse(sessionStorage.commodityUpInfo);
                            if( typeof _commondity=='object'){
                                if(sessionStorage.appId &&_commondity){
                                    if(fzydpids.indexOf(sessionStorage.appId.toString().toUpperCase())>-1){
                                        fzyPrice+=parseFloat(_commondity.realPrice);//价格
                                        fzyPrice+=parseFloat(_commondity.freight);//运费
                                    }
                                }
                            }
                        }
                    }
                }
                //debugger
                //计算易捷卡抵扣金额
                if(!!sessionStorage.yjcid&&YJCard.YjcList!=null&&YJCard.YjcList.length>0){
                    var totalBalance=0;
                    for (var i = 0; i < YJCard.YjcList.length; i++) {
                        totalBalance+=  YJCard.YjcList[i].Balance;
                    }
                    //debugger
                    if(totalBalance){
                        var yjcbalance= totalBalance;//易捷卡余额
                        if(parseFloat(payPriceValue)==0){//金额已用其他方式抵用完
                            sessionStorage.yjcamt = 0;
                            yjcValue=0;
                        }else{
                            var yjcpayPriceValue=payPriceValue-fzyPrice;//易捷卡需要抵扣的金额=剩余总金额-非自营商品总金额
                            if(yjcbalance>=eval(yjcpayPriceValue)){//如果选择的易捷卡总余额>易捷卡需要抵扣的金额
                                sessionStorage.yjcamt=yjcpayPriceValue;//易捷卡抵用的金额
                                yjcValue = yjcpayPriceValue;
                            }else{
                                sessionStorage.yjcamt = yjcbalance;//易捷卡抵用的金额
                                //  payPriceValue-=yjcbalance;
                                yjcValue=yjcbalance;
                            }
                        }
                        payPriceValue = (payPriceValue - yjcValue).toFixed(2);//剩余需要支付的金额
                    }
                    if(sessionStorage.YjcNum>0){
                        if(sessionStorage.yjcamt){
                            $("#yjctip_R").css("color",'#e95045').text("-¥"+parseFloat(sessionStorage.yjcamt).toFixed(2));
                            if(sessionStorage.yjcamt){
                                $("#payYjcValueli").show();
                                $(".payYjcValueUH").text(parseFloat(sessionStorage.yjcamt).toFixed(2));
                            }
                        }else{
                            $("#yjctip_R").text("选择使用");
                        }
                    }else{
                        $("#yjctip_R").text("无可用");
                    }
                }

            })()

            //金币
            if ($("#goldpay").is(".active")) {
                //$('#goldpw').show();
                var goldbalance = eval($("#goldbalanceValue").text());
                if (goldbalance >= eval(payPriceValue)) {
                    goldValue = payPriceValue;
                } else {
                    goldValue = goldbalance;
                }
                $(".goldValue").text(goldValue);
                $("#goldValueli").show();
            } else {
                $(".goldValue").text('0.00');
                $("#goldValueli").hide();
            }
            payPriceValue = (payPriceValue - goldValue).toFixed(2);


            $(".payprice").text(payPriceValue);
            $("#submitorder").html(getPaySubmitDesc());

            disPlaygoldul();
        }

        function displayCartInfo() {

            var sh = sessionStorage.ShopCartDate;
            var sessionStorageShopCartDate = JSON.parse(sh);
            sh = JSON.parse(sh);
            var Sum = 0;
            for (var i = 0; i < sh.length; i++) {
                var AppAmount = 0;
                for (var j = 0; j < sh[i].ShoppingCartItemSDTO.length; j++) {
                    if (sh[i].ShoppingCartItemSDTO[j].Specifications != null && Number(sh[i].ShoppingCartItemSDTO[j].Specifications.Attribute) > 0) {
                        AppAmount += Number(sh[i].ShoppingCartItemSDTO[j].CommodityNumber * sh[i].ShoppingCartItemSDTO[j].Specifications.Attribute * sh[i].ShoppingCartItemSDTO[j].RealPrice);
                    }
                    else if (sh[i].ShoppingCartItemSDTO[j].Specification != null && Number(sh[i].ShoppingCartItemSDTO[j].Specification.Attribute) > 0) {
                        AppAmount += Number(sh[i].ShoppingCartItemSDTO[j].CommodityNumber * sh[i].ShoppingCartItemSDTO[j].Specification.Attribute * sh[i].ShoppingCartItemSDTO[j].RealPrice);
                    }
                    else if (Number(sh[i].ShoppingCartItemSDTO[j].Specifications) > 0) {
                        AppAmount += Number(sh[i].ShoppingCartItemSDTO[j].CommodityNumber * sh[i].ShoppingCartItemSDTO[j].Specifications * sh[i].ShoppingCartItemSDTO[j].RealPrice);
                    }
                    else {
                        AppAmount += sh[i].ShoppingCartItemSDTO[j].CommodityNumber * (Number(sh[i].ShoppingCartItemSDTO[j].RealPrice) * 1000) / 1000;
                    }
                }
                AppAmount = Number(AppAmount.toFixed(2));
                sh[i].AppAmount = String(AppAmount);
                sessionStorageShopCartDate[i].AppAmount = String(AppAmount);
                Sum = (Sum * 1000 + AppAmount * 1000) / 1000;
            }
            sessionStorage.Price = String(Sum.toFixed(2));
            $(".totalprice").text(sessionStorage.Price);
            sessionStorage.ShopCartDate = JSON.stringify(sessionStorageShopCartDate);
            var html = getOrderListHtml(sh);
            $("#divShopCommoditys").html(html);

            //控制列表中的自提显隐
            if (isOrderSelfTake == 1) {
                $("#selftaketoggle").addClass('active');
                _selftaketoggle = true;
                $("#selftakedesc").show();
                $("#selftakeli").show();
            } else {
                $("#selftakeli").hide();
            }
            $('div[co-tag="CrowdfundingDiv"]').each(function(ind, el) {
                var cfDisplay = $(el).css("display");
                if (cfDisplay == "none") {
                    var pli = $(el).parent("li");
                    pli.css("padding-bottom", "0px");
                    // pli.css("border-bottom-width", "0px");
                }
            });
            //优惠套装订单页
            if (JsVilaDataNull(getQueryString("setMealId"))) {
                $('#nsetMeal').hide();
                $('#setMeal').removeClass('hide');
                $('#setMealInfo').removeClass('hide');
            }
        }

        function getPaySubmitDesc() {
            var result = "提交订单";
            if ("@onlyWxPay".toLowerCase() == "true" && $(".payprice").text() > 0) {
                result = "微信支付";
            }
            return result;
        }


        //验证
        function Field() {
            var FirstField = "@orderset.FirstField";
            var SecondField = "@orderset.SecondField";
            var ThirdField = "@orderset.ThirdField";
            if (FirstField.length > 0) {
                var FirstContent = $("#FirstContent").val();
                if (FirstContent == "" || FirstContent == null) {
                    var str = '@orderset.FirstField' + "不能为空";
                    toast(str);
                    return;
                }
                if (FirstContent.length > 30) {
                    var str = '@orderset.FirstField' + "长度不能超过30个字符";
                    toast(str);
                    return;
                }
            }
            if (SecondField.length > 0) {
                var SecondContent = $("#SecondContent").val();
                if (SecondContent == "" || SecondContent == null) {
                    var str = '@orderset.SecondField' + "不能为空";
                    toast(str);
                    return;
                }
                if (SecondContent.length > 30) {
                    var str = '@orderset.SecondField' + "长度不能超过30个字符";
                    toast(str);
                    return;
                }
            }
            if (ThirdField.length > 0) {
                var ThirdContent = $("#ThirdContent").val();
                if (ThirdContent == "" || ThirdContent == null) {
                    var str = '@orderset.ThirdField' + "不能为空";
                    toast(str);
                    return;
                }
                if (ThirdContent.length > 30) {
                    var str = '@orderset.ThirdField' + "长度不能超过30个字符";
                    toast(str);
                    return;
                }
            }
        }


        function submitOrder() {
            //验证
        @if (appids.Contains(Jinher.AMP.BTP.UI.Util.MobileCookies.AppId.ToString()))
            {
            <text>
//                if (!$("#invoicetoggle").is(".active")&&$("#unselect").text()!="不要发票") {
//                    toast("请填写发票信息，下单后不能申请补开~");
//                    return;
//                }
                var FirstField="@orderset.FirstField";
                var SecondField="@orderset.SecondField";
                var ThirdField="@orderset.ThirdField";
                if (FirstField.length>0) {
                    var FirstContent=$("#FirstContent").val();
                    if (FirstContent==""||FirstContent==null) {
                        var str='@orderset.FirstField'+"不能为空";
                        toast(str);
                        return;
                    }
                    if (FirstContent.length>30){
                        var str='@orderset.FirstField'+"长度不能超过30个字符";
                        toast(str);
                        return;
                    }
                }
                if (SecondField.length>0) {
                    var SecondContent=$("#SecondContent").val();
                    if(SecondContent==""||SecondContent==null)
                    {
                        var str='@orderset.SecondField'+"不能为空";
                        toast(str);
                        return;
                    }
                    if (SecondContent.length>30) {
                        var str='@orderset.SecondField'+"长度不能超过30个字符";
                        toast(str);
                        return;
                    }
                }
                if(ThirdField.length>0){
                    var ThirdContent=$("#ThirdContent").val();
                    if(ThirdContent==""||ThirdContent==null)
                    {
                        var str='@orderset.ThirdField'+"不能为空";
                        toast(str);
                        return;
                    }
                    if (ThirdContent.length>30) {
                        var str='@orderset.ThirdField'+"长度不能超过30个字符";
                        toast(str);
                        return;
                    }
                }

                if ($("#txtdetails").val() == "" && $('textarea[co-tag="Details"]').val() == "")
                {    toast("请输入食药所~");
                    return;
                }
                var invoice = JsVilaDataNull(sessionStorage.InvoiceDTO) && $.parseJSON(sessionStorage.InvoiceDTO);
                if(!invoice) {
                    toast("请填写发票信息，下单后不能申请补开~");
                    return;
                }
            </text>
            }
            if (_appSelfTakeWay == 2 || _appSelfTakeWay == 3) {
                if (_appSelfTakeFlag == 1) {
                    if (!JsVilaDataNull(sessionStorage.userSelfTake)) {
                        toast("请选择自提点");
                        return;
                    }
                    var userSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
                    if (!userSelfTakeObj.StationId) {
                        toast("请选择自提点");
                        return;
                    }
                    if ($("#AppOrderPickUpName").val() == "") {
                        toast("请输入提货人姓名");
                        return;
                    }
                    if ($("#AppOrderPickUpPhone").val() != "" && $("#AppOrderPickUpPhone").val().length < 11) {
                        toast("请输入11位手机号");
                        return;
                    }
                }
            }
            //判断是否有赠品
            if (!hasPresent()) {
                return false
            }

            ajaxLoadingSingle.show();
            orderSubmit();
        }

        function orderSubmit() {
            setTimeout(function() {
                //提交订单前判断是否用易捷卡付款
                if(!YJCard.yjcardSubmit()){
                    return
                }
                if ($("#submitorder").text() == "正在提交...") {
                    return;
                }
                $("#submitorder").html("正在提交...");
                $("#submitorder").attr("disabled", "");
                if (!saveOrderValid()) {
                    $("#submitorder").html(getPaySubmitDesc());
                    $("#submitorder").removeAttr("disabled");
                    ajaxLoadingSingle.hide();
                    return false;
                }
                var subData = getSubmitData();
                YJCard.ExtendsYjcardList(subData);//提交到后台数据 加入易捷卡信息
                //判断是否有京东商品
                SaveJdCommodityOrder(subData);
            }, 200);
        }

        function hasPresent() {
            var item = $('.tagimg2.active');
            var list = $('.tagimg1.active');
            var goods = [];
            if (item.length > 0) {
                for (var i = 0; i < item.length; i++) {
                    var name = $(item[i]).parents('.present').find('.present-title').text();
                    if (name) {
                        goods.push(name);
                    }
                }
                $('#present-tips2-title').text(goods.join('、') + ' 赠品已赠完,请删除后提交订单');
                $('#present-tips2-dialog').removeClass('hide');
                return false;
            } else if (list.length > 0) {
                for (var i = 0; i < list.length; i++) {
                    var name = $(list[i]).parents('.present').find('.present-title').text();
                    if (name) {
                        goods.push(name);
                    }
                }
                $('#present-tips-title').text(goods.join('、') + ' 赠品库存不足,请确认是否按照可赠数量继续支付');
                $('#present-tips-dialog').removeClass('hide');
                return false;
            }
            return true;
        }

        //判断是否是京东的数据
        function SaveJdCommodityOrder(subData) {
            if (_hasVirtualCommodity && _hasPhysicalCommodity) {
                toast("实物商品和虚拟商品不能一起购买，请分开下单购买");
                $(".pay-submit").html("提交订单");
                $(".pay-submit").removeAttr("disabled");
                ajaxLoadingSingle.hide();
                return false;
            }
            for (var i = 0; i < subData.length; i++) {
                if (!_hasVirtualCommodity)
                {
                    //用户所在区域是否在销售区域内。
                    if (!IsCheckCode(subData[i].ProvinceCode)
                        || !IsCheckCode(subData[i].CityCode)
                        || !IsCheckCode(subData[i].DistrictCode))
                    {
                        //toast("请完善四级地址信息！");
                        $(".pay-submit").html("提交订单");
                        $(".pay-submit").removeAttr("disabled");
                        $('#confirm-wrap').removeClass('hide');
                        ajaxLoadingSingle.hide();
                        return false;
                    }
                }
                if (subData[i].IsSetMeal && ((subData[i].IsUseYouKa && subData[i].YJBPrice > 0 && subData[i].CouponValue > 0)
                        || (subData[i].IsUseYouKa && subData[i].YJBPrice > 0)
                        || (subData[i].IsUseYouKa && subData[i].CouponValue > 0)
                        || (subData[i].YJBPrice > 0 && subData[i].CouponValue > 0))) {
                    toast("优惠券、易捷币抵现、赠送油卡兑换券、优惠套装不能同时享受，请修改~");
                    $(".pay-submit").html("提交订单");
                    $(".pay-submit").removeAttr("disabled");
                    ajaxLoadingSingle.hide();
                    return false;
                }
                var isPromotion = false;
//                for(var j=0; j < subData[i].ShoppingCartItemSDTO.length; j++) {
//                    if(subData[i].ShoppingCartItemSDTO[j].Price != subData[i].ShoppingCartItemSDTO[j].RealPrice) {
//		    	        isPromotion = true;
//                    }
//                }
                if (isPromotion && (subData[i].IsUseYouKa || subData[i].YJBPrice > 0 || subData[i].CouponValue > 0 || subData[i].IsSetMeal)) {
                    toast("活动商品不能使用优惠券、易捷币、油卡抵用券、优惠套装，请修改~");
                    $(".pay-submit").html("提交订单");
                    $(".pay-submit").removeAttr("disabled");
                    ajaxLoadingSingle.hide();
                    return false;
                }
            }
            var Data = subData;
            var subData = { orderList: subData, isHYL: sessionStorage.IsHYL ? "1" : "" };
            subData = CommLib.ObjToStringWithQuot(subData);
            getDataAjax2({
                url: "/Mobile/SaveJdCommodityOrder",
                data: subData,
                callback: function(data) {
                    if (data.ResultCode == 1) {
                        toast(data.Message);
                        $(".pay-submit").html("提交订单");
                        $(".pay-submit").removeAttr("disabled");
                        ajaxLoadingSingle.hide();
                    } else if (data.ResultCode == 2) {
                        if (sessionStorage.type != "gouwuche") {
                            toast(data.Message);
                        } else {
                            var invalidItemIds = [];
                            if (data.ErrorCommodities && data.ErrorCommodities.length > 0) {
                                var soldOutHtml = '';
                                data.ErrorCommodities.forEach(function(c) {
                                    soldOutHtml += '<div class="item"><div class="pic"><img src="' + c.PicturesPath + '"></div><div class="right"><div class="name">' + c.Name + '</div><div class="size">' + ((data.Sku && data.Sku != ",") ? c.Sku : '') + '</div><div class="price">￥' + c.Price + '</div></div></div>';
                                    invalidItemIds.push(c.ShopCartItemId);
                                });
                                Basket.invalidItemIds = invalidItemIds;
                                $("#sold-out-wrap .sold-out-lists").html(soldOutHtml);
                                $("#sold-out-wrap").show();
                            } else {
                                toast(data.Message);
                            }
                        }
                        $(".pay-submit").html("提交订单");
                        $(".pay-submit").removeAttr("disabled");
                        ajaxLoadingSingle.hide();
                    } else {
                        SaveCommodityOrder(Data);
                    }
                },
                error: function(err) {
                    $(".pay-submit").html("提交订单");
                    $(".pay-submit").removeAttr("disabled");
                    ajaxLoadingSingle.hide();
                }
            });
        }


        function getSubmitData() {
            var subData = null;
            if (sessionStorage.type == "gouwuche") {
                subData = getCartsubmitOrder();
            } else {
                subData = getSinglesubmitOrder();
            }
            if ($("#store-coupon-wrap .coupon-lists-use .icon.checked").parents(".coupon-lists.pointer").attr("id"))
                window.YouKa.useYouka = false;

            //油卡兑换券
            for (var i = 0; i < subData.length; i++) {
                subData[i].Price = Number(subData[i].Price).toFixed(2);
                if (getEsAppId() != "8B4D3317-6562-4D51-BEF1-0C05694AC3A6" && getEsAppId() != "8b4d3317-6562-4d51-bef1-0c05694ac3a6") {
                    subData[i].IsUseYouKa = false;
                }
                else {
                    subData[i].IsUseYouKa = window.YouKa.useYouka;
                }
                if (JsVilaDataNull(getQueryString("setMealId"))) {
                    subData[i].IsSetMeal = true;
                    subData[i].SetMealId = getQueryString('setMealId');
                }
                if (JsVilaDataNull(getQueryString("jcActivityId"))) {
                    if(getQueryString("jcActivityId")=='00000000-0000-0000-0000-000000000000'){continue};
                    subData[i].IsJcActivity = true;
                    subData[i].JcActivityId = getQueryString('jcActivityId');
                }
                subData[i].Freight = 0;
                if (_freightResult != null) {
                    var fr = _freightResult.GetFirstElement("AppId", subData[i].AppId);
                    if (fr != null) {
                        subData[i].Freight = fr.Freight;
                        }
                }
            }
            return subData;
        }

        function getSinglesubmitOrder() {

            var appInfo = new Object();
            appInfo.AppId = sessionStorage.appId;
            var discountprice = -1;
            if (commodityUpInfo.Intensity == 10) {
                if (commodityUpInfo.price != commodityUpInfo.realPrice) {
                    discountprice = commodityUpInfo.realPrice;
                }
            }

            if (commodityUpInfo.Specifications == undefined || commodityUpInfo.Specifications == "" || commodityUpInfo.Specifications == null) {
                commodityUpInfo.Specifications = 0;
            }
            //有规格数量的计算
            var CommodityNumber = 0;
            if (Number(commodityUpInfo.Specifications) > 0) {
                CommodityNumber = Number($('.ispinner').val() * commodityUpInfo.Specifications);
            } else {
                CommodityNumber = Number($('.ispinner').val());
            }

            var shopItem = {
                CommodityNumber: CommodityNumber, //商品数量
                Id: sessionStorage.commodityId_2, //商品ID
                Intensity: commodityUpInfo.Intensity, //折扣
                Name: commodityUpInfo.name, //商品名称
                CommodityStockId: commodityUpInfo.commodityStockId == undefined ? sessionStorage.CommodityStockId : commodityUpInfo.commodityStockId,
                Pic: commodityUpInfo.pic, //商品图片
                Price: commodityUpInfo.price, //商品单价
                SizeAndColorId: (commodityUpInfo.color ? commodityUpInfo.color : '') + ',' + (commodityUpInfo.size ? commodityUpInfo.size : '').replace(/^,*|,*$/g, ''), //尺寸颜色
                UserId: getUserId(), //用户Id
                ShopCartItemId: "00000000-0000-0000-0000-000000000000",
                RealPrice: commodityUpInfo.realPrice,
                DiscountPrice: discountprice.toString(),
                ComCategoryId: commodityUpInfo.CategoryId,
                ScorePrice: 0,
                Duty: 0,
                JdCode: '',
                Specifications: commodityUpInfo.Specifications
            };


            // 赠品信息
            if (commodityUpInfo.Presents && commodityUpInfo.Presents.length > 0) {
                shopItem.Presents = commodityUpInfo.Presents;
            }

            appInfo.ShoppingCartItemSDTO = new Array();
            appInfo.ShoppingCartItemSDTO.push(shopItem);

            if (sessionStorage.IsHYL) {
                if (sessionStorage.SrcTagId) {
                    appInfo.SrcTagId = sessionStorage.SrcTagId;
                }
            }
            if (!JsVilaDataNull(appInfo.SrcTagId)) {
                appInfo.SrcTagId = "00000000-0000-0000-0000-000000000000";
            }
            var FirstField = "@orderset.FirstField";
            var SecondField = "@orderset.SecondField";
            var ThirdField = "@orderset.ThirdField";
            if (FirstField.length > 0) {
                appInfo.FirstContent = $("#FirstContent").val();
            }
            if (SecondField.length > 0) {
                appInfo.SecondContent = $("#SecondContent").val();
            }
            if (ThirdField.length > 0) {
                appInfo.ThirdContent = $("#ThirdContent").val();
            }
            appInfo.Details = $("#txtdetails").val();
            if (appInfo.AppId && _uploadAppId.toLowerCase().indexOf(appInfo.AppId.toLowerCase()) > -1) {
                var refundImgs = "";
                var rImgs = $('#preview > li input');
                for (var i = 0; i < rImgs.length; i++) {
                    if (rImgs[i].value != "") {
                        refundImgs += rImgs[i].value + ",";
                    }
                }
                refundImgs = refundImgs.substring(0, refundImgs.length - 1);
                appInfo.PicturesPath = refundImgs;
            } else {
                appInfo.PicturesPath = "";
            }
            appInfo.CouponValue = parseFloat($("#spanCouponAmount").text());
            appInfo.CouponValue +=  StoreCoupon.StoreCouponCommdityPrice > StoreCoupon.StoreCouponPrice ? StoreCoupon.StoreCouponPrice : StoreCoupon.StoreCouponCommdityPrice;
            appInfo.Duty = $("#duty").text() || 0;
            appInfo.Price = $(".totalprice").text();

            var totalprice = eval($(".totalprice").text());
            totalprice += eval($("#freight").text());
            totalprice += eval($("#duty").text()) || 0;

            // 减去优惠券金额
            totalprice -= eval($("#spanCouponAmount").text());

            // totalprice -= appInfo.CouponValue;// eval($("#spanCouponAmount").text());
            // if(YJCOUPON.currentUseCouponPrice) {
            //     var diffPrice = Math.min(YJCOUPON.currentUseCouponPrice,totalprice);
            //     YJCOUPON.currentUseCouponPrice = diffPrice;
            //     totalprice -= YJCOUPON.currentUseCouponPrice;
            // }

            appInfo.RealPrice = totalprice.toFixed(2);

            if (!JsVilaDataNull(appInfo.RecipientsZipCode)) {
                appInfo.RecipientsZipCode = "";
            }
            if (!JsVilaDataNull(commodityUpInfo.orderType)) {
                appInfo.OrderType = 0;
            } else {
                appInfo.OrderType = commodityUpInfo.orderType;
            }

            var listApp = new Array();
            listApp.push(appInfo);

            var postData = buildOrderModel(listApp);
            return postData;
        }

        //购物车下订单
        function getCartsubmitOrder() {
            var data = [];
            var sh = sessionStorage.ShopCartDate;
            var shopcartData = [];
            if (JsVilaDataNull(sh)) {
                shopcartData = JSON.parse(sh);
                data = buildOrderModel(shopcartData);
            }

            for (var i = 0; i < data.length; i++) {
                for (var j = 0; j < data[i].ShoppingCartItemSDTO.length; j++) {
                    if (data[i].ShoppingCartItemSDTO[j].Specifications != null && Number(data[i].ShoppingCartItemSDTO[j].Specifications.Attribute) > 0) {
                        data[i].ShoppingCartItemSDTO[j].Specifications = data[i].ShoppingCartItemSDTO[j].Specifications.Attribute;
                        data[i].ShoppingCartItemSDTO[j].CommodityNumber = Number(data[i].ShoppingCartItemSDTO[j].CommodityNumber) * data[i].ShoppingCartItemSDTO[j].Specifications;
                    }
                }
            }

            //备注信息。
            $("#divShopCommoditys > div").each(function(ind, el) {
                var appid = $(this).attr("co-tag-appid");
                var detailText = $(this).find('textarea[co-tag="Details"]').val();
                var sci = data.GetOnlyElement("AppId", appid);
                sci.CouponValue = $(this).find('ul li span[co-tag="CouponAmountShop"]').text();
                sci.Details = detailText;
                var FirstField = "@orderset.FirstField";
                var SecondField = "@orderset.SecondField";
                var ThirdField = "@orderset.ThirdField";
                if (FirstField.length > 0) {
                    sci.FirstContent = $("#FirstContent").val();
                }
                if (SecondField.length > 0) {
                    sci.SecondContent = $("#SecondContent").val();
                }
                if (ThirdField.length > 0) {
                    sci.ThirdContent = $("#ThirdContent").val();
                }
            });

            return data;
        }

        //组建要提交的数据
        function buildOrderModel(appItems) {
            var isWxPay = "@onlyWxPay".toLowerCase() == "true";
            var orderSDTO = {};
            orderSDTO = {
                //Price: "",              //总价格
                //RealPrice: '',
                ShoppingCartItemSDTO: [], //商品信息
                UserId: '', //用户Id
                Details: "", //订单备注
                SrcTagId: "00000000-0000-0000-0000-000000000000",
                SrcType: 34,
                SrcAppId: "00000000-0000-0000-0000-000000000000",
                Source: "",
                WxOpenId: "",
                TradeType: 0,
                PicturesPath: '',
                PromotionType: IsPresell ? '5' : '0',
                AppOrderPickUpInfo: '',
                IsWeixinPay: isWxPay,
            };
            $.extend(orderSDTO, _addressInfo);
            //此appid从地址信息中继承来，此处要用商品的appid.
            delete orderSDTO.AppId;

            var inviterMobile=$("[tye='tel']").val();
            if(inviterMobile!=""&&inviterMobile!="undefined")
            {
               orderSDTO.InviterMobile=inviterMobile;
            }
            
            if (JsVilaDataNull(sessionStorage.SrcTagId)) {
                orderSDTO.SrcTagId = sessionStorage.SrcTagId;
            }
            if (JsVilaDataNull(sessionStorage.SrcType)) {
                orderSDTO.SrcType = sessionStorage.SrcType;
            }
            if (JsVilaDataNull(sessionStorage.srcAppId)) {
                orderSDTO.SrcAppId = sessionStorage.srcAppId;
            }
            orderSDTO.Details = appItems.Details;

            if ($("#selftaketoggle").is(".active")) {
                orderSDTO.SelfTakeFlag = 1;
            } else {
                orderSDTO.SelfTakeFlag = 0;
            }
            //发票信息。
            //if ($("#invoicetoggle").is(".active") && JsVilaDataNull(sessionStorage.InvoiceDTO)) {
            if(sessionStorage._useInvoice && JsVilaDataNull(sessionStorage.InvoiceDTO)) {
                orderSDTO.InvoiceInfo = $.parseJSON(sessionStorage.InvoiceDTO);
            }

            orderSDTO.UserId = getUserId();
//            orderSDTO.ShareId = getShareId();
//            if (orderSDTO.ShareId === "") {
//                orderSDTO.ShareId = get_cookie('shareId');
//            }
            orderSDTO.ShareId = get_cookie('shareId');
            if (orderSDTO.ShareId === "") {
                orderSDTO.ShareId = getShareId();
            }


            if (JsVilaDataNull(sessionStorage.CPSId)) {
                orderSDTO.CPSId = sessionStorage.CPSId;
            }

            // 记录易捷币信息
            //if ($("#toggleYJB").hasClass("active")) {
            if(YJB.useYjb) {
                //orderSDTO.YJBCount = $("#orderYJB").text();
                //orderSDTO.YJBPrice = $("#orderYJBAmount").text();
                orderSDTO.YJBPrice = YJB.yjbValue;
            }

            // 记录易捷抵用卷信息
            if (YJCOUPON.currentUseCouponPrice) {
                orderSDTO.YJCouponIds = YJCOUPON.currentCouponeIds;
                orderSDTO.YJCouponPrice = YJCOUPON.currentUseCouponPrice.toFixed(2);
            }

            if ($("#goldpay").hasClass("active")) {
                orderSDTO.GoldPrice = $(".goldValue").text();
            }
            orderSDTO.PayCouponValue = $(".payCouponValue").text();
            orderSDTO.PaycouponCodes = _pageCache.couponCodes;

            if ($("#goldpay").hasClass("active")
                    && $("#txtpwd").val() != "") {
                orderSDTO.PayPassword = hex_md5($("#txtpwd").val());
            }

            if ($("#hdfk").attr("checked")) {
                orderSDTO.Payment = 1;
            }
            if (JsVilaDataNull(bridge.getData('speader'))) {
                orderSDTO.SpreadCode = bridge.getData('speader');
            }
            if (!JsVilaDataNull(orderSDTO.RecipientsZipCode)) {
                orderSDTO.RecipientsZipCode = null;
            }
            if (JsVilaDataNull(commodityUpInfo)) {
                if (!JsVilaDataNull(commodityUpInfo.orderType)) {
                    orderSDTO.OrderType = 0;
                } else {
                    orderSDTO.OrderType = commodityUpInfo.orderType;
                }
                if (!JsVilaDataNull(commodityUpInfo.serviceId)) {
                    orderSDTO.ServiceId = null;
                } else {
                    orderSDTO.ServiceId = commodityUpInfo.serviceId;
                }
            }

            orderSDTO.Source = (JsVilaDataNull(sessionStorage.source) ? sessionStorage.source : 'internal');
            orderSDTO.WxOpenId = bridge.getData('WeChatKey') || "";
            orderSDTO.WxOpenId = "";
            orderSDTO.TradeType = _pageAllInfoData.TradeType;
            orderSDTO.ScoreType = getScoreType();
            //拼团
            if (sessionStorage.type == "diygroup") {
                orderSDTO.PromotionType = 3;
                if (sessionStorage.diyGroupId) {
                    orderSDTO.DiyGroupId = sessionStorage.diyGroupId;
                }
            }
            if (_appSelfTakeWay == 2 || _appSelfTakeWay == 3) {
                if (_appSelfTakeFlag == 1) {
                    orderSDTO.SelfTakeFlag = 1;
                    orderSDTO.AppOrderPickUpInfo = {};
                    var userSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
                    orderSDTO.AppOrderPickUpInfo.SelfTakeStationId = userSelfTakeObj.StationId;
                    orderSDTO.AppOrderPickUpInfo.Name = $("#AppOrderPickUpName").val();
                    orderSDTO.AppOrderPickUpInfo.Phone = $("#AppOrderPickUpPhone").val();
                    orderSDTO.AppOrderPickUpInfo.BookDate = userSelfTakeObj.AppOrderPickUpBookDate;
                    orderSDTO.AppOrderPickUpInfo.BookStartTime = userSelfTakeObj.AppOrderPickUpBookStartTime;
                    orderSDTO.AppOrderPickUpInfo.BookEndTime = userSelfTakeObj.AppOrderPickUpBookEndTime;
                }
            }

            if (appItems && appItems.length > 0) {
                //将全局信息copy到每个应用里。
                for (var i = 0; i < appItems.length; i++) {
                    appItems[i].Price = eval(appItems[i].Price).toFixed(2);
                    var shoppings = appItems[i].ShoppingCartItemSDTO;
                    if (shoppings && shoppings.length > 0) {
                        for (var j = 0; j < shoppings.length; j++) {
                            shoppings[j].ScorePrice = getComScore(appItems[i].AppId, shoppings[j].ShopCartItemId);

                            if (sessionStorage.type == "gouwuche") {
                                var comNumb = $('#hid_num_' + shoppings[j].Id + '_' + shoppings[j].CommodityStockId).val();
                                comNumb = (comNumb == undefined ? "1" : comNumb);
                                if (Number(shoppings[j].Specifications) > 0) {
                                    shoppings[j].CommodityNumber = Number(comNumb * shoppings[j].Specifications);
                                } else {
                                    shoppings[j].CommodityNumber = comNumb;
                                }

                                if (JsVilaDataNull(getQueryString("setMealId"))) {
                                    var num = $('#num_' + shoppings[j].Id).text() == undefined ? "1" : $('#num_' + shoppings[j].Id).text();
                                    if (Number(shoppings[j].Specifications) > 0) {
                                        shoppings[j].CommodityNumber = Number(num * shoppings[j].Specifications);
                                    } else {
                                        shoppings[j].CommodityNumber = comNumb;
                                    }
                                    shoppings[j].Price = shoppings[j].RealPrice;
                                }
                            }
                        }
                    }
                    $.extend(appItems[i], orderSDTO);
                    //extend后ShoppingCartItemSDTO集合中的元素丢失。
                    appItems[i].ShoppingCartItemSDTO = shoppings;
                    appItems[i].SelfTakeStationId = JsVilaDataNull(sessionStorage.stStationId) ? sessionStorage.stStationId : "00000000-0000-0000-0000-000000000000";
                    appItems[i].EsAppId = getEsAppId();
                    appItems[i].distributorId = JsVilaDataNull(sessionStorage.distributorId) ? sessionStorage.distributorId : "00000000-0000-0000-0000-000000000000";
                    //规则：下订单是使用积分抵现只会发生在购买单个店铺里的商品，如果混合支付走到这里，则$(".scoreValue").text()一定为0，RealPrice-0和没减相同。
                    appItems[i].RealPrice -= eval($(".scoreValue").text());
                    // 减去易捷币抵现金额
                    // appItems[i].RealPrice -= eval($(".yjbValue").text());
                    // appItems[i].RealPrice = appItems[i].RealPrice.toFixed(2);
                    appItems[i].ScorePrice = getAppScore(appItems[i].AppId);

                    var num = $('#num_' + shoppings[0].Id).text() == undefined ? "1" : $('#num_' + shoppings[0].Id).text();
                    appItems[i].AppAmount = appItems[i].RealPrice.toFixed(2);
                    appItems[i].CommodityNum = appItems[i].CommodityNum * num;
                    appItems[i].Duty = (appItems[i].Duty * num).toFixed(2);
                    appItems[i].RealPrice = appItems[i].RealPrice.toFixed(2);
                    if (appItems[i].AppId && _uploadAppId.toLowerCase().indexOf(appItems[i].AppId.toLowerCase()) > -1) {
                        var refundImgs = "";
                        var rImgs = $('#preview > li input');
                        for (var j = 0; j < rImgs.length; j++) {
                            if (rImgs[j].value != "") {
                                refundImgs += rImgs[j].value + ",";
                            }
                        }
                        refundImgs = refundImgs.substring(0, refundImgs.length - 1);
                        appItems[i].PicturesPath = refundImgs;
                    }
                    if (_couponResult == null) {
                        continue;
                    }
                    var appCouponInfo = _couponResult.GetFirstElement("ShopId", appItems[i].AppId);
                    if (appCouponInfo == null) {
                        continue;
                    }
                    appItems[i].CouponId = appCouponInfo.CouponId;
                    appItems[i].CouponComId = appCouponInfo.GoodId == undefined ? "" : appCouponInfo.GoodId;
                    appItems[i].ComCategoryId = appItems.CategoryId == undefined ? null : appItems.CategoryId;
                }
            }
            return appItems;
        }

        //获取url中的参数值
        function GetUrlParam(paramName, url) {
            var param = location.search;
            if (typeof url != "undefined") {
                param = url;
            }
            param = param ? param : "";
            var svalue = param.match(new RegExp("[\?\&]" + paramName + "=([^\&]*)(\&?)", "i"));
            return svalue ? svalue[1] : svalue;
        }

        //创建订单。
        function SaveCommodityOrder(subData) {
            ajaxLoadingSingle.show();
            var isHYL = sessionStorage.IsHYL ? "1" : "";
            var orderRealPrice = 0;


            var selectStoreCouponId = $("#store-coupon-wrap .coupon-lists-use .icon.checked").parents(".coupon-lists.pointer").attr("id");
            if (!selectStoreCouponId) {
                selectStoreCouponId = "00000000-0000-0000-0000-000000000000";
            }

            for (var i = 0; i < subData.length; i++) {
                orderRealPrice += parseFloat(subData[i].RealPrice);


                subData[i].StoreCouponShopDivid = 0;

                if (selectStoreCouponId != "00000000-0000-0000-0000-000000000000") {
                    for (var storeprice of StoreCoupon.CommodityDivid) {
                        if (subData[i].AppId == storeprice.appId)
                            subData[i].StoreCouponShopDivid += storeprice.value;
                    }
                }

                for (var commdity of subData[i].ShoppingCartItemSDTO) {//遍历商品
                    commdity.StoreCouponDivide = 0;   //优惠券分的的优惠金额默认0
                    if (selectStoreCouponId != "00000000-0000-0000-0000-000000000000") {
                        for (var storeprice of StoreCoupon.CommodityDivid) {
                            if (storeprice.id == commdity.Id) {
                                commdity.StoreCouponDivide += storeprice.value;
                                break;
                            }
                        }
                    }
                }
            }

            var subData = {
                orderList: subData,
                sessionId: getSessionId(),
                isHYL: isHYL,
                storeCouponId: selectStoreCouponId,
                StoreCouponPrice: StoreCoupon.StoreCouponPrice,
                StoreCouponCommdityPrice: StoreCoupon.StoreCouponCommdityPrice,
                StoreCouponCommdityCount: StoreCoupon.StoreCouponCommdityCount,

            };
//            subData = CommLib.ObjToStringWithQuot(subData);
              subData = JSON.stringify(subData);
            getDataAjax2({
                url: "/Mobile/SaveCommodityOrderNew",
                data: subData,
                callback: function(data) {
                    //                    sessionStorage.PicturesPathModel = "";
                    //                    sessionStorage.PicturesPathModelMobile = "";
                    //行为记录 提交订单增加订单Id
                    if (data && data.ResultCode == 0) {
                        localStorage.removeItem("orderDishes" + sessionStorage.appId);
                        var brOrderId = 'orderid:';
                        if (data.MainOrderId) {
                            brOrderId = brOrderId + data.MainOrderId;
                        } else if (data.OrderId) {
                            brOrderId = brOrderId + data.OrderId;
                        }
                        brOrderId = brOrderId + '|';
                        logBTP(sessionStorage.SrcType, service_type, "0x0007", sessionStorage.commodityId_2 || '', brOrderId);
                    }
                    var payPrice = eval($(".payprice").text());
                    if (payPrice == 0 && data.ResultCode == 0) {
                        data.ResultCode = 3;
                    }
                    //2.确认订单成功3.确认订单失败
                    var appBusinessType = data.ResultCode == 1 ? 3 : 2;
                    if (!JsVilaDataNull(getQueryString("setMealId"))) {
                        if (sessionStorage.type == "gouwuche" && getQueryString("fromApp") == 1) {
                            jh && jh.shoppingCartToOrder({
                                businessType: appBusinessType,
                                success: submitOrderDeal
                            });
                        }
                    }
                    if (data.ResultCode == 0) {
                        if (getUserId() != GetUrlParam("userId", data.PayUrl) || getSessionId() != GetUrlParam("sessionId", data.PayUrl)) {
                            $.ajax({
                                type: "POST",
                                url: "/Login/GatherErrorInfo?c=1&m0=curUserId:" + getUserId() + ",retUserId:" + GetUrlParam("userId", data.PayUrl)
                                    + ",curSessionId:" + GetUrlParam("sessionId", data.PayUrl) + ",retSessionId:" + GetUrlParam("sessionId", data.PayUrl)
                            });
                        }
                        // 记录当前订单Id
                        if (data.MainOrderId) {
                            sessionStorage.setItem("current_orderId", data.MainOrderId);
                            sessionStorage.setItem("current_ismainorder", "1");
                        } else {
                            sessionStorage.setItem("current_orderId", data.OrderId);
                            sessionStorage.setItem("current_ismainorder", "0");
                        }
                        setTimeout(function () {
                            window.location.href = data.PayUrl;
                        }, 1000);
                    }
                    else if (data.ResultCode == 1) {
                        $("#submitorder").html(getPaySubmitDesc());
                        $("#submitorder").removeAttr("disabled");
                        ajaxLoadingSingle.hide();
                        if (data.PayUrl) {
                            window.location.href = data.PayUrl
                        } else {
                            toast(data.Message);
                        }
                    }
                    else if (data.ResultCode == 2) {
                        toast("支付失败");
                        if (JsVilaDataNull(data.OrderId)) {
                            window.location.href = urlAppendCommonParams('MyOrderDetail?orderId=' + data.OrderId + '&userId=' + getUserId() + '&sessionId=' + getSessionId());
                        } else {
                            window.location.href = urlAppendCommonParams("/Mobile/MyOrderList?user=" + getUserId() + "&type=shuaxin&orderState=1");
                        }
                    }
                    else if (data.ResultCode == 3) {
                        ajaxLoadingSingle.hide();
                        if ($("#hdfk").attr("checked") || orderRealPrice <= 0) {
                            alert("下单成功");
                        } else {
                            alert("支付成功");
                        }
                        //下单成功后清除缓存中的易捷卡信息
                        sessionStorage.removeItem("yjcamt");
                        sessionStorage.removeItem("yjcid");
                        //成功后跳转
                        if (sessionStorage.type == "diygroup") {
                            var _diyGroupIdNew = data.DiyGroupId;
                            window.location.href = urlAppendCommonParams("/Mobile/DiyGroupDetail?diyGroupId=" + _diyGroupIdNew);
                        } else {
                            // window.location.href = urlAppendCommonParams("/Mobile/MyOrderList?user=" + getUserId() + "&type=shuaxin&orderState=1");
                            var _orderId = "";
                            if (data.MainOrderId) {
                                _orderId = data.MainOrderId;
                            } else if (data.OrderId) {
                                _orderId = data.OrderId;
                            }
                            window.location.href = urlAppendCommonParams("/Mobile/PaySuccess?user=" + getUserId() + "&orderId=" + _orderId + "&shopId=" + sessionStorage.appId + "&type=shuaxin&orderState=1");
                        }
                    }
                    else {
                        toast(data.Message);
                        $(".pay-submit").html("提交订单");
                        $(".pay-submit").removeAttr("disabled");
                        ajaxLoadingSingle.hide();
                    }

                },
                error: function(err) {
                    $(".pay-submit").html("提交订单");
                    $(".pay-submit").removeAttr("disabled");
                    ajaxLoadingSingle.hide();
                }
            });
        }

        function submitOrderDeal() {
            var data = _submitReturn;

        }

        var _hasAddress = false;

        function showAddressMain(data, commodityTypeList) {
            if ($.inArray(1, commodityTypeList) >= 0) {
                $(".delivery-info").hide();
                $("#freight").parents("li").hide();
                return;
            }
            if (data !== null) {
                showAddress(data);
                _hasAddress = true;
            } else {

                if ((getQueryString("back") == "deladdlist" || getQueryString("back") == "coupons") && JsVilaDataNull(_pageCache.addressId)) {
                    $(".dedev").html("<div class=\"devk\">请选择或添加收货地址信息</div>");
                } else {
                    $(".dedev").html('<a class="f-mail" style="width:100%;margin:0"> <div class="devk">添加收货地址信息</div></a>');
                }
            }
        }

        //显示地址信息
        function showAddress(data) {
            _addressInfo = data;
            $("#hiddphone").val(data.ReceiptPhone);
            $("#hiddaddressid").val(data.AddressId);
            $(".spusername").html(data.ReceiptUserName);
            $(".spphone").html(data.ReceiptPhone);
            if (data.RecipientsZipCode != null && data.RecipientsZipCode != "") {
                //  $(".spzipcode").html(data.RecipientsZipCode);
            }
            $(".sprovince").html(data.Province);
            $(".scity").html(data.City);
            $(".sdistrict").html(data.District);
            $(".sStreet").html(data.Street);
            $(".spadress").html(data.ReceiptAddress);
            if (IsCheckCode(data.ProvinceCode) && IsCheckCode(data.CityCode) && IsCheckCode(data.DistrictCode)) {
            } else {
                //toast("请完善四级地址信息！");
                $('#confirm-wrap').removeClass('hide');
            }

            $("#bottomAddress").text(data.Province+data.City+data.District+(data.Street?data.Street:'')+data.ReceiptAddress).show();
        }

        function ShowInvoiceMessage() {
            $("#InvoiceMessage").show();
            $("#HidisSelect").val("");
        }

        function HideInvoiceMessage() {
            var _invContent = $("#hidinvContent").val();
            if (_invContent == "明细") {
                var _invRise = $("#hidinvRise").val();
                if (_invRise == "单位") {
                    var _orgName = $("#txtOrgName").val();
                    var reg = /^\s*$/;
                    if (reg.test(_orgName)) {
                        toast("请填写单位信息！");
                        return false;
                    }
                }
            }

            //$("#InvoiceExplain").html(_invContent);
            $("#InvoiceMessage").hide();
            //$("#HidisSelect").val("1");
        }


        function saveOrderValid() {
            if ($(".devk").html() != null && $(".devk").html() != "" && _appSelfTakeFlag != 1 && !_hasVirtualCommodity) {
                toast("请先维护收货地址");
                return false;
            }
            if (_appSelfTakeFlag == 1 || _hasVirtualCommodity) {

            } else if ($(".spadress").html() == "") {
                toast("请先维护收货地址");
                return false;
            }

            //判断地址 是否因为 异常原因加载失败了
            if (!_hasVirtualCommodity && ($(".spusername").html() == "" || $("#hiddphone").val() == "")) {
                return false;
            }

            if ($("#onlinePay").attr("checked") && $("#goldpay").hasClass("active") && $("#txtpwd").val() == "") {
                toast("请输入账户交易密码！");
                return false;
            }

            var inviterMobile=$("[tye='tel']").val();
            if(inviterMobile!=""&&inviterMobile!="undefined")
            {
               var ret = true;
               var pattern = /^1[34578]\d{9}$/;  
               if(!pattern.test(inviterMobile))
               {
                  toast("手机号输入错误");
                  return false;
               }
               getDataAjax2({
                    type: "post",
                    url: '/Mobile/CheckInviterMobile',
                    async: false,
                    data: { phone: inviterMobile},
                    dataType: "json",
                    callback: function(data) {
                        if (data.ResultCode != 0) {
                            toast(data.Message);
                            ret = false;
                        }
                    },
                    error: function() {
                        toast("校验方法错误");
                        ret= false;
                    }
                });
                if (!ret) {
                    return false;
                }
            }

            //买走美国
            if (brainhoopAppId == getEsAppId()) {
                var emailFlag = true;
                var emptyEmail = false;
                if (sessionStorage.type == "gouwuche") {

                    $("#divShopCommoditys > div").each(function(ind, el) {
                        if (!emailFlag)
                            return;
                        var detailText = $(this).find('textarea[co-tag="Details"]').val().trim();
                        if (!detailText) {
                            emptyEmail = true;
                        } else if (!isEmail(detailText)) {
                            emailFlag = false;
                        }
                    });

                } else {
                    var detailText = $("#txtdetails").val().trim();
                    if (!detailText) {
                        emptyEmail = true;
                    } else if (!isEmail(detailText)) {
                        emailFlag = false;
                    }
                }
                if (emptyEmail) {
                    toast("请输入邮箱地址！");
                    return false;
                }
                if (!emailFlag) {
                    toast("请输入合法邮箱地址！");
                    return false;
                }
            }

            var valpwd = true;
            //校验金币支付密码
            if ($("#goldpay").hasClass("active") && $("#txtpwd").val() != "") {
                getDataAjax2({
                    type: "post",
                    url: '/Mobile/CheckGoldPayPwdVal',
                    async: false,
                    data: { userId: getUserId(), sessionId: getSessionId(), pwd: hex_md5($("#txtpwd").val()) },
                    dataType: "json",
                    callback: function(data) {
                        if (data.Code == 0) {
                            valpwd = true;
                        } else {
                            toast(data.Message);
                            valpwd = false;
                        }
                    },
                    error: function() {
                        valpwd = false;
                    }
                });
            }
            return valpwd;
        }


        function showDialog(el) {
            $('.mask').show();
            $(el).show();
            $('.page').addClass('lock');
        }

        function hideDialog(el) {
            $('.mask').hide();
            $(el).hide();
            $('.page').removeClass('lock');
        }

        function usePayCoupon() {
            var couponCodes = "";
            if (JsVilaDataNull(_pageCache.couponCodes)) {
                couponCodes = _pageCache.couponCodes;
            }
            var totalprice = eval($(".totalprice").text());
            var freightprice = totalprice + eval($("#freight").text());
            var psource = sessionStorage.source == "share" ? "&source=share" : "";

            var srcUrl = urlAppendCommonParams(getBtpDomain() + "Mobile/CreateOrder?back=coupons&type=" + sessionStorage.type);
            window.location.href = "@ViewBag.PromotionUrl" + "/MyVouchers/VoucherList?srcApp=btp&userId=" + getUserId() + "&sessionId=" + getSessionId() + "&selectedVCodes=" + couponCodes + "&orderAmount=" + freightprice + "&ChangeOrg=00000000-0000-0000-0000-000000000000&appId=" + getEsAppId() + "&srcUrl=" + encodeURIComponent(srcUrl);
        }

        var isOrderSelfTake = 0;

        //生成整个订单列表html.

        function getOrderListHtml(shops) {
            if (shops == null || shops.length == 0) {
                return "";
            }

            //生成html.
            var allHtml = "";
            for (var c = 0; c < shops.length; c++) {
                var commoditysHtml = getCommodityItemsInShop(shops[c].ShoppingCartItemSDTO);
                shops[c].CommoditysInShopHtml = commoditysHtml;
                //众筹相关功能先不做。
                //calculateShopCrowdfund(shops[c]);
                shops[c].CrowdfundingInfo = "";
                shops[c].cfDisplay = "none";
                shops[c].SetMealTheme = shops[c].ShoppingCartItemSDTO[0].SetMealTheme;

                var tmpComArry = [];
                if (shops[c].ShoppingCartItemSDTO) {
                    for (var m = 0; m < shops[c].ShoppingCartItemSDTO.length; m++) {
                        tmpComArry.push(shops[c].ShoppingCartItemSDTO[m].Id);
                    }
                }
                var objList = tmpComArry.join(",");
                var checkReuslt = isShowUploadOrContract(objList);

                if (checkReuslt.showContractCom) {
                    _uploadAppId = shops[c].AppId.toLowerCase();
                    var tmpDiv = " <li id=\"uploadFiles\" class=\"table-view-cell media full-cell\" style=\"padding: 11px 15px 9px 15px; padding-bottom: 13px; \">";

                    tmpDiv = tmpDiv + "<div style=\"width:330px; height:105px;\" id=\"uploadFileCom\">"
                            + $("#uploadFileCom").html() + "</div>";
                    tmpDiv = tmpDiv + "<div style=\"width:330px; clear:both;\" id=\"JhRentAgreement\">";
                    if (_showContractCommodityList.length > 0) {
                        for (var i = 0; i < _showContractCommodityList.length; i++) {
                            tmpDiv += _contractTemplete.format(_showContractCommodityList[i]);
                        }
                    }
                    tmpDiv = tmpDiv + "</div>";
                    tmpDiv = tmpDiv + "</li>";
                    shops[c].AppUploadFile = tmpDiv;
                    $("#uploadFiles").remove();
                } else {
                    shops[c].AppUploadFile = "";
                }
                allHtml += shopItemTemplate.format(shops[c]);
            }
            return allHtml;
        }

        function getCommodityItemsInShop(items) {
            var commoditysHtml = "";
            for (var i = 0; i < items.length; i++) {
                dealColorAndSize(items[i]);
                isOrderSelfTake = items[i].IsEnableSelfTake == 1 ? 1 : 0;
                items[i].SelfTakeDisplay = items[i].IsEnableSelfTake == 1 ? "inline-block" : "none";
                items[i].srckey = "src";
                items[i].AppName = JsVilaDataNull(items[i].AppName) ? items[i].AppName : "";
                items[i].CategoryName = JsVilaDataNull(items[i].CategoryName) ? items[i].CategoryName : "";
                items[i].SetMealTheme = JsVilaDataNull(items[i].SetMealTheme) ? items[i].SetMealTheme : "";
                commoditysHtml += commodityItemTemplate.format(items[i]);
            }
            return commoditysHtml;
        }

        function initPresent(presentCount, data) {
            var html = '';
            for (var i = 0; i < data.length; i++) {
                var item = data[i];
                var number = parseInt(presentCount * item.Number);
                var hasStock = item.Stock - number <= 0 ? false : true;
                /*var size = [];
                 if (item.SKU) {
                 for (var j = 0; j < item.SKU.length; j++) {
                 size.push(item.SKU[j].SecondAttribute);
                 }
                 }*/
                html += '<div class="present hide">' +
                '<div class="present-title">' + item.Name + '</div>' +
                '<div class="present-info">' +
                '<img class="tagimg1 ' + (!hasStock && item.Stock > 0 ? 'active' : '') + '" src="/Content/Mobile/kucunbuzu1.png" style="display:none;">' +
                '<img class="tagimg2 ' + (item.Stock <= 0 ? 'active' : '') + '" src="/Content/Mobile/wuhuo.png" style="display:none;">' +
                    //'<span>' + (size.length > 0 ? size.join(' ') : '') + '</span>' +
                '<span>x' + (item.Stock >= number ? item.Number : item.Stock) + '</span>' +
                '<a href="javascript:void(0);" class="pull-right' + hasStock ? ' hide' : '' + '"><img src="/Content/Mobile/shanchu.png"></a>' +
                '</div>' +
                '</div>';
            }
        }

        function dealColorAndSize(datai) {
            //datai.Size以，分隔；前颜色，后尺寸。
            if (datai.Size != null && datai.Size.length > 0) {
                var splitR = datai.Size.split(",");
                var sizeText = "";
                var s01 = false;
                var s02 = false;
                if (splitR.length == 1) {
                    if (splitR[0] != null && splitR[0].length > 0 && splitR[0] != "null") {
                        s01 = true;
                    }
                } else if (splitR.length >= 1) {
                    if (splitR[0] != null && splitR[0].length > 0 && splitR[0] != "null") {
                        s01 = true;
                    }
                    if (splitR[1] != null && splitR[1].length > 0 && splitR[1] != "null") {
                        s02 = true;
                    }
                }
                datai.SizeDisplay = s01 || s02 ? "block" : "none";
                if (s01) {
                    sizeText += splitR[0];
                }
                if (s02) {
                    if (sizeText.length > 0) {
                        sizeText += "&nbsp;&nbsp;";
                    }
                    sizeText += splitR[1];
                }
                if (Number(datai.Specifications)>0) {
                    sizeText += "&nbsp;&nbsp;" + "1*" + datai.Specifications;
                }
                if (datai.Specifications != null && Number(datai.Specifications.Attribute) > 0) {

                    sizeText += "&nbsp;&nbsp;" + "1*" + datai.Specifications.Attribute;
                }
                if (datai.Specification != null && Number(datai.Specification.Attribute) > 0) {

                    sizeText += "&nbsp;&nbsp;" + "1*" + datai.Specification.Attribute;
                }
                //if (sizeText.length>5) {
                //    sizeText=sizeText.substr(0,30)+"...";
                //}
                datai.SizeText = sizeText;
            }
            else if (Number(datai.Specifications) > 0) {
                datai.SizeText = "&nbsp;&nbsp;" + "1*" + datai.Specifications;
            }
            else if (datai.Specification != null && Number(datai.Specification.Attribute) > 0) {

                datai.SizeText = "&nbsp;&nbsp;" + "1*" + datai.Specification.Attribute;
            }
            else if (datai.Specifications != null && Number(datai.Specifications.Attribute) > 0) {

                datai.SizeText = "&nbsp;&nbsp;" + "1*" + datai.Specifications.Attribute;

            }
            else {
                datai.SizeText = "";
                datai.SizeDisplay = "none";
            }
        }


        //计算某个店铺众筹情况。

        function calculateShopCrowdfund(shop) {
            shop.CrowdfundingInfo = "";
            shop.cfDisplay = "none";
            if (_crowdfundingList == null) {
                return;
            }
            var data = _crowdfundingList.GetOnlyElement("AppId", shop.AppId);
            if (data == null) {
                return;
            }
            //用户将要够买的金额
            var usergou = 0;
            var shoppingItems = shop.ShoppingCartItemSDTO;
            if (shoppingItems == null || shoppingItems.length == 0) {
                return;
            }
            var siLength = shoppingItems.length;
            for (var i = 0; i < siLength; i++) {
                var cartItem = shoppingItems[i];
                usergou += cartItem.CommodityNumber * cartItem.RealPrice;
            }
            //众筹每股金额
            var perShareMoney = data.PerShareMoney;
            //用户已购买金额
            var money = data.Money;
            //用户已持有股数
            var currentShareCount = data.CurrentShareCount;
            //是否是进行中的众筹 true为活动中
            var isActiveCrowdfunding = data.IsActiveCrowdfunding;
            //众筹可购买股数
            var shareCountRemain = data.ShareCountRemain;


            if (isActiveCrowdfunding == "true" || isActiveCrowdfunding) {
                //如果用户将要够买 产生的股点数超过了此App剩余的股点数
                if ((usergou / perShareMoney) >= shareCountRemain) {
                    shop.CrowdfundingInfo = "您已拥有全部剩余股点" + shareCountRemain + "股！"
                    shop.cfDisplay = "block";
                } else {
                    //向上取整,有小数就整数部分加1
                    var jianggu = parseInt(usergou / perShareMoney) + 1;
                    var chaprice = ((perShareMoney * jianggu) - usergou).toFixed(2);
                    shop.CrowdfundingInfo = "您再购买" + chaprice + "元商品就能获得" + jianggu + "股，坐等分红啦！"
                    shop.cfDisplay = "block";
                }
            }
        }

        //并行一次获取金币余额、代金券张数、收货地址、积分。

        function GetCreateOrderAllInfo() {
            var isShowCoupon = sessionStorage.ProductType == "appcjzy" || sessionStorage.ProductType == "webcjzy" ? true : false;
            //地址id.
            var addressId = "00000000-0000-0000-0000-000000000000";
            if ((getQueryString("back") == "deladdlist" || getQueryString("back") == "coupons") && JsVilaDataNull(_pageCache.addressId)) {
                addressId = _pageCache.addressId;
            }
            //配送方式（配置）：0 app没有自提功能，1快递，2自提，3两者
            //检查可用的app配送方式。0 不显示配送方式；1 只显示快递；2 只显示自提；3 都显示; 4 都显示但自提灰显
            //0 非平台型app; 1 平台型app
            if (_isPlatformApp == 0) {
                if (_appSelfTakeWay == 0 || _appSelfTakeWay == 1) {
                    _checkEnableWay = 1;
                    _appSelfTakeFlag = 0;
                } else if (_appSelfTakeWay == 2) {
                    _checkEnableWay = 2;
                    _appSelfTakeFlag = 1;
                } else if (_appSelfTakeWay == 3) {
                    _checkEnableWay = 3;
                    //_appSelfTakeFlag = 0;
                }
            } else {
                if (_appSelfTakeWay == 0 || _appSelfTakeWay == 1) {
                    _checkEnableWay = 1;
                    _appSelfTakeFlag = 0;
                } else if (_appSelfTakeWay == 2 || _appSelfTakeWay == 3) {
                    //支持自提
                    var tmpAppIdArray = appIds.split(",");
                    if (tmpAppIdArray.length == 1) {
                        if (tmpAppIdArray[0] == getEsAppId()) {
                            _checkEnableWay = 3;
                        } else {
                            _checkEnableWay = 4;
                            _appSelfTakeFlag = 0;
                        }
                    } else {
                        //多app
                        _checkEnableWay = 4;
                        _appSelfTakeFlag = 0;
                    }
                }
            }
            if (JsVilaDataNull(_pageCache.appSelfTakeFlag)) {
                if (_pageCache.appSelfTakeFlag == 1 && (_checkEnableWay == 2 || _checkEnableWay == 3 || _checkEnableWay == 4)) {
                    $("#selfTakeWay").addClass('current').siblings().removeClass('current');
                    _appSelfTakeFlag = 1;
                } else {
                    $("#commonWay").addClass('current').siblings().removeClass('current');
                    _appSelfTakeFlag = 0;
                }
            } else {
                if (_appSelfTakeFlag == 1) {
                    $("#selfTakeWay").addClass('current').siblings().removeClass('current');
                } else {
                    $("#commonWay").addClass('current').siblings().removeClass('current');
                }
            }

            //检查可用的app配送方式。0 不显示配送方式；1 只显示快递；2 只显示自提；3 都显示; 4 都显示但自提灰显
            if (_checkEnableWay == 0 || _checkEnableWay == 1 || _checkEnableWay == 2) {
                $(".delivery").hide();
            } else if (_checkEnableWay == 3) {
                $(".delivery").show();
            } else if (_checkEnableWay == 4) {
                $("#selfTakeWay").addClass("disableA");
                $("#commonWay").addClass("disableB");
                $(".delivery").show();
            }

            var isWorthToGet = true;
            var appSelfTakeWay = '';
            var appSelfTakeStationId = '';
            var searchTypeForAppSelfTake = '';
            if (!JsVilaDataNull(_pageCache.appSelfTakeStationId)) {
                //没有选择时
                if (JsVilaDataNull(sessionStorage.userSelfTake)) {
                    var userSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
                    if (JsVilaDataNull(userSelfTakeObj.appSelfTakeStationId)) {
                        isWorthToGet = false;
                        appSelfTakeStationId = userSelfTakeObj.appSelfTakeStationId;
                        searchTypeForAppSelfTake = appSelfTakeStationId == '' ? 2 : 1;
                        _pageCache.appSelfTakeStationId = appSelfTakeStationId;
                        sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
                    }
                }
            } else {
                if (JsVilaDataNull(sessionStorage.userSelfTake)) {
                    var userSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
                    if (userSelfTakeObj.StationId == _pageCache.appSelfTakeStationId) {
                        isWorthToGet = false;
                    }
                }
                appSelfTakeStationId = _pageCache.appSelfTakeStationId;
                searchTypeForAppSelfTake = _pageCache.appSelfTakeStationId == '' ? 2 : 1;
            }

            var pobj = {};
            pobj.userId = getUserId();
            pobj.sessionId = getSessionId();
            pobj.addressId = addressId;
            pobj.appId = "00000000-0000-0000-0000-000000000000";
            pobj.isShowCoupon = isShowCoupon;
            pobj.commodityIds = sessionStorage.commodityId_2 + ",";
            pobj.coType = sessionStorage.type;
            pobj.areaCode = getCookie('selectCityCode');
            pobj.esAppId = getEsAppId();
            pobj.appIds = appIds;
            pobj.appSelfTakeWay = _appSelfTakeFlag == 1 ? 2 : 0;
            pobj.comList = buildComList();
            pobj.setMealId = getQueryString('setMealId');
            pobj.jcActivityId = getQueryString('jcActivityId');
            if (!isWorthToGet) {
                pobj.appSelfTakeWay = 0;
                pobj.appSelfTakeStationId = '';
                pobj.searchTypeForAppSelfTake = searchTypeForAppSelfTake;
            } else {
                pobj.appSelfTakeWay = 2;
                pobj.appSelfTakeStationId = appSelfTakeStationId;
                pobj.searchTypeForAppSelfTake = JsVilaDataNull(appSelfTakeStationId) ? 1 : 2;
            }
            //todo选择的易捷卡id
            if(sessionStorage.getItem('yjcid')){
                pobj.YjcIds=sessionStorage.yjcid;
            }
            getDataAjax2({
                url: "/Mobile/GetCreateOrderAllInfo",
                data: pobj,
                callback: function(data) {
                    if (data.ResultCode != 0) {
                        return;
                    }

                    //ajaxLoadingSingle.hide();
                    _pageAllInfoData = data;
                    if (data.TradeType == -1) {
                        toast("出错了！");
                        return;
                    }
                    //                    if (window.getUserIdAndSessionId && typeof window.getUserIdAndSessionId.getUserIdAndSessionId == "function") {
                    //                        var userAndSessionId = window.getUserIdAndSessionId.getUserIdAndSessionId();
                    //                        if (typeof userAndSessionId != "undefined" && userAndSessionId) {
                    //                            if(data.AddressInfo.UserId.toLowerCase() != userAndSessionId.split(',')[0].toLowerCase()){
                    //			                    $.ajax({
                    //			                        type: "POST",
                    //			                        url: "/Login/GatherErrorInfo?c=1&m0=curUserId:" + getUserId() + ",data.AddressInfo.UserId:" + GetUrlParam("userId", data.PayUrl)
                    //			                    });
                    //                                toast("出错了！");
                    //                                return;
                    //                            }
                    //                        }
                    //                    }
                    _isAllAppInZPH = data.IsAllAppInZPH;
                    if (data.TradeType == 0) {

                        $("#gold_balance").show();
                        //金币
                        var goldbalance = (Math.floor(data.GoldBalance * 0.1) * 0.01).toFixed(2);
                        $('#gold_balance').find('.price_3').text(goldbalance);
                        if (eval(goldbalance) == 0) {
                            $("#goldpay").css("pointer-events", "none");
                        }
                        //代金券
                        if (data.IsAllAppInZPH) {
                            $('#payCouponLi').show();
                            $('#paycouponCount').text(data.CouponCount);
                        }
                    } else {
                        $("#gold_balance").hide();
                        $('#payCouponLi').hide();

                    }

                    _hasPhysicalCommodity = $.inArray(0, data.CommodityTypeList) >= 0;
                    _hasVirtualCommodity = $.inArray(1, data.CommodityTypeList) >= 0;

                    //是否支持七天无理由退
                    if(data.Dutys.Isnsupport) {
                        $("#Isnsupport").show();
                    }

                    //收货地址
                    showAddressMain(data.AddressInfo, data.CommodityTypeList);

                    //众销
                    showCrowdfund(data.UserCrowdfunding);

                    //关税
                    initDuty(data.Dutys);

                    //虚拟商品提示信息
                    data.Dutys.List.length && initVirtual(data.Dutys.List);

                    // 预售活动发货时间
                    updateDeliveryTime(data.Dutys);

                    // 更新赠品信息
                    updateCommodityPresent(data.Dutys);

                    //计算运费
                    calcFreight(_hasAddress, 1);

                    //自提点信息
                    if (isWorthToGet) {
                        if (JsVilaDataNull(data) && JsVilaDataNull(data.AppSelfTakeStationDefaultInfo)) {
                            var dataApp = data.AppSelfTakeStationDefaultInfo;
                            if (!JsVilaDataNull(sessionStorage.userSelfTake)) {
                                var userSelfTakeObj = {
                                    IsDefault: JsVilaDataNull(dataApp.StationTimeShowList) ? dataApp.StationTimeShowList.IsDefault : false,
                                    StationId: dataApp.StationId,
                                    StationName: dataApp.StationName,
                                    StationPhone: dataApp.StationPhone,
                                    StationAddressDetails: dataApp.StationAddressDetails,
                                    PickUpName: dataApp.PickUpName,
                                    PickUpPhone: dataApp.PickUpPhone,
                                    AppOrderPickUpBookDate: '',
                                    AppOrderPickUpBookStartTime: '',
                                    AppOrderPickUpBookEndTime: '',
                                    PickUpText: '',
                                    PickUpValue: '',
                                    ScrollDayList: JsVilaDataNull(dataApp.StationTimeShowList) ? dataApp.StationTimeShowList.ScrollDayList : '',
                                    ScrollWeekTimeList: JsVilaDataNull(dataApp.StationTimeShowList) ? dataApp.StationTimeShowList.ScrollWeekTimeList : ''
                                };
                                sessionStorage.userSelfTake = JSON.stringify(userSelfTakeObj);
                            } else {
                                var userSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
                                if (userSelfTakeObj.StationId != dataApp.StationId) {
                                    userSelfTakeObj.PickUpValue = '';
                                    userSelfTakeObj.PickUpText = '';
                                    userSelfTakeObj.AppOrderPickUpBookDate = '';
                                    userSelfTakeObj.AppOrderPickUpBookStartTime = '';
                                    userSelfTakeObj.AppOrderPickUpBookEndTime = '';

                                    userSelfTakeObj.IsDefault = JsVilaDataNull(dataApp.StationTimeShowList) ? dataApp.StationTimeShowList.IsDefault : false;
                                    userSelfTakeObj.StationId = dataApp.StationId;
                                    userSelfTakeObj.StationName = dataApp.StationName;
                                    userSelfTakeObj.StationPhone = dataApp.StationPhone;
                                    userSelfTakeObj.StationAddressDetails = dataApp.StationAddressDetails;

                                    userSelfTakeObj.ScrollDayList = JsVilaDataNull(dataApp.StationTimeShowList) ? dataApp.StationTimeShowList.ScrollDayList : '';
                                    userSelfTakeObj.ScrollWeekTimeList = JsVilaDataNull(dataApp.StationTimeShowList) ? dataApp.StationTimeShowList.ScrollWeekTimeList : '';

                                    sessionStorage.userSelfTake = JSON.stringify(userSelfTakeObj);
                                }
                            }
                            _pageCache.appSelfTakeStationId = dataApp.StationId;
                            sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
                        } else {
                            sessionStorage.userSelfTake = "";
                            _pageCache.appSelfTakeStationId = "";
                        }
                    }
                    showAppSelfTakeStationDefaultInfo();


                    //支付方式
                    if (sessionStorage.IsHYL) {
                        $("#hdfkspan").hide();
                    } else {
                        $("#hdfkspan").hide();
                        if (data.IsAllAppSupportCOD && sessionStorage.type != "diygroup") {
                            $("#hdfkspan").show();
                            if (sessionStorage.appId == "099bbc98-332a-42a2-b15d-351830b55180") {
                                $("#hdfk")[0].checked = true;
                            }
                        }
                    }

                    //发票信息
                    if (data.IsInvoice && getQueryString('jcActivityId') == null) {
                        $("#divInvoice").show();
                    }
                    else if(data.IsInvoice && getQueryString('jcActivityId') =="null"){
                        $("#divInvoice").show();
                    }
                    else {
                        $("#divInvoice").hide();
                    }
                    setTimeout(function() {
                        disPlaygoldul();
                    }, 50);

                    //易捷北京-油卡兑换券
                    window.YouKa.init(data);

                    window._setMeal = data.setMeal;
                    window._Dutys = data.Dutys;

                    //是否是金采支付
                    if (getQueryString('jcActivityId') != null && getQueryString('jcActivityId') != "00000000-0000-0000-0000-000000000000" && getQueryString('jcActivityId') != "null") {
                        $('#yjbUl').addClass('hide');
                        if (data.jcActivityYouKa > 0) {
                            YouKa.setYoukaMoney(data.jcActivityYouKa);
                            //$("#youkaUl").removeClass("hide").find("span:last").text("支付后立即赠送" + getCookie("Currency") + data.jcActivityYouKa.toFixed(2) + "的油卡兑换券");
                        }
                    }
                    //可用易捷卡数量
                    if(data.YjcNum){
                        $("#yjctip_L").text(data.YjcNum);
                        sessionStorage.YjcNum=data.YjcNum;
                        $("#yjctip_C").show();
                    }else{
                        $("#yjctip_C").hide();
                        $("#yjctip_R").text('不可用');

                    }
                    //易捷卡的信息
                    if(data.YjcList){
                        //sessionStorage.YjcList=data.YjcList;//放入缓存 //sessionStorag存不了复杂格式数据
                        YJCard.YjcList=data.YjcList;
                    }else{
                        sessionStorage.removeItem('YjcList');//移除缓存
                    }
                },
                beforeSend: function() {
                    //ajaxLoading('22', '');
                    ajaxLoadingSingle.show();
                },
                error: function() {
                    ajaxLoadingSingle.hide();
                }
            });
        }

        function disPlaygoldul() {
            //所有子元素都隐藏了，父元素（父元素中包含一根分隔线）也隐藏。
            var liCount = 0;
            $("#goldul").children("li").each(function(i, el) {
                if ($(this).css("display") == "none") {
                    liCount++;
                }
            })
            if ($("#goldul").children("li").length == liCount) {
                $("#goldul").hide();
            } else {
                $("#goldul").show();
            }
        }

        //获取当前app积分抵用金额

        function getAppScore(appId) {
            var result = 0.0;
            if (((!JsVilaDataNull(window._userScore)) || (!window._userScore.IsCashForScore)) || !$("#signScorePay").hasClass("active")) {
                return result;
            }
            var appScore = window._userScore.List.GetOnlyElement("AppId", appId);
            if (appScore && appScore.Money) {
                result = appScore.Money;
            }
            return result;
        }

        //获取积分类型

        function getScoreType() {
            var result = 0;
            if (((!JsVilaDataNull(window._userScore)) || (!window._userScore.IsCashForScore)) || !$("#signScorePay").hasClass("active")) {
                return result;
            }
            return window._userScore.ScoreType;
        }

        //获取商品积分

        function getComScore(appId, itemId) {
            var result = 0.0;
            if (((!JsVilaDataNull(window._userScore)) || (!window._userScore.IsCashForScore)) || !$("#signScorePay").hasClass("active")) {
                return result;
            }
            var appScore = window._userScore.List.GetOnlyElement("AppId", appId);
            if (appScore && appScore.Money && appScore.Coms) {
                var comScore = appScore.Coms.GetOnlyElement("ItemId", itemId);
                if (comScore && comScore.Money)
                    return comScore.Money;
            }
            return result;
        }

        var uploadFrameHtml = "<iframe id=\"uploadframe\" name=\"uploadframe\" style=\"display: none\"></iframe>";
        var uploadImageArray = new Array();
        var uploadImageArrayMobile = new Array();
        var isload = true;


        //上传图片

        function uploadfun() {
            var _file = document.getElementById('add').value;
            if (_file) {
                var fileExt = _file.substr(_file.lastIndexOf(".")).toLowerCase();
                if (fileExt == '.jpg' || fileExt == '.jpeg' || fileExt == '.png' || fileExt == '.gif') {
                    loadingFrame.show();
                    setTimeout("loadingFrame.hide()", 30000);
                    document.getElementById('picForm').submit();
                } else {
                    toast("只能上传 jpg、jpeg、png、gif 类型的文件");
                    $("#add").val("");
                }
            }
        }

        //删除已传图片

        function deluploadpic(delspan) {
            var src = $(delspan).siblings("img").attr("src");
            for (var i = 0; i < uploadImageArray.length; i++) {
                if (uploadImageArray[i].indexOf(src) > 0) {
                    uploadImageArray.splice(i, 1);
                    sessionStorage.PicturesPathModel = uploadImageArray.join("|");
                    break;
                }
            }
            for (var i = 0; i < uploadImageArrayMobile.length; i++) {
                var jsonModel = $.parseJSON(uploadImageArrayMobile[i]);
                var url = jsonModel.url + "\\" + jsonModel.name;
                //toast(url);
                if (url == src) {
                    uploadImageArrayMobile.splice(i, 1);
                    sessionStorage.PicturesPathModelMobile = uploadImageArrayMobile.join("|");
                    break;
                }
            }
            $(delspan).parent().remove();
            if ($("#preview")[0].childElementCount > 6) {
                $("#addPicli").hide();
            } else if ($("#preview")[0].childElementCount == 3) {
                $("#uploadFileCom").css("height", "105px");
                $("#addPicli").show();
            } else {
                $("#addPicli").show();
            }
        }

        //上传成功后显示预览函数

        function preview(source) {
            try {
                if (source) {
                    var data = $.parseJSON(source);

                    if (data.Url) {
                        var pic = document.createElement("li");

                        var url = data.Url;
                        pic.innerHTML = "<img src='" + url + "' /><span class='icon-close' onclick='deluploadpic(this);'></span><input type='hidden' value='" + url + "'/>";
                        var box_view = document.getElementById('preview');
                        box_view.insertBefore(pic, document.getElementById('addPicli'));
                        //清除上传控件设置的文件
                        //清除上传控件设置的文件
                        if (box_view.childElementCount == 6) {
                            $("#addPicli").hide();
                        } else if (box_view.childElementCount == 4) {
                            $("#uploadFileCom").css("height", "180px");
                        } else {
                            $("#addPicli").show();
                        }
                        $("#add").val("");
                        //window.frames["uploadframe"].locatin = "about:blank";
                        if (!isload) {
                            uploadImageArray.push(source);
                            sessionStorage.PicturesPathModel = uploadImageArray.join("|");
                        }
                        $("#isEditM").val("1");
                    }
                }
            } catch (err) {
            }
        }

        var loadingFrame = {
            //显示信息框：loading.show();
            //隐藏信息框：loading.hide();
            show: function(msg) {
                //                if (document.getElementById('loading') == null) {
                //                    var _body = $('.main')[0],
                //                        _dom = document.createElement('div'),
                //                        h = document.body.scrollHeight;
                //                    _dom.innerHTML = "<span class='msg' style='top:" + (h - 200) + "px'>正在上传，请稍候</span>";
                //                    _dom.id = "loading";
                //                    _dom.className = "loading";
                //                    _dom.style.height = (h + 30) + "px";
                //                    _body.appendChild(_dom);
                //                } else {
                //                    document.getElementById('loading').style.display = "block";
                //                }
            },
            hide: function() {
                // document.getElementById('loading').style.display = "none";
            }
        };

        function uploadPic(source) {
            try {
                if (source) {
                    var data = $.parseJSON(source); //{ url = fileUrl, name = fileName }

                    if (data.url) {
                        var pic = document.createElement("li");
                        var url = data.url + "\\" + data.name;
                        pic.innerHTML = "<img src='" + url + "' /><span class='icon-close' onclick='deluploadpic(this);'></span><input type='hidden' value='" + url + "'/>";
                        var box_view = document.getElementById('preview');
                        box_view.insertBefore(pic, document.getElementById('addPicli'));
                        //清除上传控件设置的文件
                        if (box_view.childElementCount == 6) {
                            $("#addPicli").hide();
                        } else if (box_view.childElementCount == 4) {
                            $("#uploadFileCom").css("height", "180px");
                        } else {
                            $("#addPicli").show();
                        }
                        window.frames["uploadframe"].locatin = "about:blank";
                        if (!isload) {
                            uploadImageArrayMobile.push(source);
                            sessionStorage.PicturesPathModelMobile = uploadImageArrayMobile.join("|");
                        }
                        $("#add").val("");
                        $("#isEditM").val("1");

                    }
                }
            } catch (err) {

            }
        }

        //拦载处理

        function PreClickOnPic(id) {
            if (window.uploadPicand) {
                window.uploadPicand.addPicand();
            }
        }

        function showAgreement(obj) {
            for (var i = 0; i < _showContractCommodityList.length; i++) {
                if (_showContractCommodityList[i].Id == obj) {
                    window.location.href = encodeURI(urlAppendCommonParams("/Mobile/JhRentAgreement?title=" + _showContractCommodityList[i].Name));
                }
            }
        }

        //判断显隐，并附值显列表

        function isShowUploadOrContract(objList) {
            var result = {};
            var showContractCom = false;

            for (var i = 0; i < _newContractCommodityList.length; i++) {
                if (objList.indexOf(_newContractCommodityList[i].Id) > -1) {
                    showContractCom = true;
                    if (_showContractCommodityList.length == 0) {
                        _showContractCommodityList.push(_newContractCommodityList[i]);
                    } else {
                        var isExit = false;
                        for (var j = 0; j < _showContractCommodityList.length; j++) {
                            if (_showContractCommodityList[j].Name == _newContractCommodityList[i].Name) {
                                isExit = true;
                            }
                        }
                        if (!isExit) {
                            _showContractCommodityList.push(_newContractCommodityList[i]);
                        }
                    }
                }
            }
            result.showContractCom = showContractCom;
            return result;
        }

        //显隐控制

        function showHideUploadOrContract(result) {
            if (result.showContractCom) {
                if (_showContractCommodityList.length > 0) {
                    var htmlTemp = "";
                    for (var i = 0; i < _showContractCommodityList.length; i++) {
                        htmlTemp += _contractTemplete.format(_showContractCommodityList[i]);
                    }
                    $("#JhRentAgreement").append(htmlTemp);
                }
                $("#uploadFiles").show();
                $("#uploadFileCom").show();
                $("#JhRentAgreement").show();
            } else {
                $("#uploadFiles").hide();
                $("#uploadFileCom").hide();
                $("#JhRentAgreement").hide();
            }
        }


        function showAppSelfTakeStationDefaultInfo() {
            if (!JsVilaDataNull(sessionStorage.userSelfTake)) {
                if (_appSelfTakeFlag == 1) {
                    $('.delivery-info > ul').eq(1).show().siblings().hide();
                } else {
                    //$("#commonWay").addClass('current').siblings().removeClass('current');
                    $('.delivery-info > ul').eq(0).show().siblings().hide();
                }
                $("#demo_treelist").empty();
                return;
            }
            var setSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
            $("#StationName").html(setSelfTakeObj.StationName);
            $("#StationPhone").html(setSelfTakeObj.StationPhone);
            $("#StationAddressDetails").html(setSelfTakeObj.StationAddressDetails);
            $("#AppOrderPickUpName").val(setSelfTakeObj.PickUpName);
            $("#AppOrderPickUpPhone").val(setSelfTakeObj.PickUpPhone);
            if (_appSelfTakeFlag == 1) {
                $('.delivery-info > ul').eq(1).show().siblings().hide();
            } else {
                $('.delivery-info > ul').eq(0).show().siblings().hide();
            }
            $("#demo_treelist").empty();
            if (!setSelfTakeObj.ScrollDayList || !setSelfTakeObj.ScrollWeekTimeList) {
                return;
            }
            var htmlTimeList = '';
            var scrollDays = setSelfTakeObj.ScrollDayList;
            var scrollWeeks = setSelfTakeObj.ScrollWeekTimeList;
            if (setSelfTakeObj.IsDefault) {
                for (var i = 0; i < scrollDays.length; i++) {
                    scrollDays[i].ScrollDateFmt = ChangeDateFormat(scrollDays[i].ScrollDate, 2);
                    htmlTimeList += dateTemplate.format(scrollDays[i]);
                    htmlTimeList += "<ul>";
                    var timeList = scrollWeeks[0].ScrollTimeList;
                    for (var j = 0; j < timeList.length; j++) {
                        htmlTimeList += timeTemplate.format(timeList[j]);
                    }
                    htmlTimeList += "</ul>";
                }
                htmlTimeList += "</li>";
            } else {
                for (var i = 0; i < scrollDays.length; i++) {
                    scrollDays[i].ScrollDateFmt = ChangeDateFormat(scrollDays[i].ScrollDate, 2);
                    htmlTimeList += dateTemplate.format(scrollDays[i]);
                    var timeList = [];
                    for (var j = 0; j < scrollWeeks.length; j++) {
                        if (scrollWeeks[j].ScrollWeekDay == scrollDays[i].ScrollWeekDay) {
                            timeList = scrollWeeks[j].ScrollTimeList;
                        }
                    }
                    htmlTimeList += "<ul>";
                    for (var j = 0; j < timeList.length; j++) {
                        htmlTimeList += timeTemplate.format(timeList[j]);
                    }
                    htmlTimeList += "</ul>";
                }
                htmlTimeList += "</li>";
            }

            $("#demo_treelist").append(htmlTimeList);
            //日期控件
            if (setSelfTakeObj.PickUpValue != '') {
                var selectArray = setSelfTakeObj.PickUpValue.split(",");
                var dateIdex = selectArray[0];
                var timeIndex = selectArray[1];
                $('#demo_treelist').mobiscroll().treelist({
                    onSelect: mobiscroll_change, //点击确定出发的函数
                    defaultValue: [dateIdex, timeIndex]
                });
                $("#demo_datetime").val(setSelfTakeObj.PickUpText);
            } else {
                $("#demo_datetime").val("");
                $('#demo_treelist').mobiscroll().treelist({
                    onSelect: mobiscroll_change //点击确定出发的函数
                });
            }
        }

        function ChangeDateFormat(cellval, state) {
            try {
                var date = new Date(parseInt(cellval.replace("/Date(", "").replace(")/", ""), 10));
                var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                var hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                var minu = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                if (state == 1) {
                    return date.getFullYear() + "-" + month + "-" + currentDate + " " + hour + ":" + minu;
                } else {
                    return date.getFullYear() + "-" + month + "-" + currentDate;
                }
            } catch (e) {
                return "";
            }
        }

        function initShoppingCartDataFromApp(dataStr) {
            if (!dataStr) {
                initCreateOrder();
            }
            try {
                var cartDatas = JSON.parse(dataStr);
                var price = 0;
                var data = [];
                var tmpAppIds = [];
                for (var i = 0; i < cartDatas.length; i++) {
                    if (tmpAppIds.indexOf(cartDatas[i].AppId) > -1) {
                        continue;
                    }
                    tmpAppIds.push(cartDatas[i].AppId);
                }
                for (var i = 0; i < tmpAppIds.length; i++) {
                    var tmpList = cartDatas.PropertyValueEqual("AppId", tmpAppIds[i]);
                    var appData = { AppId: tmpList[0].AppId, AppName: tmpList[0].AppName, RealPrice: 0, AppAmount: 0, ShoppingCartItemSDTO: [], CommodityNum: 0, Price: 0 };
                    for (var j = 0; j < tmpList.length; j++) {
                        var realPrice = tmpList[j].DiscountPrice > 0 ? tmpList[j].DiscountPrice : tmpList[j].Price * (tmpList[j].Intensity / 10);
                        tmpList[j].RealPrice = realPrice.toFixed(2);
                        tmpList[j].SizeAndColorId = tmpList[j].Size;
                        appData.RealPrice += realPrice;
                        appData.AppAmount += realPrice * tmpList[j].CommodityNumber;

                        appData.Price += realPrice;
                        appData.CommodityNum += tmpList[j].CommodityNumber;
                        appData.ShoppingCartItemSDTO.push(tmpList[j]);

                    }

                    price += appData.AppAmount;
                    appData.Price = appData.Price.toFixed(2);
                    appData.RealPrice = appData.RealPrice.toFixed(2);
                    appData.AppAmount = appData.AppAmount.toFixed(2);

                    data.push(appData);
                }
                sessionStorage.Price = price.toFixed(2);
                sessionStorage.ShopCartDate = JSON.stringify(data);

                initCreateOrder();
            } catch (e) {
                return;
            }
        }

        function initSetMealDataFromApp(dataStr) {
            if (!dataStr) {
                initCreateOrder();
            }
            try {
                var cartDatas = JSON.parse(dataStr);
                var price = 0;
                var data = [];
                var tmpAppIds = [];
                for (var i = 0; i < cartDatas.length; i++) {
                    if (tmpAppIds.indexOf(cartDatas[i].AppId) > -1) {
                        continue;
                    }
                    tmpAppIds.push(cartDatas[i].AppId);
                }
                for (var i = 0; i < tmpAppIds.length; i++) {
                    var tmpList = cartDatas.PropertyValueEqual("AppId", tmpAppIds[i]);
                    var appData = { AppId: tmpList[0].AppId, AppName: tmpList[0].AppName, RealPrice: 0, AppAmount: 0, ShoppingCartItemSDTO: [], CommodityNum: 0, Price: 0 };
                    for (var j = 0; j < tmpList.length; j++) {
                        var realPrice = tmpList[j].DiscountPrice > 0 ? tmpList[j].DiscountPrice : tmpList[j].Price * (tmpList[j].Intensity / 10);
                        tmpList[j].RealPrice = realPrice.toFixed(2);
                        tmpList[j].SizeAndColorId = tmpList[j].Size;
                        appData.RealPrice += realPrice;
                        appData.AppAmount += realPrice * tmpList[j].CommodityNumber;

                        appData.Price += realPrice;
                        appData.CommodityNum += tmpList[j].CommodityNumber;
                        appData.ShoppingCartItemSDTO.push(tmpList[j]);

                    }

                    price += appData.AppAmount;
                    appData.Price = appData.Price.toFixed(2);
                    appData.RealPrice = appData.RealPrice.toFixed(2);
                    appData.AppAmount = appData.AppAmount.toFixed(2);

                    data.push(appData);
                }
                sessionStorage.Price = price.toFixed(2);
                sessionStorage.ShopCartDate = JSON.stringify(data);

                initCreateOrder();
            } catch (e) {
                return;
            }
        }

        function initDuty(dutyResult) {
            if (!dutyResult || !dutyResult.List || dutyResult.length <= 0 || dutyResult.TotalDuty <= 0) {
                return;
            }
            if (sessionStorage.type == "gouwuche") {
                var shopList = JSON.parse(sessionStorage.ShopCartDate);
                $("#divShopCommoditys > div").each(function(ind, el) {
                    var appid = $(this).attr("co-tag-appid");
                    var shopDutyInfo = dutyResult.List.GetFirstElement("AppId", appid);
                    if (shopDutyInfo == null || shopDutyInfo.TotalDuty <= 0) {
                        return;
                    }
                    var shop = shopList.GetFirstElement("AppId", appid);
                    var appDuty = eval(shopDutyInfo.TotalDuty);
                    $(this).find('ul').find(".shopCartItem").each(function() {
                        var itemId = $(this).attr("itemid");
                        var dutyCom = shopDutyInfo.Coms.GetFirstElement("ItemId", itemId);
                        if (dutyCom != null && dutyCom.Duty > 0) {
                            $(this).find(".itemDutyPrice").text(dutyCom.Duty.toFixed(2)).parent().show();
                        }
                    });
                    var appAmount = eval(shop.AppAmount);
                    var realPrice = appAmount + appDuty;
                    //合计
                    $(this).find('ul li span[co-tag="AppAmount"]').html(appAmount.toFixed(2));
                    shop.Duty = appDuty.toFixed(2);
                    shop.RealPrice = realPrice;
                });
                sessionStorage.ShopCartDate = JSON.stringify(shopList);
            } else {
                commodityUpInfo.Duty = 0;
                if (dutyResult.List && dutyResult.List[0].Coms) {
                    commodityUpInfo.Duty = dutyResult.List[0].Coms[0].Duty;
                }
                if (commodityUpInfo.Duty > 0) {
                    $(".sduty").text("关税: " + getCurrency() + commodityUpInfo.Duty.toFixed(2));
                }
            }
            $("#dutyValueli").show();
            $("#duty").html(dutyResult.TotalDuty.toFixed(2));

        }

        function updateCommodityPresent(dutyResult) {
            if (sessionStorage.type == "gouwuche") {
                var shopList = JSON.parse(sessionStorage.ShopCartDate);
                dutyResult.List.forEach(function (d) {
                    var shop = shopList.GetFirstElement("AppId", d.AppId);
                    d.Coms.forEach(function (dutyCom) {
                        if (dutyCom.Present && dutyCom.Present.Items && dutyCom.Present.Items.length > 0) {
                            _hasPresent = true;
                            var shopItem = shop.ShoppingCartItemSDTO.GetFirstElement("ShopCartItemId", dutyCom.ItemId);
                            var presentNum = Math.floor(dutyCom.Num / dutyCom.Present.Limit);
                            if (presentNum > 0) {
                                shopItem.Presents = new Array();
                                dutyCom.Present.Items.forEach(function (p) {
                                    var number = p.Stock - Math.floor(p.Number * presentNum) < 0 ? p.Stock : Math.floor(p.Number * presentNum);
                                    shopItem.Presents.push({
                                        CommodityId: p.Id,
                                        CommodityStockId: p.StockId,
                                        Number: number
                                    });
                                });
                                $("#divShopCommoditys > div").each(function () {
                                    $(this).find('ul').find(".shopCartItem").each(function () {
                                        var itemId = $(this).attr("itemid");
                                        if (itemId == dutyCom.ItemId) {
                                            var html = renderPresent(presentNum, dutyCom.Present.Items);
                                            $(this).find('.present-wrap').html(html).removeClass('hide');
                                        }
                                    });
                                });
                            }
                        }

                        if (dutyCom.IsAssurance) {
                            $("#divShopCommoditys > div").each(function () {
                                $(this).find('ul').find(".shopCartItem").each(function () {
                                    var itemId = $(this).attr("itemid");
                                    if (itemId == dutyCom.ItemId) {
                                        $(this).find('.isAssurance').show();
                                    }
                                });
                            });
                        }
                    });

                });
                sessionStorage.ShopCartDate = JSON.stringify(shopList);
            } else {
                if (dutyResult.List[0].Coms[0].Present) {
                    _hasPresent = true;
                    commodityUpInfo.Present = dutyResult.List[0].Coms[0].Present;
                    var list = dutyResult.List[0].Coms[0];
                    if (list.Present.Items && list.Present.Items.length) {
                        var presentNum = Math.floor(list.Num / list.Present.Limit);
                        if (presentNum > 0) {
                            var html = renderPresent(presentNum, dutyResult.List[0].Coms[0].Present.Items);
                            $('#present').html(html).removeClass('hide');
                        }
                    }
                }

                if (dutyResult.List[0].Coms[0].IsAssurance) {
                    $('#isAssurance').show();
                }
            }
        }

        function renderPresent(presentNum, items) {
            if (sessionStorage.type !== "gouwuche") {
                commodityUpInfo.Presents = [];
            }
            var html = "";
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var number = item.Stock - Math.floor(item.Number * presentNum) < 0 ? item.Stock : Math.floor(item.Number * presentNum);
                if (sessionStorage.type !== "gouwuche") {
                    commodityUpInfo.Presents.push({
                        CommodityId: item.Id,
                        CommodityStockId: item.StockId,
                        Number: number
                    });
                }
                var hasStock = item.Stock - Math.floor(item.Number * presentNum) < 0 ? false : true;
                /*   var size = [];
                 if(item.SKU){
                 for(var j = 0; j< item.SKU.length; j++){
                 size.push(item.SKU[j].SecondAttribute);
                 }
                 }*/
                html += '<div id="' + item.Id + '-' + item.StockId + '"class="present">' +
                        '<div class="present-title">' + item.Name + '</div>' +
                        '<div class="present-info">' +
                        '<img class="tagimg1 ' + (!hasStock && item.Stock > 0 ? 'active' : '') + '" src="/Content/Mobile/kucunbuzu1.png" style="display:none;">' +
                        '<img class="tagimg2 ' + (item.Stock <= 0 ? 'active' : '') + '" src="/Content/Mobile/wuhuo.png" style="display:none;">' +
                            // (size.length > 0 ? ('<span>' + size.join(' ') +'</span>'):'')+
                        '<span>x' + number + '</span>' +
                        '<a href="javascript:void(0);" onclick="showModal(this)" class="pull-right' + (hasStock ? ' hide' : '') + '"><img src="/Content/Mobile/shanchu.png"></a>' +
                        '</div>' +
                        '</div>';
            }
            return html;
        }

        //删除赠品
        function removePresent(id, AppId, ShopCartItemId) {
            if (sessionStorage.type == "gouwuche") {
                var shopList = JSON.parse(sessionStorage.ShopCartDate);
                var shop = shopList.GetFirstElement("AppId", AppId);
                var shopItem = shop.ShoppingCartItemSDTO.GetFirstElement("ShopCartItemId", ShopCartItemId);
                for (var i = 0; i < shopItem.Presents.length; i++) {
                    var item = shopItem.Presents[i];
                    if ((item.CommodityId + '-' + item.CommodityStockId) == id) {
                        shopItem.Presents.splice(i, 1);
                        _hasPresent = shopItem.Presents.length > 0;
                        break;
                    }
                }
                sessionStorage.ShopCartDate = JSON.stringify(shopList);
            } else {
                for (var i = 0, len = commodityUpInfo.Present.Items.length; i < len; i++) {
                    var item = commodityUpInfo.Present.Items[i];
                    if (item.StockId && item.Id && (item.Id + '-' + item.StockId == id)) {
                        commodityUpInfo.Present.Items.splice(i, 1);
                        _hasPresent = commodityUpInfo.Present.Items.length > 0;
                        break;
                    }
                }
                for (var i = 0; i < commodityUpInfo.Presents.length; i++) {
                    var item = commodityUpInfo.Presents[i];
                    if ((item.CommodityId + '-' + item.CommodityStockId) == id) {
                        commodityUpInfo.Presents.splice(i, 1);
                        _hasPresent = commodityUpInfo.Present.Items.length > 0;
                        break;
                    }
                }
            }
        }

        function showModal(el) {
            var id = $(el).parents('.present').attr('id');
            var appid = $(el).parents('.shopCartItem').parent().parent().attr('co-tag-appid');
            var itemid = $(el).parents('.shopCartItem').attr('itemid');
            $('#present-dialog').removeClass('hide').data('tag', id);
            $('#present-dialog').data('appid', appid);
            $('#present-dialog').data('shopcartid', itemid);
        }

        function updtePresent(val) {
            var presentNum = commodityUpInfo.Present ? Math.floor(commodityUpInfo.number / commodityUpInfo.Present.Limit) : 0;
            if (presentNum > 0) {
                if (commodityUpInfo.Present && commodityUpInfo.Present.Items && commodityUpInfo.Present.Items.length) {
                    var html = renderPresent(presentNum, commodityUpInfo.Present.Items);
                    $('#present').html(html).removeClass('hide');
                }
            } else {
                $('#present').addClass('hide');
            }
        }

        /**
         * 虚拟商品不支持退货信息显示
         */
        function initVirtual(data) {
            if (sessionStorage.type == "gouwuche") {
                for (var i = 0; i < data.length; i++) {
                    var coms = data[i].Coms;
                    for (var j = 0; j < coms.length; j++) {
                        if (coms[j].Type == 1) {
                            var obj = $('li[itemid="' + coms[j].ItemId + '"]');
                            if (obj.length) {
                                obj.find('.reserver-wrap').show();
                            }
                        }
                    }
                }
            } else {
                if (data[0].Coms && data[0].Coms[0].Type == 1) {
                    $('#reserver').show().text("此商品性质不支持7天退货");
                }
            }
        }

        //关税
        function updateDuty(num) {
            if (JsVilaDataNull(getQueryString("setMealId"))) {
                $("#duty").html(((window._Dutys.TotalDuty || 0) * num).toFixed(2));
            } else {
                $("#duty").html(((commodityUpInfo.Duty || 0) * num).toFixed(2));
            }
        }

        function updateDeliveryTime(dutyResult) {
            if (!dutyResult || !dutyResult.List) {
                return;
            }
            var deliveryTime = dutyResult.List[0].Coms[0].DeliveryTime;
            if (deliveryTime) {
                IsPresell = true;
                $("#reserver").show().text("[预售] 发货时间：" + deliveryTime);
            }
        }
    </script>
    <script>
        function initCreateOrder() {
            //商品直接购买控制数量加减
            ispinner({
                callbacks: function(el) {
                    var val = $(el.currentTarget).is("input") ? $(el.currentTarget).val() : $(el.currentTarget).find("input").val();
                    val = eval(val);
                    _commodityNum = val;
                    var valinput = $(el.currentTarget).is("input") ? $(el.currentTarget) : $(el.currentTarget).find("input");
                    if (JsVilaDataNull(getQueryString("setMealId"))) {
                        if (window._setMeal.Stock > 0) {

                            if (Number(commodityUpInfo.Specifications) > 0) {
                                //有规格的数量
                                var valNumber = 0;
                                valNumber = Number(val * commodityUpInfo.Specifications);
                                if (valNumber > window._setMeal.Stock) {
                                    toast("库存不足，最多可购买" + window._setMeal.Stock + "件");
                                }
                                val = val < window._setMeal.Stock ? val : window._setMeal.Stock;
                            } else {
                                if (val > window._setMeal.Stock) {
                                    toast("库存不足，最多可购买" + window._setMeal.Stock + "件");
                                }
                                val = val < window._setMeal.Stock ? val : window._setMeal.Stock;
                            }

                        }
                        if (window._setMeal.LimitBuyEach > 0) {
                            if (val > window._setMeal.LimitBuyEach) {
                                toast("每人限购" + window._setMeal.LimitBuyEach + "件");
                            }
                            val = val < window._setMeal.LimitBuyEach ? val : window._setMeal.LimitBuyEach;
                        }
                        valinput.val(val);
                        var spans = window._setMeal.SetMealItemsCdtos;
                        var sumPrice = 0;
                        for (var i = 0; i < spans.length; i++) {

                            $('#num_' + spans[i].CommodityId).text(val);
                            $('#price_' + spans[i].CommodityId + '_' + spans[i].ComdtyStockId).text(((spans[i].OPrice - spans[i].PreferentialPrice) * val).toFixed(2));
                            if ($('#price_' + spans[i].CommodityId + '_' + spans[i].ComdtyStockId).text() > 0) {
                                sumPrice += parseFloat($('#price_' + spans[i].CommodityId + '_' + spans[i].ComdtyStockId).text());
                            }
                        }
                        var totalprice = sumPrice.toFixed(2);
                        $(".totalprice").text(totalprice);
                        $('#AppSetMeal').text(totalprice);
                        setMealCount = val;
                        _isReloadScore = true;
                        updateDuty(val);
                        //件数减到1,或加到最大时不会再变化，也不需要再算运费。
                        calcFreight(_hasAddress, val);
                        if (getQueryString("setMealId") === null) {
                            updtePresent(val);
                        }
                    } else {
                        val = val < sessionStorage.Stock ? val : sessionStorage.Stock;
                        valinput.val(val);
                        if (commodityUpInfo.number == val) {
                            return;
                        }
                        setSessionStorage('commodityUpInfo', 'number', val);
                        commodityUpInfo.number = val;
                        $(el.currentTarget).parent().prev().find("span").eq(1).text("数量:" + val);
                        var totalprice = 0;
                        if (Number(commodityUpInfo.Specifications) > 0) {
                            //有规格的数量
                            totalprice = (commodityUpInfo.realPrice * val * commodityUpInfo.Specifications).toFixed(2);
                        } else {
                            totalprice = (commodityUpInfo.realPrice * val).toFixed(2);
                        }
                        $(".totalprice").text(totalprice);
                        _isReloadScore = true;
                        updateDuty(val);
                        //件数减到1,或加到最大时不会再变化，也不需要再算运费。
                        calcFreight(_hasAddress, 1);
                        if (getQueryString("setMealId") === null) {
                            updtePresent(val);
                        }
                    }
                }
            });
            //获取所有appid
            getAppIds();

            //拼团
            if (sessionStorage.type == "diygroup") {
                $("#activityInstruction").show();
                if (JsVilaDataNull(getQueryString("diyGroupId"))) {
                    sessionStorage.diyGroupId = getQueryString("diyGroupId");
                }
            }
            if (sessionStorage.ProductType == "appcjzy" || sessionStorage.ProductType == "webcjzy") {
                $("#selftakeli").show();
            }
            if (_selftaketoggle) {
                $("#selftaketoggle").addClass('active');
            }
            createOrder($('.content'));
            initEvent();
        }

        function initEvent() {
            var psource = sessionStorage.source == "share" ? "&source=share" : "";
            callbackurl = window.location.href;
            $("#goldpay").on('click', function(e) {
                setTimeout(function() {
                    if ($("#goldpay").is(".active")) {
                        goldpayToggleActive();
                    } else {
                        //行为记录->选择金币支付关
                        logBTP(sessionStorage.SrcType, service_type, "0x0021", sessionStorage.commodityId_2 || '');
                        $('#goldpw').hide();
                        hideDialog('#setPwdDialog');
                        hideDialog('#payDialog');
                        _pageCache.goldpay = 0;
                        sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
                    }
                    CalcPayPrice();
                }, 100);
            });
            $("#invoicetoggle").on('click', function(e) {
                setTimeout(function() {
                    if ($("#invoicetoggle").is(".active")) {
                        logBTP(sessionStorage.SrcType, service_type, "0x0026", '', logOrderId);
                        invoiceToggleActive();
                    } else {
                        $('#InvoiceMessage').hide();
                        logBTP(sessionStorage.SrcType, service_type, "0x0027", '', logOrderId);
                        _pageCache.needinvoice = 0;
                        sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
                    }
                }, 100);
            });
            $(".yj-coupon").on('click', '.toggle', function(e) {
                var _this = this;
                setTimeout(function() {
                    if ($(_this).is(".active")) {
                        $(_this).parents('.yj-coupon').find('.yj-coupon-message').show();
                    } else {
                        $(_this).parents('.yj-coupon').find('.yj-coupon-message').hide();
                    }
                }, 100);
            });
            $("#selftaketoggle").on('click', function(e) {
                $("#selftaketoggle").addClass('active');
                return false;
            });
            $("#selftakedesc").on("click", function() {
                document.location.href = urlAppendCommonParams("/Mobile/SelfTakeStationList");
            });
            $("#signScorePay").on('click', function(e) {
                setTimeout(function() {
                    if ($("#signScorePay").is(".active")) {
                        _pageCache.signScorePay = 1;
                    } else {
                        _pageCache.signScorePay = 0;
                    }
                    sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
                    CalcPayPrice();
                }, 100);
            });

            $("#InvoiceMessage").on("click", function() {
                logBTP(sessionStorage.SrcType, service_type, "0x0001", '', logOrderId);
                document.location.href = urlAppendCommonParams("/Mobile/InvoiceInfo?appIds=" + appIds);

            });
            $("#onlinePay").bind("click", function() {
                //行为记录选择在线支付
                logBTP(sessionStorage.SrcType, service_type, "0x0014", sessionStorage.commodityId_2 || '');

                if ($("#onlinePay").attr("checked")) {
                    $("#goldul").show();
                }
                CalcPayPrice();
            });


            //Start 跳转到地址编辑页面
            $(".dedev").bind("click", function() {
                var opa = "";

                if ($(".devk").html() != null && $(".devk").html() != "") {
                    opa = "add";
                    window.location.href = urlAppendCommonParams("/Mobile/AddDeliveryAddress?jcActivityId=" + getQueryString("jcActivityId") + "&setMealId=" + getQueryString("setMealId") + "&opa=" + opa + "&co=1");
                } else {
                    opa = "edit";
                    window.location.href = urlAppendCommonParams("/Mobile/DeliveryAddressList?jcActivityId=" + getQueryString("jcActivityId") + "&setMealId=" + getQueryString("setMealId") + "&opa=" + opa + "&co=1&addressid=" + $("#hiddaddressid").val());
                }
            });
            //End   跳转到地址编辑页面
            //点击设置支付密码
            $("#btnSetPwd").bind("click", function() {
                if ($.trim($("#txtSetPwd").val()) == "" || $.trim($("#txtNextPwd").val()) == "") {
                    return;
                }
                if ($.trim($("#txtSetPwd").val()) != $.trim($("#txtNextPwd").val())) {
                    toast("两次密码输入不一致");
                    return;
                }
                $("#zhifu").hide();

                getDataAjax({
                    url: '/Mobile/SetGoldPayPwd',
                    data: { userId: getUserId(), pwd: hex_md5($.trim($("#txtSetPwd").val())) },
                    callback: function(data) {
                        ajaxLoadingSingle.hide();
                        if (data.ResultCode == 1) {
                            $("#zhifu").show();
                            toast(data.Message);
                        } else {
                            hideDialog('#setPwdDialog');
                            showDialog('#payDialog');
                        }
                    },
                    beforeSend: function() {
                        ajaxLoadingSingle.show();
                    },
                    error: function() {
                        ajaxLoadingSingle.hide();
                    }
                });
            });
            //start 忘记密码
            $("#wangpwd").bind("click", function() {
                // 实例化
                var base64 = new Base64();
                // 给字符串加密
                window.location.href = "@ViewBag.FSPUrl" + "/PasswordProtect/GetPassQuestion?userId=" + getUserId() + "&sessionId=" + getSessionId() + "&ChangeOrg=00000000-0000-0000-0000-000000000000&token=12345678&clientType=web&callback=" + base64.encode(callbackurl + psource);
            });
            $("#activityLink").on("click", function() {
                window.location.href = urlAppendCommonParams("DiyGroupActivityRule");
            });
            $("#AppOrderPickUpName").on("blur", function() {
                var userSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
                userSelfTakeObj.PickUpName = $("#AppOrderPickUpName").val();
                sessionStorage.userSelfTake = JSON.stringify(userSelfTakeObj);
            });
            $("#AppOrderPickUpPhone").on("blur", function() {
                var phone = $(this).val();
                var userSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
                userSelfTakeObj.PickUpPhone = phone;
                sessionStorage.userSelfTake = JSON.stringify(userSelfTakeObj);
                if (phone != "") {
                    if (phone.length < 11) {
                        toast("请输入11位手机号");
                    }
                }
            });
            $("#selectAppSelfTake").on("click", function() {
                window.location.href = urlAppendCommonParams("/Mobile/SelfTakeStationList?stationId=" + _pageCache.appSelfTakeStationId);
            });
            $('.delivery > p').on('click', 'a', function() {
                location.reload();
                var index = $(this).index();
                $(this).addClass('current').siblings().removeClass('current');
                $('.delivery-info > ul').eq(index).show().siblings().hide();
                _appSelfTakeFlag = $(this).attr("data-selfTake");
                _pageCache.appSelfTakeFlag = _appSelfTakeFlag;
                sessionStorage.CreateOrderInfo = JSON.stringify(_pageCache);
            });
            $("#hdfk").bind("click", function() {
                //行为记录选择货到付款
                logBTP(sessionStorage.SrcType, service_type, "0x0015", sessionStorage.commodityId_2 || '');

                if ($("#hdfk").attr("checked")) {
                    $("#goldul").hide();

                }
                CalcPayPrice();
            });

            //确定维护四级地址
            $('.mk-confirm-confirm').on('click', function() {
                var par = "&type=" + sessionStorage.type + "&price=" + getQueryString('price') + "&co=1";
                window.location.href = urlAppendCommonParams("/Mobile/AddDeliveryAddress?opa=edit&addressid=" + $("#hiddaddressid").val() + par);
            });
            //赠品弹窗
            $('.mk-present-confirm').on('click', function() {
                var id = $('#present-dialog').data('tag');
                var appid = $('#present-dialog').data('appid');
                var ShopCartItemId = $('#present-dialog').data('shopcartid');
                removePresent(id, appid, ShopCartItemId);
                $('#' + id).remove();
                $('#present-dialog').addClass('hide');
            });
            $('.mk-present-cancel').on('click', function() {
                $('#present-dialog').addClass('hide');
            });
            $('.mk-present1-confirm').on('click', function() {
                $('#present-tips-dialog').addClass('hide');
                orderSubmit();
            });
            $('.mk-present1-cancel').on('click', function() {
                $('#present-tips-dialog').addClass('hide');
            });
            $('.mk-present2-confirm').on('click', function() {
                $('#present-tips2-dialog').addClass('hide');
            });
            $('#zhifu-modal').on('click','.item',function(){
                var isSelect = $(this).hasClass('active');
                if(!isSelect){
                    $(this).parent().find('.item.active').removeClass('active');
                    $(this).addClass('active');
                }
            })
        }

        //客户端直接进下订单页面，只传选中的城市，不传当前定位的城市。
        function initLbs() {
            var selectCityCode = getQueryString("selectCityCode");
            var selectCityName = "";
            if (JsVilaDataNull(selectCityCode)) {
                setCookie("selectCityCode", selectCityCode);

                var ai = getAreaInfoByCode(selectCityCode);
                if (JsVilaDataNull(ai)) {
                    setCookie("selectCityName", ai.Name);
                }
            }

            selectCityCode = getCookie('selectCityCode');
            var cityCode = getCookie('cityCode');
            if (!JsVilaDataNull(selectCityCode) || !JsVilaDataNull(cityCode)) {

                var mapObj = new AMap.Map('iCenter');
                mapObj.plugin(["AMap.CitySearch"], function() {
                    //实例化城市查询类
                    var citysearch = new AMap.CitySearch();
                    //自动获取用户IP，返回当前城市
                    citysearch.getLocalCity();
                    AMap.event.addListener(citysearch, "complete", function(result) {
                        selectCityCode = "110000";
                        selectCityName = "北京市";
                        if (result && result.city && result.bounds) {
                            var cityinfo = result.city;
                            var citybounds = result.bounds;
                            selectCityCode = getCityCode(cityinfo);
                            selectCityName = cityinfo;
                        }
                        if (!JsVilaDataNull(getCookie('cityCode'))) {
                            setSessionCookie("cityCode", selectCityCode);
                            setSessionCookie("cityName", selectCityName);
                        }
                        if (!JsVilaDataNull(getCookie('selectCityCode'))) {
                            setCookie("selectCityCode", selectCityCode);
                            setCookie("selectCityName", selectCityName);
                        }
                    });
                    AMap.event.addListener(citysearch, "error", function(result) { toast(result.info); });
                });
            }
        }

        function initLoadFile() {
            uploadImageArray = [];
            uploadImageArrayMobile = [];
            $("#add").val("");
            window.frames["uploadframe"].locatin = "about:blank";
            $("#preview > li").each(function() {
                if ($(this).attr("id") == "addPicli") {

                } else {
                    $(this).remove();
                }
            });
            if (sessionStorage.PicturesPathModel) {
                var list = sessionStorage.PicturesPathModel.split("|");
                for (var i = 0; i < list.length; i++) {
                    if (list[i].length > 0) {
                        uploadImageArray.push(list[i]);
                        preview(list[i]);
                    }
                }
            }
            if (sessionStorage.PicturesPathModelMobile) {
                var list = sessionStorage.PicturesPathModelMobile.split("|");
                for (var i = 0; i < list.length; i++) {
                    if (list[i].length > 0) {
                        uploadImageArrayMobile.push(list[i]);
                        uploadPic(list[i]);
                    }
                }
            }
            isload = false;
            //上传完成时
            document.getElementById('uploadframe').onload = function() {
                //if (document.readyState == 'complete') {
                try {
                    var doc;
                    if (navigator.userAgent.indexOf("MSIE") > 0) {
                        doc = document.getElementById('uploadframe').contentWindow.document;
                    } else {
                        doc = (document.getElementById('uploadframe').contentDocument || window.frames["uploadframe"].document);
                    }
                    if (doc && doc.body) {
                        if (doc.body.innerHTML.split('^')[0] == "0") {
                            toast(doc.body.innerHTML.split('^')[1]);
                        } else if (doc.body.innerHTML) {
                            preview(doc.body.innerHTML);
                        }
                    }
                } catch (err) {
                }
                loadingFrame.hide();
            };
        }
    </script>
    <script>
        function mobiscroll_change() {
            var selectDateTime = $('#demo_treelist_dummy').val();
            var selectArray = selectDateTime.split(" ");
            var dateIdex = selectArray[0];
            var timeIndex = selectArray[1];
            var dateItem = $("#demo_treelist>li:eq(" + dateIdex + ")");
            var timeItem = dateItem.find("ul>li:eq(" + timeIndex + ")");

            var dateInput = dateItem.find("input[name=ScrollDateValue]");
            var timeInput = timeItem.find("input[name=ScrollTimeValue]");
            var showText = dateInput.attr("data-text") + "   " + timeInput.attr("data-text");
            var userSelfTakeObj = JSON.parse(sessionStorage.userSelfTake);
            userSelfTakeObj.PickUpValue = dateIdex + "," + timeIndex;
            userSelfTakeObj.PickUpText = showText;
            userSelfTakeObj.AppOrderPickUpBookDate = dateInput.val();

            var timeArray = timeInput.val().split("|");
            userSelfTakeObj.AppOrderPickUpBookStartTime = timeArray[0];
            userSelfTakeObj.AppOrderPickUpBookEndTime = timeArray[1];

            sessionStorage.userSelfTake = JSON.stringify(userSelfTakeObj);
            $("#demo_datetime").val(showText);
        }

        $(function() {
            if (!JsVilaDataNull(sessionStorage.userLoginOut)) {
                saveContextDTOByUrl();
            }
            setPageSetting();
            uploadImageArray = [];
            uploadImageArrayMobile = [];
            shopItemTemplate = $("#divShopItemTemplate").html();
            commodityItemTemplate = $("#divCommodityItemTemplate").html();
            _contractTemplete = $("#divContractTemplate").html();

            if (JsVilaDataNull(getQueryString('shopId'))) {
                sessionStorage.appId = getQueryString('shopId');
            }
            if (JsVilaDataNull(getQueryString('type'))) {
                sessionStorage.type = getQueryString('type');
            }
            if (JsVilaDataNull(getQueryString('price'))) {
                sessionStorage.Price = getQueryString('price');;
            }
            if (JsVilaDataNull(getQueryString("distributorId"))) {
                sessionStorage.distributorId = getQueryString("distributorId");
            }
            //Andoroid直接进入此页面
            if (JsVilaDataNull(getQueryString('comInfo'))) {
                sessionStorage.commodityUpInfo = new Base64().decode(getQueryString('comInfo'));

                if (JsVilaDataNull(sessionStorage.commodityUpInfo)) {
                    commodityUpInfo = JSON.parse(sessionStorage.commodityUpInfo);
                    //兼容ios传参数错误。
                    if (commodityUpInfo.realPrice == undefined) {
                        commodityUpInfo.realPrice = commodityUpInfo.price;
                    }
                    if (JsVilaDataNull(commodityUpInfo.oldPrice)) {
                        commodityUpInfo.price = commodityUpInfo.oldPrice;
                    }
                    //comInfo中可能传的是小写的stock，而咱们的程序中用Stock。
                    if ((!JsVilaDataNull(commodityUpInfo.Stock))
                            && JsVilaDataNull(commodityUpInfo.stock)) {
                        commodityUpInfo.Stock = commodityUpInfo.stock;
                    }
                    if ((!JsVilaDataNull(commodityUpInfo.Stock))
                            && JsVilaDataNull(commodityUpInfo.stock)) {
                        commodityUpInfo.Stock = commodityUpInfo.stock;
                    }
                    if (!JsVilaDataNull(commodityUpInfo.orderType)) {
                        commodityUpInfo.orderType = 0;
                    }
                    if (!JsVilaDataNull(commodityUpInfo.CategoryId)) {
                        commodityUpInfo.CategoryId = null;
                    }
                    if (!JsVilaDataNull(commodityUpInfo.CategoryName)) {
                        commodityUpInfo.CategoryName = "";
                    }
                    if (JsVilaDataNull(commodityUpInfo.CommodityStockId)) {
                        commodityUpInfo.commodityStockId = commodityUpInfo.CommodityStockId;
                    }
                    sessionStorage.commodityUpInfo = JSON.stringify(commodityUpInfo);
                }
                if (commodityUpInfo.Stock > 0) {
                    sessionStorage.Stock = commodityUpInfo.Stock;
                }
                //兼容客户端直接访问该页面，获取不到库存情况。
                if (sessionStorage.Stock == undefined) {
                    sessionStorage.Stock = 10000;
                }
            } else if (JsVilaDataNull(sessionStorage.commodityUpInfo)) {
                commodityUpInfo = JSON.parse(sessionStorage.commodityUpInfo);

                //兼容ios传参数错误。
                if (commodityUpInfo.realPrice == undefined) {
                    commodityUpInfo.realPrice = commodityUpInfo.price;
                }
                if (!JsVilaDataNull(commodityUpInfo.CategoryId)) {
                    commodityUpInfo.CategoryId = null;
                }
                if (!JsVilaDataNull(commodityUpInfo.CategoryName)) {
                    commodityUpInfo.CategoryName = "";
                }
            }
            if (JsVilaDataNull(sessionStorage.CrowdfundingList)) {
                _crowdfundingList = JSON.parse(sessionStorage.CrowdfundingList);
            }
            if (JsVilaDataNull(getQueryString("setMealId"))) {
                //安卓优惠套装下订单页面
                if (sessionStorage.type == "gouwuche" && getQueryString("fromApp") == 1) {
                    jh && jh.setMealToOrder({
                        businessType: 1,
                        success: initSetMealDataFromApp
                    });
                } else {
                    initCreateOrder();
                }
            } else {
                if (sessionStorage.type == "gouwuche" && getQueryString("fromApp") == 1) {
                    jh && jh.shoppingCartToOrder({
                        businessType: 1,
                        success: initShoppingCartDataFromApp
                    });
                } else {
                    initCreateOrder();
                }
            }

            checkPanelAlert();

            @if (Jinher.AMP.BTP.UI.Util.MobileCookies.AppId == brainhoopAppId)
            {
            <text>
                if (sessionStorage.type == "gouwuche") {
                    $("#txtdetails").parent().prev().html('<span>备</span><span style="padding-left: 25px;">注</span>');
                }
            </text>
            }
        });
    </script>
    <script type="text/javascript">
        function checkPanelAlert() {
            $.ajax({
                type: "POST",
                url: "/Mobile/GetCreateOrderTip",
                datatype: "json",
                data: { appId: getEsAppId() },
                success: function (result) {
                    if (!result.success || !JsVilaDataNull(result.orderTip)) return;
                    openPanelAlert(result.orderTip);
                },
                error: function (err) {
                    //  toast("获取提示信息异常！");
                }
            });
        }

        function openPanelAlert(tip) {
            var base = $(".wx-pay");
            if (base && base.length <= 0) {
                base = $(".pay-submit");
            }
            $("#divPanelAlert").css("bottom", base.parent().height()).show();
            $("#divPanelAlert .con").html(tip);
        }

        function closePanelAlert() {
            $("#divPanelAlert").hide();
        }
    </script>
    <div class="panel-alert" id="divPanelAlert" style="display: none; z-index: 99999; position: fixed; max-width: 500px; left: inherit; top: inherit;">
        <span class="con"></span>
        <a href="javascript:void(0)" onclick=" closePanelAlert();return false; " class="close"></a>
    </div>
    <!--头部标题-->
    @*<header class="bar bar-nav" style="display: none;">*@
    <header class="" style="display: none;">
        <a class="icon icon-left-nav pull-left" style="display: none;"></a>
        <button class="btn pull-right" style="display: none;">分享有分成 </button>
        <h1 class="title">确认订单</h1>
    </header>
    <!--底部支付按钮-->
    @if (onlyWxPay)
    {
        <nav style="z-index: 999; bottom: 0; z-index: 999; border-bottom: 0; position: fixed; background-color: white; width: 100%;">
            <div class="wx-pay">
                <p style="color: #000">
                    实付款：<b class="money">@Currency()</b><b class="money payprice"></b>
                </p>
                <a class="weui-btn weui-btn_primary" id="submitorder" onclick=" submitOrder(); ">微信支付</a>
            </div>
        </nav>
    }
    else
    {
        <nav class="bar bar-tab" style="z-index: 999;">
            <div class="tab-item pay-cancal" style="padding-left: 15px; text-align: left; background-color: #fff;">
                <div class="h4" style="color: #333; font-family: 'Microsoft Yahei'; font-size: 14px;">
                    还需支付：<span style="padding-left: 5px; color: #dc2828;font-size: 12px;">@Currency()</span>
                    <span class="payprice" style="color: #e95045;font-size: 17px;"></span>
                    <span class="f-m-l10" style="display: none;">共1件</span>
                </div>
            </div>
            <a class="tab-item pay-submit" id="submitorder" onclick=" submitOrder(); ">提交订单 </a>
        </nav>
    }
    <!--底部地址信息 start-->
    <div class="bottom-address hide" id="bottomAddress"></div>
    <!--底部地址信息 end-->
    <!--内容-->
    <div class="content">
        <div class="myorder-detail">
            <!--7天无理由退货提示 start-->
            <div class="return-tips" style="display:none" id="Isnsupport">温馨提示：订单中含有不支持7天无理由退货的商品，请确认相关商品信息后提交订单</div>
            <!--7天无理由退货提示 end-->
            <!--配送信息-->
            <div class="delivery clearfix" style="display: none;">
                <span>配送方式：</span><p>
                    <a href="javascript:void(0);" id="commonWay" data-selftake="0" class="btn current">快递</a><a href="javascript:void(0);" id="selfTakeWay" data-selftake="1" class="btn">自提</a>
                </p>
            </div>
            <div class="delivery-info">
                <ul style="display: none;">
                    <li class="media dedev " style="color: black; cursor: pointer;">
                        <div>
                            <a class="f-mail" style="width: 100%; color: black;">
                                <div class="media-body">
                                    <input id="hiddphone" type="hidden" value="" />
                                    <div class="user-info">
                                        <span class="spusername">唐晓东</span>
                                        <span class="spphone">12345675645</span>
                                    </div>
                                    <div class="address-wrap">
                                        <img class="pic" src="/Content/Mobile/zuobiao.png">
                                        <div class="address-detail">
                                            <span class="sprovince">安徽省</span><span class="scity">安徽是</span><span class="sdistrict">大观区</span><span class="sStreet">城区</span><span class="spadress">sdfsdfsdfsdf</span>
                                        </div>
                                        <img class="angle-right" src="/Content/Mobile/yj-angle-right.png">
                                    </div>
                                </div>
                            </a>
                        </div>
                </ul>
                <ul class="table-view" style="display: none;">
                    <li class="table-view-cell form-control navigate-right">
                        <div id="selectAppSelfTake">
                            <a href="javascript:void(0)">
                                <span class="tableCell">自提点：</span>
                                <div class="address">
                                    <p><span id="StationName" style="font-size: 12px;"></span><span id="StationPhone"></span></p>
                                    <p id="StationAddressDetails"></p>
                                </div>
                            </a>
                        </div>
                    </li>
                    <li class="table-view-cell form-control">
                        <div class="form-group">
                            <span class="name tableCell">提货人：</span>
                            <input type="text" id="AppOrderPickUpName" placeholder="请输入提货人姓名" maxlength="20">
                        </div>
                    </li>
                    <li class="table-view-cell form-control">
                        <div class="form-group">
                            <span class="name tableCell">手机号：</span>
                            <input type="tel" id="AppOrderPickUpPhone" placeholder="请输入手机号" maxlength="11" pattern="[0-9]*" />
                        </div>
                    </li>
                    <li class="table-view-cell form-control">
                        <div class="form-group">
                            <span class="name tableCell">提货时间：</span>
                            <input type="text" placeholder="请选择提货时间" id="demo_datetime" readonly="readonly">
                            <input type="hidden" id="AppOrderPickUpBookDate" />
                            <input type="hidden" id="AppOrderPickUpBookStartTime" />
                            <input type="hidden" id="AppOrderPickUpBookEndTime" />
                            <ul id="demo_treelist"></ul>
                        </div>
                    </li>
                </ul>
            </div>
            <ul class="table-view" id="siglecom" style="border: 0;">
                <!--店铺标题-->
                @*<li class="table-view-cell media full-cell" style="padding: 8px 15px;">
                        <div class="media-body info-view expand">
                            <span style="color: #333; font-size:16px;font-family: 'Microsoft Yahei'">店铺名称</span>
                            <span style="color:#333;font-size: 13px;">0件</span>
                        </div>
                    </li>*@
                <li class="table-view-cell media full-cell" style="border:0;">
                    <div style="display: none;">
                        <span></span>
                        <hr />
                    </div>
                    <a>
                        <div class="media-object pull-left " style="position: relative; width: 70px; height: 70px; ">
                            <img class="compic" style="width: 70px; height: 70px;" src="">
                            <div class="selfTake noDisplay">
                                <img class="selfTakeImg" style="display: block; width: 70px;" src="/Images/selftake.png" alt="自提" />
                            </div>
                        </div>
                        <div class="media-body">
                            <b class="panicbuying-name "><span class="comName" style="font-family: 'Microsoft Yahei';"></span></b>
                            <p class="categoryProduct" style="line-height: 1.2; font-size: .7rem; font-family: 'Microsoft Yahei';"></p>
                            <p class="summary" style="line-height: 1.2; font-size: .7rem; font-family: 'Microsoft Yahei';">
                                <span></span>数量:<span class="span_number search" data-search-key="number"></span>
                                <input type="hidden" class="search price_make_1" data-search-key="price_1" value="1" />
                            </p>
                            <div class="tags" id="isAssurance" style="display:none"><span class="tag">7天退货</span></div>
                            <p class="sduty" style="line-height: 1.2; font-size: .7rem; font-family: 'Microsoft Yahei';"></p>
                            <p class="price" style="display:-webkit-box;display:-webkit-flex;display:flex;align-items: center;position: relative;bottom: unset;left: unset;right: unset">
                                <span class="comPrice" style="flex:1;-webkit-flex:1;padding-right: 8px; font-family: 'Microsoft Yahei';"></span>
                                <input type="number" min="1" max="9999" value="1" maxlength="3" class="ispinner" readonly="readonly" />
                            </p>
                        </div>
                    </a>
                </li>

                @*<li class="table-view-cell" style="height: 52px; padding-bottom: 0; padding-left: 15px;"><span style="position: relative; top: 6px; font-family: 'Microsoft Yahei';">商品数量：</span>
                        <p class="price" style="height: 37px;">
                            <input type="number" min="1" max="9999" value="1" maxlength="3" class="ispinner" readonly="readonly"/>
                        </p>
                        <span id="oneCommodityNum" class="pull-right f-heightlight"><span>0</span></span>
                    </li>*@

                <li class="table-view-cell full-cell crowli" style="display: none;">
                    <div>
                        <b class="f-heightlight">多购买多分红</b>
                        <br />
                        <span class="crowinfor" style="font-size: 0.7em; display: block; position: absolute; top: 37px; left: 10px; line-height: 1.2;"></span>
                        <br />
                        <a class="f-heightlight" id="crowdwin" href="javascript:void (0);">查看详情››</a>
                        <a class="f-heightlight" style="display: none;" href="#myModalexample">查看详情››</a>
                    </div>
                </li>
                <div id="reserver" class="reserver-wrap" style="display: none"></div>
                <div id="present" class="present-wrap hide"></div>
                <!--优惠券-->
                <li onclick="COUPON.chooseCoupon(this)" class="table-view-cell full-cell" style="padding-left: 15px; cursor: pointer; display: none; font-family: 'Microsoft Yahei'; color: #333; font-size: 14px;margin: 0 15px;padding: 10px 0!important;">优惠券<span class="pull-right spanCouponAmount push-right"><span>-￥<span id="spanCouponAmount">0</span></span><span class="notUseCoupon hide">不使用优惠券</span></span></li>

                <!--余额/加油卡支付 end-->
                <li class="shop-info-list" id="freightBar">
                    <span class="shop-info-list-title">配送方式</span>
                    <span class="shop-info-list-text"></span>
                    @*<img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">*@
                </li>
                @*<li class="table-view-cell media full-cell" style="padding-left: 0px; padding-right: 0px; display: flex; margin: 0px 15px; padding-bottom: 0px;">
                        <span style="font-size: 13px;color: #666;">留言：</span>
                        <textarea placeholder="选填，内容已和卖家协商确认" style="-webkit-flex: 1;flex:1;margin-bottom: -3px; height: 2rem; padding-top: 4px; line-height: 1;"></textarea>
                    </li>*@
                @*<li class="table-view-cell media full-cell">
                        <div class="dingdan">
                            <span>共0件商品&nbsp;&nbsp;&nbsp;小计:<span style="font-size:13px;color:#dc2828;"> ¥ </span><span style="font-size:14px;color:#dc2828;">0</span> </span>
                        </div>
                    </li>*@
            </ul>
            <div id="divShopCommoditys">
            </div>
            <div class="activity-instruction" id="activityInstruction" style="display: none;">
                <div class="instruction-head">
                    <span>活动说明</span><a href="javascript:void(0);" id="activityLink">查看更多&gt;</a>
                </div>
                <div class="steps" style="margin: 2px 0; line-height: 15px;">
                    <div class="step">
                        <div>
                            <div class="step-text">
                                选择<br>
                                心仪商品
                            </div>
                            <div class="triangle">
                            </div>
                            <div class="step-num">
                                1
                            </div>
                        </div>
                    </div>
                    <span>&gt;</span>
                    <div class="step active">
                        <div>
                            <div class="step-text">
                                支付开团<br>
                                或参团
                            </div>
                            <div class="triangle">
                            </div>
                            <div class="step-num">
                                2
                            </div>
                        </div>
                    </div>
                    <span>&gt;</span>
                    <div class="step">
                        <div>
                            <div class="step-text">
                                等待好友<br>
                                参团支付
                            </div>
                            <div class="triangle">
                            </div>
                            <div class="step-num">
                                3
                            </div>
                        </div>
                    </div>
                    <span>&gt;</span>
                    <div class="step">
                        <div>
                            <div class="step-text">
                                达到人数<br>
                                组团成功
                            </div>
                            <div class="triangle">
                            </div>
                            <div class="step-num">
                                4
                            </div>
                        </div>
                    </div>
                </div>
                <div class="activity-tip">

                </div>
            </div>
            <ul class="table-view" style="border: 0;">
                <!-- 易捷币抵现 （在易捷北京APP中开启）-->
                @*<li class="table-view-cell hide" style="display:none;font-family:'Microsoft Yahei'" id="yjb_balance">
                    <span style="margin-left: 15px;font-family: 'Microsoft Yahei';color:#333;font-size: 14px;">易捷币</span>
                    <span class="f-m-l10 badge2 badge-inverted" style="font-size: 10px;font-family: 'Microsoft Yahei';color: #666;">
                    有<span id="userYJBCount">0</span>易捷币，本单可用<span id="orderYJB">0</span>抵扣<span class="f-heightlight"></span><span class="f-heightlight" id="orderYJBAmount">0.00</span></span>
                        <div class="toggle" id="toggleYJB">
                            <div class="toggle-handle" style="margin-left: 0px;"></div>
                        </div>
                    </li> *@
                <!--油卡兑换券 （在易捷北京APP中开启）-->
                @*<li class="table-view-cell hide"><span style="margin-left: 15px; font-family: 'Microsoft Yahei'; color: #333; font-size: 14px;">油卡兑换券</span> <span style="padding-left: 10px; color: #e95045; font-size: 10px;">此福利不能与赠品、优惠券、易捷币同时享受~</span> </li>*@
                @if (!ViewBag.IsYJBJ)
                {
                    <li class="table-view-cell full-cell" style="padding-left: 15px; font-family: 'Microsoft Yahei'; font-size: 14px; color: #333;margin: 0px 15px;padding: 10px 0px !important;">
                        <span class="pull-right">
                            <span id="hdfkspan" class="f-inline-block f-m-r10" style="display: none;">
                                <input id="hdfk" type="radio" name="iCheck" />
                                <label class="text" for="hdfk">货到付款</label>
                            </span>
                            <span class="f-inline-block" style="padding-right: 15px;">
                                <input id="onlinePay" type="radio" name="iCheck" checked />
                                <label class="text" for="onlinePay">在线支付</label>
                            </span>
                        </span>
                        支付方式
                    </li>
                }
                @*<div id="divInvoice" style="display: none; padding: 0">
                        <li class="table-view-cell f-b-nb" style="padding-left: 15px; font-size: 14px; color: #333; font-family: 'Microsoft Yahei';">发票信息
                            <div class="toggle" id="invoicetoggle">
                                <div class="toggle-handle">
                                </div>
                            </div>
                        </li>
                        <li id="InvoiceMessage" class="table-view-cell full-cell" style="display: none; padding-bottom: 10px; padding-top: 10px;">
                            <a class="navigate-right"><span class="badge badge-inverted" id="invoiceTip">点击设置发票信息</span> 设置发票信息 </a>
                        </li>
                    </div>*@
            </ul>
            <!-- goldul-金币、代价券、金和积分-->
            <ul class="table-view" id="goldul" style="border:0;">
                <li id="payCouponLi" style="display: none;" class="table-view-cell">
                    <a class="navigate-right" onclick="usePayCoupon();" style="width: 100%; margin-left: 0;padding:10px 15px; color: #333; font-size: 14px; font-family: 'Microsoft Yahei';"><span class="badge badge-inverted" id="couponInfo">未使用</span>代金券 <span class="badge2 badge-negative">有<span id="paycouponCount">0</span>张可用</span> </a>
                </li>
                <li class="table-view-cell f-b-nb" style="display: none" id='signScore_balance'>
                    <span style="margin-left: 15px; color: #333; font-size: 14px; font-family: 'Microsoft Yahei';">积 分</span> <span class="f-m-l10 badge2 badge-inverted" style="vertical-align: middle; line-height: 1.6; font-family: 'Microsoft Yahei';">
                        有<span id="spanUserScore">0</span>积分<br />
                        <span id="spanActivedScore" style="display: none; font-family: 'Microsoft Yahei';">本单可用<span id="spanScoreUse">0</span>积分抵<span class="f-heightlight">@Currency()</span><span class="f-heightlight orderScoreAmount_3">0.00</span></span> <span id="spanNoScore" style="display: none;">积分不足以抵现</span> <span id="spanCannotScore" style="display: none;">本单不能使用积分抵现</span>
                    </span>
                    <div class="toggle" id="signScorePay">
                        <div class="toggle-handle">
                        </div>
                    </div>
                </li>

                <li class="table-view-cell f-b-nb" id='gold_balance' style="display: none;">
                    <span style="margin-left: 15px; color: #333; font-size: 14px; font-family: 'Microsoft Yahei';">金 币</span> <span class="f-m-l10 badge2 badge-inverted">可抵用金额 <span class="f-heightlight">@Currency()</span><span class="f-heightlight price_3" id="goldbalanceValue"></span></span>
                    <div class="toggle" id="goldpay">
                        <div class="toggle-handle">
                        </div>
                    </div>
                </li>

                <li class="table-view-cell full-cell" id="goldpw" style="display: none; padding-top: 0; margin-top: -15px;">
                    <div class="f-b-color1 f-txt-ac" id="payDialog" style="margin-top: 15px">
                        <label style="display: inline-block; width: 19%; padding-left: 15px; text-align: left; float: left; line-height: 2.5;"><span>密 码</span></label>
                        <span style="display: inline-block; width: 80%; float: left; height: 27px;">
                            <input type="password" id="txtpwd" style="" placeholder="请输入交易密码" />
                        </span>
                        <a id="wangpwd" style="text-decoration: none; display: inline-block; float: right; margin-right: 20px; margin-top: 12px; color: #a9a9a9;">忘记密码？</a>
                        <span style="clear: both;"></span>
                        <a href="javascript:void(0)" class="btn btn-negative" style="line-height: 1.4em; width: 30%; display: none;" onclick=" hideDialog('#payDialog'); ">取消</a>
                        <a id="btnsure" href="javascript:void(0)" class="btn btn-negative" style="line-height: 1.4em; width: 30%; display: none;">确认</a>
                    </div>
                    <div class="f-radius-2 f-b-color1 f-p-a10 f-txt-ac" id="setPwdDialog" style="padding: 10px 0;">
                        <div class="h5 f-m-a0" style="margin-top: 3px; text-align: left;">
                            为了您的虚拟资产安全，请先设置账户交易密码
                        </div>
                        <div style="margin-top: 7px; height: 21px; clear: both;">
                            <label style="float: left; text-align: left;"><span style="display: inline-block; margin-left: 5px;">密</span><span style="padding-left: 25px; display: inline-block;">码</span></label>
                            <span style="float: left; width: 80%">
                                <input type="password" id="txtSetPwd" style="width: 100%; text-indent: 7px;" placeholder="请设置账户交易密码" />
                            </span>
                        </div>
                        <div>
                            <label style="display: inline-block;">重复密码</label>
                            <span style="display: inline-block; width: 80%">
                                <input type="password" id="txtNextPwd" style="width: 100%; text-indent: 7px;" placeholder="请再次输入交易密码" />
                            </span>
                        </div>
                        <a href="javascript:void(0)" class="btn btn-negative" style="line-height: 1.4em; width: 30%;" onclick=" hideDialog('#setPwdDialog'); ">取消</a>
                        <a id="btnSetPwd" href="javascript:void(0)" class="btn btn-negative" style="line-height: 1.4em; width: 30%;">确认</a>
                    </div>
                </li>
            </ul>
            <!-- 易捷币抵现-->
            <ul class="table-view" id="yjbUl" style="border:0;">

                <!--油卡/易捷币 start-->
                @*<div class="shop-info-list" id="yjbBar" onclick="YJB.showYJBModal();">
                        <span class="shop-info-list-title">油卡/易捷币</span>
                        <div class="shop-info-list-text"></div>
                        <img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">
                    </div>*@
                <!--油卡/易捷币 end-->
                <!--跨店满减券 start-->
                <div id="hasStoreCoupon" class="shop-info-list hide" onclick="StoreCoupon.chooseStoreCoupon()">
                    <span class="shop-info-list-title">跨店满减券</span>
                    <div class="shop-info-list-text"></div>
                    <img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">
                </div>
                <div class="shop-info-list">
                    <span class="shop-info-list-title">跨店满减券</span>
                    <div class="shop-info-list-text"><span class="gray">无可用</span></div>
                    <img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">
                </div>
                <!--跨店满减券 end-->
                @if (ViewBag.IsYJBJ)
                {


                    <!--易捷抵用券 start-->
                    <div id="hasYJCoupon" class="shop-info-list hide" onclick="YJCOUPON.chooseYJCoupon()">
                        <span class="shop-info-list-title">易捷抵用券</span>
                        <!--<span class="unselect hide">请选择</span><span class="red">抵用券抵现 ￥28.8</span>-->
                        <div class="shop-info-list-text" id="yjCouponUseInfo"></div>
                        <img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">
                    </div>
                    <div id="noYJCoupon" class="shop-info-list hide">
                        <span class="shop-info-list-title">易捷抵用券</span>
                        <div class="shop-info-list-text"><span class="gray">无可用</span></div>
                        <img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">
                    </div>
                    <!--易捷抵用券 end-->

                    <!--易捷币 start-->
                    <li class="table-view-cell f-b-nb" id="yjb_balance" style="margin: 0 15px;padding: 10px 0!important;">
                        <span style=" font-family: 'Microsoft Yahei';font-size: 13px;color: #666;">易 捷 币</span>
                        <span class="f-m-l10 badge2 badge-inverted" style="vertical-align: middle; line-height: 1.6;font-size: 11px;color: #666;">
                            <span>您有易捷币 @Currency() </span>
                            <span id="userYJBCount">0</span>
                            <br />
                            <span style="font-family: 'Microsoft Yahei';">
                                本单可用易捷币抵现 <span class="f-heightlight">@Currency()</span>
                                <span class="f-heightlight" id="orderYJBAmount">0.00</span>
                            </span>
                        </span>
                        <div class="toggle" id="toggleYJB" style="">
                            <div class="toggle-handle" style="margin-left: 0px;">
                            </div>
                        </div>
                    </li>
                    <!--易捷币 end-->

                    <!-- 油卡兑换券 start-->
                    <li id="youkaUl" class="table-view-cell" style="margin: 0 15px;padding: 10px 0!important;">
                        <span style="font-family: 'Microsoft Yahei'; color: #666; font-size: 13px;">油卡兑换券</span>
                        <span style="padding-left: 10px; color: #e95045; font-size: 11px; font-family: 'Microsoft Yahei';">此福利不能与其他优惠同时享受~</span>
                    </li>
                    <!-- 油卡兑换券 end-->
                }

                <!--邀请人手机号 start-->
                <div id="Inviter" class="shop-info-list telphone hide">
                    <div class="shop-info-list-title">
                        <span>邀请人手机号</span>
                        <img class="icon" onclick="$('#telphone-dialog').removeClass('hide');" src="/Content/Mobile/wenhao.png">
                    </div>
                    <div class="shop-info-list-text"><input tye="tel" class="shop-info-list-input" placeholder="请输入手机号 非必填"></div>
                </div>
                <!--邀请人手机号 end-->

                <!--发票 start-->
                <div class="shop-info-list" id="invoiceBar" onclick="Invoice.openInvoicePage()">
                    <span class="shop-info-list-title">发票</span>
                    <div class="shop-info-list-text"><span class="unselect">暂不开发票</span></div>
                    <img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">
                </div>
                <!--发票 end-->
                <!--易捷卡 start-->
                <li id="YJCardSelect" style="display:none" class="table-view-cell">
                    <a class="navigate-right" style="width: 100%; margin-left: 0;padding:10px 15px; color:#333; font-size: 14px; font-family: 'Microsoft Yahei';">
                        <span class="badge badge-inverted" id="yjctip_R">选择使用</span>
                        易捷卡 <span class="badge2 badge-negative" style="display:none" id="yjctip_C">有<span id="yjctip_L">0</span>张可用</span>
                        <span id="yjctip_L1" class="badge2 badge-negative" style="display:none">已选<span id="yjctip_L2">0</span>张</span>
                    </a>
                </li>
                <!--易捷卡 end-->
                <!--余额/加油卡支付 start-->
                @*<div class="shop-info-list">
                        <span class="shop-info-list-title">余额/加油卡支付</span>
                        <div class="shop-info-list-text"><span class="unselect hide"></span><span class="red">余额支付：￥2.00</span></div>
                        <img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">
                    </div>*@
                <!--余额/加油卡支付 end-->
            </ul>

            <div class="table-view" style="border:0;">
                <div style="height: 40px; padding-left: 15px; border-bottom: 1px solid #e8e8e8; color: #333; font-size: 14px; font-family: 'Microsoft Yahei';">
                    付款详情
                </div>
                <ul style="margin-left: 15px;">
                    <li class="table-view-cell media  full-cell f-p-b0">
                        <div class="media-body info-view">
                            <span>商品金额</span> <span class="pull-right f-heightlight" style="color: #e95045;">@Currency()<span class="totalprice search" data-search-key="price_2" style="color: #e95045;"></span></span>
                        </div>
                    </li>
                    <li class="table-view-cell media  full-cell">
                        <div class="media-body info-view">
                            <span><span>运费</span></span><span class="pull-right f-heightlight" style="color: #e95045;">@Currency()<span id="freight" class="search" style="color: #e95045;">0.00</span></span>
                        </div>
                    </li>
                    <li class="table-view-cell media  full-cell" style='display: none;' id='dutyValueli'>
                        <div class="media-body info-view">
                            <span><span>关税</span></span><span class="pull-right f-heightlight" style="color: #e95045;">@Currency()<span id="duty" style="color: #e95045;">0.00</span></span>
                        </div>
                    </li>
                    <li class="table-view-cell media  full-cell" style='display: none;' id='goldValueli'>
                        <div class="media-body info-view">
                            <span>金币抵用</span><span class="pull-right f-heightlight" style="color: #e95045;">-@Currency()<span class="goldValue" style="color: #e95045;">0</span></span>
                        </div>
                    </li>
                    <li class="table-view-cell media  full-cell" style='display: none;' id='payCouponValueli'>
                        <div class="media-body info-view">
                            <span>代金券抵用</span><span class="pull-right f-heightlight" style="color: #e95045;">-@Currency()<span class="payCouponValue" style="color: #e95045;">0</span></span>
                        </div>
                    </li>
                    <li class="table-view-cell media  full-cell" style='display: none;' id='scoreValueli'>
                        <div class="media-body info-view">
                            <span>积分抵现</span><span class="pull-right f-heightlight" style="color: #e95045;">-@Currency()<span class="scoreValue" style="color: #e95045;">0</span></span>
                        </div>
                    </li>
                    <li class="table-view-cell media  full-cell" style='display: none;' id='yjCouponValueli'>
                        <div class="media-body info-view">
                            <span>易捷抵用券</span><span class="pull-right f-heightlight" style="color: #e95045;">-@Currency()<span class="yjCouponValue" style="color: #e95045;">0</span></span>
                        </div>
                    </li>
                    <li class="table-view-cell media  full-cell" style='display: none;' id='yjbValueli'>
                        <div class="media-body info-view">
                            <span>易捷币抵现</span><span class="pull-right f-heightlight" style="color: #e95045;">-@Currency()<span class="yjbValue" style="color: #e95045;">0</span></span>
                        </div>
                    </li>
                    <li class="table-view-cell media  full-cell" style='display: none;' id='payCouponValueUHli'>
                        <div class="media-body info-view">
                            <span>优惠券抵用</span><span class="pull-right f-heightlight" style="color: #e95045;">-@Currency()<span class="payCouponValueUH" style="color: #e95045;">0</span></span>
                        </div>
                    </li>

                    <li class="table-view-cell media  full-cell" style='display: none;' id='payYjcValueli'>
                        <div class="media-body info-view">
                            <span>易捷卡抵现</span><span class="pull-right f-heightlight" style="color: #e95045;">-@Currency()<span class="payYjcValueUH" style="color: #e95045;">0</span></span>
                        </div>
                    </li>

                </ul>
            </div>
            <ul class="table-view" id="ulDetails" style="border:0;display: none;">
                <li class="table-view-cell full-cell" style="padding: 11px 15px 9px 15px; height: 230px;">
                    @if (Jinher.AMP.BTP.UI.Util.MobileCookies.AppId == brainhoopAppId)
                    {
                        <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                            <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">邮</span><span style="padding-left: 25px; font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">箱</span></label>
                            <input type="text" id="txtdetails" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                        </div>
                    }
                    else if (appids.Contains(Jinher.AMP.BTP.UI.Util.MobileCookies.AppId.ToString()))
                    {

                        if (!string.IsNullOrEmpty(orderset.FirstField))
                        {
                            <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                                <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">@orderset.FirstField</span> </label>
                                <input type="text" id="FirstContent" co-tag="FirstContent" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                            </div>

                        }
                        if (!string.IsNullOrEmpty(orderset.SecondField))
                        {
                            <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                                <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">@orderset.SecondField</span> </label>
                                <input type="text" id="SecondContent" co-tag="SecondContent" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                            </div>
                        }
                        if (!string.IsNullOrEmpty(orderset.ThirdField))
                        {
                            <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                                <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">@orderset.ThirdField</span> </label>
                                <input type="text" id="ThirdContent" co-tag="ThirdContent" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                            </div>
                        }
                        <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                            <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">食</span> <span style="padding-left: 5px; font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">药</span> <span style="padding-left: 5px;">所</span> </label>
                            <input type="text" id="txtdetails" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                        </div>
                    }
                    else
                    {
                        if (!string.IsNullOrEmpty(orderset.FirstField))
                        {
                            <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                                <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">@orderset.FirstField</span> </label>
                                <input type="text" id="FirstContent" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                            </div>
                        }
                        if (!string.IsNullOrEmpty(orderset.SecondField))
                        {
                            <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                                <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">@orderset.SecondField</span> </label>
                                <input type="text" id="SecondContent" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                            </div>
                        }
                        if (!string.IsNullOrEmpty(orderset.ThirdField))
                        {
                            <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                                <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">@orderset.ThirdField</span> </label>
                                <input type="text" id="ThirdContent" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                            </div>
                        }
                        <div style="display: -webkit-box; -webkit-box-flex: 1; -webkit-box-align: center; -webkit-box-orient: horizontal;">
                            <label style="display: inline-block;"><span style="font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">备</span><span style="padding-left: 25px; font-family: 'Microsoft Yahei'; color: #333; font-size: 12px;">注</span></label>
                            <input type="text" id="txtdetails" data-search-key="text_5" class="f-m-a0 search" style="display: -webkit-box; -webkit-box-flex: 1; border-radius: 0 !important; margin-left: 10px; margin-right: 10px; font-family: 'Microsoft Yahei';" placeholder="" />
                        </div>
                    }
                    <!-- <span style="display: inline-block; width: 80%">
                        <input type="text" id="txtdetails" data-search-key="text_5" class="f-m-a0 search" style="width: 100%; border-radius: 0 !important; margin-left: 10px;font-family: 'Microsoft Yahei';" placeholder="" />
                    </span>-->
                </li>
                <li id="uploadFiles" class="table-view-cell full-cell" style="padding: 11px 15px 9px 15px; padding-bottom: 13px; display: none;">
                    <div style="width: 330px; height: 105px;" id="uploadFileCom">
                        <div>
                            <label style="display: inline-block;"><span>上传APP LOGO</span></label>
                        </div>
                        <div>
                            <form id="picForm" method="post" on enctype="multipart/form-data" target="uploadframe" action='/Handler/PhoneUploadHandler.ashx'>
                                <ul class="picture-list fn-clear" id="preview">
                                    <li id="addPicli">
                                        <a href="javascript:void(0);" class="btn_addPic">
                                            <span style="display: none;">上传</span>
                                            <input type="file" id="add" name="add" accept="image/jpg, image/jpeg, image/png, image/gif" class="filePrew" onchange=" uploadfun() " onclick=" PreClickOnPic('add') " />
                                        </a>
                                    </li>
                                </ul>
                            </form>
                        </div>
                    </div>
                    <div style="width: 330px; clear: both;" id="JhRentAgreement">
                    </div>
                </li>
            </ul>
            <!--<ul>
                <li style="padding: 11px 15px 9px 15px; height: 48px;"></li>
            </ul>-->
            <iframe id="uploadframe" name="uploadframe" style="display: none"></iframe>
        </div>
    </div>
    <div id="myModalexample" class="modal">
        <div class="bar bar-nav">
            <a class="icon icon-close pull-right" href="#myModalexample"></a>
            <h1 class="title">Modal</h1>
        </div>
        <div class="content">
            <p class="content-padded">The contents of my modal go here. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut.</p>
        </div>
    </div>
    @*店铺（应用）模板  <span class="pull-right icon-comments-alt contactOwner" co-tag="contactOwner" appid="{AppId}">联系卖家</span> *@
    <div id="divShopItemTemplate" style="display: none;">
        <div co-tag-appid="{AppId}">
            <ul class="table-view" style="border:0">
                <li class="table-view-cell media full-cell" style="padding: 8px 15px;">
                    <div class="media-body info-view expand">
                        <span style="color: #333; font-size:16px;font-family: 'Microsoft Yahei'">{AppName}</span>
                        <span style="color:#333;font-size: 13px;">{CommodityNum}件</span>
                    </div>
                </li>
                <li id="setMealInfo" class="table-view-cell media full-cell hide" style="padding: 8px 15px;">
                    <div class="media-body info-view expand">
                        <span style="color: #e95045; font-family: 'Microsoft Yahei'; border: 1px solid #e95045; padding: 0 6px; border-radius: 3px; font-size: 11px; line-height: 14px;">优惠套装 </span>
                        <span style="color: #999; padding-left: 10px;">{SetMealTheme}</span>
                    </div>
                </li>
                {CommoditysInShopHtml}

                <!--优惠券-->
                <li onclick="COUPON.chooseCoupon(this)" class="table-view-cell full-cell" style="padding-left: 15px; cursor: pointer; display: none; font-family: 'Microsoft Yahei'; color: #333; font-size: 14px;margin: 0 15px;padding: 10px 0!important;">优惠券<span class="pull-right spanCouponAmount push-right"><span>-￥<span co-tag="CouponAmountShop" id="spanCouponAmount">0</span></span><span class="notUseCoupon hide">不使用优惠券</span></span></li>

                <!--配送方式-->
                <div class="shop-info-list" class="freightBar">
                    <span class="shop-info-list-title">配送方式</span>
                    <span class="shop-info-list-text"></span>
                    @*<img class="shop-info-list-angle" src="/Content/Mobile/yj-angle-right.png">*@
                </div>

                <!--易捷币抵现 （在易捷北京APP中开启）-->
                @*            <li class="table-view-cell hide yjb" style="font-family:'Microsoft Yahei'">
                        <span style="margin-left: 15px;font-family: 'Microsoft Yahei';color:#333;font-size: 14px;">易捷币</span>
                    <span class="f-m-l10 badge2 badge-inverted" style="font-size: 10px;font-family: 'Microsoft Yahei';color: #666;">
                    有<span class="app_total">0</span>易捷币，本单可用<span class="app_canuse">0</span>抵扣<span class="f-heightlight">0.00</span></span>
                        <div class="toggle" style="" onclick="">
                            <div class="toggle-handle" style="margin-left: 0px;"></div>
                        </div>
                    </li>*@
                <!--油卡兑换券 （在易捷北京APP中开启）-->
                @*<li class="table-view-cell hide youka"><span style="margin-left: 15px; font-family: 'Microsoft Yahei'; color: #333; font-size: 14px;">油卡兑换券</span> <span style="padding-left: 10px; color: #e95045; font-size: 10px;"></span></li>*@
                @*<li class="table-view-cell media full-cell">
                        <div class="media-body info-view expand">
                            <p>
                                <span>运费</span><span class="pull-right">@Currency() <span co-tag="Freight"></span></span>
                            </p>
                        </div>
                    </li>*@
                <li class="table-view-cell media full-cell" style="padding-left: 0px; padding-right: 0px;display: -webkit-box;display: -webkit-flex;display: flex;margin: 0 15px;">
                    @if (Jinher.AMP.BTP.UI.Util.MobileCookies.AppId == brainhoopAppId)
                    {
                        <textarea placeholder="邮箱" co-tag="Details" style="margin-bottom: -3px; height: 2rem; padding-top: 4px; line-height: 1;"></textarea>
                    }
                    @*else if (Jinher.AMP.BTP.UI.Util.MobileCookies.AppId == foodAndDrugAppId)
                                    {

                        <textarea placeholder="食药所" co-tag="Details" style="margin-bottom: -3px; height: 2rem;
                            padding-top: 4px; line-height: 1;"></textarea>

                                    }*@
                    else
                    {
                        <span style="font-size: 13px;color: #666;">留言：</span>
                        <textarea placeholder="给商家留言,可不填" co-tag="Details" style="-webkit-flex: 1;flex:1;margin-bottom: -3px; height: 2rem; padding-top: 4px; line-height: 1;"></textarea>
                    }
                    <div style="display: {cfDisplay}" co-tag="CrowdfundingDiv">
                        <b class="f-heightlight">多购买多分红</b>
                        <br />
                        {CrowdfundingInfo}
                        <br />
                        <a class="f-heightlight" href="#myModalexample">查看详情››</a>
                    </div>
                </li>
                {AppUploadFile}
                <li id="nsetMeal" class="table-view-cell media full-cell">
                    <div class="dingdan">
                        <span>共{CommodityNum}件商品&nbsp;&nbsp;&nbsp;小计:<span style="font-size:13px;color:#dc2828;"> @Currency() </span><span co-tag="AppAmount" style="font-size:14px;color:#dc2828;">{AppAmount}</span> </span>
                    </div>
                </li>
                <li id="setMeal" class="table-view-cell media full-cell hide">
                    <span style="margin-left: 15px; margin-top: 5px; display: inline-block; color: #333; font-size: 14px; font-family: 'Microsoft Yahei';">套餐价：</span>
                    <span class="f-m-l10 badge2 badge-inverted"><span class="f-heightlight"></span><span class="f-heightlight price_3">@Currency()<span id="AppSetMeal"></span></span></span>
                    <p class="price" style="height: 37px;">
                        <div class="ispinner-box  ispinner-disable-left" style="float: right; margin-right: 15px;">
                            <a href="javascript:void(0)" class="minus">-</a><input type="number" min="1" max="9999" value="1" maxlength="3" class="ispinner" readonly="readonly" ispinner="true"><a href="javascript:void(0)" class="plus">+</a>
                        </div>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <div id="divCommodityItemTemplate" style="display: none;">
        <li class="table-view-cell media full-cell shopCartItem" commodityid="{Id}" itemid="{ShopCartItemId}">
            <a>
                <div class="media-object pull-left " style="position: relative; width: 70px; height: 70px;">
                    <img {srckey}="{Pic}" style="width: 70px; height: 70px;" />
                    <div class="selfTake" style="display: {SelfTakeDisplay}">
                        <img class="selfTakeImg" style="display: block; width: 70px;" src="/Images/selftake.png" alt="自提" />
                    </div>
                </div>
                <div class="media-body">
                    <b class="product">{Name}</b>
                    <p class="categoryProduct" style="line-height: 1.2; font-size: .7rem;">{CategoryName}</p>
                    <p class="summary" style="font-size: .7rem; margin-top: 5px;"><span style="overflow: hidden;">{SizeText}</span></span> </p>
                    <div class="tags isAssurance" style="display:none"><span class="tag">7天退货</span></div>
                    <p style="line-height: 1.2; font-size: .7rem; display: none"><span class="">关税: @Currency()</span><span class="itemDutyPrice"></span> </p>
                    <p class="price"><span>@Currency()</span><span id="price_{Id}_{CommodityStockId}">{RealPrice}</span><span>x{CommodityNumber}</span></p>
                    <input type="hidden" id="hid_num_{Id}_{CommodityStockId}" value="{CommodityNumber}" />
                </div>
            </a>
            <!--赠品模板-->
            <div class="present-wrap hide">

            </div>
            <div class="reserver-wrap" style="display: none">此商品性质不支持7天退货</div>
        </li>
    </div>
    <div id="divContractTemplate" style="display: none">
        <div style="vertical-align: middle; height: 22px;">
            <input type="checkbox" style="pointer-events: none; vertical-align: middle;" disabled="disabled" checked="checked" />
            <a style="vertical-align: middle; color: #000;" href="javascript:void(0)" onclick=" showAgreement('{Id}') ">金和APP平台租用协议（{Name}）</a>
        </div>
    </div>
    <input type="hidden" id="isEditM" value="" />
    <div id="mobiscrollListTemplate" style="display: none;">
        <ul>
            <li>
                {ScrollDateText}<input type="hidden" name="ScrollDateValue" value="{ScrollDateValue}" />
                <ul>
                    <li>{ScrollTimeText}<input type="hidden" name="ScrollTimeValue" value="{ScrollTimeValue}" /></li>
                </ul>
            </li>
        </ul>
    </div>
    <!--选择优惠券-->
    <div id="coupon-wrap" class="coupon-wrap hide">
        <div class="coupon-wrap-content">
            <div class="page-fixed">
                <div class="mk-header">
                    使用优惠券<a href="javascript:COUPON.closeCouponPage()" class="coupon-close"></a>
                </div>
                <div class="mk-navbar">
                    <div class="mk-navbar-list active">
                        <a href="javascript: void(0)">可用优惠券</a>
                    </div>
                    <div class="mk-navbar-list">
                        <a href="javascript: void(0)">不可用优惠券</a>
                    </div>
                </div>
            </div>
            <div class="content-tips">
                <span class="line"></span><span class="text">请选择优惠券</span> <span class="line line2"></span>
            </div>
            <div class="coupon-lists-wrap">
                <div id="coupon-lists-use"></div>
                <div class="no-use-coupon" onclick="COUPON.isUseCoupon() ">
                    <span id="is-use-coupon" class="icon pull-left"></span><span>不使用优惠券</span>
                </div>
            </div>
            <div id="coupon-lists-unuse" class="coupon-lists-wrap hide">
            </div>
        </div>
    </div>
    <!--选择跨店满减券的弹窗-->
    <div id="store-coupon-wrap" class="coupon-wrap hide">
        <div class="coupon-wrap-content">
            <div class="page-fixed">
                <div class="mk-header">
                    使用跨店满减券
                    <a href="javascript:StoreCoupon.closeCouponPage()" class="coupon-close"></a>
                </div>
                <div class="mk-navbar">
                    <div class="mk-navbar-list active">
                        <a href="javascript: void(0)">可用跨店满减券</a>
                    </div>
                    <div class="mk-navbar-list">
                        <a href="javascript: void(0)">不可用跨店满减券</a>
                    </div>
                </div>
            </div>
            <div class="content-tips">
                <span class="line"></span><span class="text">请选择跨店满减券</span> <span class="line line2"></span>
            </div>
            <div class="coupon-lists-wrap">
                <div class="coupon-lists-use"></div>
                <div class="no-use-coupon">
                    <span class="icon pull-left"></span><span>不使用跨店满减券</span>
                </div>
            </div>
            <div class="coupon-lists-wrap coupon-lists-unuse  hide"> </div>
        </div>
    </div>
    <!--完善四级地址弹窗-->
    <div id="confirm-wrap" class="mk-confirm-wrap hide">
        <div class="mk-confirm">
            <div class="mk-confirm-content">
                <div class="mk-confirm-message">地址体系已升级，请重新编辑收货地址~</div>
            </div>
            <div class="mk-confirm-bottom">
                <a href="javascript:void(0)" class="mk-confirm-btn mk-confirm-confirm">确定</a>
            </div>
        </div>
    </div>
    <!--删除赠品-->
    <div id="present-dialog" class="mk-confirm-wrap hide">
        <div class="mk-confirm">
            <div class="mk-confirm-content">
                <div class="mk-confirm-message">确认要删除当前赠品吗</div>
            </div>
            <div class="mk-confirm-bottom">
                <a href="javascript:void(0)" class="mk-confirm-btn mk-confirm-cancel mk-present-cancel">取消</a>
                <a href="javascript:void(0)" class="mk-confirm-btn mk-present-confirm">确定</a>
            </div>
        </div>
    </div>
    <!--赠品库存不足弹窗-->
    <div id="present-tips-dialog" class="mk-confirm-wrap hide">
        <div class="mk-confirm">
            <div class="mk-confirm-content">
                <div id="present-tips-title" class="mk-confirm-message"></div>
            </div>
            <div class="mk-confirm-bottom">
                <a href="javascript:void(0)" class="mk-confirm-btn mk-confirm-cancel mk-present1-cancel">取消</a>
                <a href="javascript:void(0)" class="mk-confirm-btn mk-present1-confirm">确定</a>
            </div>
        </div>
    </div>
    <!--赠品无库存不足弹窗-->
    <div id="present-tips2-dialog" class="mk-confirm-wrap hide">
        <div class="mk-confirm">
            <div class="mk-confirm-content">
                <div id="present-tips2-title" class="mk-confirm-message"></div>
            </div>
            <div class="mk-confirm-bottom">
                <a href="javascript:void(0)" class="mk-confirm-btn mk-present2-confirm">确定</a>
            </div>
        </div>
    </div>
    <!--选择易捷抵用券-->
    <div id="yj-coupon-wrap" class="coupon-wrap hide">
        #coupon-wrap
        <div class="coupon-wrap-content">
            <div class="page-fixed">
                <div class="mk-header">
                    使用易捷抵用券<a href="javascript:YJCOUPON.closeYjCouponPage()" class="coupon-close"></a>
                </div>
                <div class="mk-navbar">
                    <div class="mk-navbar-list active">
                        <a href="javascript: void(0)">可用券</a>
                    </div>
                    <div class="mk-navbar-list">
                        <a href="javascript: void(0)">不可用券</a>
                    </div>
                </div>
            </div>
            <div class="content-tips">
                <span class="line"></span><span class="text">请选择抵用券</span> <span class="line line2"></span>
            </div>
            <div class="yj-coupon-lists-wrap">
                <div id="yj-coupon-lists-use"></div>
                <div id="no-use-coupon" class="no-use-coupon hide" onclick="YJCOUPON.isUseYJCoupon()">
                    <span id="yj-is-use-coupon" class="icon pull-left"></span><span>不使用</span>
                </div>
                <div id="yj-btn" class="yi-coupon-btn hide" onclick="YJCOUPON.closeYjCouponPage()">确定</div>
            </div>
            <div id="yj-coupon-lists-unuse" class="yj-coupon-lists-wrap hide">

            </div>
        </div>
    </div>
    <!--已售罄的商品弹窗start-->
    <div id="sold-out-wrap" class="coupon-wrap" style="display: none">
        <div class="coupon-wrap-content sold-out-wrap">
            <div class="page-fixed">以下商品已售罄</div>
            <div class="sold-out-lists">
                <div class="item">
                    <div class="pic">
                        <img src="http://placehold.it/80x80">
                    </div>
                    <div class="right">
                        <div class="name">美国进口糖果 多姿乐美国进口糖果 多姿乐美国进口糖果 多姿乐美国进口糖果 多姿乐</div>
                        <div class="size">原味大包装</div>
                        <div class="price">￥9000</div>
                    </div>
                </div>
                <div class="item">
                    <div class="pic">
                        <img src="http://placehold.it/80x80">
                    </div>
                    <div class="right">
                        <div class="name">美国进口糖果 多姿乐</div>
                        <div class="size">原味大包装</div>
                        <div class="price">￥9000</div>
                    </div>
                </div>
            </div>
            <div class="sold-out-bottom">
                <a class="sold-out-btn" href="javascript:Basket.gotoBasket();">返回购物车</a>
                <a class="sold-out-btn bg-red" href="javascript:Basket.removeInvalidCommodity();">移除无货商品</a>
            </div>
        </div>
    </div>
    <!--已售罄的商品弹窗end-->
    <!--油卡/易捷币弹窗 start-->
    <div id="yjb-modal" class="yjb-content-wrap hide">
        <div class="yjb-content">
            <div class="page-fixed">
                <div class="mk-header">
                    油卡/易捷币<a href="javascript:YJB.hideYJBModal();" class="coupon-close"></a>
                </div>
            </div>
            <div class="yjb-content-lists-wrap">
                <div class="yjb-list border-bottom" id="yjb-youka">
                    <div class="item">
                        <span class="yjb-list-title">油卡兑换券</span>
                        <span class="yjb-list-pic"></span>
                    </div>
                    <div class="item-info">下单支付后即赠送￥<span id="yjb-user-youka-amount">0</span>油卡兑换券</div>
                </div>
                <div class="yjb-list" id="yjb-yjb">
                    <div class="item">
                        <span class="yjb-list-title">易捷币</span>
                        <span class="yjb-list-pic"></span>
                    </div>
                    <div class="item-info">您有易捷币￥<span id="yjb-user-amount">0</span>，本单可用易捷币抵现￥<span id="yjb-order-amount">0</span></div>
                </div>
                <div class="yjb-list" id="yjb-none">
                    <div class="item">
                        <span class="yjb-list-title">不使用该优惠</span>
                        <span class="yjb-list-pic"></span>
                    </div>
                </div>
            </div>
            <div class="yjb-bottom" onclick="YJB.confirmYJBModal()">确定</div>
        </div>
    </div>
    <!--油卡/易捷币弹窗 end-->
    <!--支付方式弹窗-->
    <div id="zhifu-modal" class="zhifu-content-wrap hide">
        <div class="zhifu-content">
            <div class="zhifu-content-header">
                <span class="name">请选择支付方式</span>
                <a href="javascript:void(0);" class="zhifu-close"></a>
            </div>
            <div class="zhifu-content-lists-wrap">
                <div class="info">需支付 <span class="price">￥<em class="number">317</em></span>元</div>
                <div class="item active">
                    <img class="pic" src="/Content/Mobile/weixinzhifu.png">
                    <span class="name">微信支付</span>
                    <span class="icon"></span>
                </div>
                <div class="item">
                    <img class="pic" src="/Content/Mobile/zhifubaozhifu.png">
                    <span class="name">支付宝</span>
                    <span class="icon"></span>
                </div>
                <div class="item">
                    <img class="pic" src="/Content/Mobile/yinlianzhifu.png">
                    <span class="name">银联支付</span>
                    <span class="icon"></span>
                </div>
            </div>
            <div class="zhifu-bottom">确认支付</div>
        </div>
    </div>
    <!--邀请人手机号填写错误弹窗/ 解释说明弹窗 start-->
    <div id="telphone-dialog" class="mk-confirm-wrap hide">
        <div class="mk-confirm">
            <div class="mk-confirm-content">
                <div class="mk-confirm-message">邀请人手机号是指中国石化销售有限公司北京石油分公司员工的联系方式，此项可不填，对您的订单不会有任何影响！</div>
            </div>
            <div class="mk-confirm-bottom">
                <a href="javascript:$('#telphone-dialog').addClass('hide');" class="mk-confirm-btn mk-telphone-confirm">确定</a>
            </div>
        </div>
    </div>
     <!--邀请人手机号填写错误弹窗/ 解释说明弹窗 end-->

    <!--易捷卡付款手机验证码start-->
    <div class="dialog" id="YjcPayDialog" style="z-index: 1101; display:none;">
        <div style="color: #666; font-size: 1em;" id="yjcPhone">

        </div>
        <div style="padding: 10px 0; position:relative">
            <input id="yjcValidate" name="" type="text" placeholder="请输入验证码" style="width: 100%; line-height: 2em; font-size: 1.2em;padding-right:85px">
            <input type="button" onclick="YJCard.GetValidateCode()" id="GetValidateCode" value="获取验证码" style="position:absolute; top:11px; right:0; padding:6px 8px; background-color:#fff; border:1px solid #ccc; border-radius:3px; font-size:12px; line-height:1; color:#333; width:80px;" />
        </div>
        <div style="text-align: center">
            <a href="javascript:void(0)" class="btn btn-large" style="line-height: 1.4em; width: 30%;" onclick="hideDialog('#YjcPayDialog');">取消</a>
            <a id="btnsure" href="javascript:void(0)" class="btn btn-danger btn-large" onclick="YJCard.Validate($('#yjcValidate').val())" style="line-height: 1.4em; width: 30%;">提交</a>
        </div>
    </div>
    <!--易捷卡付款手机验证码end-->



    <input type="hidden" id="hiddaddressid">
