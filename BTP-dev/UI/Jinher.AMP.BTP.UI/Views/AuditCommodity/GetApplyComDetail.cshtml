@using System.Collections.Generic
@using System.Web
@{
    ViewBag.Title = "商品详情";
    string NoCode = ViewBag.NoCode;
    string VideoName = ViewBag.VideoName;
    List<Jinher.AMP.BTP.Deploy.SecondAttributeDTO> Colorlist = ViewBag.Colorlist;
    List<Jinher.AMP.BTP.Deploy.SecondAttributeDTO> Sizelist = ViewBag.Sizelist;
    List<Jinher.AMP.BTP.Deploy.CustomDTO.CategorySDTO> categorylist = ViewBag.CategoryList;
    List<Jinher.AMP.BTP.Deploy.CustomDTO.CategorySDTO> innerCategorylist = ViewBag.InnerCategoryList;
    Jinher.AMP.BTP.Deploy.CustomDTO.CommodityAndCategoryDTO commodity = ViewBag.Commodity;

    List<Jinher.AMP.BTP.Deploy.CustomDTO.ColorAndSizeAttributeVM> AttributeList = ViewBag.AttributeList;
    //List<Jinher.AMP.BTP.Deploy.CustomDTO.FreightDTO> FreightList = ViewBag.FreightList;
    bool isCustomES = ViewBag.isCustomES;
    string selfTakeChk = "";
    int left = 0;
    string strleft = "";
    if (commodity != null)
    {
        selfTakeChk = commodity.IsEnableSelfTake == 0 ? "" : "checked='checked'";
        left = commodity.Picturelist.Count * 114;
        strleft = left + "px";
    }
}
@helper getUrlParam()
    { 
        string url = "flag=edit&commodityId=" + Request.QueryString["commodityId"].ToString();
        if (Request.QueryString["state"] != null)
        {
            url = url + "&state=" + Request.QueryString["state"].ToString();
        }
    @url;
}
<head>
    <!--<link href="/Scripts/ueditor_mini/dialogs/video/video.css" type="text/css" rel="stylesheet" />-->
    <link href="/Scripts/ueditor_mini/themes/default/css/umeditor.min.css" type="text/css"
        rel="stylesheet" />
    <link href="/Scripts/ueditor_mini/dialogs/image/image.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="/Scripts/ueditor_mini/umeditor.config.js"></script>
    <script type="text/javascript" src="/Scripts/ueditor_mini/umeditor.min.js"></script>
    <script type="text/javascript" src="/Scripts/ueditor_mini/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript" src="/Scripts/ueditor_mini/dialogs/link/link.js"></script>
    <script type="text/javascript" src="/Scripts/ueditor_mini/dialogs/image/image.js"></script>
    <link rel="stylesheet" type="text/css" href="/Content/default/jquery.ui.jhtablebox.css" />
     <!--弹出选择框使用-->
    <script type="text/javascript" src="/Scripts/jquery.watermark.js"></script>
    <script type="text/javascript" src="/Scripts/TableBox/jquery.ui.jhtablebox.js"></script>
    <script type="text/javascript" src="/Scripts/Validator/JValidator.js"></script>
    <script type="text/javascript" src="/Scripts/uploadify/jquery.uploadify.min.js"></script>
    <style type="text/css">
    .txtColor{ color : #8c94a9;}
    .floa2 h1,
		.floa1 h1,
		.floa11 h1,
		.bbtn h1{
			font-size: 14px;
			color: #8c94a9;
			padding-bottom: 5px;
			border-bottom: 1px solid #DDDDDD;	
		}
		.close{
			margin-top: 10px;
			float: right;
			display: inline-block;
			*zoom:1;
			*display: inline;
			width: 7px;
			height: 7px;
			color:transparent;
			background: url(/Images/shut.png) center no-repeat;
		}
		.floa11 ul,
		.floa1 ul,
		.floa2 ul {
			padding: 0px 0 10px 10px;
		}
		.floa11 ul li,
		.floa1 ul li
		.floa2 ul li{
			margin-top: 5px;
			color:#8c94a9;
		}
		.addfloa2{
			display: none; 
			z-index: 3;
			padding: 5px 10px;
			height:auto;
			border:1px solid #B8BFCF;
			
			-webkit-border-radius: 3px;
			-moz-border-radius: 3px;
			border-radius: 3px;
		}
		.btn120 {
			display: inline-block;
			width: 120px;
			height: 28px;
			line-height: 28px;
			background: url(../Content/default/images/btn120.png) no-repeat;
			text-align: center;
			vertical-align: middle;
			color: #5F7392;
			box-shadow: 1px 1px 2px #DBDBDB;
		}
	   .createtable {  
            border: 1px solid #B1CDE3;  
            padding:0;   
            margin:0 auto;  
            border-collapse: collapse;  
            width:100%;
        }  
          
     .createtable td {  
            border: 1px solid #B1CDE3;  
            background: #fff;  
            font-size:12px;  
            padding: 3px 3px 3px 8px;  
            color: #4f6b72;  
        } 
            #batchUploadA:hover
        {
            color:#007fff;
            text-decoration:underline;
        }
         #batchUploadA
        {
            color:#2f94ff;
             text-decoration:underline;
        }
         .uploadify {
    box-shadow: 1px 1px 2px #dbdbdb;
    color: #5f7392;
    display: inline-block;
    height: 28px;
    line-height: 28px;
    text-align: center;
    vertical-align: middle;
    width: 120px;
}
.uploadify-button, .uploadify-button-text {
    text-indent: 0 !important;
}
.spa span{
    margin: 0;
}

/*********************商品SKU图片*********************/
.spfb_t_r {
    margin-left: -500px;
}
.comSKUPic{
    position: relative;
    top:0;
    left:0;
}
.comSKUPic span {
    margin-left:0px;
    color: #007fff;
    text-decoration: underline;
}
.comSKUPic object {
    margin-left:-30px;
}
.createtable .uploadify{
    box-shadow: none;
}
.createtable .uploadify-button{
    background-image: none!important;
}
.createtable .comSKUPic .del{
    position: absolute;
    top: -5px;
    left: 50%;
    margin-left: 30px;
    background: #555;
    color: #fff;
    border-radius: 50%;
    width: 16px;
    height: 16px;
    font-size: 12px;
    line-height: 14px;
    text-decoration: none;
}

.uploadify-queue {
    margin-bottom: 1em
}

.uploadify-queue-item {
    background-color: #F5F5F5;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    font: 11px Verdana,Geneva,sans-serif;
    margin-top: 5px;
    max-width: 350px;
    padding: 10px
}

.uploadify-queue-item .cancel a {
    background: url('/Images/uploadify-cancel.png') 0 0 no-repeat;
    float: right;
    height: 16px;
    text-indent: -9999px;
    width: 16px
}

.uploadify-queue-item.completed {
    background-color: #E5E5E5
}

.uploadify-progress {
    background-color: #E5E5E5;
    margin-top: 10px;
    width: 100%
}

.uploadify-progress-bar {
    background-color: #09F;
    height: 3px;
    width: 1px
}

.uploadify-error {
    background-color: #FDE5DD!important
}

#tabContainer{
    margin: 0 auto;
}

ul.tabs{
    margin: 0px;
    padding: 0px;
    list-style: none;
}
ul.tabs li{
    background: none;
    color: #222;
    display: inline-block;
    padding: 10px 15px;
    cursor: pointer;
}

ul.tabs li.current{
    background: #ededed;
    color: #222;
}

.tab-content{
    display: none;
    background: #ededed;
    padding: 15px;
}

.tab-content.current{
    display: inherit;
}
.breadcrumb
        {
            padding: 10px;
            line-height: 15px;
            font-size: 14px;
            border-bottom: 1px solid #e8e8e8;
        }
        .breadcrumb > span + span
        {
            padding-left: 5px;
        }
        .breadcrumb .back
        {
            float: right;
            color: #7e7e7e;
        }
        .breadcrumb .back img
        {    
            height: 17px;
            width:17px;
            vertical-align: middle;
            margin-bottom: 3px;
            border:0px;
        }
    </style>
    <script type="text/javascript">
        var freightList = JSON.parse('@Html.Raw(ViewBag.FreightList)');
        //关联商品确定时，回调
        function commodityListFrame(ret) {
            $("#commodityListFrame").jhtablebox("close");
            $("#commodityListFrame").removeAttr("src");
            if (ret && ret.code) {
                var CommodityIds = $("#CommodityIds");
                var str = deleteNumber(ret.code, true);
                var newValue = deleteNumber(str.join(','), true);
                CommodityIds.val(newValue.join(','));
                $("#num").text("已选" + newValue.length + "件");
            }
            else if (ret.code == "") {
                var CommodityIds = $("#CommodityIds");
                CommodityIds.val("");
                $("#num").text("已选0件");
            }
        }
        $(function () {
            $("#comdtyPicBtn").hide();
            initUplodaImg();
            initUplodaCommodityListPic();
            $('#changecategory').attr('href', '/Category/EsNetIndex?callBack=' + encodeURIComponent(window.location.href));
            $('#changeInnerCategory').attr('href', '/InnerCategory/EsNetIndex?callBack=' + encodeURIComponent(window.location.href));     

            if (getQueryString("state") == 0) {
                $("#btnSubmit").text("发布");
            }
            if ($("#VideoName").html()) {
                $("#deleVideo").show();
            }
            var str = deleteNumber($("#CommodityIds").val(), true);
            $("#num").html(str.length + "件")

            //设置类目、尺寸、颜色复选框的选中状态 begin
            //            var attrValues = cateogryIdList + "," + sizeIdList + "," + colorIdList;
            //            var attrArray = attrValues.split(",");
            var attrArray = [];
            attrArray = attrArray.concat(cateogryIdList.split(','), innerCateogryIdList.split(','),
                $.trim($("#commoditysize").val()).split(','),
                $.trim($("#commoditycolor").val()).split(','));
            var attrLen = attrArray.length;
            var sourceObj = $("#categoryDiv input[type='checkbox'],#sizeDIV input[type='checkbox'],#colorDIV input[type='checkbox'], #innerCategoryDiv input[type='checkbox']");
            for (var i = 0; i < attrLen; i++) {
                var val = attrArray[i];
                if (val != "") {
                    sourceObj.each(function () {
                        if (this.value == val || $(this).nextAll('span').text().toLocaleLowerCase() == val.toLocaleLowerCase()) {
                            this.checked = true;
                        }
                    });
                }
            } //end
            $("#commoditycategory,#commoditysize,#commoditycolor").focus(function () {
                if (this.value == '请选择') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请选择';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请选择') {
                    $(this).addClass("txtColor");
                }
            });
            $("#commoditycode").focus(function () {
                var noCode = this.value;
                var $span = $(this).next();
                if (noCode.length >= 30) {
                    $span.html("最多可输入30位字符");
                } else {
                    $span.html("");
                }
            }).keyup(function () {
                var noCode = this.value;
                var $span = $(this).next();
                if (noCode.length >= 30) {
                    $span.html("最多可输入30位字符");
                } else {
                    $span.html("");
                }
            }).blur(function () {
                var noCode = this.value;
                var $span = $(this).next();
                var oldCode = $("#hid_code").val();
                if (noCode != '') {
                    if (oldCode == noCode) {
                        $span.html("");
                        return;
                    }
                    $.ajax({
                        url: '/Commodity/IsExistsNoCode',
                        type: 'post',
                        async: true,
                        dataType: "json",
                        data: { noCode: noCode, appId: '@ViewBag.AppId' },
                        error: function () {
                            $("#ajaxLoadBlind").remove();
                            alert("请求错误，请稍后刷新进行操作.");
                        },
                        success: function (msg) {
                            $("#ajaxLoadBlind").remove();
                            if (msg.ResultCode == 1) {
                                $span.html("商品编号不能重复，该编号已存在");
                                return;
                            }
                            $span.html("");
                        },
                        beforeSend: function () {
                            ajaxLoading('1', '');
                        }
                    });
                }
            });
            if ('@isCustomES'.toLowerCase() == 'false') {
                $("#commodityname").focus(function () {
                    if (this.value == '最多30个字') {
                        this.value = '';
                        $(this).removeClass("txtColor");
                    }
                }).blur(function () {
                    if (this.value == '') {
                        this.value = '最多30个字';
                        $(this).addClass("txtColor");
                    }
                    updateRight();
                }).each(function () {
                    if (this.value == '最多30个字') {
                        $(this).addClass("txtColor");
                    }
                });
            } else {
                $("#commodityname").focus(function () {
                    if (this.value == '最多60个字') {
                        this.value = '';
                        $(this).removeClass("txtColor");
                    }
                }).blur(function () {
                    if (this.value == '') {
                        this.value = '最多60个字';
                        $(this).addClass("txtColor");
                    }
                    updateRight();
                }).each(function () {
                    if (this.value == '最多60个字') {
                        $(this).addClass("txtColor");
                    }
                });
            }

            $("#commoditymarketprice").focus(function () {
                if (this.value == '请输入正数最多两位小数') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请输入正数最多两位小数';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请输入正数，最多两位小数') {
                    $(this).addClass("txtColor");
                }
            });
            $("#commodityprice").focus(function () {
                if (this.value == '请输入正数最多两位小数') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请输入正数最多两位小数';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请输入正数，最多两位小数') {
                    $(this).addClass("txtColor");
                }
            });
            $("#costPrice").focus(function () {
                if (this.value == '请输入正数最多两位小数') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请输入正数最多两位小数';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请输入正数，最多两位小数') {
                    $(this).addClass("txtColor");
                }
            });
            $("#commodityduty").focus(function () {
                if (this.value == '请输入正数最多两位小数') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请输入正数最多两位小数';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请输入正数，最多两位小数') {
                    $(this).addClass("txtColor");
                }
            });
            $("#commodityTaxRate").focus(function () {
                if (this.value == '请输入正数最多两位小数') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请输入正数最多两位小数';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请输入正数，最多两位小数') {
                    $(this).addClass("txtColor");
                }
            });
            $("#commoditystock").focus(function () {
                if (this.value == '请输入非负整数') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请输入非负整数';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请输入非负整数') {
                    $(this).addClass("txtColor");
                }
            });
            $("#commodityWeight").focus(function () {
                if (this.value == '请输入正数') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请输入正数';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请输入正数') {
                    $(this).addClass("txtColor");
                }
            });

            //start 相关商品
            $("#relationcom").bind("click", function () {
                var url = "/Commodity/RelationCommodityList?CommodityId=" + $("#commodityId").val() + "&CommodityIdList=" + $("#CommodityIds").val();
                $("#commodityListFrame").attr("src", url);
                $("#commodityListFrame").jhtablebox({
                    height: 750,
                    width: 910,
                    resizable: false,
                    title: "选择部分上架商品",
                    modal: true,
                    buttons: {},
                    autoOpen: true,
                    closedByHide: true
                });
                $("#commodityListFrame").attr("width", "910");
                $("#commodityListFrame").css("width", "910px");
            });
            //end 相关商品

            $("input[name=rdoPriceMethod]").change(function () {
                switch ($("input[name=rdoPriceMethod]:checked").attr("value")) {
                    case "0":
                        $("#liWeight").hide();
                        $("#commodityWeight").val('请输入正数').next().html("kg").css('color', '');
                        $("#commodityWeight").addClass("txtColor");
                        break;
                    case "1":
                        $("#liWeight").show();
                        break;
                    default:
                        break;
                }
                resetFreight();
            });
            if ($("input[name=rdoPriceMethod]:checked").attr("value") == 1) {
                $("#liWeight").show();
            }
            resetFreight();
        });
        //重置运费
        function resetFreight() {
            $("#commodityFreight").empty().append($("<option>").val("-1").text("请选择物流模板"));
            if (freightList && freightList.length > 0) {
                for (var i = 0; i < freightList.length; i++) {
                    if (freightList[i].ExpressType == 1 || freightList[i].PricingMethod == $("input[name=rdoPriceMethod]:checked").attr("value"))
                        $("#commodityFreight").append($("<option>").val(freightList[i].Id).text(freightList[i].Name));
                }
            }
        }

        var cateogryIdList = "@commodity.CategoryIds";
        var categoryNameList = "";

        var innerCateogryIdList = "@commodity.InnerCategoryIds";
        var innerCategoryNameList = "";

        var sizeIdList = "";
        var sizeNameList = "";

        var colorIdList = "";
        var colorNameList = "";

        function setCommodityCategory() {
            var id = [];
            var text = [];
            $('#tcategoryUl').find('input:checked').each(function () {
                id.push(this.value);
                text.push($(this).nextAll('span').text());
            });

            $('#commoditycategory').val(text);
            $('#cateogryIdList').val(id);
        }

        @if(ViewBag.IsYJBJ)
        {
        <text>
        function setInnerCommodityCategory() {
            var id = [];
            var text = [];
            $('#tinnerCategoryUl').find('input:checked').each(function () {
                id.push(this.value);
                text.push($(this).nextAll('span').text());
            });

            $('#commodityInnerCategory').val(text);
            $('#innerCateogryIdList').val(id);
        }
        </text>
        }
        
        function toCheckSelected() {
            cateogryIdList = "";
            categoryNameList = "";
            $("#tcategoryUl input:checkbox:checked").each(function () {
                cateogryIdList = cateogryIdList + "," + $(this).val();
                categoryNameList = categoryNameList + "," + $(this).next().text();
            });
            if (cateogryIdList.length > 0) {
                cateogryIdList = cateogryIdList.substring(1, cateogryIdList.length);
                categoryNameList = categoryNameList.substring(1, categoryNameList.length);
            }
            $("#commoditycategory").val(categoryNameList).removeClass("txtColor");

            toInnerCategoryCheckSelected();
        }

        function toInnerCategoryCheckSelected() {
            innerCateogryIdList = "";
            innerCategoryNameList = "";			
            $("#tinnerCategoryUl input:radio:checked").each(function () {
                innerCateogryIdList = innerCateogryIdList + "," + $(this).val();
                innerCategoryNameList = innerCategoryNameList + "," + $(this).next().text();
            });
            if (innerCateogryIdList.length > 0) {
                innerCateogryIdList = innerCateogryIdList.substring(1, innerCateogryIdList.length);
                innerCategoryNameList = innerCategoryNameList.substring(1, innerCategoryNameList.length);
            }
            
        }

        function toCheckSizeSelected() {
            sizeIdList = "";
            sizeNameList = "";
            $("#sizeUl input:checkbox:checked").each(function () {
                sizeIdList = sizeIdList + "," + $(this).val();
                sizeNameList = sizeNameList + "," + $(this).next().text();
            });
            if (sizeIdList.length > 0) {
                sizeIdList = sizeIdList.substring(1, sizeIdList.length);
                sizeNameList = sizeNameList.substring(1, sizeNameList.length);
            }
            $("#commoditysize").val(sizeNameList);
            $("#commoditysize").removeClass("txtColor");
            updateRight();
        }

        function toCheckColorSelected() {
            colorIdList = "";
            colorNameList = "";
            $("#colorUl input:checkbox:checked").each(function () {
                colorIdList = colorIdList + "," + $(this).val();
                colorNameList = colorNameList + "," + $(this).next().text();
            });
            if (colorIdList.length > 0) {
                colorIdList = colorIdList.substring(1, colorIdList.length);
                colorNameList = colorNameList.substring(1, colorNameList.length);
            }
            $("#commoditycolor").val(colorNameList);
            $("#commoditycolor").removeClass("txtColor");
            updateRight();
        }

        function closeCategoryDiv() {
            $("#categoryDiv").hide();
        }

        @if(ViewBag.IsYJBJ)
        {
        <text>
        function closeInnerCategoryDiv() {
            $("#innerCategoryDiv").hide();
        }
        </text>
        }
        function closeSzieDIV() {
            $("#sizeDIV").hide();
        }
        function closeColorDIV() {
            $("#colorDIV").hide();
        }


        $(document).ready(function () {
            //调用父窗口方法，更新布局。
            window.top.refreshLayout && window.top.refreshLayout();
            $("#commoditymarketprice").blur(function () {
                var $span = $(this).next();
                var val = $.trim(this.value);
                $span.css("color", "red");
                if (val == "" || val == "请输入正数最多两位小数") {
                    $span.html(getCurrency());
                    $span.css("color", "");
                    return;
                }
                if (!/^\d+(\.\d{2})?$/.test(val)) {
                    if (!/^\d+(\.\d{1})?$/.test(val)) {
                        $span.html("请填写正确的市场价最多保留2位小数");
                        return;
                    }
                }
                val = parseFloat(val);
                if (val < 0) {
                    $span.html("市场价必须大于等于0");
                    return;
                }
                if (val < parseFloat($.trim($("#commodityprice").val()))) {
                    $span.html("市场价不得小于商品现价");
                    return;
                }
                $span.html(getCurrency());
                $span.css("color", "");
            });

            $("#commodityprice").blur(function () {
                var $span = $(this).next();
                var val = $.trim(this.value);
                $span.css("color", "red");
                if (val == "") {
                    $span.html("商品价格不能为空");
                    return;
                }
                if (!/^\d+(\.\d{2})?$/.test(val)) {
                    if (!/^\d+(\.\d{1})?$/.test(val)) {
                        $span.html("请填写正确的价格最多保留2位小数");
                        return;
                    }
                }
                val = parseFloat(val);
                if (val < 0) {
                    $span.html("价格必须大于等于0");
                    return;
                }
                if (val > parseFloat($.trim($("#commoditymarketprice").val()))) {
                    $("#commoditymarketprice").next().css("color", "red").html("市场价不得小于商品现价");
                } else {
                    $("#commoditymarketprice").next().css("color", "").html(getCurrency());
                }
                $span.html("");
                $span.css("color", "");
            });


            @if(ViewBag.IsYJBJ)
            {
            <text>
            $("#costPrice").blur(function () {
                var $span = $(this).next();
                var val = $.trim(this.value);
                $span.css("color", "red");
                if (val == "") {
                    $span.html("进货价不能为空");
                    return;
                }
                if (!/^\d+(\.\d{2})?$/.test(val)) {
                    if (!/^\d+(\.\d{1})?$/.test(val)) {
                        $span.html("请填写正确的进货价，最多保留2位小数");
                        return;
                    }
                }
                val = parseFloat(val);
                if (val < 0) {
                    $span.html("进货价必须大于等于0");
                    return;
                }
                $span.html("");
                $span.css("color", "");
            });
            </text>
            }

            $("#commoditystock").blur(function () {
                var $span = $(this).next();
                var val = $.trim(this.value);
                $span.css("color", "red");
                if (val == "") {
                    $span.html("商品数量不能为空");
                    return;
                }

                if (!/^\d+?$/.test(val)) {
                    $span.html("请填写正确的商品数量");
                    return;
                }
                if (val < 0) {
                    $span.html("商品数量不能小于0");
                    return;
                }
                $span.html("件");
                $span.css("color", "");
            });

            $('#tcategoryUl').on('click', 'input', function () {
                var self = $(this);
                var input = self.parents('ul').prevAll().find('input');
                if (input.length) {
                    if (self.prop('checked')) {
                        input.prop('checked', true);
                    } else {
                        //				input.prop('checked', false);
                        self.parent().nextAll('ul').find('input').prop('checked', false);
                    }
                } else {
                    self.parent().nextAll('ul').find('input').prop('checked', false);
                }
                setCommodityCategory();
            });


            @if(ViewBag.IsYJBJ)
            {
            <text>
            $('#tinnerCategoryUl').on('click', 'input', function () {
                var self = $(this);
                var input = self.parents('ul').prevAll().find('input');
                if (input.length) {
                    if (self.prop('checked')) {
                        input.prop('checked', true);
                    } else {
                        self.parent().nextAll('ul').find('input').prop('checked', false);
                    }
                } else {
                    self.parent().nextAll('ul').find('input').prop('checked', false);
                }
                setInnerCommodityCategory();
            });
            </text>
            }

            $("#commoditycategory").focus(function () {
                if ("@ViewBag.IsShowCategoryTree".toLowerCase() == "false") {
                    return;
                }
                var top = $('#commoditycategory').offset().top;
                var left = $('#commoditycategory').offset().left;
                var height = $('#commoditycategory').height();
                $("#categoryDiv").css({ "top": top + height, "left": left }).show();
                $("#sizeDIV").hide();
                $("#colorDIV").hide();
                $("#attributeDIV").hide();
                $("#attrDIV2").hide();
                $("#attrDIV1").hide();
                $("#freightDIV").hide();
                @if(ViewBag.IsYJBJ)
                {
                <text>
                    $("#innerCategoryDiv").hide();
                </text>
                }
            }).blur(function () {
            });

            @if(ViewBag.IsYJBJ)
            {
            <text>
            $("#commodityInnerCategory").focus(function () {
                var top = $('#commodityInnerCategory').offset().top;
                var left = $('#commodityInnerCategory').offset().left;
                var height = $('#commodityInnerCategory').height();
                $("#innerCategoryDiv").css({ "top": top + height, "left": left }).show();
                $("#categoryDiv").hide();
                $("#sizeDIV").hide();
                $("#colorDIV").hide();
                $("#attributeDIV").hide();
                $("#attrDIV2").hide();
                $("#attrDIV1").hide();
                $("#freightDIV").hide();
            });
            </text>
            }

            $("#commoditysize").focus(function () {
                var top = $('#commoditysize').offset().top;
                var left = $('#commoditysize').offset().left;
                var height = $('#commoditysize').height();
                $("#sizeDIV").css({ "top": top + height, "left": left }).show();
                $("#categoryDiv").hide();
                $("#colorDIV").hide();
                @if(ViewBag.IsYJBJ)
                {
                <text>
                $("#innerCategoryDiv").hide();
                </text>
                }
            })

            $("#commoditycolor").focus(function () {
                var top = $('#commoditycolor').offset().top;
                var left = $('#commoditycolor').offset().left;
                var height = $('#commoditycolor').height();
                $("#colorDIV").css({ "top": top + height, "left": left }).show();
                $("#categoryDiv").hide();
                $("#sizeDIV").hide();
                @if(ViewBag.IsYJBJ)
                {
                <text>
                $("#innerCategoryDiv").hide();
                </text>
                }
            })

            //            $("#tcategoryUl input[type='checkbox']").change(function () {
            //                toCheckSelected();
            //            });

            $("#sizeUl input[type='checkbox']").change(function () {
                toCheckSizeSelected();
            });

            $("#colorUl input[type='checkbox']").change(function () {
                toCheckColorSelected();
            });

            $("#showPrev").click(function () { rotateImg("prev"); });
            $("#showNext").click(function () { rotateImg("next"); });

            $("#commodityWeight").blur(function () {
                var $span = $(this).next();
                var val = $.trim(this.value);
                $span.css("color", "red");
                if (val == "" || val == "请输入正数最多五位小数") {
                    $span.html("kg");
                    $span.css("color", "");
                    return;
                }

                if (!/^\d+(\.\d{1,5})?$/.test(val)) {
                    $span.html("请填写正确的重量参数最多保留5位小数");
                    return;
                }

                if (val <= 0) {
                    $span.html("重量参数必须大于0");
                    return;
                }
                $span.html("kg");
                $span.css("color", "");
            });

            $("#ScoreScale").blur(function () {
                var $span = $(this).next();
                var val = $.trim(this.value);
                $span.html("%积分（请到支付方式菜单设置积分兑换汇率)");
                $span.css("color", "red");
                if (val == "") {
                    $span.css("color", "");
                    $(this).val('');
                    return;
                }
                if (val <= 0) {
                    $span.html("积分比例参数必须大于0");
                    $(this).val('');
                    return;
                }
                if (!/^\d+(\.\d{1,5})?$/.test(val)) {
                    $span.html("请填写正确的积分比例参数最多保留5位小数");
                    $(this).val('');
                    return;
                }
                $span.css("color", "");
            });
        });

        function rotateImg(direction) {
            var img = $("#showImg")[0];
            var imgList = $("#sortable div.img1 img.one");
            if (imgList.length > 0) {
                for (var i = 0; i < imgList.length; i++) {
                    var newImg = imgList.get(i);
                    if (newImg.src == img.src) {
                        if (direction == 'prev') {
                            if (i == 0) {
                                img.src = imgList.get(imgList.length - 1).src;
                            }
                            else {
                                img.src = imgList.get(i - 1).src;
                            }
                            break;
                        }
                        else {
                            if (i == imgList.length - 1) {
                                img.src = imgList.get(0).src;
                            }
                            else {
                                img.src = imgList.get(i + 1).src;
                            }
                            break;
                        }
                    }
                }
            }
            else {
                img.src = "/Images/comment_pic5.png";
            }
        }

        function getListImgSrcString() {
            var src = [];
            $("#sortable").find('.one').each(function () {
                src.push($(this).attr("src"));
            });
            return src.join(',');
        }
        function Valid() {
            debugger;
			var  sss=$("#commodityInnerCategory").val();
            @if(ViewBag.IsYJBJ)
            {
                <text>
                    if ($.trim($("#commodityInnerCategory").val()) == "" || $.trim($("#commodityInnerCategory").val()) == "请选择") {
                        return "商城品类不能为空";
                    }
                    if ($.trim($("#barCode").val()) == "") {
                        return "商品条形码不能为空";
                    }
                </text>
            }

            if ($.trim($("#commoditycode").val()) == "") {
            } else {
                var noCode = $("#commoditycode").next().html();
                if (noCode != "") {
                    return "商品编号不能重复，该编号已存在";
                }
            }
            if ($.trim($("#commodityname").val()) == "" || $.trim($("#commodityname").val()) == "最多30个字" || $.trim($("#commodityname").val()) == "最多60个字") {
                return "商品名称不能为空";
            }
            if ($.trim($("#IsHaveMallApply").val()) == "True") {    
                if ($.trim($("#commodityTaxRate").val()) == "" || $.trim($("#commodityTaxRate").val()) == "请输入正数最多两位小数" || $.trim($("#commodityTaxRate").val()) == "0.00") {
                    return "销项税不能为空";
                }
                if ($.trim($("#commodityInputTax").val()) == "" || $.trim($("#commodityInputTax").val()) == "请输入正数最多两位小数" || $.trim($("#commodityTaxRate").val()) == "0.00") {
                    return "进项税不能为空";
                }
                if ($.trim($("#commodityTaxClassCode").val()) == "" || $.trim($("#commodityTaxClassCode").val()) == "请选择") {
                    return "税收编码不能为空";
                }
                if ($.trim($("#commodityUnit").val()) == "" || $.trim($("#commodityUnit").val()) == "请输入正数最多两位小数" || $.trim($("#commodityTaxRate").val()) == "0.00") {
                    return "计量单位不能为空";
                }
            }

            @if(ViewBag.ShowJDCode)
            {
                <text>
                if ($.trim($("#commodityFreight").val()) == "" || $.trim($("#commodityFreight").val()) == "-1") {
                    return "物流费用不能为空";
                }
                if ($.trim($("#saleAreastxt").text()) == "" || $.trim($("#saleAreastxt").text()) == "未指定销售区域") {
                    return "销售区域不能为空";
                }
                </text>
            }

            if ('@isCustomES'.toLowerCase() == 'false') {
                if ($.trim($("#commodityname").val()).length > 30) {
                    return "名称最多30个字";
                }
            } else {
                if ($.trim($("#commodityname").val()).length > 60) {
                    return "名称最多60个字";
                }
            }
            if ($("#commodityprice").val() == "") {
                return "商品价格不能为空";
            }
            if (!/^\d+(\.\d{2})?$/.test($("#commodityprice").val())) {
                if (!/^\d+(\.\d{1})?$/.test($("#commodityprice").val())) {
                    return "请填写正确的价格最多保留2位小数";
                }
            }
            if ($("#commodityprice").val() < 0) {
                return "价格必须大于等于0";
            }
            if (!checkMoneyRange($.trim($("#commodityprice").val()), true, false)) {
                return "最多填写9位正数";
            }

            var commoditymarketprice = $.trim($("#commoditymarketprice").val()) == '请输入正数最多两位小数' ? '' : $.trim($("#commoditymarketprice").val());
            //市场价非必填内容，但如果有只，必须是正数，最多保留两位小数，且不小于$("#commodityprice")的值
            if (commoditymarketprice != "") {
                if (!/^\d+(\.\d{2})?$/.test(commoditymarketprice)) {
                    if (!/^\d+(\.\d{1})?$/.test(commoditymarketprice)) {
                        return "请填写正确的市场价最多保留2位小数";
                    }
                }

            }
            if (parseFloat($("#commoditymarketprice").val()) < parseFloat($("#commodityprice").val())) {
                return "市场价不得小于商品现价";
            }
            if (!checkMoneyRange($.trim($("#commoditymarketprice").val()), true, true)) {
                return "最多填写9位正数";
            }

            @if(ViewBag.IsYJBJ)
            {
            <text>
            if ($("#costPrice").val() == "") {
                return "进货价不能为空";
            }
            if (!/^\d+(\.\d{2})?$/.test($("#costPrice").val())) {
                if (!/^\d+(\.\d{1})?$/.test($("#costPrice").val())) {
                    return "请填写正确的进货价，最多保留2位小数";
                }
            }
            if (!checkMoneyRange($.trim($("#costPrice").val()), true, false)) {
                return "进货价最多填写9位正数";
            }
            </text>
            }


            if ($.trim($("#commoditystock").val()) == "") {
                return "商品数量不能为空";
            }
            if (!/^\d+?$/.test($("#commoditystock").val())) {
                return "请填写正确的商品数量";
            }
            if ($.trim($("#commoditystock").val()) < 0) {
                return "商品数量不能小于0";
            }
            if ($.trim($("#picture").val()) == "") {
                return "商品缩略图不能为空";
            }
            if (!getListImgSrcString().length) {
                return "商品详情页图样不能为空"
            }
            var con = ue.getContent();
            con = con.replace(/<\/?(img)[^>]*>|&nbsp;/ig, "");
            if (con.length > 0
                && con.length > 8000) {
                return "描述内容不能超过8000个字符。";
            }

            @if(ViewBag.IsYJBJ)
            {
            @:if (!IsCanSumbit) return "请检查商品属性数量、价格、关税格式、商品条形码输入是否正确";
            }
            else
            {
            @:if (!IsCanSumbit) return "请检查商品属性数量、价格、关税格式输入是否正确";
            }

            if (!CheckAttr()) return msgError;

            if (!CheckMarketPrice()) return "市场价不得小于商品现价";

            var attrMess = "";
            $("input[name='attrCache']").each(function () {
                var price = $(this).prev().val();
                if (!checkMoneyRange(price, true, false)) {
                    attrMess = "最多填写9位正数";
                    return;
                }
                var marketprice = $(this).parent().next().children().eq(0).val();
                marketprice = $.trim(marketprice) == '' ? null : $.trim(marketprice);
                if (!checkMoneyRange(marketprice, true, true)) {
                    attrMess = "最多填写9位正数";
                    return;
                }
                var duty = $(this).parent().next().next().children().eq(0).val();
                if (!checkMoneyRange(duty, true, true)) {
                    attrMess = "最多填写9位正数";
                    return;
                }
            });
            if (attrMess)
                return attrMess;

            if ($("input[name=rdoPriceMethod]:checked").attr("value") == "1") {
                var weight = $.trim($("#commodityWeight").val());
                if (weight == "" || weight == "请输入正数") {
                    return "计重商品重量参数不能为空";
                }
                if (!/^\d+(\.\d{1,5})?$/.test(weight)) {
                    return "请填写正确的重量参数最多保留5位小数";
                }
                if (eval(weight) <= 0) {
                    return "重量参数必须为正数";
                }
            }

            return 0;
        }

        function toSelectAll(obj) {
            if ($(obj).attr("checked")) {
                $("#sortable img.one").each(function () {
                    if ($(this) != $("#sortable img:last")) {
                        $(this).addClass("imgchecked");
                        $(this).next().show();
                    }
                });
            } else {
                $("#sortable img").each(function () {
                    if ($(this) != $("#sortable img:last")) {
                        $(this).removeClass("imgchecked");
                        $(this).next().hide();
                    }
                });
            }
        }
        function toDeleteAllImgList() {
            $("#sortable div.img1").each(function () {
                if ($(this).find("img.two").css("display") != "none") {
                    $(this).remove();
                }
            });
            updateRightImg();
        }

        function updateRight() {
            updateRightImg();
            var comName = $.trim($("#commodityname").val());
            if (comName.length > 12) {
                comName = comName.substring(0, 12) + '...';
            }
            $("div.spfb_t_r ul li.one1 p").text(comName);

            $("div.spfb_t_r ul li.one2").text(getCurrency() + $("#commodityprice").val());
            var size = $.trim($("#commoditysize").val());
            if (size == "" || size == "请选择") {
                size = "请选择尺寸";
            }
            $("div.spfb_t_r ul li.one4 span.siz").text("尺寸：" + size);
            var color = $.trim($("#commoditycolor").val());
            if (color == "" || color == "请选择") {
                color = "请选择颜色";
            }
            $("div.spfb_t_r ul li.one4 span.col").text("颜色：" + color);

            $("div.spfb_t_r ul li.flag1").hide();
            $("div.spfb_t_r ul li.flag2").hide();
            for (var i = 0; i < SelectAttr.length; i++) {
                if (i == 0) {
                    $("div.spfb_t_r ul li.flag1").show();
                    $("div.spfb_t_r ul li.one4 span.col").text(SelectAttr[i].Name + "：" + $("#commodityAttr1").val());
                }
                else {
                    $("div.spfb_t_r ul li.flag2").show();
                    $("div.spfb_t_r ul li.one4 span.siz").text(SelectAttr[i].Name + "：" + $("#commodityAttr2").val());
                }
            }
        }
        function selectCode() {
            $("#MyIframeSelectCode").attr("src", 'SelSingleTaxRateCode');
            var left = document.documentElement.clientWidth / 2 - 700 / 2;
            var top = 100;
            try {
                top = window.parent.getScrollTop();
            }
            catch (Error) {
            }

            $("#dialogSelectCode").jhtablebox({
                width: 700,
                height: 680,
                modal: true,
                resizable: false,
                title: "选择税收编码",
                position: [left, top]
            });
        }
        function updateRightImg() {
            var imgList = $("#sortable div.img1 img.one");
            if (imgList.length > 0) {
                $("#showImg").attr("src", imgList[0].src);
            }
            else {
                $("#showImg").attr("src", "/Images/comment_pic5.png");
            }
        }
        function closeWindow() {
            //window.close();
            //history.back(-1);
            //	        window.location.href = document.referrer;
            window.location.href = window.parent.document.referrer_url;
        }
    </script>
    <script type="text/javascript">
        var AttrValueList = JSON.parse('@Html.Raw(ViewBag.AttributeValueJson)');
        var SelectAttr = new Array();
        var FristAttrValueList = new Array();
        var TwoAttrValueList = new Array();
        var SelectAttrValue = new Array();

        $(function () {
            $("#attributeUl input[type='checkbox']").change(function () {
                toCheckAttributeSelected(this);

                $("#attrUl1 input[type='checkbox']").change(function () {
                    CreateSingleAttributeDecare(1);
                });
            });
            //            $("#freightUl input[type='checkbox']").change(function () {
            //                toCheckFreightSelected(this);
            //            });
            $("#commodityAttribute").focus(function () {
                var top = $('#commodityAttribute').offset().top;
                var left = $('#commodityAttribute').offset().left;
                var height = $('#commodityAttribute').height();
                $("#attributeDIV").css({ "top": top + height, "left": left }).show();
                $("#categoryDiv").hide();
                $("#attrDIV2").hide();
                $("#attrDIV1").hide();
                $("#freightDIV").hide();
            });

            $("#commodityAttr1").focus(function () {
                var top = $('#commodityAttr1').offset().top;
                var left = $('#commodityAttr1').offset().left;
                var height = $('#commodityAttr1').height();
                $("#attrDIV1").css({ "top": top + height, "left": left }).show();
                $("#categoryDiv").hide();
                $("#attrDIV2").hide();
                $("#attributeDIV").hide();
                $("#freightDIV").hide();
            });
            $("#commodityAttr2").focus(function () {
                var top = $('#commodityAttr2').offset().top;
                var left = $('#commodityAttr2').offset().left;
                var height = $('#commodityAttr2').height();
                $("#attrDIV2").css({ "top": top + height, "left": left }).show();
                $("#categoryDiv").hide();
                $("#attrDIV1").hide();
                $("#attributeDIV").hide();
                $("#freightDIV").hide();
            });
            $("#commodityAttr1,#commodityAttr2").focus(function () {
                if (this.value == '请选择') {
                    this.value = '';
                    $(this).removeClass("txtColor");
                }
            }).blur(function () {
                if (this.value == '') {
                    this.value = '请选择';
                    $(this).addClass("txtColor");
                }
            }).each(function () {
                if (this.value == '请选择') {
                    $(this).addClass("txtColor");
                }
            });
            InitAttr();

        });

        function JoinName(arr) {
            var attributeNameList = "";
            for (var i = 0; i < arr.length; i++) {
                if (i == 0) {
                    attributeNameList = arr[i].Name;
                }
                else {
                    attributeNameList = attributeNameList + "," + arr[i].Name;
                }
            }
            return attributeNameList;
        }

        //利用缓存初始化
        function InitAttr() {
            selectAttrStr = '@(!string.IsNullOrEmpty(ViewBag.SelectAttr as string) ? Html.Raw(ViewBag.SelectAttr) : "")';
            if (selectAttrStr != "") {
                SelectAttr = JSON.parse(selectAttrStr);
            }

            fristAttrValueListStr = '@(!string.IsNullOrEmpty(ViewBag.First as string) ? Html.Raw(ViewBag.First) : "")';
            if (fristAttrValueListStr != "") {
                FristAttrValueList = JSON.parse(fristAttrValueListStr);
            }

            twoAttrValueListStr = '@(!string.IsNullOrEmpty(ViewBag.Two as string) ? Html.Raw(ViewBag.Two) : "")';
            if (twoAttrValueListStr != "") {
                TwoAttrValueList = JSON.parse(twoAttrValueListStr);
            }

            selectAttrValueStr = '@(!string.IsNullOrEmpty(ViewBag.SelectAttrValue as string) ? Html.Raw(ViewBag.SelectAttrValue) : "")';
            if (selectAttrValueStr != "") {
                SelectAttrValue = JSON.parse(selectAttrValueStr);
            }

            FreightId = '@(!string.IsNullOrEmpty(ViewBag.FreightId as string) ? ViewBag.FreightId : "")';
            $("#commodityFreight ").val(FreightId);

            if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
                IsInput = true;
            }
            for (var i = 0; i < SelectAttr.length; i++) {
                FromatAttrValue(SelectAttr[i].Id, SelectAttr[i].Name, i + 1);
            }

            $("#commodityAttribute").val(JoinName(SelectAttr));
            $("#commodityAttribute").removeClass("txtColor");
            $("#commodityAttr1").val(JoinName(FristAttrValueList));
            $("#commodityAttr1").removeClass("txtColor");
            $("#commodityAttr2").val(JoinName(TwoAttrValueList));
            $("#commodityAttr2").removeClass("txtColor");

            var attrArray = [];
            attrArray = attrArray.concat(SelectAttr, FristAttrValueList, TwoAttrValueList);
            var attrLen = attrArray.length;
            var sourceObj = $("#attributeDIV input[type='checkbox'],#attrDIV1 input[type='checkbox'],#attrDIV2 input[type='checkbox']");
            for (var i = 0; i < attrLen; i++) {
                var val = attrArray[i];
                if (val != "") {
                    sourceObj.each(function () {
                        if (this.value.toLocaleLowerCase() == val.Id.toLocaleLowerCase() || $(this).nextAll('span').text().toLocaleLowerCase() == val.Name.toLocaleLowerCase()) {
                            this.checked = true;
                        } else if (this.innerHTML == val) {
                            this.checked = true;
                        }
                    });
                }
            }

            if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
                CreateAttributeDecare(0);
            }
            else {//单属性商品初始化
                IsInput = true;
                CreateSingleAttributeDecare(0);
                $("#attrUl1 input[type='checkbox']").change(function () {
                    CreateSingleAttributeDecare(0);
                });
            }
            updateRight();
        }

        var FreightId = "";
        function toCheckFreightSelected(obj) {
            var attrobj = $(obj);
            if ($("#freightUl input:checkbox:checked").length > 1) {
                alert("最多只能选择一项！");
                attrobj.attr("checked", false);
                return;
            }
            var freightIdList = "";
            var freightNameList = "";

            $("#freightUl input:checkbox:checked").each(function () {
                freightIdList = $(this).val();
                freightNameList = $(this).next().text();
            });
            FreightId = freightIdList;
            // commodityFreight
            $("#commodityFreight").val(freightNameList);
            $("#commodityFreight").removeClass("txtColor");

        }

        function toCheckAttributeSelected(obj) {
            var attrobj = $(obj);
            if ($("#attributeUl input:checkbox:checked").length > 2) {
                alert("最多只能选择两项！");
                attrobj.attr("checked", false);
                return;
            }
            if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
                if (confirm("更改会清空已填写的数据，确认更改吗")) {
                    FristAttrValueList = new Array();
                    TwoAttrValueList = new Array();
                    $("#attributeDecareli").hide();
                    $("#attributeDecareTab").html("");
                    $("#tabContainer").empty();
                    $("#commodityprice").removeAttr("disabled");
                    $("#commoditymarketprice").removeAttr("disabled");
                    $("#commodityprice").removeAttr("disabled");
                    $("#commodityduty").removeAttr("disabled");
                    $("#commodityTaxRate").removeAttr("disabled");
                    @if(ViewBag.IsYJBJ)
                    {
                    <text>
                    $("#commoditycode").removeAttr("disabled");
                    $("#barCode").removeAttr("disabled");
                    @if(ViewBag.ShowJDCode)
                    {
                    <text>
                    $("#jdCode").removeAttr("disabled");    
                    </text>
                    }             
                    $("#costPrice").removeAttr("disabled");
                    </text>
                    }
                }
                else {
                    attrobj.attr("checked", true);
                    return;
                }
            }
            let oldSelectAttrLength = SelectAttr.length;
            var attrid = attrobj.val().toLocaleLowerCase();
            $("#attrSelect1").hide();
            $("#attrSelect2").hide();
            if (attrobj.attr("checked") != true && attrobj.attr("checked") != "checked") {
                for (var i = 0; i < SelectAttr.length; i++) {
                    if (SelectAttr[i].Id.toLocaleLowerCase() == attrid) {
                        SelectAttr.splice(i, 1);
                        break;
                    }
                }
            }
            else {
                SelectAttr.push({ Id: attrid, Name: attrobj.next().text() });
            }
            var attributeNameList = "";
            for (var i = 0; i < SelectAttr.length; i++) {
                if (i == 0) {
                    attributeNameList = SelectAttr[i].Name;
                }
                else {
                    attributeNameList = attributeNameList + "," + SelectAttr[i].Name;
                }
            }

            for (var i = 0; i < SelectAttr.length; i++) {
                FromatAttrValue(SelectAttr[i].Id, SelectAttr[i].Name, i + 1);
            }

            $("#commodityAttribute").val(attributeNameList);
            $("#commodityAttribute").removeClass("txtColor");

            if($("#attributeUl input:checkbox:checked").length === 0) {
                if(oldSelectAttrLength === 2) {
                    CreateAttributeDecare(0);
                }
                if(oldSelectAttrLength === 1) {
                    CreateSingleAttributeDecare(0);
                }
            }
            updateRight();
            if(SelectAttr.length==0){
               $("#commodityprice").removeAttr("disabled");
               $("#barCode").removeAttr("disabled");
            };
        }

        function closeAttributeDIV() {
            $("#attributeDIV").hide();
            // ajaxSaveInfo();
        }
        function closeFreightDIV() {
            $("#freightDIV").hide();

        }

        function FromatAttrValue(attributeId, attributeName, ids) {
            $("#attrSelect" + ids).show();
            $("#commodityAttrNameTip" + ids).html("商品" + attributeName + "：");
            $("#commodityAttr" + ids).val("");
            $("#attrIdList" + ids).val("");

            var url = "flag=edit";
            if (getQueryString("commodityId")) {
                url = url + "&commodityId=" + getQueryString("commodityId");
            }
            if (getQueryString("state")) {
                url = url + "&state=" + getQueryString("state");
            }
            $("#updateAttr" + ids).attr("href", "#" );
            $("#updateAttr" + ids).html("设置" + attributeName);

            var _attrValueList = new Array();

            for (var i = 0; i < AttrValueList.length; i++) {
                if (AttrValueList[i].AttributeId.toLocaleLowerCase() == attributeId.toLocaleLowerCase()) {
                    _attrValueList.push(AttrValueList[i]);
                }
            }

            var html = '';
            for (var i = 0; i < _attrValueList.length; i++) {
                html += '<li><label><input type="checkbox" value="' + _attrValueList[i].Id + '"/><span>' + _attrValueList[i].Name + '</span></label></li>';
            }
            $("#attrtip" + ids).html("请选择" + attributeName + "信息");
            $("#attrUl" + ids).html(html);
            $("#attrDiv" + ids).show();

            $("#attrUl" + ids + " input[type='checkbox']").change(function () {
                toCheckTwoAttributeSelected(this, ids);
            });
            //重新注册事件
        }

        function closeAttrDIV(ids) {
            $("#attrDIV" + ids).hide();
            // ajaxSaveInfo();
        }
        var IsInput = false;
        function toCheckTwoAttributeSelected(obj, ids) {
            var attrobj = $(obj);
            var sed = true;
            if (attrobj.attr("checked") != true && attrobj.attr("checked") != "checked") {
                sed = false;
            }
            if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0 && IsInput) {
                if (!confirm("更改会清空已填写的数据，确认更改吗")) {
                    attrobj.attr("checked", !sed);
                    return;
                }
            }
            var tempAttr = new Array();
            var colorIdList = "";
            var colorNameList = "";

            $("#attrUl" + ids + " input:checkbox:checked").each(function () {
                tempAttr.push({ Id: $(this).val(), Name: $(this).next().text() });
                colorIdList = colorIdList + "," + $(this).val();
                colorNameList = colorNameList + "," + $(this).next().text();
            });
            if (colorIdList.length > 0) {
                colorIdList = colorIdList.substring(1, colorIdList.length);
                colorNameList = colorNameList.substring(1, colorNameList.length);
            }

            if (ids == 1) {
                FristAttrValueList = tempAttr;
            }
            else {
                TwoAttrValueList = tempAttr;
            }
            CreateAttributeDecare(1);
            $("#commodityAttr" + ids).val(colorNameList);
            $("#commodityAttr" + ids).removeClass("txtColor");
            // $("#attrIdList" + ids).val(colorIdList);
            updateRight();
        }

        function DisabledAttribute() {
            $("#commodityprice").attr("disabled", "");
            $("#commoditymarketprice").attr("disabled", "");
            $("#commodityduty").attr("disabled", "");
            $("#commodityTaxRate").attr("disabled", "");
            @if(ViewBag.IsYJBJ)
            {
            <text>
            $("#commoditycode").attr("disabled", "");
            $("#barCode").attr("disabled", "");       
            $("#costPrice").attr("disabled", "");
            </text>
            }
            @if(ViewBag.ShowJDCode)
            {
            <text>
            $("#jdCode").attr("disabled", "");    
            </text>
            }
        }


        function RestDisabledAttribute() {
            $("#commodityprice").removeAttr("disabled");
            $("#commoditymarketprice").removeAttr("disabled");
            $("#commodityduty").removeAttr("disabled");
            $("#commodityTaxRate").removeAttr("disabled");
            @if(ViewBag.IsYJBJ)
            {
            <text>
            $("#commoditycode").removeAttr("disabled");
            $("#barCode").removeAttr("disabled");             
            $("#costPrice").removeAttr("disabled");
            </text>
            }
            @if(ViewBag.ShowJDCode)
            {
            <text>
            $("#jdCode").removeAttr("disabled");   
            </text>
            }
        }

        //根据选择的属性创建笛卡尔积
        function CreateAttributeDecare(type) {
            if (type == 1) {
                IsInput = false;
            }
            if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
                $("#commoditystock").attr('readonly', true);
                if (type == 1) {
                    $("#commoditystock").val("");
                }
                var fristAttributeId = SelectAttr[0].Id;
                var twoAttributeId = SelectAttr[1].Id;
                var fristAttributeName = SelectAttr[0].Name;
                var twoAttributeName = SelectAttr[1].Name;

                attrValueList = AttrValueList;
                fristAttrValueList = FristAttrValueList;
                twoAttrValueList = TwoAttrValueList;

                var html = "";
                html += '<tr>';
                html += '<td align="center" style=" width:10%;">' + fristAttributeName + '</td>';
                html += '<td align="center" style=" width:10%;">' + twoAttributeName + '</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>价格</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" ></span>市场价</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" ></span>关税</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>库存</td>';
                @if(ViewBag.IsYJBJ)
                {
                <text>
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>进货价</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>商品条码</td>';
                html += '<td align="center" style=" width:20%;">商品编码</td>';
                </text>
                }
                @if(ViewBag.ShowJDCode)
                {
                <text>
                html += '<td align="center" style=" width:20%;">备注编码</td>';
                </text>
                }
                html += '<td align="center" style="width:25%;">商品图片</td>';
                html += '</tr>';
                // 商品SKU轮播图Html
                var carouselUlHtml = '<ul class="tabs">';
                var carouselContentHtml = "";
                var index = 0;

                for (var i = 0; i < fristAttrValueList.length; i++) {
                    for (var j = 0; j < twoAttrValueList.length; j++) {
                        html += '<tr>';
                        if (j == 0) {
                            html += '<td align="center" rowspan="' + twoAttrValueList.length + '">' + fristAttrValueList[i].Name + '</td>';
                        }
                        var josn = '[{"AttributeId":"' + fristAttributeId + '","SecondAttributeId":"' + fristAttrValueList[i].Id + '","Attribute":"' + fristAttributeName + '","SecondAttribute":"' + fristAttrValueList[i].Name + '"},';
                        josn += '{"AttributeId":"' + twoAttributeId + '","SecondAttributeId":"' + twoAttrValueList[j].Id + '","Attribute":"' + twoAttributeName + '","SecondAttribute":"' + twoAttrValueList[j].Name + '"}]';
                        josn = encodeURIComponent(josn);
                        var reattr = AutoValue(fristAttrValueList[i].Name, twoAttrValueList[j].Name, fristAttributeName, twoAttributeName);

                        html += '<td align="center" >' + twoAttrValueList[j].Name + '</td>';

                        // 商品SKU轮播图Tab Id
                        var carouselId = "carousel" + index;
                        if(index == 0) {
                            carouselUlHtml += '<li class="tab-link current" data-tab="'+ carouselId +'">'+fristAttrValueList[i].Name+'/'+twoAttrValueList[j].Name+'</li>';
                            carouselContentHtml += '<div id="'+ carouselId +'" class="tab-content current">';
                        } else {
                            carouselUlHtml += '<li class="tab-link" data-tab="'+ carouselId +'">'+fristAttrValueList[i].Name+'/'+twoAttrValueList[j].Name+'</li>';
                            carouselContentHtml += '<div id="'+ carouselId +'" class="tab-content">';
                        }
                        carouselContentHtml += `
                                <div class="spfb_b1t">
                                    <span class="zihao">商品SKU详情页图样</span> <span>（</span>
                                    <img src="/Images/xiaoshou.jpg"><span>直接拖动图片可调整顺序）</span> <a  style="padding-left: 100px;" href="javascript:" >批量上传图片</a>
                                    <span style="margin-left: 10px;">&nbsp;&nbsp;建议图片尺寸：640*640或640*480，根据定制平台“商品轮播版式组件”的配置匹配尺寸,单张图小于100K，推荐使用640*640；</span>
                                </div>
                        `;

                        carouselContentHtml += '<div class="spfb_b1c" id="sortable'+index+'">';
                        let mleft = 0;
                        if (reattr == "") {
                            html += '<td><input type="text" name="ComPrice" style="width: 80px;" onblur="CheckAttrPrice(this)" maxlength="12"/><input type="hidden" name="attrCache" value="' + josn + '" data-tab="'+ carouselId +'" data-tab-index="'+index+'" /><input type="hidden" name="attrCacheId" value="00000000-0000-0000-0000-000000000000" /><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" name="MarketPrice" style="width: 80px;" onblur="CheckAttrMarketPrice(this)" maxlength="12"/><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text"  name="Duty" style="width: 80px;" onblur="CheckAttrDuty(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" name="ComStock" style="width: 80px;" onblur="CheckAttrNum(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                            @if(ViewBag.IsYJBJ)
                            {
                            <text>
                            html += '<td><input type="text" name="ComCostPrice" style="width: 80px;" onblur="CheckAttrCostPrice(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" name="ComBarCode" style="width: 80px;" onblur="CheckAttrBarCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" name="ComCode" style="width: 80px;" onblur="CheckAttrCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                            </text>
                            }
                            @if(ViewBag.ShowJDCode)
                            {
                            <text>
                            html += '<td><input type="text" name="ComJDCode" style="width: 80px;" onblur="CheckAttrJDCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                            </text>
                            }
                            html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none;box-shadow: none;" /></div></div></td>';
                        }
                        else {
                            var marketprice = type == 0 && reattr.MarketPrice ? reattr.MarketPrice : '';
                            var duty = type == 0 && reattr.Duty ? reattr.Duty : "";
                            html += '<td><input type="text" name="ComPrice" style="width: 80px;" value="' + (type == 0 && reattr.Price >= 0 ? reattr.Price : "") + '" onblur="CheckAttrPrice(this)" maxlength="12"/><input type="hidden" name="attrCache" value="' + josn + '" data-tab="'+ carouselId +'" data-tab-index="'+index+'" /><input type="hidden" name="attrCacheId" value="' + reattr.Id + '" /> <span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" name="MarketPrice" style="width: 80px;"  value="' + marketprice + '"  onblur="CheckAttrMarketPrice(this)" maxlength="12" /><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" name="Duty" value="' + duty + '" style="width: 80px;" onblur="CheckAttrDuty(this)"  maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" name="ComStock" style="width: 80px;" value="' + (type == 0 && reattr.Stock >= 0 ? reattr.Stock : "") + '" onblur="CheckAttrNum(this)" maxlength="11" /><span style="paddding:0px;margin:0px;"></span></td>';
                           
                            @if(ViewBag.IsYJBJ)
                            {
                            <text>
                            html += '<td><input type="text" value="' +  (type == 0 && reattr.CostPrice >= 0 ? reattr.CostPrice : "") + '" name="ComCostPrice" style="width: 80px;" onblur="CheckAttrCostPrice(this)" maxlength="12" /><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" value="' + (type == 0 && reattr.BarCode? reattr.BarCode : "") + '" name="ComBarCode" style="width: 80px;" onblur="CheckAttrBarCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                            html += '<td><input type="text" value="' + (type == 0 && reattr.Code? reattr.Code : "") + '" name="ComCode" style="width: 80px;" onblur="CheckAttrCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                            </text>
                            }
                            @if(ViewBag.ShowJDCode)
                            {
                            <text>
                            html += '<td><input type="text" value="' + (type == 0 && reattr.JDCode? reattr.JDCode : "") + '" name="ComJDCode" style="width: 80px;" onblur="CheckAttrJDCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                            </text>
                            }

                            if(type == 0 && reattr.ThumImg) {
                                html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" value="'+ reattr.ThumImg +'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"><img src="'+reattr.ThumImg+'" name="" width="80" height="80" class="one"><a href="javascript:void(0);" class="del" >x</a></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none;box-shadow: none;" /></div></div></td>';
                            } else {
                                html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none;box-shadow: none;" /></div></div></td>';
                            }
                            if(type == 0 && reattr.CarouselImgs) {
                                reattr.CarouselImgs.split(',').forEach(function(v) {
                                    mleft+=114;
                                    carouselContentHtml += `
                                        <div class="img1">
                                            <img src="`+v+`" width="80" height="80" class="one">
                                            <img src="/Images/finished.png" class="two" style="display: none">
                                            <img src="/Images/close.jpg" class="two" style="top: 0px;" >
                                        </div>
                                    `;
                                });
                            }
                        }
                        html += '</tr>';
                        carouselContentHtml += '</div>';
                        carouselContentHtml += `
                            <div id="addimg`+ index +`"  style="position: relative;margin-top: -`+(mleft>0?108:0)+`px; margin-left: `+ mleft +`px; padding: 10px 0 13px 30px">
                                <img src="/Images/comment_pic5.png" id="CommodityListPic`+ index +`">
                            </div>
                        `;
                        carouselContentHtml += '</div>';
                        index++;
                    }
                }
                $("#attributeDecareTab").html(html);
                $("#attributeDecareTab").html(html);
                $("#tabContainer").html(carouselUlHtml+carouselContentHtml);
                if (fristAttributeName != null && fristAttributeName != "" && twoAttributeName != null & twoAttributeName != "") {
                    DisabledAttribute();
                }
                else {
                    DisabledDisabledAttribute();
                }

                $("#attributeDecareli").show();
                refreshLayout();
            }
            else {
                $("#attributeDecareli").hide();
                $("#attributeDecareTab").html("");
                $("#tabContainer").empty();
                $("#commoditystock").attr('readonly', false);
            }
            initSKUCommodityPic();
        }

        function CreateSingleAttributeDecare(type) {
            if (type == 1) {
                IsInput = false;
            }
            if (SelectAttr.length == 1 && TwoAttrValueList.length == 0 && FristAttrValueList.length > 0) {
                $("#commoditystock").attr('readonly', true);
                if (type == 1) {
                    $("#commoditystock").val("");
                }
                var fristAttributeId = SelectAttr[0].Id;
                var twoAttributeId = "";
                var fristAttributeName = SelectAttr[0].Name;
                var twoAttributeName = "";

                attrValueList = AttrValueList;
                fristAttrValueList = FristAttrValueList;
                twoAttrValueList = TwoAttrValueList;

                var html = "";
                html += '<tr>';
                html += '<td align="center" style=" width:10%;">' + fristAttributeName + '</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>价格</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" ></span>市场价</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" ></span>关税</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>库存</td>';
                @if(ViewBag.IsYJBJ)
                {
                <text>
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>进货价</td>';
                html += '<td align="center" style=" width:20%;"><span style="color:red; paddding:0px;margin:0px;" >*</span>商品条码</td>';
                html += '<td align="center" style=" width:20%;">商品编码</td>';
                </text>
                }
                @if(ViewBag.ShowJDCode)
                {
                <text>
                html += '<td align="center" style=" width:20%;">备注编码</td>';
                </text>
                }
                html += '<td align="center" style=" width:20%;">商品图片</td>';
                html += '</tr>';
                // 商品SKU轮播图Html
                var carouselUlHtml = '<ul class="tabs">';
                var carouselContentHtml = "";
                var index = 0;
                for (var i = 0; i < fristAttrValueList.length; i++) {
                    html += '<tr>';
                    var josn = '[{"AttributeId":"' + fristAttributeId + '","SecondAttributeId":"' + fristAttrValueList[i].Id + '","Attribute":"' + fristAttributeName + '","SecondAttribute":"' + fristAttrValueList[i].Name + '"},';
                    josn = encodeURIComponent(josn);
                    var reattr = AutoValue(fristAttrValueList[i].Name, "", fristAttributeName, "");
                    html += '<td align="center" >' + fristAttrValueList[i].Name + '</td>';
                    // 商品SKU轮播图Tab Id
                    var carouselId = "carousel" + index;
                    if(index == 0) {
                        carouselUlHtml += '<li class="tab-link current" data-tab="'+ carouselId +'">'+fristAttrValueList[i].Name+'</li>';
                        carouselContentHtml += '<div id="'+ carouselId +'" class="tab-content current">';
                    } else {
                        carouselUlHtml += '<li class="tab-link" data-tab="'+ carouselId +'">'+fristAttrValueList[i].Name+'</li>';
                        carouselContentHtml += '<div id="'+ carouselId +'" class="tab-content">';
                    }
                    carouselContentHtml += `
                        <div class="spfb_b1t">
                            <span class="zihao">商品SKU详情页图样</span> <span>（</span>
                            <img src="/Images/xiaoshou.jpg"><span>直接拖动图片可调整顺序）</span> <a id="batchUploadA" style="padding-left: 100px;" href="javascript:" >批量上传图片</a>
                            <span style="margin-left: 10px;">&nbsp;&nbsp;建议图片尺寸：640*640或640*480，根据定制平台“商品轮播版式组件”的配置匹配尺寸,单张图小于100K，推荐使用640*640；</span>
                        </div>
                    `;
                    carouselContentHtml += '<div class="spfb_b1c" id="sortable'+index+'">';
                    let mleft = 0;
                    if (reattr == "") {
                        html += '<td><input type="text" name="ComPrice" style="width: 80px;" onblur="CheckAttrPrice(this)" maxlength="12"/><input type="hidden" name="attrCache" value="' + josn + '" data-tab="'+ carouselId +'" data-tab-index="'+index+'" /><input type="hidden" name="attrCacheId" value="00000000-0000-0000-0000-000000000000"><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="MarketPrice" style="width: 80px;" onblur="CheckAttrMarketPrice(this)" maxlength="12"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text"  name="Duty" style="width: 80px;" onblur="CheckAttrDuty(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="ComStock" style="width: 80px;" onblur="CheckAttrNum(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';                   
                        @if(ViewBag.IsYJBJ)
                        {
                        <text>
                        html += '<td><input type="text" name="ComCostPrice" style="width: 80px;" onblur="CheckAttrCostPrice(this)" maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="ComBarCode" style="width: 80px;" onblur="CheckAttrBarCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="ComCode" style="width: 80px;" onblur="CheckAttrCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        @if(ViewBag.ShowJDCode)
                        {
                        <text>
                        html += '<td><input type="text" name="ComJDCode" style="width: 80px;" onblur="CheckAttrJDCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none;box-shadow: none;" /></div></div></td>';
                    }
                    else {
                        var marketprice = type == 0 && reattr.MarketPrice ? reattr.MarketPrice : '';
                        var duty = type == 0 && reattr.Duty ? reattr.Duty : "";
                        html += '<td><input type="text" name="ComPrice" style="width: 80px;" value="' + (type == 0 && reattr.Price >= 0 ? reattr.Price : "") + '" onblur="CheckAttrPrice(this)" maxlength="12"/><input type="hidden" name="attrCache" value="' + josn + '" data-tab="'+ carouselId +'" data-tab-index="'+index+'"><input type="hidden" name="attrCacheId" value="' + reattr.Id + '"> <span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="MarketPrice" style="width: 80px;"  value="' + marketprice + '"  onblur="CheckAttrMarketPrice(this)" maxlength="12" /><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="Duty" value="' + duty + '" style="width: 80px;" onblur="CheckAttrDuty(this)"  maxlength="11"/><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" name="ComStock" style="width: 80px;" value="' + (type == 0 && reattr.Stock >= 0 ? reattr.Stock : "") + '" onblur="CheckAttrNum(this)" maxlength="11" /><span style="paddding:0px;margin:0px;"></span></td>';
                    
                        @if(ViewBag.IsYJBJ)
                        {
                        <text>
                        html += '<td><input type="text" value="' +  (type == 0 && reattr.CostPrice >= 0 ? reattr.CostPrice : "") + '" name="ComCostPrice" style="width: 80px;" onblur="CheckAttrCostPrice(this)" maxlength="12" /><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" value="' + (type == 0 && reattr.BarCode? reattr.BarCode : "") + '" name="ComBarCode" style="width: 80px;" onblur="CheckAttrBarCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        html += '<td><input type="text" value="' + (type == 0 && reattr.Code? reattr.Code : "") + '" name="ComCode" style="width: 80px;" onblur="CheckAttrCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        @if(ViewBag.ShowJDCode)
                        {
                        <text>
                        html += '<td><input type="text" value="' + (type == 0 && reattr.JDCode? reattr.JDCode : "") + '" name="ComJDCode" style="width: 80px;" onblur="CheckAttrJDCode(this)" /><span style="paddding:0px;margin:0px;"></span></td>';
                        </text>
                        }
                        if(type == 0 && reattr.ThumImg) {
                            html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" value="'+ reattr.ThumImg +'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"><img src="'+reattr.ThumImg+'" name="" width="80" height="80" class="one"><a href="javascript:void(0);" class="del" >x</a></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none;box-shadow: none;" /></div></div></td>';
                        } else {
                            html += '<td><div class="comSKUPic" style="width:125px;text-align:center"><input type="hidden" name="ComThumImg" id="ComThumImgSrc'+index+'" /><div id="ComThumImgContent'+index+'" style="margin-top:10px;"></div><div><input type="file" id="ComThumPicBtn'+index+'" style="display: none" /></div></div></td>';
                        }
                        if(type == 0 && reattr.CarouselImgs) {
                            reattr.CarouselImgs.split(',').forEach(function(v) {
                                mleft += 114;
                                carouselContentHtml += `
                                    <div class="img1">
                                        <img src="`+v+`" width="80" height="80" class="one">
                                        <img src="/Images/finished.png" class="two" style="display: none">
                                        <img src="/Images/close.jpg" class="two" style="top: 0px;" >
                                    </div>
                                `;
                            });
                        }
                    }
                    html += '</tr>';
                    carouselContentHtml += '</div>';
                    carouselContentHtml += `
                        <div id="addimg`+ index +`"  style="position: relative;margin-top:-`+(mleft>0?108:0)+`px; margin-left: `+ mleft +`px; padding: 10px 0 13px 30px">
                            <img src="/Images/comment_pic5.png" id="CommodityListPic`+ index +`">
                        </div>
                    `;
                    carouselContentHtml += '</div>';
                    index++;
                }
                carouselUlHtml += '</ul>';
                $("#attributeDecareTab").html(html);
                $("#tabContainer").html(carouselUlHtml+carouselContentHtml);
                if (fristAttributeName != null && fristAttributeName != "") {
                  DisabledAttribute();
                }
                else {
                    DisabledDisabledAttribute();
                }
                $("#attributeDecareli").show();
                refreshLayout();
            }
            else {
                $("#attributeDecareli").hide();
                $("#attributeDecareTab").html("");
                $("#tabContainer").empty();
                $("#commoditystock").attr('readonly', false);
            }
            initSKUCommodityPic();
        }



        function refreshLayout() {
            try {
                $("body").height($("body div:first").outerHeight());
                if(!window.parent===window) {
                    window.parent.refreshLayout();
                }
            }
            catch (err) {
            }
        }

        function AutoValue(fname, tname, aName1, aName2) {
            fname = fname.toLocaleLowerCase();
            tname = tname.toLocaleLowerCase();
            if (SelectAttrValue.length > 0 && SelectAttrValue[0].ComAttribute.length) {
                var a1 = SelectAttrValue[0].ComAttribute[0].Attribute.toLocaleLowerCase();
                var a2 = SelectAttrValue[0].ComAttribute.length > 1 ? SelectAttrValue[0].ComAttribute[1].Attribute.toLocaleLowerCase() : "";
                aName1 = aName1.toLocaleLowerCase();
                aName2 = aName2.toLocaleLowerCase();

                if (a1 == aName1 && a2 == aName2) {
                    for (var i = 0; i < SelectAttrValue.length; i++) {
                        var f = SelectAttrValue[i].ComAttribute[0].SecondAttribute.toLocaleLowerCase();
                        var t = SelectAttrValue[i].ComAttribute.length > 1 ? SelectAttrValue[i].ComAttribute[1].SecondAttribute.toLocaleLowerCase() : "";
                        if (fname == f && t == tname) {
                            return { Price: SelectAttrValue[i].Price, Stock: SelectAttrValue[i].Stock, Id: SelectAttrValue[i].Id, MarketPrice: SelectAttrValue[i].MarketPrice, Duty: SelectAttrValue[i].Duty, CostPrice: SelectAttrValue[i].CostPrice, BarCode: SelectAttrValue[i].BarCode, Code: SelectAttrValue[i].Code, JDCode: SelectAttrValue[i].JDCode, ThumImg: SelectAttrValue[i].ThumImg, CarouselImgs: SelectAttrValue[i].CarouselImgs };
                        }
                    }
                }
            }
            return "";
        }

        function CheckAttrPrice(obj) {
            var val = $(obj).val();
            var tip = $(obj).next().next().next();
            tip.css("color", "red");
            if (val == "") {
                $(obj).val('0.00');
                alert('金额不能为空');
                return;
            }
            if (!/^\d+(\.\d{2})?$/.test(val)) {
                if (!/^\d+(\.\d{1})?$/.test(val)) {
                    $(obj).val('0.00');
                    alert("请填写正确的金额最多保留2位小数");
                    return;
                }
            }
            if (val < 0) {
                $(obj).val('0.00');
                alert('金额不可为负数');
                return;
            }
            if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                    alert("最多填写9位正数");
                    return;
                }
            }

            var marketprice = $(obj).parent().next().find('input:first').val();
            if (parseFloat(val) > parseFloat(marketprice)) {
                //$(obj).parent().next().find('span:first').html("不得大于市场价").css("color", "red");
                tip.html("不得大于市场价");
                return;
            }
            var maxprice = 9999999999;
            var hasprice = false;
            $("input[name='ComPrice']").each(function () {
                var s = $(this).val();
                if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                    maxprice = parseFloat(s);
                    hasprice = true;
                }
            });
            if (hasprice) {
                $("#commodityprice").val(maxprice);
            }
            tip.html("");
            tip.css("color", "");
            IsInput = true;
        }
        function CheckAttrMarketPrice(obj) {
            var val = $(obj).val();
            var tip = $(obj).next();
            tip.css("color", "red");
            if (val == "") {
                return;
            }
            if (!/^\d+(\.\d{2})?$/.test(val)) {
                if (!/^\d+(\.\d{1})?$/.test(val)) {
                    $(obj).val('0.00');
                    alert("请填写正确的金额最多保留2位小数");
                    return;
                }
            }
            if (val < 0) {
                $(obj).val('0.00');
                alert('金额不可为负数');
                return;
            }
            if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                    alert("最多填写9位正数");
                    return;
                }
            }

            var price = $(obj).parent().prev().find('input:first').val();
            if (parseFloat(val) < parseFloat(price)) {
                //$(obj).parent().next().find('span:first').html("不得大于市场价").css("color", "red");
                tip.html("不得小于现价");
                return;
            }

            var maxprice = 9999999999;
            var hasprice = false;
            $("input[name='MarketPrice']").each(function () {
                var s = $(this).val();
                if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                    maxprice = parseFloat(s);
                    hasprice = true;
                }
            });
            if (hasprice) {
                $("#commoditymarketprice").val(maxprice);
            }

            tip.html("");
            tip.css("color", "");
            IsInput = true;
        }
        function CheckAttrNum(obj) {
            var n = 0;
            $("input[name='ComStock']").each(function () {
                var s = $(this).val();
                if (s != "" && /^\d+?$/.test(s)) {
                    n += parseInt(s);
                }
            });
            $("#commoditystock").val(n);

            var v = $(obj).val();
            var tip = $(obj).next();
            tip.css("color", "red");
            if (v == "") {
                tip.html("不能为空");
                return;
            }
            if (!/^\d+?$/.test(v)) {
                tip.html("格式错误");
                return;
            }
            //            if (v <= 0) {
            //                tip.html("必须大于0");
            //                return;
            //            }

            tip.html("");
            tip.css("color", "");
            IsInput = true;
        }
        function checkMoneyRange(money, canZero, isNullable) {
            if ((money == "" || money == null) && isNullable) {
                return true;
            }
            if (canZero) {
                if (money > 999999999.99 || money < 0)
                    return false;
            } else {
                if (money > 999999999.99 || money <= 0)
                    return false;
            }
            return true;
        }
        function CheckAttrDuty(obj) {
            var val = $(obj).val();
            var tip = $(obj).next();
            tip.css("color", "red");
            tip.html("");
            if (val == "") {
                return;
            }
            if (!/^\d+(\.\d{2})?$/.test(val)) {
                if (!/^\d+(\.\d{1})?$/.test(val)) {
                    tip.html("格式错误");
                    return;
                }
            }
            if (val < 0) {
                $(obj).val('0.00');
                alert('金额不可为负数');
                return;
            }
            if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                    alert("最多填写9位正数");
                    return;
                }
            }

            var maxprice = 9999999999;
            var hasprice = false;
            $("input[name='Duty']").each(function () {
                var s = $(this).val();
                if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                    maxprice = parseFloat(s);
                    hasprice = true;
                }
            });
            if (hasprice) {
                $("#commodityduty").val(maxprice).removeClass('txtColor');
            } else {
                $("#commodityduty").val("请输入正数最多两位小数").addClass('txtColor');
            }

            tip.html("");
            tip.css("color", "");
            IsInput = true;
        }

        function CheckAttrCostPrice(obj) {
            var val = $(obj).val();
            var tip = $(obj).next().next();
            tip.css("color", "red");
            if (val == "") {
                $(obj).val('0.00');
                alert('金额不能为空');
                return;
            }
            if (!/^\d+(\.\d{2})?$/.test(val)) {
                if (!/^\d+(\.\d{1})?$/.test(val)) {
                    $(obj).val('0.00');
                    alert("请填写正确的金额最多保留2位小数");
                    return;
                }
            }
            if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                if (!/^\d{1,9}$|^\d{1,9}[.]\d{1,2}$/.test(val)) {
                    alert("最多填写9位正数");
                    return;
                }
            }

            val = parseFloat(val);
            if (val < 0) {
                $(obj).val('0.00');
                alert('金额不可为负数');
                return;
            }

            var maxprice = 9999999999;
            var hasprice = false;
            $("input[name='ComCostPrice']").each(function () {
                var s = $(this).val();
                if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                    maxprice = parseFloat(s);
                    hasprice = true;
                }
            });

            if (hasprice) {
                $("#costPrice").val(maxprice).removeClass('txtColor');
            }
            tip.html("");
            tip.css("color", "");
            IsInput = true;
        }

        function CheckAttrBarCode(obj) {
            var val = $(obj).val();
            var tip = $(obj).next();
            tip.css("color", "red");
            if (val == "") {
                tip.html("不能为空");
                return;
            }

            var maxprice = 9999999999;
            var barCode = '';
            var hasprice = false;
            $("input[name='ComPrice']").each(function () {
                var s = $(this).val();
                if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                    maxprice = parseFloat(s);
                    hasprice = true;
                    barCode = $(this).parent().next().next().next().next().next().children().eq(0).val();
                }
            });

            if (hasprice&&barCode==val) {
                $("#barCode").val(val).removeClass('txtColor');
            }

            tip.html("");
            tip.css("color", "");
            IsInput = true;
        }

        function CheckAttrCode(obj){
            var val = $(obj).val();
            var tip = $(obj).next();
            tip.css("color", "red");
            if (val == "") {
                return;
            }

            var maxprice = 9999999999;
            var barCode = '';
            var hasprice = false;
            $("input[name='ComPrice']").each(function () {
                var s = $(this).val();
                if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                    maxprice = parseFloat(s);
                    hasprice = true;
                    barCode = $(this).parent().next().next().next().next().next().next().children().eq(0).val();
                }
            });

            if (hasprice&&barCode==val) {
                $("#commoditycode").val(val).removeClass('txtColor');
            }
            
            tip.html("");
            tip.css("color", "");
            IsInput = true;
        }

        function CheckAttrJDCode(obj){
            var val = $(obj).val();
            var tip = $(obj).next();
            tip.css("color", "red");
            if (val == "") {
                return;
            }

            var maxprice = 9999999999;
            var barCode = '';
            var hasprice = false;
            $("input[name='ComPrice']").each(function () {
                var s = $(this).val();
                if (parseFloat(s) > 0 && maxprice > parseFloat(s)) {
                    maxprice = parseFloat(s);
                    hasprice = true;
                    barCode = $(this).parent().next().next().next().next().next().next().next().children().eq(0).val();
                }
            });

            if (hasprice&&barCode==val) {
                $("#jdCode").val(val).removeClass('txtColor');
            }
            
            tip.html("");
            tip.css("color", "");
            IsInput = true;
        }

        var msgError = "";
        function CheckAttr() {
            msgError = "";
            if (SelectAttr.length > 0) {
                if (FristAttrValueList.length <= 0) {
                    msgError = "商品" + SelectAttr[0].Name + "不能为空";
                    return false;
                }
            }

            if (SelectAttr.length > 1) {
                if (TwoAttrValueList.length <= 0) {
                    msgError = "商品" + SelectAttr[1].Name + "不能为空";
                    return false;
                }
            }
            return true;
        }

        var IsCanSumbit = true;
        function CheckData(price, stock) {
            if (stock == "" || price == "") {
                IsCanSumbit = false;
                return;
            }
            if (!/^\d+?$/.test(stock)) {
                IsCanSumbit = false;
                return;
            }
            if (!/^\d+(\.\d{2})?$/.test(price)) {
                if (!/^\d+(\.\d{1})?$/.test(price)) {
                    IsCanSumbit = false;
                    return;
                }
            }
            //            if (stock <= 0 || price<=0) {
            //                IsCanSumbit = false;
            //                return;
            //            }
        }

        // 获取用户输入的属性值
        function GetInputValue() {
            IsCanSumbit = true;
            var selectJson = "[";
            $("input[name='attrCache']").each(function () {
                var price = $(this).prev().val();
                var marketprice = $(this).parent().next().children().eq(0).val();
                var duty = $(this).parent().next().next().children().eq(0).val();
                if (duty == "" || duty == null || duty == undefined) {
                    duty = 0;
                }
                var stock = $(this).parent().next().next().next().children().eq(0).val();
                var CostPrice = $(this).parent().next().next().next().next().children().eq(0).val();
                var BarCode = $(this).parent().next().next().next().next().next().children().eq(0).val();
                var Code = $(this).parent().next().next().next().next().next().next().children().eq(0).val();
                var JDCode = $(this).parent().next().next().next().next().next().next().next().children().eq(0).val();

                // 计算图片地址
                var index = $(this).attr('data-tab-index');
                var ThumImg = $("#ComThumImgSrc"+index).val();
                var src = [];
                $("#sortable"+index).find('.one').each(function () {
                    src.push($(this).attr("src"));
                });
                var CarouselImgs = src.join(',');

                marketprice = $.trim(marketprice) == '' ? null : $.trim(marketprice);
                if (duty) {
                    if (!/^\d+(\.\d{2})?$/.test(duty)) {
                        if (!/^\d+(\.\d{1})?$/.test(duty)) {
                            IsCanSumbit = false;
                        }
                    }
                }

                marketprice = $.trim(marketprice) == '' ? null : $.trim(marketprice);
                if (duty) {
                    if (!/^\d+(\.\d{2})?$/.test(duty)) {
                        if (!/^\d+(\.\d{1})?$/.test(duty)) {
                            IsCanSumbit = false;
                        }
                    }
                }

                @if(ViewBag.IsYJBJ)
                {
                <text>
                if(!BarCode) {
                    IsCanSumbit = false;
                }
                </text>
                }

                var ComAttributeIds = decodeURIComponent($(this).val());
                ComAttributeIds = ComAttributeIds.substring(0, ComAttributeIds.length - 1);
                var t = '{"ComAttributeIds":' + ComAttributeIds + '],"Price":"' + price + '","Stock":"' + stock + '","Id":"' + $(this).next().val() + '","MarketPrice":' + marketprice + ',"Duty":' + duty + ',"CostPrice":"' + CostPrice + '","BarCode":"' + BarCode + '","Code":"' + Code + '","JDCode":"' + JDCode + '", "ThumImg":"' + ThumImg + '", "CarouselImgs":"' + CarouselImgs + '"}';
                if (selectJson == "[") {
                    selectJson += t;
                }
                else {
                    selectJson += "," + t;
                }
                if (IsCanSumbit) {
                    CheckData(price, stock);
                }
            });
            if (selectJson != "]") {
                selectJson += "]";
                return selectJson;
            }
            return "";
        }
        //校验市场价是否合法
        //市场价不能小于商品现价
        function CheckMarketPrice() {
            var result = true;
            var multAttr = false;
            $("input[name='attrCache']").each(function () {
                multAttr = true;
                var price = $(this).prev().val();
                var marketprice = $(this).parent().next().children().eq(0).val();
                if (parseFloat(price) > parseFloat(marketprice)) {
                    result = false;
                    return;
                }
            });
            if (!multAttr) {
                var price = $("#commodityprice").val();
                var marketprice = $("#commoditymarketprice").val();
                if (parseFloat(price) > parseFloat(marketprice)) {
                    result = false;
                }
            }
            return result;
        }
        //获取只有一个属性的字符串
        function GetOneAttrStr() {
            var attributeNames = "";
            var attributeIds = "";
            var attrName = "";
            var attrId = "";
            if (SelectAttr.length == 1) {
                for (var i = 0; i < FristAttrValueList.length; i++) {
                    if (i == 0) {
                        attributeNames = FristAttrValueList[i].Name;
                        attributeIds = FristAttrValueList[i].Id;
                    }
                    else {
                        attributeNames = attributeNames + "," + FristAttrValueList[i].Name;
                        attributeIds = attributeIds + "," + FristAttrValueList[i].Id;
                    }
                }
                attrId = SelectAttr[0].Id;
                attrName = SelectAttr[0].Name;
            }
            return { attrIds: attributeIds, attrNames: attributeNames, attrName: attrName, attrId: attrId };
        }
        function deleteNumber(str, type) {
            var arr = str.split(',');
            var tmpArr = [];
            var tmpObj = {};
            var tmpValue = '';
            for (var i = 0; i < arr.length; i++) {
                tmpValue = $.trim(arr[i]);
                if (!tmpObj[tmpValue] && tmpValue) {
                    if (tmpValue == '请选择商品编号') {
                        break;
                    }
                    tmpObj[tmpValue] = true;
                    tmpArr.push(tmpValue);
                }
            }
            return type ? tmpArr : tmpArr.join(',');
        }

        function ConfirmAppDistrictOption(arg) {
            if (arg.length > 0) {
                var saleAreas = "";
                var saleAreasText = "";
                for (var i = 0; i < arg.length - 1; i++) {
                    saleAreas += arg[i].AreaCode + ",";
                    saleAreasText += arg[i].AreaName + "、";
                }
                saleAreas += arg[arg.length - 1].AreaCode;
                saleAreasText += arg[arg.length - 1].AreaName;
                //alert(saleAreas);
                $("#SaleAreas").val(saleAreas);
                $("#saleAreastxt").text(saleAreasText);
            }
            else {
                $("#SaleAreas").val("");
                $("#saleAreastxt").text("未指定销售区域");
            }
            closeDivSetSaleAreasDialog();
        }
        function CancelAppDistrictOption() {
            closeDivSetSaleAreasDialog();
        }
        function GetAppDistrictOption() {
            var tem = $("#SaleAreas").val();
            var arg = tem;
            var code = arg.split(',');
            var a = new Array();
            for (var i = 0; i < code.length; i++) {
                a[i] = {};
                a[i].AreaCode = code[i];
            }
            return a;
        }
        function ShowDivSetSaleAreasDialog() {

            $("#divSetSaleAreasDialog").jhtablebox({
                height: 530,
                width: 632,
                resizable: false,
                title: "选择区域",
                position: [300, 125],
                modal: true,
                closedByHide: false
            });
            $("#divSetSaleAreasDialog").parent().css({ "position": "fixed", "top": 125, "left": 300 });

        }
        function closeDivSetSaleAreasDialog() {
            $("#divSetSaleAreasDialog").jhtablebox("close");
        }

        //        视频地址

        function VideoDivAlert() {

            $("#divSetVideoDialog").jhtablebox({
                height: 640,
                width: 850,
                resizable: false,
                title: "添加多媒体",
                position: [300, 50],
                modal: true,
                closedByHide: false
            });
            $("#divSetVideoDialog").parent().css({ "position": "fixed", "top": 50, "left": 300 });

        }
        function toDeleteVideo() {
            if ($("#VideoName").html()) {
                $("<div></div>").jhtablebox({
                    position: [300, 125],
                    type: "Confirm",
                    title: "消息提示",
                    content: "您确认要删除视频吗？",
                    autoOpen: true,
                    confirm: function () {
                        $("#deleVideo").hide();
                        $("#VideoName").html("");
                        $("#VideoUrl").html("");
                        $("#VideoWebUrl").html("");
                        $("#VideoPicUrl").html("");
                    }
                });

            } else {
                alert("没有可删除的视频！");
            }
        }
        function MediaSelectComplete(result) {
            if (result.operation == "confirm") {
                document.getElementById("VideoName").innerText = result.name;
                $("#deleVideo").show();
                document.getElementById("VideoUrl").innerText = result.clientUrl;
                document.getElementById("VideoWebUrl").innerText = result.url;
                document.getElementById("VideoPicUrl").innerText = result.thumbnailUrl;
            }

            $("#divSetVideoDialog").jhtablebox("close");
        }
        // 初始化上传图片
        function initUplodaImg() {
            $("#comdtyPicBtn").uploadify({
                'swf': '@Url.Content("~/scripts/uploadify/uploadify.swf")',
                'auto': true,
                'multi': false,
                'width': 80,
                'height': 28,
                'buttonText': '上传图片',
                'buttonImage': '/Content/images/btn80.png',
                'fileTypeDesc': 'Image',
                'fileTypeExts': '*.jpg;*.png',
                'preventCaching': true,
                'uploader': '/AppImage/DirectUploadWH',
                'formData': { "iHeight": 316, "iWidth": 316 },
                fileSizeLimit: '50KB',
                'onUploadSuccess': function (file, data, response) {
                    if (data != "false") {
                        if (data != "size" && data != "whsize") {
                            var httpurl = data;
                            $("#CommodityImg").attr("src", httpurl);
                            $('#picture').val(httpurl);
                            refreshLayout();
                        } else if (data == "size") {
                            alert("请上传50K以内的图片！");
                        } else {
                            alert("请按要求高度和宽度上传图片！");
                        }
                    } else {
                        alert("上传失败！");
                    }
                },
                'onUploadError': function (file, errorCode, errorMes) {
                    alert("上传失败，请稍后再试");
                },
                'onFallback': function () {
                    alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试");
                },
                fileSizeLimit: '50KB',
                onSelectError: function (file, errorCode, errorMsg) {
                    switch (errorCode) {
                        case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:
                            this.queueData.errorMsg = '建议图片小于50K！';
                            break;
                    }
                }
            });
        }

        var leftValue = 0;
        function initUplodaCommodityListPic() {
            $("#CommodityListPic").uploadify({
                'swf': '@Url.Content("~/scripts/uploadify/uploadify.swf")',
                'auto': true,
                'multi': false,
                'width': 85,
                'height': 85,
                'buttonText': '',
                'buttonImage': '/Images/comment_pic5.png',
                'fileTypeDesc': 'Image',
                'fileTypeExts': '*.jpg;*.png',
                'preventCaching': true,
                'uploader': '/AppImage/DirectUploadWH',
                'formData': { "iHeight": 640, "iWidth": 640 },
                'onUploadSuccess': function (file, data) {
                    if (data !== "false") {
                        if ($("#sortable").find('.one').length < 5) {
                            var a = newGuid();
                            var htmlContent = '<div id="' + a + '" class="img1">' +
                                  '<img src="{src}" name="" width="80" height="80" class="one">' +
                                  '<img src="/Images/finished.png" class="two" style="display: none">' +
                                  '<img src="/Images/close.jpg" class="two" style="top: 0px;" >' +
                                  '</div>';
                            htmlContent = htmlContent.replace("{src}", data);
                            $("#sortable").append(htmlContent);

                            leftValue = $("#addimg").css('margin-left');
                            if (leftValue === undefined) {
                                leftValue = 0;
                            } else {
                                leftValue = leftValue.substring(0, 3);
                            }
                            leftValue = parseInt(leftValue) + 114;
                            $("#addimg").css('margin-top', '-108px');
                            $("#addimg").css('margin-left', leftValue + "px");

                            getListImgSrcString();
                            //更新右部手机图
                            updateRight();
                            dialogImgClosed();
                        } else {
                            alert("最多只能上传5张图片！");
                        }

                    } else {
                        alert("上传失败！");
                    }
                },
                'onUploadError': function () {
                    alert("上传失败，请稍后再试");
                },
                'onFallback': function () {
                    alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试");
                },
                fileSizeLimit: '100KB',
                onSelectError: function (file, errorCode, errorMsg) {
                    switch (errorCode) {
                        case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:
                            this.queueData.errorMsg = '建议图片小于100K！';
                            break;
                    }
                }
            });
            $("#CommodityListPic-queue").remove();
        }
        function deleteImg(img) {
            if (img.parentNode !== undefined) {

                var $addimg = $(img).parent().parent().parent().children().eq(2);
                var cleftValue = $addimg.css('margin-left');
                cleftValue = parseInt(cleftValue.substring(0, 3)) - 114;
                if (cleftValue === 0) {
                    $addimg.css('margin-top', "0px");
                }
                $addimg.css('margin-left', cleftValue + "px");
                img.parentNode.remove();

                //leftValue = $("#addimg").css('margin-left');
                //leftValue = parseInt(leftValue.substring(0, 3)) - 114;
                //if (leftValue === 0) {
                //    $("#addimg").css('margin-top', "0px");
                //}
                //$("#addimg").css('margin-left', leftValue + "px");
            }
        }

        // 初始化商品SKU图片
        function initSKUCommodityPic() {
            var skuTotal = 0;
            if (SelectAttr.length == 2 && TwoAttrValueList.length > 0 && FristAttrValueList.length > 0) {
                skuTotal = TwoAttrValueList.length*FristAttrValueList.length;
            } else if(SelectAttr.length == 1 && TwoAttrValueList.length == 0 && FristAttrValueList.length > 0) {
                 skuTotal = FristAttrValueList.length;
            }
            if (skuTotal > 0) {
                for (let i=0;i<skuTotal;i++) {
                    // 缩略图
                    $("#ComThumPicBtn"+i).uploadify({
                        'swf': '@Url.Content("~/scripts/uploadify/uploadify.swf")',
                        'auto': true,
                        'multi': false,
                        'width': 60,
                        'height': 28,
                        'buttonText': '上传图片',
                        'buttonImage': '/Content/images/btn80.png',
                        'fileTypeDesc': 'Image',
                        'fileTypeExts': '*.jpg;*.png',
                        'preventCaching': true,
                        'uploader': '/AppImage/DirectUploadWH',
                        'formData': { "iHeight": 316, "iWidth": 316 },
                        'removeTimeout': 1,
                        'onUploadSuccess': function (file, data, response) {
                            if (data != "false") {
                                if (data != "size" && data != "whsize") {
                                    var httpurl = data;
                                    $("#ComThumImgContent"+i).html('<img src="' + data + '" name="" width="80" height="80" class="one"><a href="javasctipt:void(0)" class="del" >x</a>');
                                    $("#ComThumPicDelBtn"+i).show();
                                    $("#ComThumImgSrc"+i).val(httpurl);
                                    // ajaxSaveInfo();
                                } else if (data == "size") {
                                    alert("请上传50K以内的图片！");
                                } else {
                                    alert("请按要求高度和宽度上传图片！");
                                }
                            } else {
                                alert("上传失败！");
                            }
                        },
                        'onUploadError': function (file, errorCode, errorMes) {
                            alert("上传失败，请稍后再试");
                        },
                        'onFallback': function () {
                            alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试");
                        },
                        fileSizeLimit: '50KB',
                        onSelectError: function (file, errorCode, errorMsg) {
                            switch (errorCode) {
                                case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:
                                    this.queueData.errorMsg = '建议图片小于50K！';
                                    break;
                            }
                        }
                    });

                    // 轮播图
                    $("#CommodityListPic"+i).uploadify({
                        'swf': '@Url.Content("~/scripts/uploadify/uploadify.swf")',
                        'auto': true,
                        'multi': false,
                        'width': 85,
                        'height': 85,
                        'buttonText': '',
                        'buttonImage': '/Images/comment_pic5.png',
                        'fileTypeDesc': 'Image',
                        'fileTypeExts': '*.jpg;*.png',
                        'preventCaching': true,
                        'uploader': '/AppImage/DirectUploadWH',
                        'formData': { "iHeight": 640, "iWidth": 640 },
                        'onUploadSuccess': function (file, data) {
                            if (data !== "false") {
                                if ($("#sortable"+i).find('.one').length < 5) {
                                    var a = newGuid();
                                    var htmlContent = '<div id="' + a + '" class="img1">' +
                                            '<img src="{src}" name="" width="80" height="80" class="one">' +
                                            '<img src="/Images/finished.png" class="two" style="display: none">' +
                                            '<img src="/Images/close.jpg" class="two" style="top: 0px;" >' +
                                            '</div>';
                                    htmlContent = htmlContent.replace("{src}", data);
                                    $("#sortable"+i).append(htmlContent);

                                    leftValue = $("#addimg"+i).css('margin-left');
                                    if (leftValue === undefined) {
                                        leftValue = 0;
                                    } else {
                                        leftValue = leftValue.substring(0, 3);
                                    }
                                    leftValue = parseInt(leftValue) + 114;
                                    $("#addimg"+i).css('margin-top', '-108px');
                                    $("#addimg"+i).css('margin-left', leftValue + "px");
                                    dialogImgClosed();
                                    //保存数据到 cookie.
                                    // ajaxSaveInfo();
                                } else {
                                    alert("最多只能上传5张图片！");
                                }

                            } else {
                                alert("上传失败！");
                            }
                        },
                        'onUploadError': function () {
                            alert("上传失败，请稍后再试");
                        },
                        'onFallback': function () {
                            alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试");
                        },
                        fileSizeLimit: '100KB',
                        'onSelectError': function (file, errorCode, errorMsg) {
                            switch (errorCode) {
                                case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:
                                    this.queueData.errorMsg = '建议图片小于100K！';
                                    break;
                            }
                        }
                    });
                    $("#CommodityListPic"+i+"-queue").remove();
                }
                
                /***************Tabs***************/
                $('ul.tabs li').click(function(){
                    var tab_id = $(this).attr('data-tab');

                    $('ul.tabs li').removeClass('current');
                    $('.tab-content').removeClass('current');

                    $(this).addClass('current');
                    $("#"+tab_id).addClass('current');
                })
            } else {
                $("#tabContainer").empty();
            }
        }

        // 删除商品SKU缩略图
        function deleteComImg(img) {
            $(img).parent().prev().prev().val("");
            $(img).parent().html("");
        }
    </script>
</head>
<div class="box">
	<div id="bread" class="breadcrumb" >
        <span>修改商品记录</span>
        <span> > </span>
        <span style="color:red">商品详情</span>
        <a class="back" href="javascript:window.history.back();">
            <img src="/Content/images/wx-back.png"  /><span>&nbsp;返回上一级</span>
        </a>
    </div>
    <div class="content">
        <div class="right right1">
            <div class="spfb_t">
                <div class="spfb_t_l" style="width: 1200px">
                    <ul>
                        <li>
                            <h2>基本信息</h2>
                            <input type= "hidden" id ="commodityId" value ="@commodity.CommodityId" />
                        </li>
                        <li>
                            <span>商品类目：</span>
                            <input type="text" id="commoditycategory" readonly="readonly" value="@commodity.CateNames" />
                            <a  href="javascript:" >类目设置</a>
                        </li>
                        @if(ViewBag.IsYJBJ)
                        {
                        <li>
                            <img src="/Images/xin.png" /><span style="margin-left:0px;">商城品类：</span>
                            <input type="text" id="commodityInnerCategory" readonly="readonly" value="@commodity.InnerCateNames" />
                            @if(ViewBag.IsYJApp)
                            {
                            <a  href="javascript:" >品类设置</a>
                            }
                                <span style="coloe: gray">此品类为商城管理使用品类</span> </li>
                        }
                       @if (commodity.CommodityType==0)
                        {
                            <li><span>商品类型：</span>
                                <input id="idSW" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoCommodityType"
                                    value="0" checked="checked" />
                                <label for="idSW">
                                    实物商品</label>
                                <input id="idXN" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoCommodityType"
                                    value="1" />
                                <label for="idXN">
                                    虚拟商品（卡密）</label>
                            </li>
                        }
                        else
                        {
                            <li><span>商品类型：</span>
                                <input id="idSW" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoCommodityType"
                                    value="0"  />
                                <label for="idSW">
                                    实物商品</label>
                                <input id="idXN" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoCommodityType"
                                    value="1" checked="checked" />
                                <label for="idXN">
                                    虚拟商品（卡密）</label>
                            </li> 
                        }
                         @if (commodity.CommodityType == 1)
                         {
                         <li class="dxin"  id="liYJCouponActivityId">
                            <img src="/Images/xin.png" />
                            <span>活动编码：</span>
                            <input type="text" id="YJCouponActivityId" value="@commodity.YJCouponActivityId" class="txtColor"  maxlength="60"/>
                        </li>
                        <li class="dxin"  id="liYJCouponType">
                            <img src="/Images/xin.png" />
                            <span>类型编码：</span>
                            <input type="text" id="YJCouponType" value="@commodity.YJCouponType" class="txtColor" maxlength="60" />
                        </li>
                         }
                         
                        @if (ViewBag.IsYJBJ)
                        {
                        <li>
                            <img src="/Images/xin.png"/><span style="margin-left:0px;">商品条码：</span>
                            <input type="text" id="barCode" value="@commodity.BarCode" class="txtColor" />
                            <span style="margin: 0; color: red;"></span>
                            <input type="hidden" id="old_barCode" value="@commodity.BarCode" />
                        </li>
                        }
                        <li><span>商品编号：</span>
                            <input type="text" id="commoditycode" value="@NoCode" class="txtColor" maxlength="@Jinher.AMP.BTP.Common.InputControl.Commodity_NoCode_Length" />
                            <span style="margin: 0; color: red;"></span>
                            <input type="hidden" id="hid_code" value="@NoCode" />
                        </li>
                        @if(ViewBag.ShowJDCode)
                        {
                            <li>
                                <span>备注编码：</span>
                                <input type="text" id="jdCode" value="@commodity.JDCode" class="txtColor" />
                                <span style="margin: 0; color: red;"></span>
                            </li>
                        }
                        <li class="dxin">
                            <img src="/Images/xin.png" />
                            <span>商品名称：</span>
                            @if (isCustomES)
                            {
                                <input type="text" id="commodityname" value="@commodity.Name" class="txtColor" maxlength="60" />
                            }
                            else
                            {
                                <input type="text" id="commodityname" value="@commodity.Name" class="txtColor" maxlength="30" />
                            }
                            <input type="hidden" value="" id="commodityState" />
                        </li>
                        <li><span style="margin-left: 33px">市场价：</span>
                            @if (commodity.MarketPrice.HasValue)
                            {
                                <input onblur="CheckInputFloatKk(this)" type="text" id="commoditymarketprice" value="@commodity.MarketPrice.Value.ToString("0.##")" onchange="updateRight()"
				       maxlength="12"/>
                            }
                            else
                            {
                                <input onblur="CheckInputFloatKk(this)" type="text" id="commoditymarketprice" value="请输入正数最多两位小数"
                                    onchange="updateRight()" maxlength="12" class="txtColor" />
                            }
                            <span style="margin: 0">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                        </li>
                        <li class="dxin">
                            <img src="/Images/xin.png"/>
                            <span>商品现价：</span>
                            <input type="text" id="commodityprice" value="@commodity.Price" onchange="updateRight()" onblur="CheckInputFloatKk(this)" class="txtColor" maxlength="12"/><span></span>
                            <span style="margin: 0">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                        </li>
                        @if(ViewBag.IsYJBJ)
                        {
                        <li class="dxin">
                            <img src="/Images/xin.png"/>
                            <span style="margin-left: 13px">进货价：</span>
                            @if (commodity.CostPrice.HasValue)
                            {
                            <input type="text" id="costPrice" value="@commodity.CostPrice.Value" onchange="updateRight()" onblur="CheckInputFloatKk(this)" class="txtColor" maxlength="12"/>
                                
                            }
                            else
                            {                                
                            <input type="text" id="costPrice" value="请输入正数最多两位小数" onchange="updateRight()" onblur="CheckInputFloatKk(this)" class="txtColor" maxlength="12"/>                               
                            }
                            <span></span>
                            <span style="margin: 0">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                        </li>
                        }
                        <li class="dxin">
                            <img src="/Images/xin.png"/>
                            <span>税收编码：</span>
                            <input readonly="readonly" type="text" id="commodityTaxClassCode" value="@commodity.TaxClassCode"  maxlength="30" />
                        </li>
                        <li>
                        <li class="@(ViewBag.IsYJBJ?"dxin":"")">
                            @if (ViewBag.IsYJBJ)
                            {
                            <img src="/Images/xin.png"/>
                            <span style="margin-left: 15px;">销项税：</span>
                            }
                            else
                            {
                            <span style="margin-left: 35px">销项税：</span>
                            }
                            @if (commodity.CommodityTaxRate.HasValue)
                            {
                                <input onblur="CheckInputFloatKk(this)" type="text" id="commodityTaxRate" value="@commodity.CommodityTaxRate.Value.ToString("0.##")" onchange="updateRight()" maxlength="12"/>
                            }
                            else
                            {
                                <input onblur="CheckInputFloatKk(this)" type="text" id="commodityTaxRate" value="请输入正数最多两位小数"
                                       onchange="updateRight()" maxlength="12" class="txtColor"/>
                            }
                            <span style="margin: 0">%</span> </li>
                        <li class="@(ViewBag.IsYJBJ?"dxin":"")">
                            @if (ViewBag.IsYJBJ)
                            {
                            <img src="/Images/xin.png"/>
                            <span style="margin-left: 15px;">进项税：</span>
                            }
                            else
                            {
                            <span style="margin-left: 35px">进项税：</span>
                            }
                            @if (commodity.CommodityInputTax.HasValue)
                            {
                                <input onblur="CheckInputFloatKk(this)" type="text" id="commodityInputTax" value="@commodity.CommodityInputTax.Value.ToString("0.##")" onchange="updateRight()" maxlength="12"/>
                            }
                            else
                            {
                                <input onblur="CheckInputFloatKk(this)" type="text" id="commodityInputTax" value="请输入正数最多两位小数"
                                    onchange="updateRight()" maxlength="12" class="txtColor" />
                            }
                            <span style="margin: 0">%</span>
                        </li>
                        <li>
                            <span style="margin-left: 49px">关税：</span>
                            @if (commodity.CommodityDuty.HasValue)
                            {
                                <input onblur="CheckInputFloatKk(this)" type="text" id="commodityduty" value="@commodity.CommodityDuty.Value.ToString("0.##")" onchange="updateRight()" maxlength="12"/>
                            }
                            else
                            {
                                <input onblur="CheckInputFloatKk(this)" type="text" id="commodityduty" value="请输入正数最多两位小数" onchange="updateRight()" maxlength="12" class="txtColor" />
                            }
                            <span style="margin: 0">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()</span>
                        </li>
                        <li style="display: none;"><span>商品尺寸：</span>
                            <input type="text" id="commoditysize" readonly="readonly" value="@commodity.SizeNames" class="txtColor" />
                            <a   id="updatesize">尺寸设置</a>
                        </li>
                        <li style="display: none;"><span>商品颜色：</span>
                            <input type="text" id="commoditycolor" readonly="readonly" value="@commodity.ColorNames" class="txtColor" />
                            <a target="_self"  id="updatecolor">
                                颜色设置</a> </li>
                        <li><span>商品属性：</span>
                            <input type="text" id="commodityAttribute" value="请选择" readonly="readonly" class="txtColor" />
                            <a target="_self"  id="updatecolor">
                                属性设置</a></li>
                        <li style="display: none;" id="attrSelect1"><span id="commodityAttrNameTip1">商品属性1：</span>
                            <input type="text" id="commodityAttr1" value="请选择" readonly="readonly" class="txtColor" />
                            <a   id="updateAttr1">
                                设置</a></li>
                        <li style="display: none;" id="attrSelect2"><span id="commodityAttrNameTip2">商品属性2：</span>
                            <input type="text" id="commodityAttr2" value="请选择" readonly="readonly" class="txtColor" />
                            <a   id="updateAttr2">
                                设置</a> </li>
                        <li style="padding-left: 15px; width: 1050px; display: none;" id="attributeDecareli">
                            <table class="createtable" border="0" align="center" cellpadding="0" cellspacing="0"
                                id="attributeDecareTab">
                            </table>
                        </li>
                        <li class="dxin">
                            <img src="/Images/xin.png"/>
                            <span>商品数量：</span>
                            <input type="text" id="commoditystock" value="@commodity.Stock" class="txtColor"/><span>件</span>
                        </li>
                        <li class="dxin">
                            <img src="/Images/xin.png"/>
                            <span>计量单位：</span>
                            <input type="text" id="commodityUnit" value="@commodity.Unit"  maxlength="10"/>
                        </li>
                        <li class="@(ViewBag.IsYJBJ?"dxin":"")">
                            @if (ViewBag.IsYJBJ)
                            {
                            <img src="/Images/xin.png"/>
                            <span>计价方式：</span>
                            }
                            else
                            {
                            <span style="margin-left: 20px">计价方式：</span>
                            }
                            @if (commodity.PricingMethod == 1)
                            {
                                <input id="idJS" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoPriceMethod"
                                    value="0" />
                                <label for="idJS">
                                    按件数</label>
                                <input id="idZL" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoPriceMethod"
                                    value="1" checked="checked" />
                                <label for="idZL">
                                    按重量</label>
                            }
                            else
                            {                            
                                <input id="idJS" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoPriceMethod"
                                    value="0" checked="checked" />
                                <label for="idJS">
                                    按件数</label>
                                <input id="idZL" style="width: 15px; height: 13px; border: none;" type="radio" name="rdoPriceMethod"
                                    value="1" />
                                <label for="idZL">
                                    按重量</label>

                            }
                        </li>
                        <li class="dxin" style="display: none" id="liWeight">
                            <img src="/Images/xin.png" />
                            <span>重量参数：</span>
                            @if (commodity.Weight != 0)
                            {
                                <input type="text" id="commodityWeight" value='@string.Format("{0:0.#####}", commodity.Weight)'/>
                            }
                            else
                            {
                                <input type="text" id="commodityWeight" value="请输入正数" class="txtColor" />
                            }
                            <span>kg</span></li>
                        @if (ViewBag.ShowJDCode)
                        {
                        <li class="dxin">
                            <img src="/Images/xin.png"/>
                            <span>物流费用：</span>
                            <select id="commodityFreight" class="txtColor" style="width: 452px; height: 29px;">
                            </select>                            
                        </li>
                        <li class="dxin">
                            <img src="/Images/xin.png"/>
                            <span>销售区域：</span> <span id="saleAreastxt">@ViewBag.SaleAreasText</span> 
                            <a href="javascript:" id="updateTmpSaleAreas" >编辑区域</a>
                        </li>
                        }
                        else
                        {
                        <li><span>物流费用：</span>
                            <select id="commodityFreight" class="txtColor" style="width: 452px; height: 29px;">
                            </select>
                            <a target="_self"  id="updateFreight">物流模板设置</a></li>
                        <li><span>销售区域：</span> <span id="saleAreastxt">@ViewBag.SaleAreasText</span> <a href="javascript:"
                            id="updateTmpSaleAreas" >编辑区域</a> </li>
                        @* <li style="display:@ViewBag.IsAppInZPH"><span>
                            <input type="checkbox" id="chkIsEnableSelfTake" style="width: auto; height: auto;
                                cursor: pointer;" @selfTakeChk  />
                        </span>
                            <label for="chkIsEnableSelfTake" style="cursor: pointer">
                                支持自提</label>
                        </li>*@
                        }
                        <li>
                            <span>服务权益：<a href="javascript::">请点此选择支持的服务项</a></span>
                            <ul id="fwqy" style="margin:15px 0 0 70px;line-height:5px;">
                                <li>
                                   @if (commodity.IsAssurance==true) {
                                        <input id="IsAssurance"  type="hidden" name="IsAssurance" value="1" />
                                        <span>退换货：七天无理由退</span>
                                    }
                                    else {
                                         <input id="IsAssurance"  type="hidden" name="IsAssurance" value="0"/>
                                    }
                                </li>
                                <li>
                                    @if (commodity.IsReturns==true) {
                                        <input  id="IsReturns"  type="hidden" name="IsReturns" value="1" />
                                        <span>退换货：不支持退货</span>
                                    }
                                    else {
                                         <input  id="IsReturns"  type="hidden" name="IsReturns"  value="0"/>
                                    }
                                </li>
                            </ul>
                        </li>
                        <li><span>成交后送商品金额的</span>
                            @if (commodity.ScoreScale != 0)
                            {
                                <input type="text" class="txtColor" id="ScoreScale" value="@string.Format("{0:0.#####}", commodity.ScoreScale)" style="width: 80px; text-align: center; border-bottom: 1px solid #ccc;" />
                            }
                            else
                            {
                                <input type="text" class="txtColor" id="ScoreScale" style="width: 80px; text-align: center;
                                    border-bottom: 1px solid #ccc;" />
                            }
                            <span>%积分（请到支付方式菜单设置积分兑换汇率)</span></li>
                        <li>
                            <input id="CommodityIds" type="hidden" value="@commodity.RelaCommodityList" /><span>相关商品：</span>
                            <a  style="text-decoration: underline; cursor: pointer;">选择相关商品</a>&nbsp;&nbsp;&nbsp;<span
                                id="num">已选0件</span> </li>
                        <div id="VideoFunc">
                            <li>
                                <input id="CommodityVideo" type="hidden" value="" /><span>视频展示：</span> <a id="relationvideo"
                                     style="text-decoration: underline; cursor: pointer;">从资源库获取</a>&nbsp;&nbsp;&nbsp;<span
                                        id="VideoName">@VideoName</span> &nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" style="display: none"
                                            id="deleVideo" >删除</a></li>
                        </div>
                        <li class="spa">
                            <div style="display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex;
                                -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center;
                                align-items: center;">
                                <img src="/Images/xin.png" alt="" />
                                <span style="margin-left: -2px;">商品缩略图：<input type="file" id="comdtyPicBtn" style="display: none" /></span>
                                <span style="margin-left: 10px;">&nbsp;&nbsp;建议图片尺寸：316*316,小于50K</span>
                            </div>
                            <div>
                                <img class="tut" style="margin-top:10px;margin-left: 20px;" alt="" src="@commodity.PicturesPath"
					     width="110" height="110" id="CommodityImg"/>
                            </div>
                            <input type="hidden" id="picture" value="@commodity.PicturesPath" />
                        </li>
                    </ul>
                </div>
                <div id="uploadDiv" class='dialog pic-edit' style="top: 50px; margin-left: -300;
                    display: none">
                    <a title="关闭" class="close" href="#nogo" >关闭</a>
                    <div class="dialog-hd">
                        上传图片
                    </div>
                    <div class="custom-pic">
                        <div class="custom-pic-top">
                            <input type="file" id="file_upload" name="file_upload" />
                            <p>
                                请上传JPG、PNG格式的图片，建议上传尺寸为<br />
                                140px*140px的图片（图片过小会导致图片效果变虚）
                            </p>
                        </div>
                        <div id="custompicdiv" class="custom-pic-bd">
                            <input type="hidden" id="x1" name="x1" value="" />
                            <input type="hidden" id="y1" name="y1" value="" />
                            <input type="hidden" id="x2" name="x2" value="" />
                            <input type="hidden" id="y2" name="y2" value="" />
                        </div>
                    </div>
                    <div class="btn-center">
                        <a class="btn120" href="#nogo" >上传 </a><a class="btn120" href="#nogo"
                            >取消 </a>
                    </div>
                </div>
                <div class="spfb_t_r" style="margin-right:0px">
                    <ul>
                        <li>
                            <img src="/images/tele_top.png" alt="" width="240" height="15" /></li>
                        <li>
                            <img src="/images/add_pic.png" alt="" width="240" height="32" /></li>
                        <li>
                            <div id="showPrev" style="float: left; top: 50%; margin-top: -90px; position: absolute;
                                cursor: pointer">
                                <img src="/Images/m_prev.png" />
                            </div>
                            <div id="showNext" style="float: right; top: 50%; margin-top: -90px; position: absolute;
                                right: 0; cursor: pointer">
                                <img src="/Images/m_next.png" />
                            </div>
                            <div>
                                @if (commodity.Picturelist != null && commodity.Picturelist.Count > 0)
                                {
                                    <img id="showImg" src="@commodity.Picturelist[0]" alt="" width="240" height="181" />                                                    
                                }
                                else
                                {
                                    <img id="showImg" src="/Images/comment_pic5.png" alt="" width="240" height="181" />
                                }
                            </div>
                        </li>
                        <li class="one one1" style="position: absolute; top: 210px;">
                            <p>@commodity.Name</p>
                            <span>收藏</span> </li>
                        <li class="one one2">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()@commodity.Price</li>
                        <li class="one one4 flag1"><span class="col">@commodity.ColorNames</span></li>
                        <li class="one one4 flag2"><span class="siz">@commodity.SizeNames</span></li>
                        <li class="one one4">
                            <p>
                                <span class="fir">卖家包邮</span><span>月销量82笔</span><span>广东广州</span>
                            </p>
                        </li>
                        <li>
                            <img src="/images/add3.png" alt="" width="240" height="39" /></li>
                        <li class="one6"></li>
                        <li class="one5"><span class="spa1">加入购物车</span><span class="spa2">购买</span></li>
                    </ul>
                </div>
                <div style="clear: both;">
                </div>
            </div>
            <div class="spfb_b">
                <div class="spfb_b1">
                    <div class="spfb_b1t">
                        <span class="xint">*</span> <span class="zihao">商品详情页图样</span> <span>（</span>
                        <img src="/Images/xiaoshou.jpg" />
                        <span>直接拖动图片可调整顺序）</span><a id="batchUploadA" style="padding-left: 100px;" href="javascript:"
                            >批量上传图片</a><span style="margin-left: 10px;">&nbsp;&nbsp;建议图片尺寸：640*640或640*480，根据定制平台“商品轮播版式组件”的配置匹配尺寸,单张图小于100K，推荐使用640*640；</span>
                        @*<span style="float: right; padding-right: 15px;">
                            <input type="file" id="btn_file" style="display: none" />
                            <input id="selectAllInput" name="selectAllInput" type="checkbox" onpropertychange="toSelectAll(this)"
                                onchange="toSelectAll(this)" value="全选" />
                            <label for="selectAllInput">
                                全选</label>&nbsp&nbsp&nbsp&nbsp&nbsp<a href="javascript:void(0)" >删除</a></span>*@
                    </div>
                    <div class="spfb_b1c" id="sortable">
                        @if (commodity.Picturelist != null)
                        {
                            foreach (var picture in commodity.Picturelist)
                            {
                            <div class="img1">
                                <img src="@picture" width="80" height="80" class="one"/>
                                <img src="/Images/finished.png" class="two" style="display: none" />
                                <img src="/Images/close.jpg" class="two" style="top: 0px;" >
                            </div>
                            }
                        }
                    </div>
                    <div id="addimg" style="position: relative;margin-top:-108px; margin-left: @strleft; padding: 10px 0 13px 30px">
                        <img src="/Images/comment_pic5.png" id="CommodityListPic" /></div>
                </div>
                <div class="spfb_b1">
                    <div id="tabContainer">
                    </div>
                </div>
                <div class="spfb_b1">
                    <div class="spfb_b1t">
                        <span class="zihao1">描述内容</span>
                    </div>
                    <div id="textDiv" class="item" style="padding-left: 0px;">
                        <script type="text/plain" id="myEditor"></script>
                    </div>
                </div>
                <div class="spfb_b1">
                    <div class="spfb_b1t">
                        <span class="zihao1">规格参数：</span>
                    </div>
                    <div id="textTechSpecsDiv" class="item" style="padding-left: 0; width: 100%;">
                        <script type="text/plain" id="myTechSpecsEditor"></script>
                    </div>
                </div>
                <div class="spfb_b1">
                    <div class="spfb_b1t">
                        <span class="zihao1">售后说明：</span>
                    </div>
                    <div id="textSaleServiceDiv" class="item" style="padding-left: 0; width: 100%;">
                        <script type="text/plain" id="mySaleServiceEditor"></script>
                    </div>
                </div>
            </div>           
        </div>
    </div>
    <div class="floa11 addfloa2" id="attributeDIV">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" ></a><span>最多只能选择两项</span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="attributeUl">
                @foreach (var attr in AttributeList)
                {

                    <li>
                        <label>
                            <input type="checkbox" value="@attr.AttributeId"/><span>@attr.AttributeName</span></label></li>
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1>
            </h1>
            <a href="javascript:;" id="savecolor"  class="btn120"
                style="margin-top: 6px;">确定</a>
        </div>
    </div>
    <div class="floa11 addfloa2" id="attrDIV1">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" ></a><span id="attrtip1">
                请选择**信息</span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="attrUl1">
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1>
            </h1>
            <a href="javascript:;" id="savecolor"  class="btn120" style="margin-top: 6px;">
                确定</a>
        </div>
    </div>
    <div class="floa11 addfloa2" id="attrDIV2" style="z-index: 9999;">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" ></a><span id="attrtip2">
                请选择**信息</span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="attrUl2">
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1>
            </h1>
            <a href="javascript:;" id="savecolor"  class="btn120" style="margin-top: 6px;">
                确定</a>
        </div>
    </div>
    <div class="floa11 addfloa2" id="freightDIV" style="z-index: 9999;">
    </div>

@if (ViewBag.IsYJBJ)
{
    <div class="floa2 addfloa2" id="innerCategoryDiv">
        <!-- gyy -->
        <h1>
            <a href="javascript:;" class="close" ></a><span>选择商品品类</span>
        </h1>
        <div style="overflow-y: auto; height: 195px;">
            <ul class="first" id="tinnerCategoryUl">
                @foreach (var cate in innerCategorylist)
                {
                    <li class="firs">
                    <label>
                        @if (cate.SecondCategory == null || cate.SecondCategory.Count == 0)
                        {  
                              if(cate.Name==@commodity.InnerCateNames){
                                  <input name="cateogryClassLevel" type="radio" value="@cate.Id" checked="checked"/>
                              }
							  else{
                                  <input name="cateogryClassLevel" type="radio" value="@cate.Id"/>
                              }   
                        }
                        <span>@cate.Name</span>
                    </label>
                    <ul class="second">
                        @if (cate.SecondCategory == null) { cate.SecondCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.SCategorySDTO>(); }
                        @foreach (var scate in cate.SecondCategory)
                        {
                            <li class="firs firs1">
                                <label>
                                    @if (scate.ThirdCategory == null || scate.ThirdCategory.Count == 0)
                                    {
									    if(scate.Name==@commodity.InnerCateNames){
                                             <input name="cateogryClassLevel" type="radio" value="@scate.Id" checked="checked"/>
                                        }else{
                                          <input name="cateogryClassLevel" type="radio" value="@scate.Id" />
                                        }
                                    }
									<span>@scate.Name</span>
                                </label>
                                <ul class="third">
                                    @if (scate.ThirdCategory == null) { scate.ThirdCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.TCategorySDTO>(); }
                                    @foreach (var tcate in scate.ThirdCategory)
                                    {
                                        <li>
                                            <label>                                                
                                                @if(tcate.Name==@commodity.InnerCateNames){
                                                <input name="cateogryClassLevel" type="radio" value="@scate.Id" checked="checked"/>
                                                }else{
                                                <input name="cateogryClassLevel" type="radio" value="@scate.Id" />
                                                }<span>@tcate.Name</span>
                                            </label>
                                        </li>
                                    }
                                </ul>
                            </li>
                        }
                    </ul>
                </li>
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1>
            </h1>
            <a href="javascript:;" id="saveInnerCategory"  class="btn120"
                style="margin-top: 6px;">确定</a>
        </div>
    </div>
}

    <div class="floa2 addfloa2" id="categoryDiv">
        <!-- gyy -->
        <h1>
            <a href="javascript:;" class="close" ></a>
            <spano>
            选择类目信息</span>
        </h1>
        <div style="overflow-y: auto; height: 195px;">
            <ul class="first" id="tcategoryUl">
                @foreach (var cate in categorylist)
                {
                    <li class="firs">
                        <label>
                            @if (cate.SecondCategory == null || cate.SecondCategory.Count == 0)
                            {
                                <input name="cateogryClassLevel1" type="checkbox" value="@cate.Id"/>
                            }<span>@cate.Name</span>
                        </label>
                        <ul class="second">
                            @if (cate.SecondCategory == null) { cate.SecondCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.SCategorySDTO>(); }
                            @foreach (var scate in cate.SecondCategory)
                            {
                                <li class="firs firs1">
                                    <label>
                                        @if (scate.ThirdCategory == null || scate.ThirdCategory.Count == 0)
                                        {
                                            <input name="cateogryClassLevel2" type="checkbox" value="@scate.Id"/>
                                        }<span>@scate.Name</span>
                                    </label>
                                    <ul class="third">
                                        @if (scate.ThirdCategory == null) { scate.ThirdCategory = new List<Jinher.AMP.BTP.Deploy.CustomDTO.TCategorySDTO>(); }
                                        @foreach (var tcate in scate.ThirdCategory)
                                        {
                                            <li>
                                                <label>
                                                    <input name="cateogryClassLevel3" type="checkbox"
								       value="@tcate.Id"/><span>@tcate.Name</span>
                                                </label>
                                            </li>
                                        }
                                    </ul>
                                </li>
                            }
                        </ul>
                    </li>
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1>
            </h1>
            <a href="javascript:;" id="savecategory"  class="btn120"
                style="margin-top: 6px;">确定</a>
        </div>
    </div>
    <div class="floa1 addfloa2" id="sizeDIV">
        <!-- gyy -->
        <h1>
            <a href="javascript:;" class="close" ></a><span>选择尺寸信息</span>
        </h1>
        <div style="overflow-y: auto; height: 160px;">
            <!-- gyy 195 -->
            <ul class="first" id="sizeUl">
                @foreach (var size in Sizelist)
                {
                    <li>
                        <label>
                            <input type="checkbox" value="@size.Id" /><span>@size.Name</span>
                        </label>
                    </li>
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1>
            </h1>
            <a href="javascript:;" id="savesize"  class="btn120" style="margin-top: 6px;">
                确定</a>
        </div>
    </div>
    <div class="floa11 addfloa2" id="colorDIV">
        <!--gyy -->
        <h1>
            <a href="javascript:;" class="close" ></a><span>选择颜色信息</span>
        </h1>
        <div style="overflow-y: auto; height: 150px;">
            <ul class="first" id="colorUl">
                @foreach (var color in Colorlist)
                {
                    <li>
                        <label>
                            <input type="checkbox" value="@color.Id"/><span>@color.Name</span></label></li>                                                           
                }
            </ul>
        </div>
        <div class="bbtn" style="text-align: center;">
            <h1>
            </h1>
            <a href="javascript:;" id="savecolor"  class="btn120" style="margin-top: 6px;">
                确定</a>
        </div>
    </div>
    <div id="divSetSaleAreasDialog" style="display: none;">
        <div>
            <input type="hidden" id="SaleAreas" value="@commodity.SaleAreas" />
            <iframe style="width:100%;height:600px; scroll:auto; border:0;" src="@ViewBag.ProvinceCityUrl">
            </iframe>
        </div>
    </div>
    @*视频地址*@
    <div id="divSetVideoDialog" style="display: none;">
        <div>
            <span style="display: none" id="VideoName"></span><span style="display: none" id="VideoUrl">@ViewBag.VideoUrl</span>
            <span style="display: none" id="VideoWebUrl">@ViewBag.VideoWebUrl</span> <span style="display: none"
                id="VideoPicUrl">@ViewBag.VideoPicUrl</span>
            <iframe style="width:100%;height:600px; scroll:auto; border:0;" src="@ViewBag.VideoHost">
            </iframe>
        </div>
    </div>
    <div id="loadImgDiv" style="overflow: hidden; width: auto; min-height: 0; height: 470px;
        display: none;">
        <iframe id="contentFrame" name="contentFrame" scrolling="no" src="" height="480"
            width="630" frameborder="0" style="border: 0; overflow: hidden;"></iframe>
    </div>
    <div id="uploadImgBatchDiv">
        <iframe id="uploadImgBatchIframe" style="width: 100%; height: 600px; scroll: auto;
            border: 0;"></iframe>
    </div>
<div id="loadCommodityList" style="overflow: hidden; width: auto; min-height: 0;
                                                               height: 470px; display: none;">
    <iframe id="commodityListFrame" name="commodityListFrame" scrolling="yes" src=""
            frameborder="0" style="border: 0; overflow: hidden; padding: 0; margin: 0; height: 630px;
                                                                              width: 939px" width="939"></iframe>
</div>
<div style="display: none">
    <input id="IsHaveMallApply" hidden="hidden" value="@ViewBag.IsHaveMallApply"/>
</div>
<div id="dialogSelectCode" style="display: none;">
    <iframe id="MyIframeSelectCode" frameborder="0" style="width: 100%; height: 700px;
        overflow-y: auto; border: 0px;"></iframe>
</div>

<div class="tanchu" id="ServiceData" style="margin-top:450px; width: 500px;height:400px;">
        <div style="height: 20px;color: #555;padding: 5px 15px;position: relative;background: #efefef;overflow: hidden;">
            <span>选择服务项设置</span><a style="position: absolute;top: 5px;right: 15px;font-size: 14px; cursor:pointer;" >x</a>
        </div>

        <div style="width:100%;height:300px;overflow-y:auto;margin-top:10px;">
             <ul id="Service" style="margin:5px 0 0 25px">
                <li>
                   <input  name="items" type="checkbox"  value="0" />
                   <span>退换货：七天无理由退</span>
                </li>
                 <li>
                   <input  name="items" type="checkbox"  value="0"  />
                   <span>退换货：不支持退货</span>
                </li>
            </ul>
        </div>
        <div class="tanchu_r">
            <div style="text-align:center;">
                <button  id="btnExportData">确定</button>
                &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
                <button > 取消</button>
            </div>
            
        </div>
 </div>

<script type="text/javascript">

    $(function(){
       var str='@commodity.ServiceSettingId';
       if(str.length>0)
       {
            $.ajax({
                type:"post",
                url:"@Url.Action("GetServiceSettings","Commodity")",
                data:{ids:str},
                success: function (data) {
                    var html="";
                    if(data!=null){
                        if(data.length>0){
                            for(var i=0;i<data.length;i++) {
                                html+='<li><input   type="hidden" name="ServiceSettingId" value="'+data[i].Id+'" /><span>'+data[i].Title+':'+data[i].Content+'</span><li>';
                            }
                        }

                    }
                    $("#fwqy").append(html);
                },
                error: function ()
                {
                    alert("操作失败");
                }
            });
       }

    })
    

       //弹出导出    
    function ShowServiceData() {

        $("#ServiceData").OpenDiv();
        $("#Service").find("li:gt(1)").empty();
        $.ajax({
            type: "post",
            url: "@Url.Action("GetAllServiceSettings","Commodity")",
            data:{AppId:'@ViewBag.AppId'},
            success: function (data) {
                var html="";
                if(data.length>0){
                    for(var i=0;i<data.length;i++) {
                        html+='<li><input name="items"  type="checkbox"  value="'+data[i].Id+'" /> <span>'+data[i].Title+'：'+data[i].Content+'</span></li>';
                    }
                }
                $("#Service").append(html);
                Checkitem();
            },
            error: function ()
            {
                alert("操作失败");
            }
        });
    }


    //获取选中的值
    function  Checkitem(){

        if($("input[name='IsAssurance']").val()==1){
            $("input[name='items']:eq(0)").prop("checked",true);
        }
        
        if($("input[name='IsReturns']").val()==1){
            $("input[name='items']:eq(1)").prop("checked",true);
        }

        var ServiceSettingIds=[];
        $("input[name='ServiceSettingId']").each(function(){
            ServiceSettingIds.push($(this).val());
        });
        
        var resval="";
        $("input[name='items']:gt(1)").each(function(){
            resval=$(this).val();
            for(var i=0;i<ServiceSettingIds.length;i++){
               if(ServiceSettingIds[i]==resval) 
               {
                  $(this).prop("checked",true);
               }
            }

        });
    }

    //关闭服务项设置  
    function serviceclose() {
        $("#ServiceData").CloseDiv();
    }
    
    //添加数据
    function serviceAdd() {
        $("#ServiceData").CloseDiv();
        $("#fwqy").empty();
        var html="";
        $("input[name='items']").each(function(){
            var Id="";
            var Content="";
            if ($(this).attr("checked")) {   
                Id=$(this).val();
                Content = $(this).next().text();
                if(Content=="退换货：七天无理由退"){
                   html+='<li><input id="IsAssurance"  type="hidden" name="IsAssurance" value="1" /><span>退换货：七天无理由退</span><li>';
                }
                else if(Content=="退换货：不支持退货"){
                   html+='<li><input id="IsReturns"  type="hidden" name="IsReturns" value="1" /><span>退换货：不支持退货</span><li>';
                }
                else {
                   html+='<li><input   type="hidden" name="ServiceSettingId" value="'+Id+'" /><span>'+Content+'</span><li>';
                }
            }

        });
        $("#fwqy").append(html);
        $("input[name='items']").prop("checked",false);
    }





        function umeditorCheckImgSize(size) {
            if (size > 500 * 1000) {
                alert("最大只能上传500KB");
                return false;
            }
            return true;
        }
        //选择“虚拟商品（卡密）”后，出现“活动编码”和“类型编码”;
        //$("input[name=rdoCommodityType]").change(function () {
        //    switch ($("input[name=rdoCommodityType]:checked").attr("value")) {
        //        case "1":
        //            $("#liYJCouponActivityId").show();
        //            $("#liYJCouponType").show();                   
        //            break;
        //        case "0":
        //            $("#liYJCouponActivityId").hide();
        //            $("#liYJCouponType").hide();
        //            break;
        //        default:
        //            break;
        //    }
        //});
         //商品编辑页面设置商品类型为只读
         $("input[name=rdoCommodityType]").attr("disabled",true);
        //商品编码验证
        $("#YJCouponActivityId").focus(function () {
            if (this.value == '最多60个字') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '最多60个字';
                $(this).addClass("txtColor");
            }
            updateRight();
        }).each(function () {
            if (this.value == '最多60个字') {
                $(this).addClass("txtColor");
            }
        });
        //类型编码验证
        $("#YJCouponType").focus(function () {
            if (this.value == '最多60个字') {
                this.value = '';
                $(this).removeClass("txtColor");
            }
        }).blur(function () {
            if (this.value == '') {
                this.value = '最多60个字';
                $(this).addClass("txtColor");
            }
            updateRight();
        }).each(function () {
            if (this.value == '最多60个字') {
                $(this).addClass("txtColor");
            }
        });
        var ue = UM.getEditor('myEditor', {
            //这里可以选择自己需要的工具按钮名称
            toolbar: ['undo redo | bold italic underline strikethrough | forecolor | removeformat |',
            'insertorderedlist insertunorderedlist | selectall cleardoc | paragraph fontsize',
            '| justifyleft justifycenter justifyright justifyjustify |',
            'link unlink | image | horizontal fullscreen'],
            //focus时自动清空初始化时的内容
            autoClearinitialContent: false,
            //是否开启字数统计

            wordCount: true,
            //允许的最大字符数
            maximumWords: 2000,
            //关闭elementPath
            elementPathEnabled: true,
            //默认的编辑区域高度
            initialFrameHeight: 300,
            //宽度 
            initialFrameWidth: "100%",
            //自适应高度
            autoHeightEnabled: false,
            //工具条保持不动
            autoFloatEnabled: false,
            zIndex: 4,
            //更多其他参数，请参考umeditor.config.js中的配置项
            filterRules: function () {
                return {
                    //$:{}表示不保留任何属性
                    p: { $: {} },
                    h3: { $: {} },
                    h2: { $: {} },
                    img: function (node) {
                        var src = node.getAttr('src');
                        node.setAttr();
                        node.setAttr({ 'src': src })
                    },
                    //黑名单，以下标签及其子节点都会被过滤掉
                    '-': 'script style meta iframe embed object'
                }
            } ()
        });
        ue.setContent('@Html.Raw(@commodity.Description)');
        

        var techSpecsEditor = UM.getEditor('myTechSpecsEditor', {
            //这里可以选择自己需要的工具按钮名称
            toolbar: ['undo redo | bold italic underline strikethrough | forecolor | removeformat |',
            'insertorderedlist insertunorderedlist | selectall cleardoc | paragraph fontsize',
            '| justifyleft justifycenter justifyright justifyjustify |',
            'link unlink | image | horizontal fullscreen'],
            //focus时自动清空初始化时的内容
            autoClearinitialContent: false,
            //是否开启字数统计

            wordCount: true,
            //允许的最大字符数
            maximumWords: 2000,
            //关闭elementPath
            elementPathEnabled: true,
            //默认的编辑区域高度
            initialFrameHeight: 300,
            //宽度 
            initialFrameWidth: "100%",
            //自适应高度
            autoHeightEnabled: false,
            //工具条保持不动
            autoFloatEnabled: false,
            zIndex: 4,
            //更多其他参数，请参考umeditor.config.js中的配置项
            filterRules: function () {
                return {
                    //$:{}表示不保留任何属性
                    p: { $: {} },
                    h3: { $: {} },
                    h2: { $: {} },
                    img: function (node) {
                        var src = node.getAttr('src');
                        node.setAttr();
                        node.setAttr({ 'src': src })
                    },
                    //黑名单，以下标签及其子节点都会被过滤掉
                    '-': 'script style meta iframe embed object'
                }
            } ()
        });
        techSpecsEditor.setContent('@Html.Raw(@commodity.TechSpecs)');


        var saleServiceEditor = UM.getEditor('mySaleServiceEditor', {
            //这里可以选择自己需要的工具按钮名称
            toolbar: ['undo redo | bold italic underline strikethrough | forecolor | removeformat |',
            'insertorderedlist insertunorderedlist | selectall cleardoc | paragraph fontsize',
            '| justifyleft justifycenter justifyright justifyjustify |',
            'link unlink | image | horizontal fullscreen'],
            //focus时自动清空初始化时的内容
            autoClearinitialContent: false,
            //是否开启字数统计

            wordCount: true,
            //允许的最大字符数
            maximumWords: 2000,
            //关闭elementPath
            elementPathEnabled: true,
            //默认的编辑区域高度
            initialFrameHeight: 300,
            //宽度 
            initialFrameWidth: "100%",
            //自适应高度
            autoHeightEnabled: false,
            //工具条保持不动
            autoFloatEnabled: false,
            zIndex: 4,
            //更多其他参数，请参考umeditor.config.js中的配置项
            filterRules: function () {
                return {
                    //$:{}表示不保留任何属性
                    p: { $: {} },
                    h3: { $: {} },
                    h2: { $: {} },
                    img: function (node) {
                        var src = node.getAttr('src');
                        node.setAttr();
                        node.setAttr({ 'src': src })
                    },
                    //黑名单，以下标签及其子节点都会被过滤掉
                    '-': 'script style meta iframe embed object'
                }
            } ()
        });
        saleServiceEditor.setContent('@Html.Raw(@commodity.SaleService)');
    </script>
    <script type="text/javascript">

        //以下为图片批量上传所用

        //在页面中添加图片
        function loadBatchUploadListImg(imgListArry) {
            var listImgSrc = imgListArry;
            for (var i = 0; i < listImgSrc.length; i++) {
                if (listImgSrc[i] != "") {
                    var htmlContent = $('<div class="img1">' +
                        '<img src="" name="" width="80" height="80" class="one">' +
                        '<img src="/Images/finished.png" class="two" style="display: none">' +
                        '<img src="/Images/close.jpg" class="two" style="top: 0px;" >' +
                        '</div>');
                    var clone = htmlContent.clone();
                    clone.find('.one').attr('src', listImgSrc[i]).attr('name', listImgSrc[i]);
                    $("#sortable").append(clone);

                    leftValue = $("#addimg").css('margin-left');
                    if (leftValue === undefined) {
                        leftValue = 0;
                    } else {
                        leftValue = leftValue.substring(0, 3);
                    }
                    leftValue = parseInt(leftValue) + 114;
                    $("#addimg").css('margin-top', '-108px');
                    $("#addimg").css('margin-left', leftValue + "px");

                    //更新右部手机图
                    updateRight();
                    dialogImgClosed();
                    // 保存数据到 cookie.
                    // ajaxSaveInfo();
                }
            }
        }

        //图片批量上传的url
        var curUrl = window.location.href;
        var uploadImgBatchIframeUrl = "/ImgBatchUpload/Index" + curUrl.substring(curUrl.indexOf("?"));

        //打开
        function uploadImgBatch() {
            var icount = $("#sortable").find('.one').length;
            if (icount >= 5) {
                alert('最多只能上传5张图片');
                return;
            }
            $("#uploadImgBatchIframe").attr("src", uploadImgBatchIframeUrl);
            $("#uploadImgBatchDiv").jhtablebox({
                title: "批量上传图片",
                width: 710,
                height: 490,
                modal: true,
                resizable: false
            });
        }
        //初时加载
        function loadBatchParam() {
            var objLoad = {};
            var icount = $("#sortable").find('.one').length;
            objLoad.Width = 640;
            objLoad.Height = 480;
            objLoad.Size = 50;
            objLoad.Accept = [".png", ".jpg", ".jpeg"];
            objLoad.Count = 5;
            objLoad.iCount = icount;
            objLoad.Url = "/Handler/ImgBatchUploadHandler.ashx";
            objLoad.fileSizeLimit = 100;
            return objLoad;
        }
        //关闭
        function uploadImgBatchClose() {
            $("#uploadImgBatchDiv").jhtablebox("close");
        }
        //确定
        function uploadImgBatchConfirm(obj) {
            $("#uploadImgBatchDiv").jhtablebox("close");
            if (obj && obj.Url) {
                loadBatchUploadListImg(obj.Url);
            }
        }
        function newGuid() {
            var guid = "";
            for (var i = 1; i <= 32; i++) {
                var n = Math.floor(Math.random() * 16.0).toString(16);
                guid += n;
                if ((i == 8) || (i == 12) || (i == 16) || (i == 20))
                    guid += "-";
            }
            return guid;
        }
        function setCodeData(id) {
            $('#commodityTaxClassCode').val(id);
        }

        function closeTbBox() {
            $("#dialogSelectCode").jhtablebox("close");
        }
		$("input").attr('disabled',"true");		
		$("button").attr('disabled',"true");
    </script>
