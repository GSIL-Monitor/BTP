@using System
@using System.Collections.Generic
@using System.Linq
@using System.Web
@{
    ViewBag.Title = "订单管理";
    List<Jinher.AMP.BTP.Deploy.CustomDTO.CommodityOrderVM> commodityOrderList = ViewBag.commodityOrderList;
    List<int> stwog = Jinher.AMP.BTP.UI.Models.PaySourceVM.GetSecTransWithoutGoldPayment();
    string stwogStr = "," + string.Join(",", stwog) + ",";

}
@helper getPayment(int payment)
    {
        switch (payment)
        {
            case 0:
    <text>（金币支付）</text>
                break;
            case 1:
    <text>（货到付款）</text>
                break;
            case 2:
    <text>（支付宝直接到账）</text>
                break;
            case 3:
    <text>（支付宝担保交易）</text>
                break;
            case 4:
    <text>（U付）</text>   
                break;
            default:
    <text></text>
                break;
        }
}
@helper getTimeState(Jinher.AMP.BTP.Deploy.CustomDTO.CommodityOrderVM order)
    {
        switch (order.State)
        {
            case 0:
    <text>提交订单时间：@order.SubTime</text>
            break;
            case 1:
            if (order.Payment != 1)
            {
    <text>付款时间：@order.PaymentTime</text>
            }
            else
            {
    <text>提交订单时间：@order.SubTime</text>
            }
            break;
            case 2:
    <text>发货时间：@order.ShipmentsTime</text>
          break;
            case 3:
          switch (order.StateAfterSales)
          {
              case -1:
              case 3:
    <text>成交时间：@order.ConfirmTime</text>
          break;
              case 5:
    <text>申请退款时间：@order.RefundTime</text>
            break;
              case 7:
    <text>交易失败时间：@order.ModifiedOnServiceAfterSales</text>
            break;
              case 10:
    <text>达成协议时间：@order.AgreementTime</text>
            break;
              case 12:
    <text>达成协议时间：@order.ModifiedOnServiceAfterSales</text>
            break;
              case 13:
    <text>达成协议时间：@order.ModifiedOnServiceAfterSales</text>
            break;
              case 15:
    <text>解冻时间：@order.ModifiedOnServiceAfterSales</text>
          break;
              default:
    <text>成交时间：@order.ConfirmTime</text>
          break;
          }

          break;
            case 4:
    <text>取消订单时间：@order.ConfirmTime</text>
            break;
            case 5:
    <text>取消订单时间：@order.ConfirmTime</text>
            break;
            case 6:
    <text>交易失败时间：@order.ConfirmTime</text>
            break;
            case 7:
    <text>交易失败时间：@order.ConfirmTime</text>
            break;
            case 8:
    <text>申请退款时间：@order.RefundTime</text>
            break;
            case 9:
    <text>申请退款时间：@order.RefundTime</text>
            break;
            case 10:
    <text>达成协议时间：@order.AgreementTime</text>
            break;
            case 11:
    <text>付款时间：@order.PaymentTime</text>
          break;
            case 12:
    <text>达成协议时间：@order.ConfirmTime</text>
            break;
            case 13:
    <text>出库时间：@order.ShipmentsTime</text>
          break;
            default:
          break;

        }
}
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>订单管理</title>
    <script src="/Scripts/CommLib.js" type="text/javascript"></script>
    <script type="text/javascript" src="/Scripts/jquery.watermark.js"></script>
    <script src="/Scripts/pic/jquery.imgbox.pack.js" type="text/javascript"></script>
    <script src="/Scripts/TableBox/jquery.ui.jhtablebox.js" type="text/javascript"></script>
    <script src="/Scripts/DatePicker/jquery.ui.datepicker.js" type="text/javascript"></script>
    <script src="/Scripts/DatePicker/jquery.ui.jhdatetime.js" type="text/javascript"></script>
    <script src="/Scripts/DatePicker/jquery.ui.jhstartandenddate.js" type="text/javascript"></script>
    <script src="/Scripts/Validator/JValidator.js" type="text/javascript"></script>

    <script type="text/javascript">
        var ServerClock =

            function (sTime) {

                //估计从服务器下载网页到达客户端的延时时间，默认为1秒。

                var _delay = 0;



                //服务器端的时间

                var serverTime = null;

                if (arguments.length == 0) {

                    //没有设置服务器端的时间，按当前时间处理

                    serverTime = new Date();

                    _delay = 0;

                }

                else

                //  serverTime = new Date(s_year, s_month - 1, s_day, s_hour, s_min, s_sec);

                    serverTime = new Date(sTime);

                //客户端浏览器的时间

                var clientTime = new Date();

                //获取时间差

                //  alert("serverTime.getTime():" + serverTime.getTime() + "--clientTime.getTime():" + clientTime.getTime());
                var _diff = serverTime.getTime() - clientTime.getTime();



                //设置从服务器下载网页到达客户端的延时时间，默认为1秒。

                this.set_delay = function (value) { _delay = value; };



                //获取服务的日期时间

                this.get_ServerTime = function (formatstring) {

                    clientTime = new Date();

                    serverTime.setTime(clientTime.getTime() + _diff + _delay);
                    //alert(clientTime.getTime()+"--- diff --" +_diff);
                    if (formatstring == null)

                        return serverTime;

                    else

                        return serverTime.format(formatstring);

                };

            }

        Date.prototype.format = function (format) {
            var o = {
                "M+": this.getMonth() + 1, //month 
                "d+": this.getDate(), //day 
                "h+": this.getHours(), //hour 
                "m+": this.getMinutes(), //minute 
                "s+": this.getSeconds(), //second 
                "q+": Math.floor((this.getMonth() + 3) / 3), //quarter 
                "S": this.getMilliseconds() //millisecond 
            }

            if (/(y+)/.test(format)) {
                format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            }

            for (var k in o) {
                if (new RegExp("(" + k + ")").test(format)) {
                    format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
                }
            }
            return format;
        }


    </script>
    <style type="text/css">
        ::-webkit-scrollbar
        {
            width: 14px;
            height: 14px;
        }
        ::-webkit-scrollbar-track, ::-webkit-scrollbar-thumb
        {
            border-radius: 999px;
            border: 5px solid transparent;
        }
        ::-webkit-scrollbar-track
        {
            box-shadow: 1px 1px 5px rgba(0,0,0,.2) inset;
        }
        ::-webkit-scrollbar-thumb
        {
            min-height: 20px;
            background-clip: content-box;
            box-shadow: 0 0 0 5px rgba(0,0,0,.2) inset;
        }
        ::-webkit-scrollbar-corner
        {
            background: transparent;
        }
        
        
        #content
        {
            padding: 10px;
        }
        .runw
        {
            width: 80px;
            text-align: right;
            height: 40px;
        }
        .brunw
        {
            width: 150px;
            text-align: right;
            height: 10px;
        }
        .txtColor
        {
            width: 180px !important;
        }
        .spfb_t_l table tr
        {
            height: 40px;
        }
        .pingz
        {
            margin-right: 14px;
        }
        .dxq_title .on
        {
            background: url('/images/biao.jpg') 0 no-repeat;
            width: 125px;
            height: 34px;
            line-height: 32px;
            text-align: center;
            color: #454f58;
        }
        
        .dxq_title .xian
        {
            width: 64px;
            height: 3px;
            border-top: 3px solid #dde1e4;
            margin-top: 15px;
        }
        
        .dxq_title .tw
        {
            background: url('/images/biao2.jpg') 0 no-repeat;
            width: 125px;
            height: 34px;
            line-height: 32px;
            text-align: center;
            color: #ffffff;
        }
        .dxq_title sapn
        {
            margin-bottom: 0px !important;
        }
        /**详情专用***/
        .u-refund
        {
            max-width: 500px;
            margin: auto;
            border: 1px solid #ddd;
        }
        .u-refund .item-refund
        {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .u-refund p
        {
            display: -webkit-box;
            display: -moz-box;
            display: box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: -moz-flex;
            display: flex;
            -webkit-box-lines: single;
            -moz-box-lines: single;
            box-lines: single;
            -webkit-box-align: center;
            -moz-box-align: center;
            box-align: center;
            -ms-flex-align: center;
            -webkit-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -webkit-justify-content: flex-start;
            justify-content: flex-start;
            -webkit-align-items: center;
            align-items: center;
            margin: 0;
            font-size: 12px;
            font-family: 'Microsoft YaHei';
            color: #2c2c2c;
            overflow: hidden;
            line-height: 26px;
        }
        .u-refund p.reason
        {
            color: #858585;
        }
        .u-refund p.reason .liy
        {
            padding-left: 60px;
            margin-right: 10px;
        }
        .u-refund .item-refund p .name
        {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            flex-shrink: 0;
        }
        .u-refund .item-refund p .spacing
        {
            word-spacing: 1rem;
        }
        .u-refund .item-refund p span.date
        {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            flex-shrink: 0;
        }
        .u-refund .item-refund p span.conte
        {
            width: 100%;
            overflow: hidden;
            vertical-align: middle;
            -webkit-box-flex: 2;
            -moz-box-flex: 2;
            box-flex: 2;
            -ms-flex: 2;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        .u-refund .item-refund p span.reCont
        {
            display: inline-block;
            width: 100%;
        }
        .u-refund .item-refund p span.reCont .photo
        {
            display: inline-block;
            width: 20%;
            height: 0;
            padding-bottom: 20.8%;
            overflow: hidden;
            margin: 0 1% .5% 0;
        }
        .u-refund .item-refund p span.reCont .photo img
        {
            width: 100%;
            height: auto;
        }
        .u-refund .item-more
        {
            display: block;
            height: 33px;
            line-height: 33px;
            color: #315bde;
            text-align: center;
            font-size: 12px;
            font-family: 'Microsoft YaHei';
            text-decoration: none;
        }
        /**详情专用***/
        .ghcred
        {
            color: Red;
        }
        .hide
        {
            display: none;
        }
        .show
        {
            display: block;
        }
        .timeClass
        {
            color: #D90000;
            font-size: 12px;
            margin: 13px 0 0 5px;
        }
    </style>
    <script type="text/javascript">

        var PriceLow = "";
        var PriceHight = "";
        var SeacrhContent = "";
        var DayCount = "";
        var State = "";
        var Payment = "";
        var StartOrderTime = "";
        var EndOrderTime = "";
        var RefundDetailPageIndex = 1;
        var RefundDetailPageSize = 5;
        var RefundOrderId = "";
        var _stwog = "";


        function Updates(obj, id) {
            var state = $.trim($("#states").val());
            var message = $("#Content").val();

            if (!state) {
                //没有获取到状态值，取对应下拉框的selected值
                state = $(obj).parent().find("select.select")[0].value;
            }
            if (state == 11) {
                alert("钱还没有到账,请先不要发货");
                return false;
            }
            if (state == 2) {
                $("#btnShip").html("确定");
                $("#btnShip").html("确定");
                $("#txtExpOrderNo").val("");
                $("#txtShipExp").val("");
                $("#expSelect").val("0");
                $(".qtwu").hide();
                $("#shipOrderId").text(id);
                $("#shipWin").OpenDiv();
                if (window.parent) { //在iframe页面打开时，纠正top
                    $("#shipWin").css("top", 200 + $(window.parent.document).scrollTop());
                }
                return;
            }
            $.ajax({
                url: '/CommodityOrder/UpdateCommodityOrder/',
                type: 'post',
                data: { commodityOrderId: id,
                    state: state,
                    message: message,
                    userId: getQueryString("userId")
                },
                success: function (data) {
                    if (data.Result) {
                        var rowcounts = $("#rowcounts");
                        var rowcounts_number = rowcounts.val() - 1;
                        rowcounts.val(rowcounts_number);
                        if (!rowcounts_number % 1) {
                            $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                        } else {
                            var page = $('.ui-jhpager-pager').text().split('/')[0];
                            if (page == 1) {
                                page = 1;
                            } else if (page > 1) {
                                page -= 1;
                            }

                            toSearch(page);
                            //			                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[1] - 1, rowcounts_number);
                        }
                    }
                    //window.location.href = "/CommodityOrder/Index";
                    //更新页面显示的交易状态
                    var $p = $(obj).parent().parent();
                    if (state == 2) {
                        $p.html('已发货');
                    }
                    else if (state == 3) {
                        $p.html('交易成功');
                    }
                    else if (state == 4) {
                        $p.html('交易失败');
                    }
                    else {
                        //  window.location.href = "/CommodityOrder/Index";
                        location.reload();
                    }
                    //让订单总价不可修改
                    var $priceP = $p.parent().next().find("p:first");
                    if ($priceP.find("a.state").length) {
                        $priceP.html($priceP.find("span:first").html());
                    }
                    //取消订单后更新实收总价
                    if (state == 4) {
                        $priceP.html(getCurrency() + "0");
                    }
                    //清空交易状态临时值
                    $("#states").val('');
                    //清空取消订单填写描述
                    $("#Content").val('');
                },
                error: function () {

                }
            });
        }
        function CancelUpdatePrice(obj) {
            var $obj = $(obj);
            var $p = $obj.parent().parent();
            $p.find("span:first").show();
            $p.find("input.price").val($p.find("span:first").text().replace(/(^\s*)|(\s*$)/g, "").replace("￥", "").replace("$", ""));
        }
        function UpdatePrice(obj, id) {
            var $obj = $(obj);
            var price = $.trim($("#prices").val());
            if (!price) {//没有获取到实收价格值，取对应input值
                price = $(obj).parent().find("input.price").val();
            }
            if (price) {
                if (!/^\d+(\.\d{2})?$/.test(price)) {
                    if (!/^\d+(\.\d{1})?$/.test(price)) {
                        alert("请填写正确的价格最多保留2位小数");
                        return;
                    }
                }
                if (price <= 0) {
                    alert("价格必须大于0");
                    return;
                }
                if (price != $obj.parents('.parentElement').find('.find_1').text().replace(/(^\s*)|(\s*$)/g, "").replace("￥", "").replace("$", "")) {
                    $.ajax({
                        url: '/CommodityOrder/UpdateOrderPrice/',
                        type: 'post',
                        data: { orderId: id,
                            price: price,
                            userId: getQueryString("userId")
                        },
                        success: function () {
                            //window.location.href = "/CommodityOrder/Index";
                            //更新页面显示的订单总价
                            var $p = $obj.parent().parent();
                            var a = '<img src="/Content/images/update.png" alt="" width="17" height="17">';
                            $p.find("span:first").html(getCurrency() + price);
                            $p.find("span:first").show();
                            $p.find("input.price").val(price);
                            $obj.next().click();
                            //清空临时值
                            $("#prices").val('');
                            if ($p.find(".yprice").length > 0) {
                            }
                            else {
                                $p.prepend("<font class=\"yprice\" style=\"text-decoration: line-through;\">" + getCurrency() + $p.find(".hiddprice").val() + "</font><br/>");
                                if ($p.find(".find_1").after(a) == null) {
                                    $p.find(".find_1").after(a);
                                }
                                $p.find(".spanFreight").hide();

                            }

                        },
                        error: function () {

                        }
                    })
                } else {
                    var $p = $obj.parent().parent();
                    $p.find("span:first").html(getCurrency() + price);
                    $p.find("span:first").show();
                    $p.find("input.price").val(price);
                    $obj.next().click();
                    //清空临时值
                    $("#prices").val('');
                }
            }
        }


        function toSelectByPrice(obj, pricelow, pricehight) {
            if ($.trim(pricelow) == "" || $.trim(pricehight) == "") {
                alert("请填写完整的金额范围");
                return false;
            }
            if (isNaN(pricelow) || isNaN(pricehight)) {
                alert("请填写正确的金额");
                return false;
            }
            if (parseInt(pricelow) > parseInt(pricehight)) {
                //交换变量值
                pricelow = [pricehight, pricehight = pricelow][0];
            }
            $("#priceli span").removeClass("yanse");
            $(obj).addClass("yanse");
            PriceLow = pricelow;
            PriceHight = pricehight;
            toSearch();
        }

        function toSelectByDay(obj, daycount) {
            if (daycount) {
                if (/^[1-9]\d*$/.test(daycount)) {
                    $("#dayli span").removeClass("yanse");
                    $(obj).addClass("yanse");
                    DayCount = daycount;
                    StartOrderTime = "";
                    EndOrderTime = "";
                    toSearch();
                }
                else {
                    alert("请填写正确的天数");
                }
            } else if (daycount == 0) {
                $("#dayli span").removeClass("yanse");
                $(obj).addClass("yanse");
                DayCount = daycount;
                StartOrderTime = "";
                EndOrderTime = "";
                toSearch();
            } else {
                alert("请填写天数");
            }
        }
        function toSelectByDates(obj, start, end) {
            if (start) {
                if (isDate(start)) {
                    $("#dayli span").removeClass("yanse");
                    $(obj).addClass("yanse");
                    DayCount = "0";
                    StartOrderTime = start;
                    var d1 = new Date(start.replace(/\-/g, "\/"));
                    var d2 = '';
                    if (end && isDate(end)) {
                        EndOrderTime = end;
                        d2 = new Date(end.replace(/\-/g, "\/"));
                    } else {
                        EndOrderTime = '';
                        d2 = new Date();
                    }

                    if (d1 >= d2) {
                        alert("开始时间不能大于结束时间！");
                        return false;
                    }

                    toSearch();
                }
                else {
                    alert("请填写正确的查询日期");
                }
            } else {
                alert("请填写查询日期");
            }
        }

        function toSelectByState(obj, s) {
            $("#stateli span").removeClass("yanse");
            $(obj).addClass("yanse");
            State = s;
            toSearch();
        }
        function toSelectByPayment(obj, p) {
            $("#paymentli span").removeClass("yanse");
            $(obj).addClass("yanse");
            Payment = p;
            toSearch();
        }


        function SearchOrderCode() {
            SeacrhContent = $.trim($("#se").val());
            if (SeacrhContent == '可输入订单编号、收货人姓名、手机号查询') {
                SeacrhContent = "";
            }
            toSearch();
        }
        function ImportOrder() {
            if (getQueryString('src') == 'qry') {
                return;
            }
            var importOrderIds = "";
            $("input[name=itemCheckBox]:checked").each(function () { importOrderIds = importOrderIds + "," + $(this).attr("id"); })
            if (importOrderIds == "") {
                alert("请选择要导出的订单");
                return;
            }
            window.open('/CommodityOrder/ExportOrders?orderIds=' + importOrderIds);
        }


        function closeSellersRemarkTip() {
            $("#divSellersRemark").CloseDiv();
        }


        var commodityOrderId = "";
        var objs = "";
        //单击添加弹出添加商家备注对话框
        function SetSellersRemark(obj, id, Remark) {
            if (getQueryString('src') == 'qry') {
                return;
            }

            commodityOrderId = id;
            objs = obj;


            $("#SellersRemarkContent").val(decodeURI(Remark));

            var result = 140 - decodeURI(Remark).length;

            $('.SellersRemarkcontentwordage').html('还可以输入' + result + '字符');

            $("#divSellersRemark").OpenDiv();

            if (window.parent) { //在iframe页面打开时，纠正top
                $("#divSellersRemark").css("top", 50 + $(window.parent.document).scrollTop());
            }

        }


        function SellersRemarkOK() {

            var mess = $.trim($("#SellersRemarkContent").val());
            if (mess == null || mess == "" || mess == undefined || mess == "undefined") {
                $('.SellersRemarkcontentwordage').html('添加备注内容不能为空');
                return false;
            } else if (mess.length > 140) {
                return false;

            } else {


                var obj = $(objs);

                var idtype = obj.attr("id");

                closeSellersRemarkTip();

                $.ajax({
                    url: '/CommodityOrder/UpdateSellersRemark',
                    type: 'post',
                    data: { commodityOrderId: commodityOrderId,
                        SellersRemark: encodeURI(mess),
                        state: "addOrupdate"
                    },
                    success: function (data) {

                        if (data.Result) {


                            if (idtype == "addSellersRemark") {

                                obj.hide();
                                obj.next().show();
                                obj.next().find("#showSellersRemark").html(mess);
                                obj.next().find("#updateSellersRemark").attr("onclick", "SetSellersRemark(this,'" + commodityOrderId + "','" + encodeURI(mess) + "')");

                            } else {


                                obj.parent().parent().show();

                                obj.parent().parent().find("#showSellersRemark").html(mess);
                                obj.parent().parent().find("#updateSellersRemark").attr("onclick", "SetSellersRemark(this,'" + commodityOrderId + "','" + encodeURI(mess) + "')");
                                obj.parent().parent().prev().find("#addSellersRemark").hide();
                            }

                        } else {
                            alert(data.Messages);
                        }

                    },
                    error: function () {

                    }
                })
            }

        }

        //删除卖家订单
        function delSellersRemark(obj, id) {
            if (getQueryString('src') == 'qry') {
                return;
            }
            var objs = $(obj);

            if (!confirm("确认删除吗")) {
                return false;
            }

            $.ajax({
                url: '/CommodityOrder/UpdateSellersRemark',
                type: 'post',
                data: { commodityOrderId: id,
                    SellersRemark: "null",
                    state: "delete"
                },
                success: function (data) {

                    if (data.Result) {

                        objs.parent().parent().prev().show();
                        objs.parent().parent().hide();

                    } else {
                        alert(data.Messages);
                    }

                },
                error: function () {

                }
            })


        }

        function BackTo() {
            var url = window.location.href.replace('CommodityOrder', 'AppTradeInfo'); //  + "&src=qry&appId=" + id;

            window.location.href = url.substring(0, url.indexOf('&src='));
        }
        document.ondragstart = function () { return false; }
        $(document).ready(function () {
            _stwog = "@stwog";
            $('#EndTime').datepicker({

                changeMonth: true,

                changeYear: true,

                showOtherMonths: true,

                selectOtherMonths: true

            }).change(function () {
                if ($(this).val() != "") {
                    if ($('#StartTime').val() != "") {
                        $("#btnExportData").attr("disabled", "");
                        $("#btnExportData").removeAttr("disabled");
                    }
                }
                else {
                    $("#btnExportData").attr("disabled", "disabled");
                }
            });
            //TODO  ghc 修改js
            $('#StartTime').datepicker({

                changeMonth: true,

                changeYear: true,

                showOtherMonths: true,

                selectOtherMonths: true
            }).change(function () {
                if ($(this).val() != "") {
                    if ($('#EndTime').val() != "") {
                        $("#btnExportData").attr("disabled", "");
                        $("#btnExportData").removeAttr("disabled");
                    }
                }
                else {
                    $("#btnExportData").attr("disabled", "disabled");
                }
            });
            $('#EndOrderTime').datepicker({

                changeMonth: true,

                changeYear: true,

                showOtherMonths: true,

                selectOtherMonths: true

            });

            $('#StartOrderTime').datepicker({

                changeMonth: true,

                changeYear: true,

                showOtherMonths: true,

                selectOtherMonths: true
            });
            if (getQueryString('src') == 'qry') {
                $('#backBtn').show();
            }
            else {
                $('#backBtn').hide();
            }

            var limitNum = 140;
            var pattern = '还可以输入' + limitNum + '字符';
            $('.contentwordage').html(pattern);
            $('#Content').keyup(function () {
                var remain = $.trim($(this).val()).length;
                if (remain > limitNum) {
                    pattern = "字数超过限制！";

                } else {
                    var result = limitNum - remain;
                    pattern = '还可以输入' + result + '字符';
                }
                $('.contentwordage').html(pattern);
            });
            //卖家备注信息

            $('#SellersRemarkContent').keyup(function () {
                var remain = $.trim($(this).val()).length;
                if (remain > limitNum) {
                    pattern = "字数超过限制！";

                } else {
                    var result = limitNum - remain;
                    pattern = '还可以输入' + result + '字符';
                }
                $('.SellersRemarkcontentwordage').html(pattern);
            });



            function showContent(event, data) {

                var rowcounts = $("#rowcounts").val();
                if (rowcounts == 0) {
                    $("#pager").hide();
                    $('#content_make').hide();
                }
                else {
                    ajaxLoading(1, '#content_make');
                    $("#dataDIV").html(data);
                    newSetIframeHeight();
                }
            }
            $("#tzinfor").live("click", function () {
                var hre = $(this).attr("tzinfors");
                //                win(hre, null, 1124, 768);

                ShowOrderDetail();
                $("#orderdetailurl").attr("src", hre);
                if (window.parent) { //在iframe页面打开时，纠正top

                    $(".ui-jhtablebox-top").css("top", 50 + $(window.parent.document).scrollTop());
                }
            });
            $("#pager").jhpager({
                dataType: 'html',
                requestType: 'post',
                dataSource: '/CommodityOrder/PartialIndex',
                async: true,
                totalCount: '@ViewBag.Count',
                rowNum: 20,
                beforeRequest: function () {
                    $("#dataDIV").empty();
                    $(window.parent.document).scrollTop(0);
                    ajaxLoading(1, '#content_make');
                },
                requestFailure: function () {
                },
                requestSuccess: showContent,
                requestData: function () {
                    return {
                        priceLow: PriceLow,
                        priceHight: PriceHight,
                        seacrhContent: SeacrhContent,
                        dayCount: DayCount,
                        state: State,
                        payment: Payment,
                        pageSize: 20
                    };
                }
            });
            $("#expSelect").change(function () {
                if ($(this).val() == "1") {
                    $(".qtwu").show();
                }
                else {
                    $(".qtwu").hide();
                }
            });
            var limitNum = 140;
            var pattern = '还可以输入' + limitNum + '字符';
            $('.contentwordage').html(pattern);
            $('#Content').keyup(function () {
                var remain = $.trim($(this).val()).length;
                if (remain > limitNum) {
                    pattern = "字数超过限制！";

                } else {
                    var result = limitNum - remain;
                    pattern = '还可以输入' + result + '字符';
                }
                $('.contentwordage').html(pattern);
            });

            $("#delorder").live("click", function () {
                if (getQueryString('src') == 'qry') {
                    return;
                }
                if (!confirm("确认删除吗")) {
                    return false;
                }
                $.ajax({
                    url: '/CommodityOrder/DelOrder/',
                    type: 'post',
                    data: { commodityOrderId: $(this).attr("orderid"),
                        IsDel: 2
                    },
                    success: function (data) {
                        if (data.Result) {
                            var rowcounts = $("#rowcounts");
                            var rowcounts_number = rowcounts.val() - 1;
                            rowcounts.val(rowcounts_number);
                            if (!rowcounts_number % 1) {
                                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                            } else {
                                var page = $('.ui-jhpager-pager').text().split('/')[0];
                                if (page == 1) {
                                    page = 1;
                                } else if (page > 1) {
                                    page -= 1;
                                }

                                toSearch(page);
                                //			                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[1] - 1, rowcounts_number);

                            }
                        }
                        else {
                            alert(data.Messages);
                        }
                    },
                    error: function () {

                    }
                });
            });

            $("#allCheck").on('click', function () {
                var s = document.getElementsByName("itemCheckBox");
                if ($(this).prop('checked')) {
                    for (var i = 0; i < s.length; i += 1)
                        s[i].checked = "checked";
                } else {
                    for (var i = 0; i < s.length; i += 1)
                        s[i].checked = "";
                }
            });
            $("input[name=itemCheckBox]").bind("click", function () {
                if ($("input[name=itemCheckBox]").length == $("input[name=itemCheckBox]:checked").length) {
                    $("#allCheck").attr("checked", 'true')
                }
                else {
                    $("#allCheck").removeAttr("checked")
                }
            });
            //交易状态修改
            $(document).on("click", "a.state", function () {
                if (getQueryString('src') == 'qry') {
                    return;
                }
                var $p = $(this).parent();
                var $spanPrev = $p.find("span:first");
                $spanPrev.css("display", "none");
                var $spanNext = $(this).next();
                $spanNext.css("display", "inline");
                $(this).css("display", "none");

            });
            //交易状态取消修改
            $(document).on("click", "a.cancel", function () {
                $(this).parent().css("display", "none").prev().css("display", "inline").prev().prev().css("display", "inline");
            });

            $(document).on("change", ".select", function () {
                var v = this.value;
                $("#states").val(v);
                if (v == "4") {
                    $("#div3").OpenDiv();
                    if (window.parent) { //在iframe页面打开时，纠正top
                        $("#div3").css("top", 200 + $(window.parent.document).scrollTop());
                    }
                    $(this).parent().find(".cancel").click();
                    $(document).data("execUpdates", $(this).parent().find(".updates")); //缓存提交更新按钮对象
                    //还原下拉选择项
                    this.selectedIndex = 0;
                } else {
                    var div3 = document.getElementById('div3');
                    div3.style.display = "none";
                }

                if (v == "5") {
                    $("#baorefund").OpenDiv();
                    if (window.parent) { //在iframe页面打开时，纠正top
                        $("#baorefund").css("top", 200 + $(window.parent.document).scrollTop());
                    }
                }

            });
            $(".pingz").imgbox({
                'speedIn': 0,
                'speedOut': 0,
                'alignment': 'center',
                'overlayShow': true,
                'allowMultiple': false
            });
            // 查看退款 
            $("#refundInfor").live("click", function () {
                if (getQueryString('src') == 'qry') {
                    return;
                }
                $(".divliu").hide();
                var orderid = $(this).attr("orderid");
                var orstate = $(this).attr("orstate");

                var orpayment = $(this).attr("orpayment");

                var orAfState = $(this).attr("orAfState");
                orAfState = orAfState == undefined ? "0" : orAfState;

                var orRefundAfState = $(this).attr("orStateRefundAfterSales");
                orRefundAfState = orRefundAfState == undefined ? "-1" : orRefundAfState;

                var orRefundState = $(this).attr("orStateRefund");
                orRefundState = orRefundState == undefined ? "-1" : orRefundState;

                $("#hiddorid").val(orderid);
                $("#hiddstate").val(orstate);
                $("#hiddpayment").val(orpayment);
                $("#hiddorAfState").val(orAfState);

                $("#hiddSelfTakeFlag").val($(this).attr("selfTakeFlag"));
                $("#hiddorStateRefundAfterSales").val(orRefundAfState);
                $("#hiddorStateRefund").val(orRefundState);
                var rifUrl = '/CommodityOrder/GetOrderRefund'
                if (orstate == 3 && orAfState != undefined) {
                    rifUrl = "/CommodityOrder/GetOrderRefundAfterSales";
                }



                //显隐控制
                var isShowRefundNow = IsShowNow(orstate, orRefundState, orAfState, orRefundAfState)

                if (isShowRefundNow == 2) {
                    $("#refundNow").hide();
                    //点击查看时，先取第一页的数据
                    RefundDetailPageIndex = 1;
                    RefundOrderId = orderid;
                    var refundInfoModle = {};
                    refundInfoModle.PageIndex = RefundDetailPageIndex;
                    refundInfoModle.PageSize = RefundDetailPageSize;
                    refundInfoModle.CommodityOrderId = RefundOrderId;
                    var subData = CommLib.ObjToStringWithQuot(refundInfoModle);
                    GetGHC(subData, 2);
                    $("#refund").OpenDiv();
                    if (window.parent) { //在iframe页面打开时，纠正top
                        $("#refund").css("top", 100 + $(window.parent.document).scrollTop());
                    }
                }
                else {
                    $("#refundNow").show();
                    $.ajax({
                        url: rifUrl,
                        type: 'post',
                        data: { CommodityOrderId: orderid },
                        error: function () {
                            alert("请求错误，请稍后刷新进行操作.");
                        },
                        success: function (msg) {
                            if (!msg) {
                                return;
                            }
                            switch (msg.RefundType) {

                                case 0:
                                    $(".restate").html("仅退款");
                                    $("#hiddretype").val("0");
                                    break;
                                default:
                                    $(".restate").html("退款退货");
                                    $("#hiddretype").val("1");
                                    break;
                            }
                            //在申请详情中显示时间
                            $("#ghcApplyTimer").html("");
                            //待发货退款中
                            if (orstate == 8) {
                                $("#ghcApplyTimer").html('<span>' + "48小时不处理，系统将自动退款给客户" + '</span>');
                            }
                            //申请的已发货与出库中退款中
                            else if (orstate == 9 || orstate == 14) {
                                //仅退款
                                if (msg.RefundType == 0) {
                                    $("#ghcApplyTimer").html('<span>' + "5天不处理，系统将自动退款给客户（第" + CalDate(msg.SubTime) + "天）" + '</span>');
                                }
                                else {
                                    $("#ghcApplyTimer").html('<span>' + "5天不处理，系统将自动达成协议（第" + CalDate(msg.SubTime) + "天）" + '</span>');
                                }
                            }
                            else if (orstate == 10 && msg.state == 10) {
                                //前台显示
                            }
                            else if (orstate == 10 && msg.state == 11) {
                                //$("#ghcLogisticsTimer").html('<span>' + "9天不处理，系统将自动确认收货（第" + CalDate(msg.RefundExpOrderTime) + "天）" + '</span>');
                            }
                            else if (orstate == 3) {
                                if (orAfState == 5) {
                                    //仅退款
                                    if (msg.RefundType == 0) {
                                        $("#ghcApplyTimer").html('<span>' + "5天不处理，系统将自动退款给客户（第" + CalDate(msg.SubTime) + "天）" + '</span>');
                                    }
                                    else {
                                        $("#ghcApplyTimer").html('<span>' + "5天不处理，系统将自动达成协议（第" + CalDate(msg.SubTime) + "天）" + '</span>');
                                    }
                                }
                                else if (orstate == 10 && msg.state == 10) {
                                    //前台显示
                                }
                                else if (orAfState == 10 && msg.state == 11) {
                                    //$("#ghcLogisticsTimer").html('<span>' + "9天不处理，系统将自动确认收货（第" + CalDate(msg.RefundExpOrderTime) + "天）" + '</span>');
                                }
                            }

                            if (orstate == 8 || orstate == 9 || orstate == 14) {
                                $("#btnrun").show();
                                $("#btnrun").html("同意退款申请 ");
                                $("#btnCancel").show();
                                $("#btnCancel").html("拒绝退款申请 ");
                            }
                            else if (orstate == 10) {
                                $(".divliu").show();
                                $("#btnrun").hide();
                                $("#btnrun").html("等待客户发货");
                                $("#btnCancel").hide();
                            }
                            else if (orstate == 3) {
                                if (orAfState == 5) {
                                    $("#btnrun").show();
                                    $("#btnrun").html("同意退款申请 ");

                                    $("#btnCancel").show();
                                    $("#btnCancel").html("拒绝退款申请 ");
                                }
                                else if (orAfState == 7) {
                                    $("#btnrun").hide();
                                    $("#btnCancel").hide();
                                }
                                else if (orAfState == 10) {
                                    $(".divliu").show();
                                    $("#btnrun").hide();
                                    $("#btnCancel").hide();
                                    $("#btnrun").html("等待客户发货");
                                }
                                else if (orAfState == 15) {
                                    $("#btnrun").hide();
                                    $("#btnCancel").hide();
                                }
                                else {
                                    $("#btnrun").hide();
                                    $("#btnCancel").hide();
                                }
                            }
                            else {
                                $("#btnrun").hide();
                                $("#btnrun").html("已退款");

                                $("#btnCancel").hide();
                                $("#btnCancel").html("取消");
                            }

                            $(".reseason").html(msg.RefundReason);
                            $(".remoney").html(getCurrency() + msg.RefundMoney);
                            $(".redesc").html(msg.RefundDesc);

                            var im = "";
                            $(".reimg").html("");
                            if (msg.OrderRefundImgs && msg.OrderRefundImgs != "") {
                                $(".tpiz").show();
                                for (var i = 0; i < msg.OrderRefundImgs.split(',').length; i++) {
                                    $(".reimg").append("<a class=\"pingz\" title=\"\" href=\"" + msg.OrderRefundImgs.split(',')[i] + "\"><img  height=\"55px\" width=\"55px\" alt=\"\" src=\"" + msg.OrderRefundImgs.split(',')[i] + "\" /></a>");
                                }
                            }
                            else {
                                $(".tpiz").hide();
                            }
                            //$(".reimg").html(msg.OrderRefundImgs);
                            $("#refund").OpenDiv();
                            if (window.parent) { //在iframe页面打开时，纠正top
                                $("#refund").css("top", 100 + $(window.parent.document).scrollTop());
                            }
                            //$(".restate").html("仅退款");

                            if (orRefundState >= 0 || orRefundAfState >= 0) {
                                //点击查看时，先取第一页的数据
                                RefundDetailPageIndex = 1;
                                RefundOrderId = orderid;
                                var refundInfoModle = {};
                                refundInfoModle.PageIndex = RefundDetailPageIndex;
                                refundInfoModle.PageSize = RefundDetailPageSize;
                                refundInfoModle.CommodityOrderId = RefundOrderId;
                                var subData = CommLib.ObjToStringWithQuot(refundInfoModle);
                                GetGHC(subData, 1);
                            }
                            else {
                                $("#ghc2").hide();
                                $("#ghc3").hide();
                            }
                        }
                    });
                }
                $("#ghc3").live("click", function () {
                    var refundInfoModle = {};
                    refundInfoModle.PageIndex = RefundDetailPageIndex;
                    refundInfoModle.PageSize = RefundDetailPageSize;
                    refundInfoModle.CommodityOrderId = RefundOrderId;
                    var subData = CommLib.ObjToStringWithQuot(refundInfoModle);
                    GetGHC(subData, 2);
                });
            });

            // 查看退款物流信息 
            $("#refundexp").live("click", function () {
                if (getQueryString('src') == 'qry') {
                    return;
                }
                var orderid = $(this).attr("orderid");
                var orstate = $(this).attr("orstate");
                var orpayment = $(this).attr("orpayment");
                var orAfState = $(this).attr("orAfState");


                var reUrl = orstate == 3 && orAfState != undefined ? "/CommodityOrder/GetOrderRefundAfterSales" : '/CommodityOrder/GetOrderRefund'

                $("#thstate").val(orstate);
                $("#thiddoridexp").val(orderid);
                $("#hiddorid").val(orderid);
                $("#thiddpayment").val(orpayment);
                $("#thiddorAfState").val(orAfState);

                $.ajax({
                    url: reUrl,
                    type: 'post',
                    data: { CommodityOrderId: orderid },
                    error: function () {
                        alert("请求错误，请稍后刷新进行操作.");
                    },
                    success: function (msg) {
                        $("#ghcLogisticsTimer").html("");
                        if (orstate == 7) {
                            $("#btnexp").html("已退款");
                        }

                        $(".reexpco").html(msg.RefundExpCo);
                        $(".reorderno").html(msg.RefundExpOrderNo);


                        if (orstate == 10 && msg.State == 11) {
                            $("#ghcLogisticsTimer").html('<span>' + "9天不处理，系统将自动确认收货（第" + CalDate(msg.RefundExpOrderTime) + "天）" + '</span>');
                        }
                        else if (orstate == 3 && orAfState == 10 && msg.State == 11) {
                            $("#ghcLogisticsTimer").html('<span>' + "9天不处理，系统将自动确认收货（第" + CalDate(msg.RefundExpOrderTime) + "天）" + '</span>');
                        }

                        //控制延长收货时间按钮的显示。
                        //转换时间格式 为了计算日期时间差
                        var myDate = new Date();
                        var month = myDate.getMonth() + 1 < 10 ? "0" + (myDate.getMonth() + 1) : myDate.getMonth() + 1;
                        var currentDate = myDate.getDate() < 10 ? "0" + myDate.getDate() : myDate.getDate();
                        var eDate = myDate.getFullYear() + "-" + month + "-" + currentDate;

                        //计算时间差
                        var sDate = ChangeDateFormat(msg.RefundExpOrderTime, 3);
                        var sArr = sDate.split("-");
                        var eArr = eDate.split("-");
                        var sRDate = new Date(sArr[0], sArr[1], sArr[2]);
                        var eRDate = new Date(eArr[0], eArr[1], eArr[2]);
                        var result = (eRDate - sRDate) / (24 * 60 * 60 * 1000) + 1;
                        if (result >= 6 && result <= 9 && !msg.IsDelayConfirmTimeAfterSales) {
                            $("#btnDelayTime").show();
                        }
                        else {
                            $("#btnDelayTime").hide();
                        }

                        if (orstate == 10) {
                            $("#btnrefundReceive").show();
                        }
                        else if (orAfState == 10) {
                            $("#btnrefundReceive").show();
                        }
                        else {
                            $("#btnrefundReceive").hide();
                        }
                        $("#trefundexp").OpenDiv();
                        if (window.parent) { //在iframe页面打开时，纠正top
                            $("#trefundexp").css("top", 200 + $(window.parent.document).scrollTop());
                        }
                        //$(".restate").html("仅退款");

                    }
                });
            });

            //同意退款申请
            $("#btnrun").live("click", function () {
                var retype = $("#hiddretype").val();
                var statename = $("#btnrun").html();
                var dstate = $("#hiddstate").val();
                var orAfState = $("#hiddorAfState").val();

                switch (dstate) {

                    case "8":
                        if (_stwog.indexOf("," + $("#hiddpayment").val() + ",") > -1) {
                            dstate = 12;
                        }
                        else {
                            dstate = 7;
                        }
                        break;
                    case "9":
                        if (retype == 0) {
                            if (_stwog.indexOf("," + $("#hiddpayment").val() + ",") > -1) {
                                dstate = 12;
                            }
                            else {
                                dstate = 7;
                            }
                        }
                        else {
                            dstate = 10;
                        }
                        break;
                    case "14":
                        if (retype == 0) {
                            if (_stwog.indexOf("," + $("#hiddpayment").val() + ",") > -1) {
                                dstate = 12;
                            }
                            else {
                                dstate = 7;
                            }
                        }
                        else {
                            dstate = 10;
                        }
                        break;
                    case "3":
                        //售后退款类型：仅退款=0，退货退款=1
                        if (retype == 0) {
                            if (_stwog.indexOf("," + $("#hiddpayment").val() + ",") > -1) {
                                dstate = 7;
                            }
                            else {
                                dstate = 7;
                            }
                        }
                        else {
                            if ($("#hiddSelfTakeFlag").val() == 1) {
                                dstate = 7;
                            }
                            else {
                                dstate = 10;
                            }
                        }
                        break;

                }

                if (statename == "提交中,请稍候" || statename == "已退款" || statename == "等待客户发货") {
                    return;
                }
                $("#btnrun").html("提交中,请稍候");
                //如果支付宝直接到账 并且是待发货退款中的时候 弹出填写相关信息页面
                if (($("#hiddpayment").val() == 2 && $("#hiddstate").val() == 8) || ($("#hiddpayment").val() == 2 && $("#hiddstate").val() == 9 && retype == 0)) {
                    $("#refund").CloseDiv()
                    $("#baorefund").OpenDiv();
                    if (window.parent) { //在iframe页面打开时，纠正top
                        $("#baorefund").css("top", 200 + $(window.parent.document).scrollTop());
                    }
                }
                else {
                    var ucoUrl = '/CommodityOrder/UpdateCommodityOrder/';
                    if ($("#hiddstate").val() == "3" && orAfState != undefined && orAfState != "0") {
                        ucoUrl = "/CommodityOrder/UpdateCommodityOrderAfterSales/";

                    }
                    $.ajax({
                        url: ucoUrl,
                        type: 'post',
                        data: { commodityOrderId: $("#hiddorid").val(),
                            state: dstate,
                            message: "",
                            userId: getQueryString("userId")
                        },
                        success: function (data) {
                            if (data.Result) {
                                $("#btnrun").html("已退款");
                                closeTiporder();
                                var rowcounts = $("#rowcounts");
                                var rowcounts_number = rowcounts.val() - 1;
                                rowcounts.val(rowcounts_number);
                                if (!rowcounts_number % 1) {
                                    $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                                } else {
                                    var page = $('.ui-jhpager-pager').text().split('/')[0];
                                    if (page == 1) {
                                        page = 1;
                                    } else if (page > 1) {
                                        page -= 1;
                                    }

                                    toSearch(page);
                                    //			                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[1] - 1, rowcounts_number);
                                }
                            }
                            else {

                                $("#btnrun").html(statename);
                                $(".spalert").html(data.Messages);
                            }
                        },
                        error: function () {
                            $("#btnrun").html(statename);
                            //$(".spalert").html("erro");
                        }
                    });
                }
            });

            //拒绝退款申请。
            $("#btnCancel").live("click", function () {
                HideRefund();
                $("#RefundReason").val("");
                $("#RefundReasonForm").jhtablebox({
                    title: "拒绝申请",
                    width: 450,
                    height: 400,
                    draggable: true,
                    modal: true,
                    resizable: false,
                    zIndex: 10005,
                    beforeClose: function (e) {
                    },
                    close: function () {
                        ShowRefund();
                    }
                });
            });

            //拒绝收货
            $("#btnrefundReceive").live("click", function () {
                HideReceiveRefund();
                $("#RefundReceiveReason").val("");
                $("#RefundReceiveReasonForm").jhtablebox({
                    title: "拒绝收货",
                    width: 450,
                    height: 400,
                    draggable: true,
                    modal: true,
                    resizable: false,
                    zIndex: 10005,
                    beforeClose: function (e) {
                    },
                    close: function () {
                        ShowReceiveRefund();
                    }
                });
            });

            //确认收到退货
            $("#btnexp").live("click", function () {
                var statename = $("#btnexp").html();
                if (statename == "提交中,请稍候") {
                    return;
                }
                //如果支付宝直接到账 并且是待发货退款中的时候 弹出填写相关信息页面
                var dsate = "7";
                if (_stwog.indexOf("," + $("#thiddpayment").val() + ",") > -1) {
                    dsate = 7;
                }
                if ($("#thiddpayment").val() == 2 && $("#thstate").val() == 10) {
                    $("#trefundexp").CloseDiv()
                    $("#baorefund").OpenDiv();
                    if (window.parent) { //在iframe页面打开时，纠正top
                        $("#baorefund").css("top", 200 + $(window.parent.document).scrollTop());
                    }
                }
                else {
                    var ucoUrl = '/CommodityOrder/UpdateCommodityOrder/';
                    if ($("#thstate").val() == "3" && $("#thiddorAfState").val() != "undefined" && $("#thiddorAfState").val() != "") {
                        ucoUrl = "/CommodityOrder/UpdateCommodityOrderAfterSales/";
                    }
                    $.ajax({
                        url: ucoUrl,
                        type: 'post',
                        data: { commodityOrderId: $("#thiddoridexp").val(),
                            state: dsate,
                            message: "",
                            userId: getQueryString("userId")
                        },
                        success: function (data) {
                            if (data.Result) {
                                $("#trefundexp").CloseDiv();
                                var rowcounts = $("#rowcounts");
                                var rowcounts_number = rowcounts.val() - 1;
                                rowcounts.val(rowcounts_number);
                                if (!rowcounts_number % 1) {
                                    $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                                } else {
                                    var page = $('.ui-jhpager-pager').text().split('/')[0];
                                    if (page == 1) {
                                        page = 1;
                                    } else if (page > 1) {
                                        page -= 1;
                                    }

                                    toSearch(page);
                                    //			                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[1] - 1, rowcounts_number);
                                }
                            }
                            else {

                                $("#btnexp").html(statename);
                                //$(".spalert").html("退款失败");
                            }
                        },
                        error: function () {
                            $("#btnexp").html(statename);
                            //$(".spalert").html("erro");
                        }
                    });
                }
            });
            //延长收货时间（3天）
            $("#btnDelayTime").live("click", function () {
                var ucoUrl = '/CommodityOrder/DelayConfirmTime/';
                if ($("#hiddstate").val() == "3" && $("#hiddorStateRefundAfterSales").val() > 0) {
                    ucoUrl = "/CommodityOrder/DelayConfirmTimeAfterSales";
                }
                $.ajax({
                    url: ucoUrl,
                    type: 'post',
                    data:
                    {
                        commodityOrderId: $("#thiddoridexp").val()
                    },
                    success: function (data) {
                        if (data.Result) {
                            $("#trefundexp").CloseDiv();
                            var rowcounts = $("#rowcounts");
                            var rowcounts_number = rowcounts.val() - 1;
                            rowcounts.val(rowcounts_number);
                            if (!rowcounts_number % 1) {
                                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                            } else {
                                var page = $('.ui-jhpager-pager').text().split('/')[0];
                                if (page == 1) {
                                    page = 1;
                                } else if (page > 1) {
                                    page -= 1;
                                }

                                toSearch(page);
                                //$("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[1] - 1, rowcounts_number);
                            }
                        }
                    },
                    error: function () {
                    }
                });

            });
            //start 支付宝直接到账退款 
            $("#btnbaorun").bind("click", function () {
                $("#tuierrorInfo").hide();
                $("#tuierrorInfo").html("");




                if ($("#txtReceiverAccount").val() == "") {
                    $("#tuierrorInfo").html("请填写退款收款人账户");
                    $("#tuierrorInfo").show();
                    return false;
                }
                if ($("#txtReceiver").val() == "") {
                    $("#tuierrorInfo").html("请填写收款人姓名");
                    $("#tuierrorInfo").show();
                    return false;
                }
                if (!/^\d+(\.\d{2})?$/.test($("#txtRefundMoney").val())) {
                    if (!/^\d+(\.\d{1})?$/.test($("#txtRefundMoney").val())) {
                        $("#tuierrorInfo").html("请填写正确的金额");
                        $("#tuierrorInfo").show();
                        return false;
                    }
                }
                $.ajax({
                    url: '/CommodityOrder/AlipayZhiTui/',
                    type: 'post',
                    data: { commodityorderId: $("#hiddorid").val(),
                        ReceiverAccount: $("#txtReceiverAccount").val(),
                        Receiver: $("#txtReceiver").val(),
                        RefundMoney: $("#txtRefundMoney").val()
                    },
                    success: function (data) {
                        if (data.Result) {
                            $("#baorefund").CloseDiv();
                            var rowcounts = $("#rowcounts");
                            var rowcounts_number = rowcounts.val() - 1;
                            rowcounts.val(rowcounts_number);
                            if (!rowcounts_number % 1) {
                                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                            } else {
                                var page = $('.ui-jhpager-pager').text().split('/')[0];
                                if (page == 1) {
                                    page = 1;
                                } else if (page > 1) {
                                    page -= 1;
                                }

                                toSearch(page);
                                //			                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[1] - 1, rowcounts_number);
                            }
                        }
                        else {

                        }
                    },
                    error: function () {

                    }
                });
            });
            //end  支付宝直接到账退款 

            $(document).on("blur", ".price", function () {
                var v = this.value;
                $("#prices").val(v);
            });

            $(".an1").click(function () {
                var con = $.trim($("#Content").val());
                if (con.length > 140) {
                    $('.contentwordage').html("字数超过限制！");
                    return false;
                }
                if ($.trim($("#Content").val())) {
                    $(document).data("execUpdates").click();
                    closeTip();
                }
            });
            $("#RefundReasonSure").live("click", function () {
                var commodityOrderIdR = $("#hiddorid").val();
                var refuseReason = $("#RefundReason").val();
                if ($.trim(refuseReason) == "") {
                    alert("拒绝原因不能为空");
                    return;
                }
                if ($.trim(refuseReason).length > 140) {
                    alert("拒绝原因不能大于140字");
                    return;
                }
                DoRefuse(commodityOrderIdR, refuseReason);

            });
            $("#RefundReasonCancel").live("click", function () {
                $("#RefundReasonForm").jhtablebox("close");
                ShowRefund();
            });
            $("#RefundReceiveReasonSure").live("click", function () {
                var commodityOrderIdR = $("#hiddorid").val();
                var refuseReason = $("#RefundReceiveReason").val();
                if ($.trim(refuseReason) == "") {
                    alert("拒绝原因不能为空");
                    return;
                }
                if ($.trim(refuseReason).length > 140) {
                    alert("拒绝原因不能大于140字");
                    return;
                }
                DoReceiveRefuse(commodityOrderIdR, refuseReason);

            });
            $("#RefundReceiveReasonCancel").live("click", function () {
                $("#RefundReceiveReasonForm").jhtablebox("close");
                ShowReceiveRefund();
            });
        })


        function toSearch(pageNumber) {

            var page = pageNumber ? pageNumber : 1;

            if (window.search) {
                window.search.abort();
                searchFun();
            } else {
                searchFun();
            }

            function searchFun() {
                var $dataDIV = $("#dataDIV");
                var $rowcounts = $("#rowcounts");
                window.search = $.ajax({
                    url: '/CommodityOrder/PartialIndex?currentPage=' + page,
                    type: 'post',
                    data: {
                        priceLow: PriceLow,
                        priceHight: PriceHight,
                        seacrhContent: SeacrhContent,
                        dayCount: DayCount,
                        state: State,
                        payment: Payment,
                        pageSize: 20,
                        userId: getQueryString("userId"),
                        startTime: StartOrderTime,
                        endTime: EndOrderTime
                    },
                    beforeSend: function () {
                        $dataDIV.empty();
                        ajaxLoading(1, '#content_make');
                    },
                    complete: function () {
                        ajaxLoading(1, '#content_make');
                    },
                    success: function (html) {
                        $dataDIV.html(html);
                        $("#pager").jhpager("refresh", page, $("#rowcounts").val());
                        newSetIframeHeight();
                    },
                    error: function () {

                    }
                })
            }
        }
        //关闭层div3的显示    
        function closeTip() {
            $("#div3").CloseDiv();
            //清空交易状态临时值
            $("#states").val('');
        }

        //关闭层的显示    
        function closeTiporder() {
            $("#refund").CloseDiv();

        }
        //关闭层的显示    
        function closebtnbaorun() {
            $("#baorefund").CloseDiv();

        }

        //关闭层的显示    
        function closebtnShip() {
            $("#shipWin").CloseDiv();

        }
        //关闭层的显示    
        function closeexp() {
            $("#trefundexp").CloseDiv();

        }

        //弹出导出    
        function ShowExportData() {
            $("#popupExportData").OpenDiv();
        }

        //关闭导出    
        function closeExport() {
            $("#popupExportData").CloseDiv();
        }

        //批量导出    
        function ExportData() {

            $("#btnExportData").attr("disabled", "");

            var startTime = $("#StartTime").val();
            var endTime = $("#EndTime").val();
            var appid = getQueryString('appId');
            var exportType = $("input[name='ExportType']:checked").val();
            $("#ExportError").html("" + exportType + "数据正在导出，请您稍等！");
            if (startTime == "" || endTime == "") {
                // alert("开始时间,结束时间不能为空！");
                $("#ExportError").html("开始时间,结束时间不能为空！");
                return false;
            }
            if (startTime > endTime) {
                $("#ExportError").html("开始时间不能大于结束时间！");
                return false;
            }
            if (appid == null || appid == "") {
                $("#ExportError").html("未获取到当前appId！");
                return false;
            }
            var _selstate = $("#selState").val();
            if (exportType == "word") {
                $.ajax({
                    url: '/CommodityOrder/GetOrderIds',
                    type: 'post',
                    data: { startTime: startTime,
                        endTime: endTime,
                        state: _selstate,
                        appid: appid
                    },
                    success: function (data) {
                        if (data.Result) {
                            if (data.Messages == "") {
                                $("#ExportError").html("没有找到要导出的数据！");
                                $("#btnExportData").removeAttr("disabled");
                            }
                            else {
                                $("#startTimeWord").val(startTime);
                                $("#endTimeWord").val(endTime);
                                $("#stateWord").val(_selstate);
                                $("#appidWord").val(appid);
                                $("#orderIdsWord").val(data.Messages);

                                $("#FormWord").submit();
                                $("#ExportError").html("");
                                $("#btnExportData").removeAttr("disabled");
                                closeExport();
                                // window.location.href = '/CommodityOrder/ExportOrders?orderIds=' + data;
                            }
                        }
                        else {
                            $("#ExportError").html("没有找到要导出的数据！");
                            $("#btnExportData").removeAttr("disabled");
                        }
                    },
                    error: function () {
                        $("#ExportError").html("");
                        $("#btnExportData").removeAttr("disabled");
                    }
                });
                // window.location.href = '/CommodityOrder/ExportOrders?startTime=' + startTime + '&endTime=' + endTime + '&state=' + _selstate + '&appid=' + appid;
                // return false;
            }
            else if (exportType == "excel") {

                $.ajax({
                    url: '/CommodityOrder/GetOrderIds',
                    type: 'post',
                    data: { startTime: startTime,
                        endTime: endTime,
                        state: _selstate,
                        appid: appid
                    },
                    success: function (data) {
                        if (data.Result) {
                            if (data.Messages == "") {
                                $("#ExportError").html("没有找到要导出的数据");
                                $("#btnExportData").removeAttr("disabled");
                            }
                            else {
                                $("#startTimeExcel").val(startTime);
                                $("#endTimeExcel").val(endTime);
                                $("#stateExcel").val(_selstate);
                                $("#appidExcel").val(appid);
                                $("#orderIdsExcel").val(data.Messages);

                                $("#FormExcel").submit();
                                $("#ExportError").html("");
                                $("#btnExportData").removeAttr("disabled");
                                closeExport();
                            }
                        }
                        else {
                            $("#ExportError").html("没有找到要导出的数据！");
                            $("#btnExportData").removeAttr("disabled");
                        }
                    },
                    error: function () {
                        $("#ExportError").html("");
                        $("#btnExportData").removeAttr("disabled");
                    }
                });
                //window.location.href = '/CommodityOrder/ExportExcelData?startTime=' + startTime + '&endTime=' + endTime + '&state=' + _selstate + '&appid=' + appid + '&orderids='+;
                //return false;
            }




        }


        //确定发货
        function shipUpdataOrder() {
            var statename = $("#btnShip").html();
            if (statename == "提交中,请稍候") {
                return;
            }
            $("#errorInfo").hide();
            $("#errorInfo").html("");
            var shipExp = $("#expSelect").find("option:selected").text();
            if (shipExp == "请选择") {
                $("#errorInfo").html("请选择快递方式");
                $("#errorInfo").show();
                return;
            }
            if ($("#txtExpOrderNo").val() == "") {
                $("#errorInfo").html("请填写快递单号");
                $("#errorInfo").show();
                return;
            }
            if (shipExp == "其他物流公司") {

                if ($("#txtShipExp").val() == "") {
                    $("#errorInfo").html("请填写物流公司");
                    $("#errorInfo").show();
                    return;
                }
            }
            if (shipExp == "其他物流公司") {
                shipExp = $("#txtShipExp").val();
            }
            $("#btnShip").html("提交中,请稍候");
            $.ajax({
                url: '/CommodityOrder/ShipUpdataOrder/',
                type: 'post',
                data: { commodityOrderId: $("#shipOrderId").text(),
                    shipExpCo: shipExp,
                    expOrderNo: $("#txtExpOrderNo").val()
                },
                success: function (data) {

                    //清空交易状态临时值
                    $("#states").val('');
                    if (data.Result) {
                        var rowcounts = $("#rowcounts");
                        var rowcounts_number = rowcounts.val() - 1;
                        rowcounts.val(rowcounts_number);
                        if (!rowcounts_number % 1) {
                            $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                        } else {
                            var page = $('.ui-jhpager-pager').text().split('/')[0];
                            if (page == 1) {
                                page = 1;
                            } else if (page > 1) {
                                page -= 1;
                            }

                            toSearch(page);
                            //			                $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[1] - 1, rowcounts_number);
                        }
                        closebtnShip();
                        $("#errorInfo").hide();
                    }
                    else {
                        $("#btnShip").html("确定");
                        $("#errorInfo").html(data.Message);
                        $("#errorInfo").show();
                    }
                },
                error: function () {
                    $("#btnShip").html("确定");
                    $("#errorInfo").html("error");
                    $("#errorInfo").show();
                }
            });
        }

        function ContactCustomer(orderId, appId, toUserId) {
            if (getQueryString('src') == 'qry') {
                return;
            }
            var sceneId = '@ViewBag.SceneId';
            if (sceneId == '' || sceneId == '00000000-0000-0000-0000-000000000000') {
                alert("您非客服人员，不能使用该功能，可到“对外管理”菜单中添加自己为客服！");
            }
            $.ajax({
                url: '/CommodityOrder/GetContactCustomerData/',
                type: 'post',
                data: {
                    orderId: orderId,
                    appId: appId,
                    userId: toUserId,
                    sceneId: '@ViewBag.SceneId'
                },
                success: function (data) {
                    if (data.Result) {
                        //data.Data数据格式 {fromUserId:"",fromUserName:"",appId:"",sceneId:"",iconPath:""}
                        window.parent.sns.chat.messageChat(data.Data);
                    }
                    else {
                    }
                },
                error: function () {
                }
            });
        }

        function ShowOrderDetail() {

            $("#OrderDetail").jhtablebox({
                title: "订单详情",
                width: 1200,
                height: 800,
                draggable: true,
                modal: true,
                resizable: false,
                beforeClose: function (e) {
                }
            });


        }

        function win(url, obj, width, height) {
            return window.showModalDialog(url, obj || window, "center=1;dialogWidth=" + (width || 970) + "px;dialogHeight=" + (height || 620) + "px;")
        }

        //获取URL某值
        function getQueryString(name) {
            var r;
            if (arguments.length > 1) {
                r = arguments[1].split('?')[1];
            } else {
                r = window.location.search.substr(1);
            }
            //	var r = str ? str.split('?')[1] : '' || window.location.search.substr(1);
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            r = r.match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }

        //同意订单退款、退货。
        function agreeOrderRefund(orderId, state) {
            var message = $("#Content").val();
            $.ajax({
                url: '/CommodityOrder/UpdateCommodityOrderAfterSales/',
                type: 'post',
                data: { commodityOrderId: id,
                    state: state,
                    message: message,
                    userId: getQueryString("userId")
                },
                success: function (data) {
                    if (data.Result) {
                        var rowcounts = $("#rowcounts");
                        var rowcounts_number = rowcounts.val() - 1;
                        rowcounts.val(rowcounts_number);
                        if (!rowcounts_number % 1) {
                            $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                        } else {
                            var page = $('.ui-jhpager-pager').text().split('/')[0];
                            if (page == 1) {
                                page = 1;
                            } else if (page > 1) {
                                page -= 1;
                            }

                            toSearch(page);
                            //$("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[1] - 1, rowcounts_number);
                        }
                    }

                    //清空取消订单填写描述
                    $("#Content").val('');
                },
                error: function () {

                }
            });
        }

        String.prototype.format = function (args) {
            var result = this;
            if (arguments.length > 0) {
                if (arguments.length == 1 && typeof (args) == "object") {
                    for (var key in args) {
                        if (args[key] != undefined) {
                            var reg = new RegExp("({" + key + "})", "g");
                            result = result.replace(reg, args[key]);
                        }
                    }
                }
                else {
                    for (var i = 0; i < arguments.length; i++) {
                        if (arguments[i] != undefined) {
                            var reg = new RegExp("({[" + i + "]})", "g");
                            result = result.replace(reg, arguments[i]);
                        }
                    }
                }
            }
            return result;
        }
        //是否显示当前 type  1：显示；2：不显示
        function GetGHC(refundInfo, type) {
            $.ajax({
                url: '/CommodityOrder/GetRefundInfo',
                type: 'post',
                dataType: "json",
                contentType: "application/json",
                data: refundInfo,
                error: function () {
                    alert("请求错误，请稍后刷新进行操作.");
                },
                success: function (msg) {
                    if (msg == null || msg.length < 1) {
                        $("#ghc3").html("无更多数据");
                        return;
                    }
                    //第一页
                    if (RefundDetailPageIndex == 1) {
                        $("#ghc2").html("");
                    }
                    if (type == 1 && msg.length == 1) {
                        $("#ghc2").hide();
                        $("#ghc3").hide();

                    } else {
                        if (msg.length == 5) {
                            $("#ghc3").html("点击查看更多");
                            $("#ghc2").show();
                            $("#ghc3").show();
                        } else {
                            $("#ghc3").html("");
                            $("#ghc2").show();
                            $("#ghc3").hide();
                        }

                        for (var j = 0; j < msg.length; j++) {
                            //由于显示当前，所以历史记录中需要过滤掉当前
                            if (type == 1) {
                                if (RefundDetailPageIndex == 1 && j == 0) {
                                    continue;
                                }
                            }
                            msg[j].StateText = SetState(msg[j].State);
                            msg[j].ImgList = SetImgGhc(msg[j].OrderRefundImgs);
                            msg[j].RefundTypeText = SetRefundTypeText(msg[j].RefundType);
                            msg[j].SubTime = ChangeDateFormat(msg[j].SubTime, 2);
                            msg[j].ModifiedOn = ChangeDateFormat(msg[j].ModifiedOn, 2);
                            if (msg[j].State == 2 || msg[j].State == 4) {
                                msg[j].RefuseShow = "show";
                                msg[j].RefuseHide = "hide";
                                msg[j].RefuseReason = msg[j].RefuseReason == null ? "" : msg[j].RefuseReason;
                                msg[j].RefuseTime = msg[j].RefuseTime == null ? "" : ChangeDateFormat(msg[j].RefuseTime, 2);
                            }
                            else {
                                msg[j].RefuseShow = "hide";
                                msg[j].RefuseHide = "show";
                            }
                            var tmpHtml = $("#OrderRefundAfterSalesListTemplete").html().format(msg[j]);
                            //var tmpHtml = $("#RefundDetailTemplete").html().format(msg[j]);
                            $("#ghc2").append(tmpHtml);
                        }
                        //取完1页后，页数加1
                        RefundDetailPageIndex++;
                    }
                }
            });
        }
        function SetImgGhc(imgList) {
            if (imgList && imgList != "") {
                var im = "";
                for (var i = 0; i < imgList.split(',').length; i++) {
                    im += "<a class=\"pingz\" title=\"\" href=\"" + imgList.split(',')[i] + "\"><img  height=\"55px\" width=\"55px\" alt=\"\" src=\"" + imgList.split(',')[i] + "\" /></a>";
                    //im += '<span class="photo"><img src="' + imgList.split(',')[i] + '" alt=""></span>';
                }
                return im;
            }
            return "";
        }
        function SetRefundTypeText(refundType) {
            var text = '';
            switch (refundType) {
                case 0:
                    text = "仅退款";
                    break;
                default:
                    text = "退款退货";
                    break;
            }
            return text;
        }
        function SetState(state) {
            //退款中=0，已退款=1，已拒绝=2，已撤销=3，售后退款中商家同意退款，商家未收到货=10 ,金和处理退款中=12,买家发货超时，商家未收到货=13
            var text = '';
            switch (state) {
                case 0:
                    text = "退款中";
                    break;
                case 1:
                    text = "已退款";
                    break;
                case 2:
                    text = "已拒绝";
                    break;
                case 3:
                    text = "已撤销";
                    break;
                case 4:
                    text = "已拒绝收货";
                    break;
                case 10:
                    text = "售后退款中商家同意退款，商家未收到货";
                    break;
                case 12:
                    text = "处理退款中";
                    break;
                case 13:
                    text = "超时，客户未发货";
                    break;
                default:
                    text = "未知";
                    break;
            }
            return text;
        }
        function ChangeDateFormat(cellval, state) {
            try {
                var date = new Date(parseInt(cellval.replace("/Date(", "").replace(")/", ""), 10));
                var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                var hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                var minu = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                var second = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
                if (state == 1) {
                    return date.getFullYear() + "-" + month + "-" + currentDate + " " + hour + ":" + minu;
                }
                else if (state == 2) {
                    return date.getFullYear() + "-" + month + "-" + currentDate + " " + hour + ":" + minu + ":" + second;
                }
                else {
                    return date.getFullYear() + "-" + month + "-" + currentDate;
                }
            } catch (e) {
                return "";
            }
        }
        //拒绝申请
        function DoRefuse(commodityOrderId, refuseReason) {
            var ucoUrl = "";
            if ($("#hiddstate").val() == 3) {
                ucoUrl = "/CommodityOrder/RefuseRefundOrderAfterSales/";
            } else {
                ucoUrl = "/CommodityOrder/RefuseRefundOrder/";
            }
            var statename = $("#btnrun").html();
            $.ajax({
                url: ucoUrl,
                type: 'post',
                data: { commodityOrderId: $("#hiddorid").val(),
                    state: 2,
                    message: "",
                    userId: getQueryString("userId"),
                    refuseReason: refuseReason
                },
                success: function (data) {
                    if (data.Result) {
                        $("#btnrun").html("已退款");
                        closeTiporder();
                        var rowcounts = $("#rowcounts");
                        var rowcounts_number = rowcounts.val() - 1;
                        rowcounts.val(rowcounts_number);
                        if (!rowcounts_number % 1) {
                            $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                        } else {
                            var page = $('.ui-jhpager-pager').text().split('/')[0];
                            if (page == 1) {
                                page = 1;
                            } else if (page > 1) {
                                page -= 1;
                            }

                            toSearch(page);
                        }
                    }
                    else {
                        $("#btnrun").html(statename);
                        $(".spalert").html(data.Messages);
                    }

                    $("#RefundReasonForm").jhtablebox("close");
                    $("#refund").CloseDiv();
                },
                error: function () {
                    $("#btnrun").html(statename);
                    //$(".spalert").html("erro");
                    $("#RefundReasonForm").jhtablebox("close");
                    $("#refund").CloseDiv();
                }
            });
        }
        //拒绝收货
        function DoReceiveRefuse(commodityOrderId, refuseReason) {
            var ucoUrl = "";
            if ($("#hiddstate").val() == 3) {
                ucoUrl = "/CommodityOrder/RefuseRefundOrderSellerAfterSales/";
            } else {
                ucoUrl = "/CommodityOrder/RefuseRefundOrderSeller/";
            }
            var statename = $("#btnrun").html();
            $.ajax({
                url: ucoUrl,
                type: 'post',
                data: { commodityOrderId: $("#hiddorid").val(),
                    state: 2,
                    message: "",
                    userId: getQueryString("userId"),
                    refuseReason: refuseReason
                },
                success: function (data) {
                    if (data.Result) {
                        $("#btnrun").html("已退款");
                        closeTiporder();
                        var rowcounts = $("#rowcounts");
                        var rowcounts_number = rowcounts.val() - 1;
                        rowcounts.val(rowcounts_number);
                        if (!rowcounts_number % 1) {
                            $("#pager").jhpager("refresh", $('.ui-jhpager-pager').text().split('/')[0], rowcounts_number);
                        } else {
                            var page = $('.ui-jhpager-pager').text().split('/')[0];
                            if (page == 1) {
                                page = 1;
                            } else if (page > 1) {
                                page -= 1;
                            }

                            toSearch(page);
                        }
                    }
                    else {
                        $("#btnrun").html(statename);
                        $(".spalert").html(data.Messages);
                    }

                    $("#RefundReceiveReasonForm").jhtablebox("close");
                    $("#trefundexp").CloseDiv();
                },
                error: function () {
                    $("#btnrun").html(statename);
                    //$(".spalert").html("erro");
                    $("#RefundReceiveReasonForm").jhtablebox("close");
                    $("#trefundexp").CloseDiv();
                }
            });
        }
        function HideRefund() {
            $("#refund").hide();
        }
        function ShowRefund() {
            $("#refund").show();
        }
        function HideReceiveRefund() {
            $("#trefundexp").hide();
        }
        function ShowReceiveRefund() {
            $("#trefundexp").show();
        }
        //是否显示当前 1：显示；2：不显示
        function IsShowNow(commodityOrderState, orderRefundState, commodityOrderServiceState, orderRefundAfterSalesState) {

            if (commodityOrderState == 3) {    //售后
                //订单状态（必填）：确认收货=3，售后退款中=5,已退款=7，商家未收到货=10 ,金和处理退款中=12, 买家发货超时，商家未收到货=3，售后交易成功=15
                if (commodityOrderServiceState == 7 || commodityOrderServiceState == 12 || commodityOrderServiceState == 15) {
                    return 2;
                }
                else if (commodityOrderServiceState == 5 || commodityOrderServiceState == 10) {
                    return 1;
                }
                else if (commodityOrderServiceState == 3) {
                    //状态：退款中=0，已退款=1，已拒绝=2，已撤销=3，拒绝收货=4，售后退款中商家同意退款，商家未收到货=10 , 买家已发货=11,金和处理退款中=12,买家发货超时，商家未收到货=13
                    if (orderRefundAfterSalesState == 1 || orderRefundAfterSalesState == 2 || orderRefundAfterSalesState == 3 || orderRefundAfterSalesState == 4 || orderRefundAfterSalesState == 12 || orderRefundAfterSalesState == 13) {
                        return 2;
                    }
                    else if (orderRefundAfterSalesState == 0 || orderRefundAfterSalesState == 10 || orderRefundAfterSalesState == 11) {
                        return 1;
                    }
                    else if (orderRefundAfterSalesState == -1) {
                        return 2;
                    }
                    else {
                        return 1;
                    }
                }
                else {
                    return 1;
                }
            }
            else {    //售中
                //订单状态（必填）：未支付=0，未发货=1，已发货=2，确认收货=3，商家取消订单=4，客户取消订单=5，超时交易关闭=6，已退款=7，待发货退款中=8，已发货退款中=9,已发货退款中商家同意退款，商家未收到货=10,付款中=11,金和处理退款中=12,出库中=13，出库中退款中=14
                if (commodityOrderState == 0 || commodityOrderState == 1 || commodityOrderState == 2 || commodityOrderState == 4 || commodityOrderState == 5 || commodityOrderState == 6 || commodityOrderState == 7 || commodityOrderState == 11 || commodityOrderState == 12 || commodityOrderState == 13) {
                    return 2;
                }
                else if (commodityOrderState == 8 || commodityOrderState == 9 || commodityOrderState == 10 || commodityOrderState == 14) {
                    return 1;
                }
                else {
                    return 1;
                }
            }
        }

        $(function () {
            var limitNum = 140;
            $('#RefundReason').on('keydown keyup keypress submit focus blur copy cut paste change input', function (event) {
                var value = $.trim($(this).val());
                var remain = value.length;

                if (remain > limitNum) {
                    $(this).val(value.substring(0, limitNum));

                } else {
                    var result = limitNum - remain;
                }
            });
            $('#RefundReceiveReason').on('keydown keyup keypress submit focus blur copy cut paste change input', function (event) {
                var value = $.trim($(this).val());
                var remain = value.length;

                if (remain > limitNum) {
                    $(this).val(value.substring(0, limitNum));

                } else {
                    var result = limitNum - remain;
                }
            });
        });
    </script>
    <style type="text/css">
        input.inp-txt
        {
            height: 18px;
            line-height: 18px;
            border: 1px solid #B6C0CD;
            padding: 4px 5px;
            vertical-align: middle;
            border-radius: 3px;
            box-shadow: inset 1px 1px 2px #DBDBDB;
        }
        .btn120
        {
            display: inline-block;
            width: 120px;
            height: 28px;
            line-height: 28px;
            background: url(../Content/default/images/btn120.png) no-repeat;
            text-align: center;
            vertical-align: middle;
            color: #5F7392;
            box-shadow: 1px 1px 2px #DBDBDB;
        }
        .dgl_bot_header span.addColor
        {
            color: #8C94A9;
        }
        .dgl_bot_header a.orderText
        {
            color: #409FFF;
        }
        .dgl_bot_header a.orderText:hover
        {
            color: #80BDE3;
        }
        .dgl_bot_header a:hover
        {
            color: #80BDE3;
        }
        .left_border p a.state
        {
            color: #409FFF;
        }
        .left_border p a.state:hover
        {
            color: #80BDE3;
        }
        #ghc3
        {
            display: block;
            color: #315bde;
            text-align: center;
            font-size: 12px;
            font-family: 'Microsoft YaHei';
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    <script type="text/javascript">
        //比较时间，得出第几天
        function CalDate(comDate) {
            //控制延长收货时间按钮的显示。
            //转换时间格式 为了计算日期时间差
            var myDate = new Date();
            var month = myDate.getMonth() + 1 < 10 ? "0" + (myDate.getMonth() + 1) : myDate.getMonth() + 1;
            var currentDate = myDate.getDate() < 10 ? "0" + myDate.getDate() : myDate.getDate();
            var eDate = myDate.getFullYear() + "-" + month + "-" + currentDate;

            //计算时间差
            var sDate = ChangeDateFormat(comDate, 3);
            var sArr = sDate.split("-");
            var eArr = eDate.split("-");
            var sRDate = new Date(sArr[0], sArr[1], sArr[2]);
            var eRDate = new Date(eArr[0], eArr[1], eArr[2]);
            var result = (eRDate - sRDate) / (24 * 60 * 60 * 1000) + 1;
            return result;
        }
    </script>
</head>
<form id="FormWord" action="/CommodityOrder/ExportOrders" method="post">
<input type="hidden" name="startTimeWord" id="startTimeWord" />
<input type="hidden" name="endTimeWord" id="endTimeWord" />
<input type="hidden" name="stateWord" id="stateWord" />
<input type="hidden" name="appidWord" id="appidWord" />
<input type="hidden" name="orderIdsWord" id="orderIdsWord" />
</form>
<form id="FormExcel" action="/CommodityOrder/ExportExcelData" method="post">
<input type="hidden" name="startTimeExcel" id="startTimeExcel" />
<input type="hidden" name="endTimeExcel" id="endTimeExcel" />
<input type="hidden" name="stateExcel" id="stateExcel" />
<input type="hidden" name="appidExcel" id="appidExcel" />
<input type="hidden" name="orderIdsExcel" id="orderIdsExcel" />
</form>
<div class="box">
    <div class="content">
        <div class="dgl_title">
            <ul>
                <li class="cx"><span>订单查询</span>
                    <input type="text" id="se" value="可输入订单编号、收货人姓名、手机号查询" onfocus="if(this.value==defaultValue) {this.value='';this.type='text';}"
                        onblur="if(!value) {value=defaultValue; this.type='text';}" class="inp-txt" style="width: 400px;
                        color: #8c94a9;" />
                    <a class="btn120" href="#" onclick="SearchOrderCode()">查询</a> <a id="backBtn" class="btn120"
                        style="display: none;" href="#" onclick="BackTo()">返回</a> </li>
                <li id="priceli"><span class="tou">消费金额：</span> <span class="yanse" style="cursor: pointer"
                    onclick="toSelectByPrice(this,-1,-1)">全部</span> <span style="cursor: pointer" onclick="toSelectByPrice(this,0,100)">
                        0-100</span> <span style="cursor: pointer" onclick="toSelectByPrice(this,101,500)">101-500</span>
                    <span style="cursor: pointer" onclick="toSelectByPrice(this,501,1000)">501-1000</span>
                    <span style="cursor: pointer" onclick="toSelectByPrice(this,1001,2000)">1001-2000</span>
                    <span style="cursor: pointer" onclick="$(this).css('display','none').next().css('display','inline');">
                        自定义</span> <span style="display: none;">
                            <input id="beginPrice" type="text" class="inp-txt" style="width: 40px; color: #8c94a9;
                                height: 10px; line-height: 10px;" />
                            <span style="padding: 0 2px; margin-right: 0;">-</span>
                            <input id="endPrice" type="text" class="inp-txt" style="width: 40px; color: #8c94a9;
                                height: 10px; line-height: 10px;" />
                            <span style="cursor: pointer" onclick="toSelectByPrice(this,$('#beginPrice').val(),$('#endPrice').val())">
                                确定</span> </span></li>
                <li id="dayli"><span style="cursor: pointer" class="tou">订单时间：</span> <span style="cursor: pointer"
                    class="yanse" onclick="toSelectByDay(this,0)">全部</span> <span style="cursor: pointer"
                        onclick="toSelectByDay(this,3)">近3天</span> <span style="cursor: pointer" onclick="toSelectByDay(this,7)">
                            近7天</span> <span style="cursor: pointer" onclick="toSelectByDay(this,14)">近14天</span>
                    <span style="cursor: pointer" onclick="toSelectByDay(this,30)">近30天</span> <span
                        onclick="toSelectByDay(this,90)" style="cursor: pointer">近三个月</span> <span style="cursor: pointer"
                            onclick="$(this).css('display','none').next().css('display','inline');">自定义</span>
                    <span style="display: none;">
                        <input type="text" id="StartOrderTime" class="inp-txt" style="width: 80px; color: #8c94a9;height: 10px; line-height: 10px;" value="@DateTime.Today.ToString("yyyy-MM-dd")"/>
                        <strong style="font-weight: normal;">-</strong>
                        <input type="text" id="EndOrderTime" class="inp-txt" style="width: 80px; color: #8c94a9;height: 10px; line-height: 10px;" value="@DateTime.Today.ToString("yyyy-MM-dd")"/>
                        <span onclick="toSelectByDates(this,$('#StartOrderTime').val(),$('#EndOrderTime').val())"
                            style="cursor: pointer; margin-left: 0">确定</span> </span></li>
                <li id="stateli"><span class="tou">订单状态：</span> <span class="yanse" style="cursor: pointer"
                    onclick="toSelectByState(this,-1)">全部</span> <span onclick="toSelectByState(this,'0')"
                        style="cursor: pointer">待付款</span> <span style="cursor: pointer" onclick="toSelectByState(this,'1,11')">
                            待发货</span><span style="cursor: pointer" onclick="toSelectByState(this,'13')">出库中</span>
                    <span style="cursor: pointer" onclick="toSelectByState(this,'2')">已发货</span> <span
                        style="cursor: pointer" onclick="toSelectByState(this,'8,9,10,12,14')">退款中</span>
                    <span style="cursor: pointer" onclick="toSelectByState(this,'7')">已退款</span> <span
                        style="cursor: pointer" onclick="toSelectByState(this,'3')">交易成功</span> <span style="cursor: pointer"
                            onclick="toSelectByState(this,'4,5,6')">交易失败</span> <span style="cursor: pointer"
                                onclick="toSelectByState(this,'99')">待自提</span> </li>
                <li id="paymentli"><span class="tou">支付方式：</span> <span class="yanse" style="cursor: pointer"
                    onclick="toSelectByPayment(this,-1)">全部</span> <span onclick="toSelectByPayment(this,0)"
                        style="cursor: pointer">金币</span> <span style="cursor: pointer" onclick="toSelectByPayment(this,2)">
                            支付宝(直接到账)</span> <span style="cursor: pointer" onclick="toSelectByPayment(this,1)">货到付款</span>
                    <span style="cursor: pointer" onclick="toSelectByPayment(this,3)">支付宝(担保交易)</span>
                    <span style="cursor: pointer" onclick="toSelectByPayment(this,4)">U付</span>
                </li>
            </ul>
        </div>
        <div class="zhjian" style="width: 96%;">
            <span style="display: inline-block; float: left;">订单信息 (<span style="color: Red;
                display: inline; padding-left: 3px;">金和官方不介入交易纠纷处理，请自行评估货到付款交易风险！</span>)</span>
            <div style="float: right; margin-top: 25px;">
                <a class="btn120" href="#" onclick="ShowExportData()">批量导出</a>&nbsp;&nbsp;<a class="btn120"
                    href="#" onclick="ImportOrder()"> 导出订单</a></div>
            <div style="clear: both;">
            </div>
        </div>
        <div id="content_make">
            <div id="dataDIV">
                <table class="dgl_bot" style="color: #8C94A9;">
                    <thead>
                        <tr class="t_tr1" style="color: #8C94A9;">
                            <td width="5px">
                            </td>
                            <td>
                                <span style="float: left; margin-left: 6px;">
                                    <input type="checkbox" id="allCheck" />
                                    <span style="margin-left: 22px">全选</span> </span><span>商品名称 </span>
                            </td>
                            <td width="10%">
                                单价（元）
                            </td>
                            <td width="10%">
                                数量
                            </td>
                            <td width="10%">
                                买家
                            </td>
                            <td width="10%">
                                交易状态<input type="hidden" id="states" value='' />
                            </td>
                            <td width="12%">
                                实收款（元）<input type="hidden" id="prices" value='' />
                            </td>
                            <td width="150px;">
                                备注
                            </td>
                            <td width="5">
                            </td>
                        </tr>
                        <tr class="sep-row">
                            <td colspan="8">
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int num = 0;
                        }
                        @foreach (Jinher.AMP.BTP.Deploy.CustomDTO.CommodityOrderVM commodityOrderVM in commodityOrderList)
                        {
                            var orderState = commodityOrderVM.CommodityOrderId + "_State";
                            string stDisplay = commodityOrderVM.SelfTakeFlag == 0 ? "none" : "inline-block";
                            <tr class="dgl_bot_header">
                                <td class="left_sep">
                                </td>
                                <td colspan="7">
                                    <input style="margin:5px;" type="checkbox" name="itemCheckBox" id ="@commodityOrderVM.CommodityOrderId"/>
                                    <span class="ml15 addColor">订单编号：<a id="tzinfor" href="javascript:void(0)" target="_self" tzinfors="/CommodityOrder/CommodityOrderDetail?commodityOrderId=@commodityOrderVM.CommodityOrderId">@commodityOrderVM.CommodityOrderCode</a></span>
                                    <span class="ml50 addColor">@getTimeState(commodityOrderVM)</span> <span class="ml50 addColor"  style="display:@stDisplay">
                                        <img style="position: relative; top: 5px;" src="/Content/Images/ztflag.png" />
                                        <span style="margin-top: -10;">@commodityOrderVM.SelfTakeAddress</span> </span>
                                    <span style=" float:right; margin-right:8px;cursor:pointer;" class="ml50 addColor"  onclick="ContactCustomer('@commodityOrderVM.CommodityOrderId','@commodityOrderVM.AppId','@commodityOrderVM.UserId')">
                                        <img style="margin-top: 1px; margin-right: 5px;" src="/Content/Mobile/contactOwner.png" />联系客户</span>
                                </td>
                                <td class="right_sep">
                                </td>
                            </tr>

                            if (commodityOrderVM.OrderItems != null && commodityOrderVM.OrderItems.Count > 0)
                            {
                                var count = commodityOrderVM.OrderItems.Count;
                                var orderItems = commodityOrderVM.OrderItems;
                                string isST = commodityOrderVM.SelfTakeFlag == 1 ? "block" : "none";

                                for (var i = 0; i < count; i++)
                                {
                                    Jinher.AMP.BTP.Deploy.CustomDTO.OrderItemsVM orderItem = orderItems[i];
                            <tr class="dgl_bot_con">
                                <td class="left_sep">
                                </td>
                                <td align="left">
                                    <div class="com_img ml15">
                                        <div style="position: relative; width: 81px; height: 83px">
                                            <img class="img" src="@orderItem.PicturesPath" width="81" height="83" />
                                            <div class="selfTake" style="display:@isST">
                                                <img class="selfTakeImg" style="display: block; width: 81px;" src="/Images/selftake.png"
                                                    alt="自提" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="com_info">
                                        <div class="com_name">
                                            @orderItem.CommodityIdName
                                        </div>
                                        <div class="com_attr">
                                            @foreach (var item in orderItem.CommodityCategorys)
                                            {
                                                if (item != "null" && item != "请选择")
                                                {
                                                <span>@item</span>
                                                }
                                            }<br />
                                            @{
                                            if (!string.IsNullOrEmpty(orderItem.SizeAndColorId))
                                            {
                                                orderItem.SizeAndColorId = orderItem.SizeAndColorId.Replace("颜色", "");
                                                orderItem.SizeAndColorId = orderItem.SizeAndColorId.Replace("尺寸", "");
                                                orderItem.SizeAndColorId = orderItem.SizeAndColorId.Replace(":", "");
                                                orderItem.SizeAndColorId = orderItem.SizeAndColorId.Replace("：", "");
                                                List<string> attrs = orderItem.SizeAndColorId.Split(new char[] { ',', '，' }).ToList();
                                                foreach (string attr in attrs)
                                                {
                                                    if (attr != "null" && attr != "请选择")
                                                    {
                                                <span>@attr</span>
                                                    }
                                                }
                                            }
                                                    
                                            }
                                        </div>
                                    </div>
                                </td>
                                <td align="center" class="com_price">
                                    <p>
                                        @Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()@orderItem.Price
                                    </p>
                                </td>
                                <td align="center">@orderItem.Number
                                </td>
                                @if (i == 0)
                                {
                                    <td align="center" rowspan="@count" class="left_border">@commodityOrderVM.ReceiptUserName
                                    </td> 
                                    <td align="center"  rowspan="@count"  class="left_border">
                                        <p style="vertical-align: middle">
                                            @switch (commodityOrderVM.State)
                                            {
                                                case 0:
                                                <text><span>待付款</span>
                                                <br />
                                                <a href="javascript:;" class="state">修改</a> <span style="display: none;">
                                                    <select class="select">
                                                        <option value="0">请选择</option>
                                                        <option value="4">取消订单</option>
                                                    </select><br />
                                                    <a href="javascript:;" class="updates"  onclick="Updates(this,'@commodityOrderVM.CommodityOrderId')">
                                                        确定</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="cancel">取消</a></span>
                                                @* 待付款时不能进行修改（以后可能会改，不要删除注释部分代码！）
                                                    <br/><a href="javascript:;" class="state">修改</a>
                                                    <span style="display:none;"><select class="select"><option value="2">已发货</option>
                                                    <option value="4">取消订单</option>
                                                </select><br /><a href="javascript:;" class="updates" onclick="Updates(this,'@commodityOrderVM.CommodityOrderId')">
                                                    确定</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="cancel">取消</a></span>*@
                                                </text>
                                                                                                              break;
                                                case 1:
                                                <text><span>待发货</span><br />
                                                @if ((ViewBag.IsOrg == null) || (ViewBag.IsOrg != null && ViewBag.BTPOrderStateUpd != null && ViewBag.IsOrg && ViewBag.BTPOrderStateUpd))
                                                {
                                                <a href="javascript:;" class="state">修改</a> 
                                                }
                                                <span style="display: none;">
                                                    <select class="select">
                                                        <option value="13">出库中</option>
                                                        <option value="2">已发货</option>
                                                        @if (commodityOrderVM.Payment == 1)
                                                        {
                                                            <option value="4">取消订单</option>
                                                        }
                                                    </select><br />
                                                    <a href="javascript:;" class="updates"  onclick="Updates(this,'@commodityOrderVM.CommodityOrderId')">
                                                        确定</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="cancel">取消</a>
                                                </span>
                                                </text>
                                                                                                              break;
                                                case 2:
                                                                                                              if (commodityOrderVM.Payment == 1)
                                                                                                              {//货到付款
                                                <text><span>已发货</span><br />
                                                @if ((ViewBag.IsOrg == null) || (ViewBag.IsOrg != null && ViewBag.BTPOrderStateUpd != null && ViewBag.IsOrg && ViewBag.BTPOrderStateUpd))
                                                {
                                                <a href="javascript:;" class="state">修改</a>
                                                }
                                                <span style="display: none;">
                                                    <select class="select">
                                                        <option value="3">交易成功</option>
                                                        <option value="4">取消订单</option>
                                                    </select><br />
                                                    <a href="javascript:;" class="updates"  onclick="Updates(this,'@commodityOrderVM.CommodityOrderId')">
                                                        确定</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="cancel">取消</a>
                                                </span>
                                                </text>
                                                                                                              }
                                                                                                              else
                                                                                                              {
                                                <text>已发货</text>
                                                                                                              };
                                                                                                              break;
                                                case 3:
                                                                                                              switch (commodityOrderVM.StateAfterSales)
                                                                                                              {
                                                                                                                  case -1:
                                                <text>交易成功</text>                                                     break; break;
                                                                                                                  case 3:
                                                <text>交易成功</text><div style="color: red;">
                                                    (冻结)</div>        break;
                                                                                                                  case 15:
                                                <text>交易成功</text>
                                                                      break;
                                                                                                                  case 5:
                                                                                                                  case 10:

                                                <text>退款中</text>
                                                                      break;
                                                                                                                  case 12:
                                                <text>处理退款中</text>
                                                                      break;
                                                                                                                  case 7:
                                                <text>已退款</text>
                                                                      break;
                                                                                                                  default:                                             
                                                <text>交易成功</text>
                                                                      break;
                                                                                                              }
                                                                                                              break;
                                                case 4:
                                                <text>交易失败</text>
                                                                                                              break;
                                                case 6:
                                                <text>交易失败</text>                                                       
                                                                                                              break;
                                                case 8:
                                                case 14:
                                                
                                                <text><span>退款中</span><br />
                                                @if ((ViewBag.IsOrg == null) || (ViewBag.IsOrg != null && ViewBag.BTPOrderStateUpd != null && ViewBag.IsOrg && ViewBag.BTPOrderStateUpd))
                                                {
                                                <a href="javascript:;" class="state">修改</a> 
                                                }
                                                <span style="display: none;">
                                                    <select class="select">
                                                        <option value="2">已发货</option>
                                                    </select><br />
                                                    <a href="javascript:;" class="updates"  onclick="Updates(this,'@commodityOrderVM.CommodityOrderId')">
                                                        确定</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="cancel">取消</a>
                                                </span>
                                                </text>
                                                                                                              break;
                                                case 9:
                                                <text>退款中</text>
                                                                                                              break;
                                                case 7:
                                                <text>已退款</text>
                                                                                                              break;
                                                case 10:
                                                <text>退款中</text>
                                                                                                              break;
                                                case 5:
                                                <text>交易失败</text>
                                                                                                              break;
                                                case 11:
                                                <text><span>待发货</span><br />
                                                @if ((ViewBag.IsOrg == null) || (ViewBag.IsOrg != null && ViewBag.BTPOrderStateUpd != null && ViewBag.IsOrg && ViewBag.BTPOrderStateUpd))
                                                {
                                                <a href="javascript:;" class="state">修改</a> 
                                                }
                                                <span style="display: none;">
                                                    <select class="select">
                                                        <option value="13">出库中</option>
                                                        <option value="11">已发货</option>
                                                        @if (commodityOrderVM.Payment == 1)
                                                        {
                                                            <option value="4">取消订单</option>
                                                        }
                                                    </select><br />
                                                    <a href="javascript:;" class="updates"  onclick="Updates(this,'@commodityOrderVM.CommodityOrderId')">
                                                        确定</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="cancel">取消</a></span>
                                                </text>
                                                                                                              break;
                                                case 12:
                                                <text>处理退款中</text>
                                                                                                              break;
                                                case 13:
                                                <text>出库中
                                                <br />
                                                @if ((ViewBag.IsOrg == null) || (ViewBag.IsOrg != null && ViewBag.BTPOrderStateUpd != null && ViewBag.IsOrg && ViewBag.BTPOrderStateUpd))
                                                {
                                                <a href="javascript:;" class="state">修改</a> 
                                                }
                                                <span style="display: none;">
                                                    <select class="select">
                                                        <option value="2">已发货</option>
                                                        @if (commodityOrderVM.Payment == 1)
                                                        {
                                                            <option value="4">取消订单</option>
                                                        }
                                                    </select><br />
                                                    <a href="javascript:;" class="updates"  onclick="Updates(this,'@commodityOrderVM.CommodityOrderId')">
                                                        确定</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="cancel">取消</a>
                                                </span>
                                                </text>
                                                                                                              break;

                                            }
                                        </p>
                                    </td>
                                    <td align="center" rowspan="@count" class="left_border">
                                        <div class="parentElement">
                                            <input class="hiddprice" type="hidden" value="@(commodityOrderVM.Price + commodityOrderVM.Freight)" />
                                            @if (commodityOrderVM.State == 0)
                                            {
                                                if (commodityOrderVM.IsModifiedPrice == true)
                                                {
                                                <text> <font class="yprice" style="text-decoration: line-through;">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()@(commodityOrderVM.Price + commodityOrderVM.Freight)
                                                </font>
                                                <br />
                                                </text>
                                                }
                                                <text> <span class="find_1">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()@commodityOrderVM.CurrentPrice</span>
                                                @if (commodityOrderVM.IsModifiedPrice == true)
                                                {
                                                <img src="/Content/images/update.png" alt="" width="17" height="17" />
                                                }
                                                <br />
                                                @if ((ViewBag.IsOrg == null) || (ViewBag.IsOrg != null && ViewBag.BTPOrderPriceUpd != null && ViewBag.IsOrg && ViewBag.BTPOrderPriceUpd))
                                                {
                                                <a href="javascript:;" class="state">修改</a> 
                                                }
                                                <span style="display: none;">
                                                    <input class="price" type="text" style="width:50px;border:1px solid #B8BFCF;" value="@commodityOrderVM.CurrentPrice" />
                                                    <br />
                                                    <a href="javascript:;"  onclick="UpdatePrice(this,'@commodityOrderVM.CommodityOrderId')">
                                                        确定</a> &nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="cancel" onclick="CancelUpdatePrice(this)">取消</a></span>
                                                </text>
                                            }
                                            else
                                            {
                                                if (commodityOrderVM.State != 4 && commodityOrderVM.State != 5)
                                                {

                                                    if (commodityOrderVM.IsModifiedPrice == true)
                                                    {                                                    
                                                <text> <font class="yprice" style="text-decoration: line-through;">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()@(commodityOrderVM.Price + commodityOrderVM.Freight)
                                                </font>
                                                <br />
                                                </text>
                                                    }
                                                <text> <span class="find_1">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()@commodityOrderVM.CurrentPrice</span>
                                                @if (commodityOrderVM.IsModifiedPrice == true)
                                                {
                                                <img src="/Content/images/update.png" alt="" width="17" height="17" />
                                                }
                                                <br />
                                                </text> 
                                                <text>@getPayment(commodityOrderVM.Payment)</text>
                                                }
                                                else
                                                {

                                                    if (commodityOrderVM.IsModifiedPrice == true)
                                                    {                                                    
                                                <text> <font class="yprice" style="text-decoration: line-through;">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()@(commodityOrderVM.Price + commodityOrderVM.Freight)
                                                </font>
                                                <br />
                                                </text>
                                                    }
                                                <text> <span class="find_1">@Jinher.AMP.BTP.UI.Util.WebUtil.GetCurrency()@commodityOrderVM.CurrentPrice</span>
                                                @if (commodityOrderVM.IsModifiedPrice == true)
                                                {
                                                <img src="/Content/images/update.png" alt="" width="17" height="17" />
                                                }
                                                <br />
                                                </text>                                                      
                                                <text>@getPayment(commodityOrderVM.Payment)</text>                                    
                                               
                                                <br />
                                                if (commodityOrderVM.MessageToBuyer != null)
                                                {
                                                    if (commodityOrderVM.MessageToBuyer.Length > 30)
                                                    {
                                                        var str = 15;
                                                        var commo = commodityOrderVM.MessageToBuyer;
                                                        var fcount = commodityOrderVM.MessageToBuyer.Length / 15;
                                                        for (var y = 0; y < fcount; y++)
                                                        {
                                                            commo = commo.Insert(str, "\n");
                                                            str = str + 16;

                                                        }
                                                <text><span title="@commo">(@commodityOrderVM.MessageToBuyer.Substring(0, 30)
                                                </span>...)
                                                </text>
                                                    }
                                                    else
                                                    {
                                                <text>(@commodityOrderVM.MessageToBuyer)</text>
                                                    }
                                                }
                                                }
                                            }
                                            @if (commodityOrderVM.State == 8 || commodityOrderVM.State == 9 || commodityOrderVM.State == 7 || commodityOrderVM.State == 14)
                                            {
                                                if (commodityOrderVM.State == 8)
                                                {
                                                <text><div class="ghcred">
                                                    客户申请退款</div></text>
                                                }
                                                else if (commodityOrderVM.State == 9 || commodityOrderVM.State == 14)
                                                {
                                                <text><div class="ghcred">
                                                    客户申请退款/退货</div></text>
                                                }
                                                else if (commodityOrderVM.State == 7)
                                                {

                                                }
                                            }
                                            else if (commodityOrderVM.State == 1 || commodityOrderVM.State == 2 || commodityOrderVM.State == 13)
                                            {
                                                if (commodityOrderVM.StateRefund == 2)
                                                {
                                                    if (commodityOrderVM.RefundType == 0)
                                                    {
                                                <text><div class="ghcred">
                                                    已拒绝退款申请</div></text>
                                                    }
                                                    if (commodityOrderVM.RefundType == 1)
                                                    {
                                                <text><div class="ghcred">
                                                    已拒绝退款/退货申请</div></text>
                                                    }
                                                }
                                                else if (commodityOrderVM.StateRefund == 4)
                                                {
                                                <text><div class="ghcred">
                                                    已拒绝收货</div></text>
                                                }
                                            }
                                            else
                                            {
                                                if (commodityOrderVM.State == 10)
                                                {
                                                <text><div class="ghcred">
                                                    已达成协议
                                                </div>
                                                </text> 
                                                    if (commodityOrderVM.RefundExpCo != null && commodityOrderVM.RefundExpOrderNo != "")
                                                    {
                                                <text><div>
                                                    <a href="javascript:;" id="refundexp" orpayment="@commodityOrderVM.Payment"  orderid="@commodityOrderVM.CommodityOrderId" orstate= "@commodityOrderVM.State">
                                                        退货物流信息</a></div></text>
                                                    }
                                                }

                                            }
                                            @if (commodityOrderVM.State == 2)
                                            {
                                                if (commodityOrderVM.IsDelayConfirmTime)
                                                {
                                                <text><div class="ghcred">
                                                    买家申请延长收货时间3天！</div></text>
                                                }
                                            }
                                            @if (commodityOrderVM.State == 4 || commodityOrderVM.State == 5 || commodityOrderVM.State == 6 || commodityOrderVM.State == 7)
                                            {
                                                <text><div>
                                                    <a href="javascript:;" id="delorder"  orderid="@commodityOrderVM.CommodityOrderId">删除</a></div></text>
                                            }
                                            else if (commodityOrderVM.State == 3)
                                            {
                                                if (commodityOrderVM.StateAfterSales == 5 && commodityOrderVM.StateRefundAfterSales == 0)
                                                {
                                                    if (commodityOrderVM.RefundType == 0)
                                                    {
                                                <text><div class="ghcred">
                                                    客户申请退款</div></text>
                                                    }
                                                    if (commodityOrderVM.RefundType == 1)
                                                    {
                                                <text><div class="ghcred">
                                                    客户申请退款/退货</div></text>
                                                    }
                                                }
                                                else if (commodityOrderVM.StateAfterSales == 3 && commodityOrderVM.StateRefundAfterSales == 13)
                                                {
                                                <text><div class="ghcred">
                                                    超时，客户未发货</div></text>
                                                }
                                                else if (commodityOrderVM.StateAfterSales == 3 && commodityOrderVM.StateRefundAfterSales == 2)
                                                {
                                                    if (commodityOrderVM.RefundType == 0)
                                                    {
                                                <text><div class="ghcred">
                                                    已拒绝退款申请</div></text>
                                                    }
                                                    if (commodityOrderVM.RefundType == 1)
                                                    {
                                                <text><div class="ghcred">
                                                    已拒绝退款/退货申请</div></text>
                                                    }
                                                }
                                                else if (commodityOrderVM.StateAfterSales == 3 && commodityOrderVM.StateRefundAfterSales == 4)
                                                {
                                                <text><div class="ghcred">
                                                    已拒绝收货</div></text>
                                                }
                                                //售后退款中=5,已退款=7，商家未收到货=10 ,金和处理退款中=12
                                                if (commodityOrderVM.StateAfterSales == 5)
                                                {

                                                }
                                                else if (commodityOrderVM.StateAfterSales == 7)
                                                {                                             
                                                <text><div>
                                                    <a href="javascript:;" id="delorder"  orderid="@commodityOrderVM.CommodityOrderId">删除</a></div>
                                                </text>
                                                     
                                                }
                                                else if (commodityOrderVM.StateAfterSales == 10)
                                                {
                                                <div class="ghcred">
                                                    已达成协议
                                                </div>
                                                    if (commodityOrderVM.IsDelayConfirmTimeAfterSales == true && commodityOrderVM.StateRefundAfterSales == 11)
                                                    {
                                                <text><div class="ghcred">
                                                    卖家申请延长收货时间3天！</div></text>
                                                    }
                                                    if (commodityOrderVM.RefundExpCo != null && commodityOrderVM.RefundExpOrderNo != "")
                                                    {
                                                <text><div>
                                                    <a href="javascript:void(0);" id="refundexp" orpayment="@commodityOrderVM.Payment"  orderid="@commodityOrderVM.CommodityOrderId" orstate= "@commodityOrderVM.State"  orAfState="@commodityOrderVM.StateAfterSales" >
                                                        退货物流信息</a></div></text>
                                                    }
                                                    else
                                                    {

                                                    }
                                                }

                                            }
                                            @if (commodityOrderVM.StateRefund >= 0 || commodityOrderVM.StateRefundAfterSales >= 0)
                                            {
                                                <text><div>
                                                    <a href="javascript:void(0);" id="refundInfor" retype="" orpayment="@commodityOrderVM.Payment" orderid="@commodityOrderVM.CommodityOrderId" orstate= "@commodityOrderVM.State" orAfState="@commodityOrderVM.StateAfterSales" selfTakeFlag="@commodityOrderVM.SelfTakeFlag" orStateRefundAfterSales="@commodityOrderVM.StateRefundAfterSales" orStateRefund="@commodityOrderVM.StateRefund">
                                                        查看详情</a></div></text>
                                            }
                                            @{                                              
                                            if (commodityOrderVM.IsModifiedPrice == false && commodityOrderVM.SelfTakeFlag == 0)
                                            {
                                                <text>
                                                <div class="spanFreight">
                                                    含运费 @commodityOrderVM.Freight 元
                                                </div></text>
                                            }
                                            }
                                            @if (commodityOrderVM.State == 3 && commodityOrderVM.Commission > decimal.Zero)
                                            {                                             
                                                <text>
                                                <div>
                                                    支付众销佣金 @commodityOrderVM.Commission 元
                                                </div></text>
                                            }
                                            @if (commodityOrderVM.IsCrowdfunding && commodityOrderVM.CfDividend.HasValue && commodityOrderVM.CfDividend.Value > decimal.Zero && commodityOrderVM.State != 0 && commodityOrderVM.State != 11)
                                            {
                                                decimal cfdividend = commodityOrderVM.CfDividend.HasValue ? commodityOrderVM.CfDividend.Value : 0.0m;
                                                <text>
                                                <div>
                                                    支付众筹佣金 @string.Format("{0:0.00#}", cfdividend) 元
                                                </div></text>
                                            }
                                            @if (commodityOrderVM.SpreadGold > decimal.Zero)
                                            { 
                                                <text>
                                                <div style="display: block;">
                                                    推广者分成 @string.Format("{0:0.00#}", (decimal)commodityOrderVM.SpreadGold / 1000)
                                                    元
                                                </div></text>
                                            }
                                            @if (commodityOrderVM.OwnerShare > decimal.Zero)
                                            { 
                                                <text>
                                                <div style="display: block;">
                                                    应用主分成 @string.Format("{0:0.00#}", commodityOrderVM.OwnerShare)
                                                    元
                                                </div></text>
                                            }
                                            @{                                              
                                            if (commodityOrderVM.State == 7)
                                            {
                                                <text><div>
                                                    退款金额 @commodityOrderVM.RefundMoney 元</div>
                                                </text>
                                            }
                                            else if (commodityOrderVM.State == 3 && commodityOrderVM.StateAfterSales == 7)
                                            {                                              
                                                <text><div>
                                                    退款金额 @commodityOrderVM.RefundMoney 元</div>
                                                </text>
                                            }
                                            
                                            }
                                        </div>
                                    </td>
                                    <td style="text-align: center; width:150px;" rowspan="@count"class="left_border">
                                        @if (commodityOrderVM.SellersRemark == null)
                                        {
		 
                                            
                                            <text><a href="javascript:;" id="addSellersRemark" onclick="SetSellersRemark(this,'@commodityOrderVM.CommodityOrderId','')">添加</a></text>
                                            <div id="divSellersRemarks" style="display: none; width: 145px; overflow-x: hidden;
                                                overflow-y: auto; word-wrap: break-word; word-break: break-all;">
                                                <span id="showSellersRemark">@System.Web.HttpContext.Current.Server.UrlDecode(commodityOrderVM.SellersRemark)</span>
                                                <br />
                                                <text><a href="javascript:;" id="updateSellersRemark" onclick="SetSellersRemark(this,'@commodityOrderVM.CommodityOrderId','@commodityOrderVM.SellersRemark')">修改</a>&nbsp;&nbsp;&nbsp;<a href="#" id="delSellersRemark" onclick="delSellersRemark(this,'@commodityOrderVM.CommodityOrderId')">删除</a></text>
                                            </div>
                            
                                        }
                                        else
                                        {
                                            <text><a href="javascript:;" id="addSellersRemark" style=" display:none;" onclick="SetSellersRemark(this,'@commodityOrderVM.CommodityOrderId','')">添加</a></text>
                                            <div id="divSellersRemarks" style="width: 145px; overflow-x: hidden; overflow-y: auto;
                                                word-wrap: break-word; word-break: break-all;">
                                                <span id="showSellersRemark">@System.Web.HttpContext.Current.Server.UrlDecode(commodityOrderVM.SellersRemark)</span>
                                                <br />
                                                <text><a href="javascript:;" id="updateSellersRemark" onclick="SetSellersRemark(this,'@commodityOrderVM.CommodityOrderId','@commodityOrderVM.SellersRemark')">修改</a>&nbsp;&nbsp;&nbsp;<a href="#" id="delSellersRemark" onclick="delSellersRemark(this,'@commodityOrderVM.CommodityOrderId')">删除</a></text>
                                            </div>
                                        }
                                    </td>
                                    <td align="center" rowspan="@count" class="right_sep">
                                    </td>
                                }
                            </tr>
                                }
                            }
                            <tr class="sep-row">
                                <td colspan="8">
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="tanchu" id="div3">
            <div>
                <div class="tanchu_r">
                    <p class="color ty" style="display: none;">
                        买家已付款，请确定协商无误后再执行该操作！</p>
                    <p>
                        请填写取消订单原因：</p>
                    <textarea rows="5" cols="10" id="Content" style="border: 1px solid #B8BFCF; width: 95%;
                        margin-left: 10px; height: 160px;"></textarea>
                    <div class="contentwordage" style="text-align: right; font-size: 10px; color: red;
                        margin-right: 10px;">
                        还能输入150个字</div>
                    <div style="text-align: center;">
                        <button class="an1">
                            确定</button>
                        <button onclick="closeTip()">
                            取消</button></div>
                </div>
            </div>
            <div class="shut" onclick="closeTip()">
                <img src="/images/shut.png" alt="" width="7" height="7" />
            </div>
        </div>
        <div class="tanchu" id="popupExportData">
            <div class="tanchu_r">
                <br />
                <span>&nbsp;&nbsp;&nbsp;订单状态：</span>
                <br />
                <div>
                    &nbsp;&nbsp;<select id="selState" style="width: 130px; height: 27px; line-height: 27px;
                        color: #8c94a9">
                        <option value="">全部</option>
                        <option value="0">待付款</option>
                        <option value="1,11">待发货</option>
                        <option value="13">出库中</option>
                        <option value="2">已发货</option>
                        <option value="8,9,10,12,14">退款中</option>
                        <option value="7">已退款</option>
                        <option value="3">交易成功</option>
                        <option value="4,5,6">交易失败</option>
                        <option value="99">待自提</option>
                        <option value="100">售后完毕</option>
                    </select>
                </div>
                <br />
                <span>&nbsp;&nbsp;&nbsp;请设置导出订单时间范围：</span>
                <br />
                <div>
                    <input type="text" id="StartTime" class="inp-txt" style="width: 120px;" />
                    <strong style="font-weight: normal;">-</strong>
                    <input type="text" id="EndTime" class="inp-txt" style="width: 120px;" />
                </div>
                <br />
                <div>
                    <input type="radio" name="ExportType" value="word" style="width: 50px; height: 10px;" />导出Word
                    &nbsp;&nbsp;<input type="radio" name="ExportType" value="excel" checked="checked"
                        style="width: 50px; height: 10px;" />导出Excel
                </div>
                <br />
                <div style="text-align: center;">
                    <button onclick="closeExport()">
                        取消</button>
                    &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
                    <button onclick="ExportData()" id="btnExportData">
                        确定</button>
                </div>
                <div class="shut" onclick="closeExport()">
                    <img src="/images/shut.png" alt="" width="7" height="7" />
                </div>
                <p id="ExportError" style="color: Red;">
                </p>
            </div>
        </div>
        <div class="tanchu" id="divSellersRemark">
            <div>
                <div class="tanchu_r">
                    <p>
                        请填写卖家备注信息：</p>
                    <textarea rows="5" cols="10" id="SellersRemarkContent" style="border: 1px solid #B8BFCF;
                        width: 95%; margin-left: 10px; height: 160px;"></textarea>
                    <div class="SellersRemarkcontentwordage" style="text-align: right; font-size: 10px;
                        color: red; margin-right: 10px;">
                        还可以输入140个字</div>
                    <div style="text-align: center;">
                        <button id="btnSellersRemarkOk" onclick="SellersRemarkOK()">
                            确定</button>
                        <button onclick="closeSellersRemarkTip()">
                            取消</button></div>
                </div>
            </div>
            <div class="shut" onclick="closeSellersRemarkTip()">
                <img src="/images/shut.png" alt="" width="7" height="7" />
            </div>
        </div>
        <div class="tanchu" id="refund" style="width: 600px; height: 535px; position: relative;">
            <input id="hiddorid" type="hidden" />
            <input id="hiddstate" type="hidden" />
            <input id="hiddpayment" type="hidden" />
            <input id="hiddretype" type="hidden" />
            <input id="hiddorAfState" type="hidden" />
            <input id="hiddSelfTakeFlag" type="hidden" />
            <input id="hiddorStateRefundAfterSales" type="hidden" />
            <input id="hiddorStateRefund" type="hidden" />
            <div style="width: 590px; height: 490px; position: relative;">
                <div style="position: absolute; right: 4px; top: 4px;" onclick="closeTiporder()">
                    <img src="/images/shut.png" alt="" width="7" height="7" />
                </div>
                <div style="width: 570px; height: 490px; overflow: auto;">
                    <div id="refundNow">
                        <div class="tanchu_r" style="border: 1px solid #ccc; margin: 5px; width: auto; padding-bottom: 5px;">
                            <div class="divliu dxq_title" style="margin: 10px 0px 0px 20px; display: none; height: 34px;">
                                <span class="on">客户申请退款/退货 </span><span class="xian"></span><span class="on">处理申请</span>
                                <span class="xian"></span><span class="tw">等待客户发货 </span>
                            </div>
                            <div style="padding-left: 15px; font-size: 12px;">
                                <div style="margin-bottom: 10px;">
                                    <p class="color restate">
                                    </p>
                                </div>
                                <div>
                                    <table style="color: Black; line-height: 28px;" cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td class="runw" style="height: auto;">
                                                <span>退款原因：</span>
                                            </td>
                                            <td style="height: auto;">
                                                <span class="reseason"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="runw" style="height: auto;">
                                                <span>退款金额：</span>
                                            </td>
                                            <td style="height: auto;">
                                                <span class="remoney"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="runw" style="height: auto;">
                                                <span>退款说明：</span>
                                            </td>
                                            <td style="height: auto;">
                                                <span class="redesc"></span>
                                            </td>
                                        </tr>
                                        <tr class="tpiz">
                                            <td class="runw">
                                                <span>凭证：</span>
                                            </td>
                                            <td>
                                                <div id="images" class="reimg">
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                    <div id="ghcApplyTimer" class="timeClass">
                                    </div>
                                    <p class="color">
                                        您可通过线下与客户沟通，由客户撤销退款申请</p>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center; width: auto; height: auto;" class="tanchu_r">
                            <button class="an1" id="btnrun">
                                确定</button>
                            <button class="an1" id="btnCancel" style="display: none;">
                                取消</button><span class="spalert color"></span> <span class="spalert color"></span>
                        </div>
                    </div>
                    @*               <div class="u-refund" id="ghc2">
                </div>*@
                    <div id="ghc2" style="clear: both; position: relative; margin: 0 auto; margin-top: 20px;
                        font-size: 12px; color: #858585; line-height: 26px;">
                    </div>
                </div>
            </div>
            <div id="ghc3" style="margin-top: 5px;">
                点击查看更多</div>
        </div>
        <div class="tanchu" id="baorefund" style="height: 340px; width: 435px;">
            <div>
                <div class="tanchu_r">
                    <div class="spfb_t_l" style="font-size: 14px; margin-top: 40px;">
                        <p class="color" style="margin-left: 99px; display: none;" id="tuierrorInfo">
                        </p>
                        <table style="color: Black;">
                            <tr>
                                <td class="brunw">
                                    <span>退款收款人账户：</span>
                                </td>
                                <td>
                                    <input type="text" id="txtReceiverAccount" class="txtColor" maxlength="30" />
                                </td>
                            </tr>
                            <tr>
                                <td class="brunw">
                                    <span>收款人姓名：</span>
                                </td>
                                <td>
                                    <input type="text" id="txtReceiver" class="txtColor" maxlength="30" />
                                </td>
                            </tr>
                            <tr>
                                <td class="brunw">
                                    <span>退款金额 ：</span>
                                </td>
                                <td>
                                    <input type="text" id="txtRefundMoney" class="txtColor" maxlength="30" />
                                </td>
                            </tr>
                            <tr style="display: none;">
                                <td class="brunw">
                                    <span>备注：</span>
                                </td>
                                <td>
                                    <input type="text" id="txtRefundDesc" class="txtColor" maxlength="30" />
                                </td>
                            </tr>
                        </table>
                        <p class="color">
                        </p>
                    </div>
                    <div style="text-align: center;">
                        <button class="an1" id="btnbaorun">
                            确定</button>
                        <button onclick="closebtnbaorun()">
                            取消</button></div>
                </div>
            </div>
            <div class="shut" onclick="closebtnbaorun()">
                <img src="/images/shut.png" alt="" width="7" height="7" />
            </div>
        </div>
        <div class="tanchu" id="shipWin" style="height: 340px; width: 485px;">
            <div>
                <div class="tanchu_r">
                    <div class="spfb_t_l" style="font-size: 14px; margin-top: 40px;">
                        <p class="color" style="margin-left: 99px; display: none;" id="errorInfo">
                            &nbsp;
                        </p>
                        <table style="color: Black;">
                            <tr>
                                <td class="brunw" style="width: 200px;">
                                    <span style="display: none;" id="shipOrderId"></span><span>请选择物流公司：</span>
                                </td>
                                <td>
                                    <select id="expSelect" style="width: 182px; height: 27px; line-height: 27px; color: #8c94a9;
                                        margin-left: 10px;">
                                        <option value="0">请选择</option>
                                        <option value="13">申通快递</option>
                                        <option value="2">韵达快运</option>
                                        <option value="3">圆通速递</option>
                                        <option value="4">中通快递</option>
                                        <option value="5">顺丰速运</option>
                                        <option value="6">百世汇通</option>
                                        <option value="7">天天快递</option>
                                        <option value="8">EMS</option>
                                        <option value="9">宅急送</option>
                                        <option value="10">中国邮政</option>
                                        <option value="11">德邦</option>
                                        <option value="12">全峰快递</option>
                                        <option value="14">快捷快递</option>
                                        <option value="15">京东快递</option>
                                        <option value="1">其他物流公司</option>
                                    </select>
                                </td>
                            </tr>
                            <tr class="qtwu" style="display: none;">
                                <td class="brunw" style="width: 200px;">
                                    @*<input type="checkbox" id="shipExpCheck" style="width: 15px; vertical-align: inherit;" />*@
                                    <span style="margin-left: 0px;">其他物流公司：</span>
                                </td>
                                <td>
                                    <input type="text" id="txtShipExp" class="txtColor" maxlength="30" />
                                </td>
                            </tr>
                            <tr>
                                <td class="brunw" style="width: 200px;">
                                    <span>请填写快递单号：</span>
                                </td>
                                <td>
                                    <input type="text" id="txtExpOrderNo" class="txtColor" maxlength="30" />
                                </td>
                            </tr>
                        </table>
                        <p class="color" style="margin-left: 99px;">
                            请正确填写，以方便客户及时跟踪物流信息
                        </p>
                    </div>
                    <div style="text-align: center;">
                        <button class="an1" id="btnShip" onclick="shipUpdataOrder()">
                            确定</button>
                        <button onclick="closebtnShip()">
                            取消</button></div>
                </div>
            </div>
            <div class="shut" onclick="closebtnShip()">
                <img src="/images/shut.png" alt="" width="7" height="7" />
            </div>
        </div>
        <div class="tanchu" id="trefundexp" style="height: 300px; width: 500px;">
            <input id="thiddoridexp" type="hidden" />
            <input id="thstate" type="hidden" />
            <input id="thiddpayment" type="hidden" />
            <input id="thiddorAfState" type="hidden" />
            <div>
                <div class="tanchu_r">
                    <div style="padding-left: 15px; font-size: 14px;">
                        <p class="color restate">
                        </p>
                        <div style="font-size: 26px; line-height: 28px; text-align: center; margin-bottom: 30px;">
                            退货物流信息</div>
                        <table style="color: Black;">
                            <tr>
                                <td class="runw">
                                    <span>物流公司：</span>
                                </td>
                                <td>
                                    <span class="reexpco"></span>
                                </td>
                            </tr>
                            <tr>
                                <td class="runw">
                                    <span>快递单号：</span>
                                </td>
                                <td>
                                    <span class="reorderno"></span>
                                </td>
                            </tr>
                        </table>
                        <div id="ghcLogisticsTimer" class="timeClass" style="margin-top: 0; margin: 10px;">
                        </div>
                        @*   <p class="color">
                        </p>*@
                    </div>
                    <div style="text-align: center;">
                        <button class="an1" id="btnDelayTime" style="width: 140px;">
                            延长收货时间（3天）</button>
                        <button class="an1" id="btnexp">
                            确认收到退货</button>
                        <button class="an1" id="btnrefundReceive">
                            拒绝收货</button><span class="spalert"></span>
                    </div>
                </div>
                <div class="shut" onclick="closeexp()">
                    <img src="/images/shut.png" alt="" width="7" height="7" />
                </div>
            </div>
        </div>
    </div>
    <div id="pager">
    </div>
</div>
<div style="display: none;" class="OrderDetailPar">
    <div id="OrderDetail" style="margin: 0 auto;">
        <iframe id="orderdetailurl" src="" width="1193px;" height="690px" style="margin-bottom: 20px;
            border: 0px;"></iframe>
    </div>
</div>
<div id="OrderRefundAfterSalesListTemplete" style="display: none;">
    <div style="border: 1px solid #ccc; padding: 5px; margin-top: 5px; margin-left: 5px;
        margin-right: 5px; padding-left: 30px;">
        <div>
            <table cellpadding="0" cellspacing="0" style="word-break: break-all;">
                <tr>
                    <td>
                        <div style="width: 100px;">
                            <span>{StateText}：</span></div>
                    </td>
                    <td style="width: 100%;">
                        <div class="{RefuseShow}" style="word-break: break-all;">
                            <span class="RefuseReason">{RefuseReason}</span> <span class="RefuseTime">{RefuseTime}</span>
                        </div>
                        <div class="{RefuseHide}">
                            <span class="ModifiedOn">{ModifiedOn}</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>{RefundTypeText}</span>
                    </td>
                    <td>
                        <span class="SubTime">{SubTime}</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>退款原因：</span>
                    </td>
                    <td>
                        <span class="RefundReason">{RefundReason}</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>退款金额：</span>
                    </td>
                    <td>
                        <span class="RefundMoney">{RefundMoney}</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>退款说明：</span>
                    </td>
                    <td>
                        <span class="RefundDesc">{RefundDesc}</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>凭证：</span>
                    </td>
                    <td>
                        <div class="OrderRefundImgs">
                            {ImgList}
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<div id="RefundDetailTemplete" style="display: none;">
    <div class="item-refund">
        <p>
            <span class="name">{StateText}：</span> <span style="display: {RefuseShow}"><span
                class="conte">{RefuseReason}</span> <span class="date">{RefuseTime}</span> </span>
            <span class="{RefuseHide}"><span class="date">{ModifiedOn}</span> </span>
        </p>
        <p class="reason">
            <span class="liy">{RefundTypeText}</span>{SubTime}
        </p>
        <p class="reason">
            <span class="name">退款原因：</span> <span class="reCont">{RefundReason}</span>
        </p>
        <p class="reason">
            <span class="name">退款金额：</span> <span class="reCont">{RefundMoney}</span>
        </p>
        <p class="reason">
            <span class="name">退款说明：</span> <span class="reCont">{RefundDesc}</span>
        </p>
        <p class="reason">
            <span class="name spacing">凭 证：</span> <span class="reCont">{ImgList} </span>
        </p>
    </div>
</div>
<div id="RefundReasonForm" style="display: none">
    <input type="hidden" id="CommodityOrderIdR" />
    <div style="margin: 0 auto; margin-top: 10px; width: 420px; height: 250px;">
        <table cellpadding="0" cellspacing="0" style="color: Black; font-size: 14px; line-height: 26px;">
            <tr>
                <td>
                    <span>请填写拒绝退款/退货申请原因(140字)：</span>
                </td>
            </tr>
            <tr>
                <td>
                    <textarea rows="2" cols="2" style="width: 400px; height: 200px;" id="RefundReason"></textarea>
                </td>
            </tr>
            <tr>
                <td class="tanchu_r" style="width: auto; height: auto; text-align: center;">
                    <button id="RefundReasonSure">
                        确定</button>
                    <button id="RefundReasonCancel">
                        取消</button>
                </td>
            </tr>
        </table>
    </div>
</div>
<div id="RefundReceiveReasonForm" style="display: none">
    <div style="margin: 0 auto; margin-top: 10px; width: 420px; height: 250px;">
        <table cellpadding="0" cellspacing="0" style="color: Black; font-size: 14px; line-height: 26px;">
            <tr>
                <td>
                    <span>请填写拒绝收货原因(140字)：</span>
                </td>
            </tr>
            <tr>
                <td>
                    <textarea rows="2" cols="2" style="width: 400px; height: 200px;" id="RefundReceiveReason"></textarea>
                </td>
            </tr>
            <tr>
                <td class="tanchu_r" style="width: auto; height: auto; text-align: center;">
                    <button id="RefundReceiveReasonSure">
                        确定</button>
                    <button id="RefundReceiveReasonCancel">
                        取消</button>
                </td>
            </tr>
        </table>
    </div>
</div>
